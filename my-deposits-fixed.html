<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì…ê¸ˆ ë‚´ì—­ - ìŠˆí¼í”Œë ˆì´ìŠ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
        * { font-family: 'Pretendard Variable', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸ’° ë‚´ ì…ê¸ˆ ë‚´ì—­</h1>
            <p class="text-gray-600">í¬ì¸íŠ¸ ì¶©ì „ ì‹ ì²­ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ì‹ ì²­ì¼ì‹œ</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ì…ê¸ˆì•¡</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ì…ê¸ˆìëª…</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ìƒíƒœ</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ì²˜ë¦¬ì¼ì‹œ</th>
                        </tr>
                    </thead>
                    <tbody id="depositList" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                ë¡œë”© ì¤‘...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mt-6">
            <a href="/dashboard" class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium">
                â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>
    </div>

    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user || !user.id) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = '/login';
        }

        // ì…ê¸ˆ ë‚´ì—­ ë¡œë“œ
        async function loadDeposits() {
            try {
                const response = await fetch(`/api/my-deposits?userId=${user.id}`);
                const data = await response.json();
                
                const tbody = document.getElementById('depositList');
                
                if (data.success && data.deposits && data.deposits.length > 0) {
                    tbody.innerHTML = data.deposits.map(deposit => {
                        const statusMap = {
                            'pending': '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">ëŒ€ê¸°ì¤‘</span>',
                            'approved': '<span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">ìŠ¹ì¸ì™„ë£Œ</span>',
                            'rejected': '<span class="px-3 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">ê±°ì ˆë¨</span>'
                        };
                        
                        return `
                            <tr>
                                <td class="px-6 py-4 text-sm text-gray-900">${new Date(deposit.created_at).toLocaleString('ko-KR')}</td>
                                <td class="px-6 py-4 text-sm font-semibold text-gray-900">${deposit.amount.toLocaleString()}ì›</td>
                                <td class="px-6 py-4 text-sm text-gray-600">${deposit.depositor_name || '-'}</td>
                                <td class="px-6 py-4">${statusMap[deposit.status] || deposit.status}</td>
                                <td class="px-6 py-4 text-sm text-gray-600">${deposit.processed_at ? new Date(deposit.processed_at).toLocaleString('ko-KR') : '-'}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                                ì…ê¸ˆ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                            </td>
                        </tr>
                    `;
                }
            } catch (err) {
                console.error('ì…ê¸ˆ ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨:', err);
                document.getElementById('depositList').innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-12 text-center text-red-500">
                            ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadDeposits();
    </script>
</body>
</html>
