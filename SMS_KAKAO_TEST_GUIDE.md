# SMS & μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅ λ°μ†΅ ν…μ¤νΈ κ°€μ΄λ“

## π― ν…μ¤νΈ λ©ν‘
- SMS λ°μ†΅ κΈ°λ¥ κ²€μ¦
- μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅ λ°μ†΅ κΈ°λ¥ κ²€μ¦
- ν¬μΈνΈ μ°¨κ° λ° ν™λ¶ λ΅μ§ κ²€μ¦
- μ•λ¦¬κ³  API μ—°λ™ ν™•μΈ

---

## β οΈ μ‚¬μ „ μ¤€λΉ„μ‚¬ν•­

### 1. **μ•λ¦¬κ³  IP ν™”μ΄νΈλ¦¬μ¤νΈ μ„¤μ •** (ν•„μ)
- κ°€μ΄λ“: `ALIGO_IP_SETUP.md` μ°Έκ³ 
- ν„μ¬ μƒνƒ: β IP μΈμ¦ μ¤λ¥ λ°μƒ μ¤‘
- ν•΄κ²° λ°©λ²•: μ•λ¦¬κ³  κ΄€λ¦¬μ νμ΄μ§€μ—μ„ "λ¨λ“  IP ν—μ©" μ„¤μ •

### 2. **λ°μ‹ λ²νΈ λ“±λ΅ ν™•μΈ**
```bash
# λ“±λ΅λ λ°μ‹ λ²νΈ ν™•μΈ
curl "http://localhost:3000/api/sms/senders?userId=1" | python3 -m json.tool

# μμƒ κ²°κ³Ό:
# {
#     "success": true,
#     "senders": [
#         {
#             "phone_number": "01087399697",
#             "status": "verified"
#         }
#     ]
# }
```

### 3. **ν¬μΈνΈ μ”μ•΅ ν™•μΈ**
```bash
# ν„μ¬ μ”μ•΅ μ΅°ν
curl "http://localhost:3000/api/users/1/points" | python3 -m json.tool

# ν¬μΈνΈ λ¶€μ΅± μ‹ μ¶©μ „ (ν…μ¤νΈμ©)
npx wrangler d1 execute webapp-production --local \
  --command="UPDATE users SET balance = 100000 WHERE id = 1"
```

---

## π“± SMS λ°μ†΅ ν…μ¤νΈ

### **ν…μ¤νΈ 1: SMS λ‹¨λ¬Έ (90λ°”μ΄νΈ μ΄ν•)**

```bash
curl -X POST "http://localhost:3000/api/sms/send" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "senderId": 1,
    "receivers": [
      {"name": "ν™κΈΈλ™", "phone": "01087399697"}
    ],
    "message": "μ•λ…•ν•μ„Έμ”! SMS ν…μ¤νΈ λ©”μ‹μ§€μ…λ‹λ‹¤.",
    "testMode": false
  }' | python3 -m json.tool
```

**μμƒ κ²°κ³Ό:**
```json
{
    "success": true,
    "message": "SMS 1κ±΄μ΄ λ°μ†΅λμ—μµλ‹λ‹¤.",
    "balance": 99980,
    "cost": 20,
    "msgId": "123456789"
}
```

**ν¬μΈνΈ μ°¨κ°:** 20P (SMS 1κ±΄)

---

### **ν…μ¤νΈ 2: LMS μ¥λ¬Έ (90λ°”μ΄νΈ μ΄κ³Ό)**

```bash
curl -X POST "http://localhost:3000/api/sms/send" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "senderId": 1,
    "receivers": [
      {"name": "κΉ€μ² μ", "phone": "01087399697"}
    ],
    "message": "μ•λ…•ν•μ„Έμ”! μ°λ¦¬λ”μνΌν”λ μ΄μ¤λ‹¤ ν•™μ› λ§μΌ€ν… κµμ΅ ν”λ«νΌμ…λ‹λ‹¤. λ„¤μ΄λ²„ ν”λ μ΄μ¤ μƒμ„λ…Έμ¶, λΈ”λ΅κ·Έ λ§μΌ€ν…, νΌλ„ λ§μΌ€ν… κµμ΅μ„ μ κ³µν•©λ‹λ‹¤. μ „κµ­ ν•™μ›μ¥λ‹λ“¤κ³Ό ν•¨κ» μ„±μ¥ν•λ” κµμ΅ μ»¤λ®¤λ‹ν‹°μ— μ°Έμ—¬ν•μ„Έμ”!",
    "testMode": false
  }' | python3 -m json.tool
```

**μμƒ κ²°κ³Ό:**
```json
{
    "success": true,
    "message": "LMS 1κ±΄μ΄ λ°μ†΅λμ—μµλ‹λ‹¤.",
    "balance": 99930,
    "cost": 50,
    "msgId": "123456790"
}
```

**ν¬μΈνΈ μ°¨κ°:** 50P (LMS 1κ±΄)

---

### **ν…μ¤νΈ 3: λ‹¤μ μμ‹ μ λ°μ†΅**

```bash
curl -X POST "http://localhost:3000/api/sms/send" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "senderId": 1,
    "receivers": [
      {"name": "ν•™λ¶€λ¨1", "phone": "01012345678"},
      {"name": "ν•™λ¶€λ¨2", "phone": "01023456789"},
      {"name": "ν•™λ¶€λ¨3", "phone": "01034567890"}
    ],
    "message": "#{μ΄λ¦„}λ‹! μμ—… μ‹κ°„μ΄ λ³€κ²½λμ—μµλ‹λ‹¤.",
    "testMode": false
  }' | python3 -m json.tool
```

**μμƒ κ²°κ³Ό:**
```json
{
    "success": true,
    "message": "SMS 3κ±΄μ΄ λ°μ†΅λμ—μµλ‹λ‹¤.",
    "balance": 99870,
    "cost": 60,
    "msgId": "123456791"
}
```

**ν¬μΈνΈ μ°¨κ°:** 60P (SMS 3κ±΄ Γ— 20P)

---

### **ν…μ¤νΈ 4: μμ•½ λ°μ†΅**

```bash
# 10λ¶„ ν›„ μμ•½ λ°μ†΅
RESERVE_TIME=$(date -d "+10 minutes" '+%Y-%m-%d %H:%M:%S')

curl -X POST "http://localhost:3000/api/sms/send" \
  -H "Content-Type: application/json" \
  -d "{
    \"userId\": 1,
    \"senderId\": 1,
    \"receivers\": [
      {\"name\": \"μμ•½ν…μ¤νΈ\", \"phone\": \"01087399697\"}
    ],
    \"message\": \"μμ•½ λ°μ†΅ ν…μ¤νΈ λ©”μ‹μ§€μ…λ‹λ‹¤.\",
    \"reserveTime\": \"$RESERVE_TIME\",
    \"testMode\": false
  }" | python3 -m json.tool
```

---

## π’¬ μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅ λ°μ†΅ ν…μ¤νΈ

### **μ‚¬μ „ μ¤€λΉ„: ν…ν”λ¦Ώ λ“±λ΅**

β οΈ **μ¤‘μ”:** μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅μ€ μ‚¬μ „μ— μΉμΈλ ν…ν”λ¦Ώλ§ μ‚¬μ© κ°€λ¥ν•©λ‹λ‹¤.

1. **μ•λ¦¬κ³  κ΄€λ¦¬μ νμ΄μ§€ μ ‘μ†**
   - https://smartsms.aligo.in/
   - μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅ β†’ ν…ν”λ¦Ώ κ΄€λ¦¬

2. **ν…ν”λ¦Ώ λ“±λ΅ μμ‹**
   ```
   ν…ν”λ¦Ώλ…: μμ—…κ³µμ§€
   ν…ν”λ¦Ώμ½”λ“: TM001 (μ•λ¦¬κ³ μ—μ„ μλ™ μƒμ„±)
   ν…ν”λ¦Ώλ‚΄μ©:
   μ•λ…•ν•μ„Έμ”, #{ν•™μ›λ…}μ…λ‹λ‹¤.
   #{ν•™μƒλ…}λ‹μ λ‹¤μ μμ—… μΌμ •μ„ μ•λ‚΄λ“λ¦½λ‹λ‹¤.
   μΌμ‹: #{μμ—…μΌμ‹}
   μ¥μ†: #{μμ—…μ¥μ†}
   κ°μ‚¬ν•©λ‹λ‹¤.
   ```

3. **μΉμΈ λ€κΈ°**
   - ν…ν”λ¦Ώ κ²€μλ” λ³΄ν†µ 1-2μΌ μ†μ”
   - μΉμΈ μ™„λ£ ν›„ ν…ν”λ¦Ώ μ½”λ“ ν™•μΈ

---

### **ν…μ¤νΈ 5: μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅ λ°μ†΅**

```bash
curl -X POST "http://localhost:3000/api/kakao/send" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "senderKey": "ad62ec244b84e0dee23c850772aa0e784a78a16f",
    "templateCode": "TM001",
    "receivers": [
      {
        "name": "ν™κΈΈλ™",
        "phone": "01087399697",
        "variables": {
          "ν•™μ›λ…": "μνΌν”λ μ΄μ¤",
          "ν•™μƒλ…": "ν™κΈΈλ™",
          "μμ—…μΌμ‹": "2026λ…„ 1μ›” 15μΌ μ¤ν›„ 2μ‹",
          "μμ—…μ¥μ†": "λ³Έκ΄€ 201νΈ"
        }
      }
    ],
    "failover": "Y",
    "failoverSms": "μμ—… μΌμ • μ•λ‚΄μ…λ‹λ‹¤.",
    "testMode": false
  }' | python3 -m json.tool
```

**μμƒ κ²°κ³Ό:**
```json
{
    "success": true,
    "message": "μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅ 1κ±΄μ΄ λ°μ†΅λμ—μµλ‹λ‹¤.",
    "balance": 99855,
    "cost": 15,
    "msgId": "KA123456"
}
```

**ν¬μΈνΈ μ°¨κ°:** 15P (μ•λ¦Όν†΅ 1κ±΄)

**failover μµμ…:**
- `Y`: μ•λ¦Όν†΅ μ‹¤ν¨ μ‹ SMSλ΅ λ€μ²΄ λ°μ†΅
- `N`: μ‹¤ν¨ μ‹ μ¬μ‹λ„ μ—†μ

---

## π“ λ°μ†΅ λ‚΄μ—­ ν™•μΈ

### **SMS λ°μ†΅ λ‚΄μ—­**
```bash
curl "http://localhost:3000/api/sms/logs?userId=1&page=1&limit=10" | python3 -m json.tool
```

### **μΉ΄μΉ΄μ¤ν†΅ λ°μ†΅ λ‚΄μ—­**
```bash
curl "http://localhost:3000/api/kakao/logs?userId=1&page=1&limit=10" | python3 -m json.tool
```

### **ν¬μΈνΈ κ±°λ λ‚΄μ—­**
```bash
curl "http://localhost:3000/api/point-transactions/1?limit=10" | python3 -m json.tool
```

---

## π” μƒμ„Έ κ²°κ³Ό μ΅°ν

### **μ•λ¦¬κ³  μ „μ†΅κ²°κ³Ό μƒμ„Έ μ΅°ν**
```bash
# msg_idλ΅ μμ‹ μλ³„ λ°μ†΅ μƒνƒ ν™•μΈ
curl -X POST "https://apis.aligo.in/sms_list/" \
  --data-urlencode "key=4bbi3l27pb5qh11tkujl578bttz6vb5j" \
  --data-urlencode "user_id=wangholy" \
  --data-urlencode "mid=123456789" \
  --data-urlencode "page=1" | python3 -m json.tool
```

**κ²°κ³Ό μμ‹:**
```json
{
    "result_code": 1,
    "message": "success",
    "list": [
        {
            "mdid": "987654321",
            "type": "SMS",
            "sender": "01087399697",
            "receiver": "01012345678",
            "sms_state": "λ°μ†΅μ™„λ£",
            "send_date": "2026-01-14 12:32:41"
        }
    ]
}
```

---

## β… ν…μ¤νΈ μ²΄ν¬λ¦¬μ¤νΈ

### **SMS ν…μ¤νΈ**
- [ ] λ‹¨λ¬Έ SMS λ°μ†΅ (90λ°”μ΄νΈ μ΄ν•)
- [ ] μ¥λ¬Έ LMS λ°μ†΅ (90λ°”μ΄νΈ μ΄κ³Ό)
- [ ] λ‹¤μ μμ‹ μ λ°μ†΅
- [ ] μμ•½ λ°μ†΅
- [ ] μΉν™ λ³€μ (#{μ΄λ¦„}) ν…μ¤νΈ
- [ ] ν¬μΈνΈ μ°¨κ° ν™•μΈ
- [ ] λ°μ†΅ μ‹¤ν¨ μ‹ ν™λ¶ ν™•μΈ

### **μΉ΄μΉ΄μ¤ν†΅ μ•λ¦Όν†΅ ν…μ¤νΈ**
- [ ] ν…ν”λ¦Ώ λ“±λ΅ λ° μΉμΈ
- [ ] μ•λ¦Όν†΅ λ°μ†΅
- [ ] ν…ν”λ¦Ώ λ³€μ μΉν™
- [ ] failover (SMS λ€μ²΄λ°μ†΅) ν…μ¤νΈ
- [ ] ν¬μΈνΈ μ°¨κ° ν™•μΈ

### **ν†µν•© ν…μ¤νΈ**
- [ ] ν¬μΈνΈ κ±°λ λ‚΄μ—­ μ΅°ν
- [ ] λ°μ†΅ λ‚΄μ—­ μ΅°ν
- [ ] ν†µκ³„ ν™•μΈ (μ„±κ³µ/μ‹¤ν¨ κ±΄μ)

---

## π› λ¬Έμ  ν•΄κ²°

### **λ¬Έμ  1: μΈμ¦μ¤λ¥μ…λ‹λ‹¤.-IP**
- **μ›μΈ:** μ•λ¦¬κ³  IP ν™”μ΄νΈλ¦¬μ¤νΈ λ―Έμ„¤μ •
- **ν•΄κ²°:** `ALIGO_IP_SETUP.md` μ°Έκ³ 

### **λ¬Έμ  2: ν¬μΈνΈκ°€ λ¶€μ΅±ν•©λ‹λ‹¤**
- **μ›μΈ:** μ‚¬μ©μ μ”μ•΅ λ¶€μ΅±
- **ν•΄κ²°:** 
  ```bash
  npx wrangler d1 execute webapp-production --local \
    --command="UPDATE users SET balance = 100000 WHERE id = 1"
  ```

### **λ¬Έμ  3: λ°μ‹ λ²νΈλ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤**
- **μ›μΈ:** λ°μ‹ λ²νΈ λ―Έλ“±λ΅ λλ” λ―ΈμΈμ¦
- **ν•΄κ²°:** μ•λ¦¬κ³  μ‚¬μ΄νΈμ—μ„ λ°μ‹ λ²νΈ λ“±λ΅ λ° μΈμ¦

### **λ¬Έμ  4: ν…ν”λ¦Ώμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤**
- **μ›μΈ:** μΉ΄μΉ΄μ¤ν†΅ ν…ν”λ¦Ώ λ―Έλ“±λ΅
- **ν•΄κ²°:** μ•λ¦¬κ³  μ‚¬μ΄νΈμ—μ„ ν…ν”λ¦Ώ λ“±λ΅ λ° μΉμΈ λ€κΈ°

---

## π“ μ§€μ›

### **μ•λ¦¬κ³  κ³ κ°μ„Όν„°**
- μ „ν™”: 1577-6556
- μ΄λ©”μΌ: cs@aligosoft.com
- μ΄μμ‹κ°„: ν‰μΌ 09:00-18:00

### **μ‹μ¤ν… λ¬Έμ**
- μ½”λ“ μ €μ¥μ†: GitHub
- λ΅κ·Έ ν™•μΈ: `pm2 logs webapp --nostream`

---

IP μ„¤μ •μ΄ μ™„λ£λλ©΄ μ„ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤λ¥Ό μμ„λ€λ΅ μ§„ν–‰ν•΄μ£Όμ„Έμ”! π
