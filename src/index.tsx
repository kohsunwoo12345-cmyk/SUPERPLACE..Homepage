// SUPERPLACE Academy - Complete Restructure 2026 - Dashboard Permission Fix v1.1
import { Hono } from 'hono'
import { cors } from 'hono/cors'
import { getCookie } from 'hono/cookie'
import { serveStatic } from 'hono/cloudflare-workers'
// FIXME: student-routes.ts temporarily disabled due to teacher_classes error
// import studentRoutes from './student-routes'
import studentPages from './student-pages'
import formBuilderRoutes from './form-builder-routes'

type Bindings = {
  DB: D1Database
  R2: R2Bucket
  OPENAI_API_KEY?: string
  OPENAI_BASE_URL?: string
  ALIGO_API_KEY?: string
  ALIGO_USER_ID?: string
  GOOGLE_CLIENT_ID?: string
  KAKAO_JS_KEY?: string
}

const app = new Hono<{ Bindings: Bindings }>()

// Enable CORS for API routes
app.use('/api/*', cors())

// Serve static files
app.use('/static/*', serveStatic({ root: './public' }))

// Mount student management routes
// FIXME: student-routes.tsÏùò /api/studentsÍ∞Ä index.tsxÏùò /api/studentsÎ≥¥Îã§ Ïö∞ÏÑ†ÎêòÏñ¥
// teacher_classes ÏóêÎü¨ Î∞úÏÉù. ÏûÑÏãúÎ°ú Ï£ºÏÑù Ï≤òÎ¶¨ÌïòÍ≥† index.tsxÏùò ÎùºÏö∞Ìä∏Îßå ÏÇ¨Ïö©
// app.route('/', studentRoutes)

// Mount form builder routes (Ìèº ÌÖúÌîåÎ¶ø Î∞è Ï†úÏ∂ú Í¥ÄÎ¶¨)
app.route('/', formBuilderRoutes)

// ========================================
// API Routes
// ========================================

// Î¨∏Ïùò Ï†ëÏàò API
app.post('/api/contact', async (c) => {
  try {
    const { name, email, phone, academy_name, message } = await c.req.json()
    
    // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
    if (!name || !email || !phone || !message) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // DB Ï†ÄÏû•
    const result = await c.env.DB.prepare(`
      INSERT INTO contacts (name, email, phone, academy_name, message)
      VALUES (?, ?, ?, ?, ?)
    `).bind(name, email, phone, academy_name || '', message).run()

    return c.json({ 
      success: true, 
      message: 'Î¨∏ÏùòÍ∞Ä Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§. Îπ†Î•∏ ÏãúÏùº ÎÇ¥Ïóê Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.',
      id: result.meta.last_row_id 
    })
  } catch (err) {
    console.error('Contact submission error:', err)
    return c.json({ success: false, error: 'Î¨∏Ïùò Ï†ëÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÌöåÏõêÍ∞ÄÏûÖ API
app.post('/api/signup', async (c) => {
  try {
    const { email, password, name, phone, academy_name, academy_location } = await c.req.json()
    
    if (!email || !password || !name || !phone || !academy_name) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ïù¥Î©îÏùº Ï§ëÎ≥µ ÌôïÏù∏
    const existing = await c.env.DB.prepare(`
      SELECT id FROM users WHERE email = ?
    `).bind(email).first()

    if (existing) {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Í∞ÄÏûÖÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.' }, 400)
    }

    // ÎπÑÎ∞ÄÎ≤àÌò∏ Ìï¥Ïã± (Ïã§Ï†úÎ°úÎäî bcrypt Îì± ÏÇ¨Ïö© Í∂åÏû•)
    const hashedPassword = password // TODO: Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑúÎäî Ìï¥Ïã± ÌïÑÏöî

    // DB Ï†ÄÏû• (academy_name Ïª¨Îüº Ìè¨Ìï®)
    // ‚úÖ Í∏∞Î≥∏Í∞í: role = 'director' (ÏõêÏû•Îãò)
    // ‚úÖ ÏÑ†ÏÉùÎãòÏúºÎ°ú Îì±Î°ùÌïòÎäî Í≤ÉÏùÄ ÏõêÏû•ÎãòÏù¥ Î≥ÑÎèÑÎ°ú Ï∂îÍ∞ÄÌï¥Ïïº Ìï®
    const result = await c.env.DB.prepare(`
      INSERT INTO users (email, password, name, phone, academy_name, role)
      VALUES (?, ?, ?, ?, ?, 'director')
    `).bind(email, hashedPassword, name, phone, academy_name || '').run()

    return c.json({ 
      success: true, 
      message: 'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
      id: result.meta.last_row_id 
    })
  } catch (err) {
    console.error('Signup error:', err)
    return c.json({ success: false, error: 'ÌöåÏõêÍ∞ÄÏûÖ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// DB Health Check API
app.get('/api/health', async (c) => {
  try {
    // DB Î∞îÏù∏Îî© ÌôïÏù∏
    if (!c.env.DB) {
      return c.json({ 
        success: false, 
        error: 'DB binding not found',
        env_keys: Object.keys(c.env)
      }, 500)
    }

    // Í∞ÑÎã®Ìïú ÏøºÎ¶¨ ÌÖåÏä§Ìä∏
    const testResult = await c.env.DB.prepare('SELECT 1 as test').first()
    
    // users ÌÖåÏù¥Î∏î Íµ¨Ï°∞ ÌôïÏù∏
    const tableInfo = await c.env.DB.prepare(`PRAGMA table_info(users)`).all()
    
    return c.json({ 
      success: true, 
      message: 'DB connection is healthy',
      test_result: testResult,
      users_table_columns: tableInfo.results.map(col => col.name)
    })
  } catch (err) {
    return c.json({ 
      success: false, 
      error: err.message,
      stack: err.stack
    }, 500)
  }
})

// Î°úÍ∑∏Ïù∏ API
app.post('/api/login', async (c) => {
  try {
    // DB Î∞îÏù∏Îî© ÌôïÏù∏
    if (!c.env.DB) {
      return c.json({ 
        success: false, 
        error: 'DB binding not configured. Please check Cloudflare Pages settings.',
        debug: {
          env_keys: Object.keys(c.env),
          has_db: !!c.env.DB
        }
      }, 500)
    }

    const { email, password } = await c.req.json()
    
    if (!email || !password) {
      return c.json({ success: false, error: 'Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // ÏÇ¨Ïö©Ïûê Ï°∞Ìöå (Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïª¨ÎüºÏóê ÎßûÏ∂∞ ÏàòÏ†ï)
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, role, points, academy_name FROM users WHERE email = ? AND password = ?
    `).bind(email, password).first()

    if (!user) {
      return c.json({ success: false, error: 'Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.' }, 401)
    }

    // ÏÑ∏ÏÖò ÏÉùÏÑ±
    const sessionId = crypto.randomUUID()
    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7Ïùº
    
    await c.env.DB.prepare(`
      INSERT INTO sessions (session_id, user_id, expires_at)
      VALUES (?, ?, ?)
    `).bind(sessionId, user.id, expiresAt.toISOString()).run()

    // Ïø†ÌÇ§ ÏÑ§Ï†ï
    c.header('Set-Cookie', `session_id=${sessionId}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=${7 * 24 * 60 * 60}`)

    return c.json({ 
      success: true, 
      message: 'Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ',
      user: { 
        id: user.id, 
        email: user.email, 
        name: user.name, 
        role: user.role, 
        points: user.points || 0,
        academy_name: user.academy_name || '',
        user_type: 'director' // Í∏∞Î≥∏Í∞í (Ïª¥Îüº ÏóÜÏùå)
      }
    })
  } catch (err) {
    console.error('Login error:', err)
    console.error('Login error details:', {
      message: err.message,
      stack: err.stack,
      name: err.name
    })
    return c.json({ 
      success: false, 
      error: 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      debug: {
        error_message: err.message,
        error_name: err.name,
        has_db: !!c.env.DB
      }
    }, 500)
  }
})

// Íµ¨Í∏Ä ÏÜåÏÖú Î°úÍ∑∏Ïù∏ API
app.post('/api/auth/google', async (c) => {
  try {
    const { idToken, email, name, picture } = await c.req.json()
    
    if (!idToken || !email) {
      return c.json({ success: false, error: 'Íµ¨Í∏Ä Ïù∏Ï¶ù Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }

    // Íµ¨Í∏Ä IDÎ°ú ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    let user = await c.env.DB.prepare(`
      SELECT id, email, name, role, points, google_id FROM users WHERE google_id = ?
    `).bind(idToken).first()

    // Ïù¥Î©îÏùºÎ°ú Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Ï°∞Ìöå (Íµ¨Í∏Ä IDÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞)
    if (!user) {
      user = await c.env.DB.prepare(`
        SELECT id, email, name, role, points, google_id FROM users WHERE email = ?
      `).bind(email).first()

      // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÏóêÍ≤å Íµ¨Í∏Ä ID Ïó∞Îèô
      if (user && !user.google_id) {
        await c.env.DB.prepare(`
          UPDATE users SET google_id = ?, profile_image = ?, social_provider = 'google', updated_at = CURRENT_TIMESTAMP WHERE id = ?
        `).bind(idToken, picture || null, user.id).run()
        
        user.google_id = idToken
      }
    }

    // Ïã†Í∑ú ÏÇ¨Ïö©ÏûêÏù∏ Í≤ΩÏö∞
    if (!user) {
      return c.json({ 
        success: false, 
        needsRegistration: true,
        socialData: {
          provider: 'google',
          email: email,
          name: name,
          picture: picture,
          google_id: idToken
        },
        message: 'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
      }, 200)
    }

    return c.json({ 
      success: true, 
      message: 'Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ',
      user: { 
        id: user.id, 
        email: user.email, 
        name: user.name, 
        role: user.role, 
        points: user.points || 0,
        profile_image: user.profile_image
      }
    })
  } catch (err) {
    console.error('Google login error:', err)
    return c.json({ success: false, error: 'Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ ÏÜåÏÖú Î°úÍ∑∏Ïù∏ API
app.post('/api/auth/kakao', async (c) => {
  try {
    const { accessToken, id, email, nickname, profile_image } = await c.req.json()
    
    if (!accessToken || !id) {
      return c.json({ success: false, error: 'Ïπ¥Ïπ¥Ïò§ Ïù∏Ï¶ù Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }

    const kakaoId = String(id)

    // Ïπ¥Ïπ¥Ïò§ IDÎ°ú ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    let user = await c.env.DB.prepare(`
      SELECT id, email, name, role, points, kakao_id FROM users WHERE kakao_id = ?
    `).bind(kakaoId).first()

    // Ïù¥Î©îÏùºÎ°ú Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Ï°∞Ìöå (Ïπ¥Ïπ¥Ïò§ IDÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞)
    if (!user && email) {
      user = await c.env.DB.prepare(`
        SELECT id, email, name, role, points, kakao_id FROM users WHERE email = ?
      `).bind(email).first()

      // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÏóêÍ≤å Ïπ¥Ïπ¥Ïò§ ID Ïó∞Îèô
      if (user && !user.kakao_id) {
        await c.env.DB.prepare(`
          UPDATE users SET kakao_id = ?, profile_image = ?, social_provider = 'kakao', updated_at = CURRENT_TIMESTAMP WHERE id = ?
        `).bind(kakaoId, profile_image || null, user.id).run()
        
        user.kakao_id = kakaoId
      }
    }

    // Ïã†Í∑ú ÏÇ¨Ïö©ÏûêÏù∏ Í≤ΩÏö∞
    if (!user) {
      return c.json({ 
        success: false, 
        needsRegistration: true,
        socialData: {
          provider: 'kakao',
          email: email || '',
          name: nickname || '',
          picture: profile_image || '',
          kakao_id: kakaoId
        },
        message: 'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
      }, 200)
    }

    return c.json({ 
      success: true, 
      message: 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ',
      user: { 
        id: user.id, 
        email: user.email, 
        name: user.name, 
        role: user.role, 
        points: user.points || 0,
        profile_image: user.profile_image
      }
    })
  } catch (err) {
    console.error('Kakao login error:', err)
    return c.json({ success: false, error: 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Ïã§ÏãúÍ∞Ñ Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå API
app.get('/api/users/:id/points', async (c) => {
  try {
    const userId = c.req.param('id')
    
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, points FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    return c.json({ 
      success: true,
      points: user.points || 0,
      user: { id: user.id, email: user.email, name: user.name, points: user.points || 0 }
    })
  } catch (err) {
    console.error('Get points error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω API
app.post('/api/admin/users/:id/password', async (c) => {
  try {
    const userId = c.req.param('id')
    const { newPassword } = await c.req.json()

    if (!newPassword || newPassword.length < 6) {
      return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.' }, 400)
    }

    await c.env.DB.prepare(`
      UPDATE users SET password = ? WHERE id = ?
    `).bind(newPassword, userId).run()

    return c.json({ success: true, message: 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Password change error:', err)
    return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â API
app.put('/api/admin/users/:id/points', async (c) => {
  try {
    const userId = c.req.param('id')
    const { points } = await c.req.json()

    if (!points || points <= 0) {
      return c.json({ success: false, error: 'Ïò¨Î∞îÎ•∏ Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.' }, 400)
    }

    // ÌòÑÏû¨ Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT points FROM users WHERE id = ?
    `).bind(userId).first()

    const newPoints = (user?.points || 0) + points

    // Ìè¨Ïù∏Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE users SET points = ? WHERE id = ?
    `).bind(newPoints, userId).run()

    return c.json({ success: true, message: 'Ìè¨Ïù∏Ìä∏Í∞Ä ÏßÄÍ∏âÎêòÏóàÏäµÎãàÎã§.', newPoints })
  } catch (err) {
    console.error('Points update error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê API
app.put('/api/admin/users/:id/points/deduct', async (c) => {
  try {
    const userId = c.req.param('id')
    const { points } = await c.req.json()

    if (!points || points <= 0) {
      return c.json({ success: false, error: 'Ïò¨Î∞îÎ•∏ Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.' }, 400)
    }

    // ÌòÑÏû¨ Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, points FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    const currentPoints = user?.points || 0
    const newPoints = currentPoints - points

    console.log('Deduct points:', { userId, userName: user.name, currentPoints, deductPoints: points, newPoints })

    // Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê (ÎßàÏù¥ÎÑàÏä§ ÌóàÏö©)
    await c.env.DB.prepare(`
      UPDATE users SET points = ? WHERE id = ?
    `).bind(newPoints, userId).run()

    return c.json({ 
      success: true, 
      message: points + 'PÍ∞Ä Ï∞®Í∞êÎêòÏóàÏäµÎãàÎã§.',
      deductedPoints: points,
      newPoints: newPoints 
    })
  } catch (err) {
    console.error('Points deduct error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©ÏûêÎ°ú Î°úÍ∑∏Ïù∏ API
app.post('/api/admin/login-as/:id', async (c) => {
  try {
    const userId = c.req.param('id')

    // ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, role FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    return c.json({ 
      success: true, 
      message: 'Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ',
      user: { id: user.id, email: user.email, name: user.name, role: user.role }
    })
  } catch (err) {
    console.error('Login as error:', err)
    return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÌöåÏõêÍ∞ÄÏûÖ API
app.post('/api/register', async (c) => {
  try {
    const { email, password, name, phone, academy_name, academy_location, google_id, kakao_id, profile_image, social_provider } = await c.req.json()

    // ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏ (ÏÜåÏÖú Î°úÍ∑∏Ïù∏Ïùò Í≤ΩÏö∞ ÎπÑÎ∞ÄÎ≤àÌò∏ Î∂àÌïÑÏöî)
    if (!email || !name) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // ÏÜåÏÖú Î°úÍ∑∏Ïù∏Ïù¥ ÏïÑÎãå Í≤ΩÏö∞ ÎπÑÎ∞ÄÎ≤àÌò∏ ÌïÑÏàò
    if (!social_provider && !password) {
      return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ïù¥Î©îÏùº Ï§ëÎ≥µ ÌôïÏù∏
    const existingUser = await c.env.DB.prepare(`
      SELECT id FROM users WHERE email = ?
    `).bind(email).first()

    if (existingUser) {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Îì±Î°ùÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.' }, 400)
    }

    // ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±
    // ‚úÖ Í∏∞Î≥∏Í∞í: role = 'director' (ÏõêÏû•Îãò)
    const result = await c.env.DB.prepare(`
      INSERT INTO users (email, password, name, phone, academy_name, role, google_id, kakao_id, profile_image, social_provider)
      VALUES (?, ?, ?, ?, ?, 'director', ?, ?, ?, ?)
    `).bind(
      email, 
      password || 'social_login_' + Date.now(), 
      name, 
      phone || null, 
      academy_name || null,
      google_id || null,
      kakao_id || null,
      profile_image || null,
      social_provider || null
    ).run()

    return c.json({ 
      success: true, 
      message: 'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
      user: { id: result.meta.last_row_id, email, name }
    })
  } catch (err) {
    console.error('Register error:', err)
    return c.json({ success: false, error: 'ÌöåÏõêÍ∞ÄÏûÖ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ========================================
// Helper Functions
// ========================================

/**
 * Íµ¨ÎèÖ ÏÉùÏÑ± Ïãú Í∏∞Î≥∏ Í∂åÌïú ÏûêÎèô Î∂ÄÏó¨
 * @param db - Cloudflare D1 Database
 * @param userId - ÏÇ¨Ïö©Ïûê ID
 */
async function grantDefaultPermissions(db: any, userId: string | number) {
  console.log('[Permissions] Granting default permissions for user:', userId)
  
  // Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Î∂ÄÏó¨Ìï† Í∂åÌïú Î™©Î°ù
  const defaultPermissions = [
    'student_management',    // ÌïôÏÉù Í¥ÄÎ¶¨
    'landing_builder',       // ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞
    'ai_learning_report',    // AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏
    'parent_message',        // ÌïôÎ∂ÄÎ™® Î©îÏãúÏßÄ
    'blog_writer',          // Î∏îÎ°úÍ∑∏ ÏûëÏÑ±
    'search_volume',        // Í≤ÄÏÉâÎüâ Ï°∞Ìöå
    'dashboard_analytics',  // ÎåÄÏãúÎ≥¥Îìú Î∂ÑÏÑù
    'keyword_analyzer',     // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
    'review_template',      // Î¶¨Î∑∞ ÌÖúÌîåÎ¶ø
    'ad_copy_generator',    // Í¥ëÍ≥† Î¨∏Íµ¨ ÏÉùÏÑ±
    'photo_optimizer',      // ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî
    'competitor_analysis',  // Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù
    'blog_checklist',       // Î∏îÎ°úÍ∑∏ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
    'content_calendar',     // ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî
    'consultation_script',  // ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏
    'place_optimization',   // ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî
    'roi_calculator',       // ROI Í≥ÑÏÇ∞Í∏∞
    'sms_sender'           // SMS Î∞úÏÜ°
  ]
  
  let successCount = 0
  let failCount = 0
  
  for (const programKey of defaultPermissions) {
    try {
      // üî• ÏàòÏ†ï: Î®ºÏ†Ä Í∏∞Ï°¥ Í∂åÌïúÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
      const existing = await db.prepare(`
        SELECT id FROM user_permissions 
        WHERE user_id = ? AND program_key = ?
      `).bind(userId, programKey).first()
      
      if (existing) {
        // Í∏∞Ï°¥ Í∂åÌïúÏù¥ ÏûàÏúºÎ©¥ ÌôúÏÑ±ÌôîÎßå
        await db.prepare(`
          UPDATE user_permissions 
          SET is_active = 1, granted_by = 'system'
          WHERE user_id = ? AND program_key = ?
        `).bind(userId, programKey).run()
        console.log(`[Permissions] ‚úÖ Activated: ${programKey}`)
      } else {
        // Í∂åÌïúÏù¥ ÏóÜÏúºÎ©¥ ÏÉàÎ°ú ÏÉùÏÑ±
        await db.prepare(`
          INSERT INTO user_permissions (user_id, program_key, granted_by, is_active, created_at)
          VALUES (?, ?, 'system', 1, datetime('now'))
        `).bind(userId, programKey).run()
        console.log(`[Permissions] ‚úÖ Created: ${programKey}`)
      }
      successCount++
    } catch (err) {
      failCount++
      console.error(`[Permissions] ‚ùå Failed to grant: ${programKey}`, err)
    }
  }
  
  console.log(`[Permissions] Grant complete: ${successCount} success, ${failCount} failed`)
  return { successCount, failCount }
}

// ========================================
// User Permissions API Routes
// ÏÇ¨Ïö©Ïûê Í∂åÌïú ÌôïÏù∏ API
app.get('/api/user/permissions', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // Í¥ÄÎ¶¨ÏûêÎäî Î™®Îì† Í∂åÌïú Î≥¥Ïú†
    const user = await c.env.DB.prepare('SELECT id, role, academy_id FROM users WHERE id = ?').bind(userId).first()
    if (user && user.role === 'admin') {
      return c.json({ 
        success: true, 
        permissions: {
          search_volume: true,
          sms: true,
          sms_sender: true,
          landing_builder: true,
          analytics: true,
          student_management: true,
          ai_learning_report: true,
          parent_message: true,
          blog_writer: true,
          dashboard_analytics: true,
          keyword_analyzer: true,
          review_template: true,
          ad_copy_generator: true,
          photo_optimizer: true,
          competitor_analysis: true,
          blog_checklist: true,
          content_calendar: true,
          consultation_script: true,
          place_optimization: true,
          roi_calculator: true,
          all: true
        }
      })
    }
    
    // üî• Íµ¨ÎèÖÏù¥ ÏûàÎäî ÏÇ¨Ïö©ÏûêÎäî Í∏∞Î≥∏ Í∂åÌïú Ï°∞Ìöå
    const academyId = user?.id || userId
    const subscription = await c.env.DB.prepare(`
      SELECT id FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()
    
    console.log('[Permissions] User:', userId, 'Academy:', academyId, 'Subscription:', subscription?.id || 'none')

    // ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Í∂åÌïú Ï°∞Ìöå
    const permissions = await c.env.DB.prepare(`
      SELECT program_key 
      FROM user_permissions 
      WHERE user_id = ? AND is_active = 1 
      AND (expires_at IS NULL OR expires_at > datetime('now'))
    `).bind(userId).all()

    const permissionMap = {
      search_volume: false,
      sms: false,
      sms_sender: false,
      landing_builder: false,
      analytics: false,
      student_management: false,
      ai_learning_report: false,
      parent_message: false,
      blog_writer: false,
      dashboard_analytics: false,
      keyword_analyzer: false,
      review_template: false,
      ad_copy_generator: false,
      photo_optimizer: false,
      competitor_analysis: false,
      blog_checklist: false,
      content_calendar: false,
      consultation_script: false,
      place_optimization: false,
      roi_calculator: false,
      all: false
    }

    permissions.results.forEach(p => {
      permissionMap[p.program_key] = true
      console.log('[Permissions] Found permission:', p.program_key)
    })
    
    console.log('[Permissions] Final permission map:', permissionMap)

    return c.json({ success: true, permissions: permissionMap })
  } catch (err) {
    console.error('Get user permissions error:', err)
    return c.json({ success: false, error: 'Í∂åÌïú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í∂åÌïú Î∂ÄÏó¨ API
app.post('/api/admin/grant-permission', async (c) => {
  try {
    const body = await c.req.json()
    const { userId, programKey, expiresAt } = body
    const adminId = body.adminId || body.grantedBy // adminId ÎòêÎäî grantedBy Î™®Îëê ÌóàÏö©
    
    if (!userId || !programKey || !adminId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare('SELECT role FROM users WHERE id = ?').bind(adminId).first()
    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // Í∂åÌïú Î∂ÄÏó¨
    await c.env.DB.prepare(`
      INSERT OR REPLACE INTO user_permissions (user_id, program_key, granted_by, is_active, expires_at)
      VALUES (?, ?, ?, 1, ?)
    `).bind(userId, programKey, adminId, expiresAt || null).run()

    return c.json({ success: true, message: 'Í∂åÌïúÏù¥ Î∂ÄÏó¨ÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Grant permission error:', err)
    return c.json({ success: false, error: 'Í∂åÌïú Î∂ÄÏó¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê Í∂åÌïú ÌöåÏàò API
app.post('/api/admin/revoke-permission', async (c) => {
  try {
    const { userId, programKey, adminId } = await c.req.json()
    
    if (!userId || !programKey || !adminId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare('SELECT role FROM users WHERE id = ?').bind(adminId).first()
    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // Í∂åÌïú ÌöåÏàò
    await c.env.DB.prepare(`
      UPDATE user_permissions 
      SET is_active = 0 
      WHERE user_id = ? AND program_key = ?
    `).bind(userId, programKey).run()

    return c.json({ success: true, message: 'Í∂åÌïúÏù¥ ÌöåÏàòÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Revoke permission error:', err)
    return c.json({ success: false, error: 'Í∂åÌïú ÌöåÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê Í∂åÌïú ÏùºÍ¥Ñ ÏóÖÎç∞Ïù¥Ìä∏ API
app.post('/api/admin/update-user-permissions', async (c) => {
  try {
    const { userId, permissions, adminId } = await c.req.json()
    
    if (!userId || !permissions || !adminId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare('SELECT role FROM users WHERE id = ?').bind(adminId).first()
    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // Ìä∏ÎûúÏû≠ÏÖòÏúºÎ°ú ÏùºÍ¥Ñ Ï≤òÎ¶¨
    // 1. Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÏùò Í∏∞Ï°¥ Í∂åÌïú Î™®Îëê ÎπÑÌôúÏÑ±Ìôî
    await c.env.DB.prepare(`
      UPDATE user_permissions 
      SET is_active = 0 
      WHERE user_id = ?
    `).bind(userId).run()

    // 2. ÏÉàÎ°úÏö¥ Í∂åÌïú Ï∂îÍ∞Ä
    let successCount = 0
    for (const programKey of permissions) {
      try {
        await c.env.DB.prepare(`
          INSERT OR REPLACE INTO user_permissions (user_id, program_key, granted_by, is_active)
          VALUES (?, ?, ?, 1)
        `).bind(userId, programKey, adminId).run()
        successCount++
      } catch (err) {
        console.error('Í∂åÌïú Ï∂îÍ∞Ä Ïò§Î•ò:', programKey, err)
      }
    }

    return c.json({ 
      success: true, 
      message: `${successCount}Í∞úÏùò Í∂åÌïúÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.`,
      count: successCount
    })
  } catch (err) {
    console.error('Update permissions error:', err)
    return c.json({ success: false, error: 'Í∂åÌïú ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìñâ API
app.post('/api/admin/run-migration', async (c) => {
  try {
    const { adminId } = await c.req.json()
    
    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare('SELECT role FROM users WHERE id = ?').bind(adminId).first()
    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // user_permissions ÌÖåÏù¥Î∏î Ïû¨ÏÉùÏÑ±
    await c.env.DB.prepare(`DROP TABLE IF EXISTS user_permissions_backup`).run()
    
    // Í∏∞Ï°¥ ÌÖåÏù¥Î∏îÏùÑ Î∞±ÏóÖÏúºÎ°ú Ïù¥Î¶Ñ Î≥ÄÍ≤Ω (Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏùÑ Í≤ΩÏö∞)
    try {
      await c.env.DB.prepare(`ALTER TABLE user_permissions RENAME TO user_permissions_backup`).run()
    } catch (e) {
      // ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Î¨¥Ïãú
      console.log('No existing user_permissions table to backup')
    }
    
    // ÏÉà ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS user_permissions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER NOT NULL,
        program_key TEXT NOT NULL,
        granted_by INTEGER,
        granted_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        expires_at DATETIME,
        is_active INTEGER DEFAULT 1,
        FOREIGN KEY (user_id) REFERENCES users(id),
        FOREIGN KEY (granted_by) REFERENCES users(id),
        UNIQUE(user_id, program_key)
      )
    `).run()
    
    // Ïù∏Îç±Ïä§ ÏÉùÏÑ±
    await c.env.DB.prepare(`CREATE INDEX IF NOT EXISTS idx_user_permissions_user_id ON user_permissions(user_id)`).run()
    await c.env.DB.prepare(`CREATE INDEX IF NOT EXISTS idx_user_permissions_program_key ON user_permissions(program_key)`).run()
    await c.env.DB.prepare(`CREATE INDEX IF NOT EXISTS idx_user_permissions_active ON user_permissions(is_active)`).run()

    return c.json({ success: true, message: 'user_permissions ÌÖåÏù¥Î∏îÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ïû¨ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Migration error:', err)
    return c.json({ success: false, error: 'ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message }, 500)
  }
})

// SMS API Routes
// ========================================

// SMS ÏöîÍ∏àÌëú Ï°∞Ìöå API
app.get('/api/sms/pricing', async (c) => {
  try {
    const pricing = await c.env.DB.prepare(`
      SELECT * FROM sms_pricing ORDER BY wholesale_price ASC
    `).all()

    return c.json({ success: true, pricing: pricing.results })
  } catch (err) {
    console.error('Get SMS pricing error:', err)
    return c.json({ success: false, error: 'SMS ÏöîÍ∏àÌëú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ Î™©Î°ù Ï°∞Ìöå API
app.get('/api/sms/senders', async (c) => {
  try {
    // Ìó§Îçî ÎòêÎäî ÏøºÎ¶¨ ÌååÎùºÎØ∏ÌÑ∞ÏóêÏÑú userId Í∞ÄÏ†∏Ïò§Í∏∞
    const userId = c.req.header('X-User-Id') || c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const senders = await c.env.DB.prepare(`
      SELECT id, phone_number, verification_method, verification_date, status
      FROM sender_ids
      WHERE user_id = ?
      ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ success: true, senders: senders.results })
  } catch (err) {
    console.error('Get senders error:', err)
    return c.json({ success: false, error: 'Î∞úÏã†Î≤àÌò∏ Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ Îì±Î°ù API (ÏïåÎ¶¨Í≥† ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Ïù∏Ï¶ù ÏôÑÎ£å ÌõÑ DBÏóê Ï†ÄÏû•)
app.post('/api/sms/sender/register', async (c) => {
  try {
    const { userId, phoneNumber, verificationMethod } = await c.req.json()
    
    if (!userId || !phoneNumber) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ï†ÑÌôîÎ≤àÌò∏ ÌòïÏãù Í≤ÄÏ¶ù (ÌïòÏù¥Ìîà Ï†úÍ±∞)
    const cleanNumber = phoneNumber.replace(/-/g, '')
    if (!/^01[0-9]{8,9}$/.test(cleanNumber)) {
      return c.json({ success: false, error: 'Ïò¨Î∞îÎ•∏ Ìú¥ÎåÄÌè∞ Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ïù¥ÎØ∏ Îì±Î°ùÎêú Î≤àÌò∏Ïù∏ÏßÄ ÌôïÏù∏
    const existing = await c.env.DB.prepare(`
      SELECT id FROM sender_ids WHERE user_id = ? AND phone_number = ?
    `).bind(userId, cleanNumber).first()
    
    if (existing) {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏ÏûÖÎãàÎã§.' }, 400)
    }

    // DBÏóê Î∞úÏã†Î≤àÌò∏ Îì±Î°ù (ÏïåÎ¶¨Í≥† ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Ïù∏Ï¶ù ÏôÑÎ£åÎêú Î≤àÌò∏)
    const result = await c.env.DB.prepare(`
      INSERT INTO sender_ids (user_id, phone_number, verification_method, status, verification_date)
      VALUES (?, ?, ?, 'verified', CURRENT_TIMESTAMP)
    `).bind(userId, cleanNumber, verificationMethod || 'manual').run()
    
    return c.json({ 
      success: true, 
      message: 'Î∞úÏã†Î≤àÌò∏Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.',
      senderId: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Sender registration error:', err)
    return c.json({ success: false, error: 'Î∞úÏã†Î≤àÌò∏ Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ ÏÇ≠Ï†ú API
app.delete('/api/sms/sender/:senderId', async (c) => {
  try {
    const senderId = c.req.param('senderId')
    const userId = c.req.query('userId')
    
    if (!userId || !senderId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÏùò Î∞úÏã†Î≤àÌò∏Ïù∏ÏßÄ ÌôïÏù∏
    const sender = await c.env.DB.prepare(`
      SELECT id FROM sender_ids WHERE id = ? AND user_id = ?
    `).bind(senderId, userId).first()
    
    if (!sender) {
      return c.json({ success: false, error: 'Î∞úÏã†Î≤àÌò∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    // Î∞úÏã†Î≤àÌò∏ ÏÇ≠Ï†ú
    await c.env.DB.prepare(`
      DELETE FROM sender_ids WHERE id = ? AND user_id = ?
    `).bind(senderId, userId).run()
    
    return c.json({ 
      success: true, 
      message: 'Î∞úÏã†Î≤àÌò∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (err) {
    console.error('Sender delete error:', err)
    return c.json({ success: false, error: 'Î∞úÏã†Î≤àÌò∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// === SMS ÌÖúÌîåÎ¶ø & Ìè¥Îçî Í¥ÄÎ¶¨ API ===

// Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå
app.get('/api/sms/folders', async (c) => {
  try {
    const userId = c.req.query('userId')
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const folders = await c.env.DB.prepare(`
      SELECT * FROM sms_folders WHERE user_id = ? ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ success: true, folders: folders.results })
  } catch (err) {
    console.error('Get folders error:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî ÏÉùÏÑ±
app.post('/api/sms/folders', async (c) => {
  try {
    const { userId, name } = await c.req.json()
    if (!userId || !name) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }

    const result = await c.env.DB.prepare(`
      INSERT INTO sms_folders (user_id, name) VALUES (?, ?)
    `).bind(userId, name).run()

    return c.json({ success: true, folderId: result.meta.last_row_id })
  } catch (err) {
    console.error('Create folder error:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî ÏÇ≠Ï†ú
app.delete('/api/sms/folders/:folderId', async (c) => {
  try {
    const folderId = c.req.param('folderId')
    const userId = c.req.query('userId')

    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // Ìè¥Îçî ÏÜåÏú†Í∂å ÌôïÏù∏
    const folder = await c.env.DB.prepare(`
      SELECT * FROM sms_folders WHERE id = ? AND user_id = ?
    `).bind(folderId, userId).first()

    if (!folder) {
      return c.json({ success: false, error: 'Ìè¥ÎçîÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    // Ìè¥Îçî ÎÇ¥ ÌÖúÌîåÎ¶øÎì§Ïùò folder_idÎ•º NULLÎ°ú Î≥ÄÍ≤Ω
    await c.env.DB.prepare(`
      UPDATE sms_templates SET folder_id = NULL WHERE folder_id = ?
    `).bind(folderId).run()

    // Ìè¥Îçî ÏÇ≠Ï†ú
    await c.env.DB.prepare(`
      DELETE FROM sms_folders WHERE id = ?
    `).bind(folderId).run()

    return c.json({ success: true })
  } catch (err) {
    console.error('Delete folder error:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})

// ÌÖúÌîåÎ¶ø Î™©Î°ù Ï°∞Ìöå
app.get('/api/sms/templates', async (c) => {
  try {
    const userId = c.req.query('userId')
    const folderId = c.req.query('folderId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    let query = 'SELECT * FROM sms_templates WHERE user_id = ?'
    let params = [userId]

    if (folderId) {
      query += ' AND folder_id = ?'
      params.push(folderId)
    } else {
      query += ' AND folder_id IS NULL'
    }

    query += ' ORDER BY updated_at DESC'

    const templates = await c.env.DB.prepare(query).bind(...params).all()

    return c.json({ success: true, templates: templates.results })
  } catch (err) {
    console.error('Get templates error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌÖúÌîåÎ¶ø ÏÉùÏÑ±
app.post('/api/sms/templates', async (c) => {
  try {
    const { userId, folderId, title, message, receivers } = await c.req.json()
    
    if (!userId || !title || !message) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }

    const result = await c.env.DB.prepare(`
      INSERT INTO sms_templates (user_id, folder_id, title, message, receivers)
      VALUES (?, ?, ?, ?, ?)
    `).bind(userId, folderId || null, title, message, receivers || null).run()

    return c.json({ success: true, templateId: result.meta.last_row_id })
  } catch (err) {
    console.error('Create template error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Ï†ÄÏû• Ïã§Ìå®' }, 500)
  }
})

// ÌÖúÌîåÎ¶ø ÏàòÏ†ï
app.put('/api/sms/templates/:templateId', async (c) => {
  try {
    const templateId = c.req.param('templateId')
    const { userId, title, message, folderId } = await c.req.json()

    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // ÌÖúÌîåÎ¶ø ÏÜåÏú†Í∂å ÌôïÏù∏
    const template = await c.env.DB.prepare(`
      SELECT * FROM sms_templates WHERE id = ? AND user_id = ?
    `).bind(templateId, userId).first()

    if (!template) {
      return c.json({ success: false, error: 'ÌÖúÌîåÎ¶øÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    await c.env.DB.prepare(`
      UPDATE sms_templates 
      SET title = ?, message = ?, folder_id = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(title, message, folderId || null, templateId).run()

    return c.json({ success: true })
  } catch (err) {
    console.error('Update template error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø ÏàòÏ†ï Ïã§Ìå®' }, 500)
  }
})

// ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú
app.delete('/api/sms/templates/:templateId', async (c) => {
  try {
    const templateId = c.req.param('templateId')
    const userId = c.req.query('userId')

    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // ÌÖúÌîåÎ¶ø ÏÜåÏú†Í∂å ÌôïÏù∏
    const template = await c.env.DB.prepare(`
      SELECT * FROM sms_templates WHERE id = ? AND user_id = ?
    `).bind(templateId, userId).first()

    if (!template) {
      return c.json({ success: false, error: 'ÌÖúÌîåÎ¶øÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    await c.env.DB.prepare(`
      DELETE FROM sms_templates WHERE id = ?
    `).bind(templateId).run()

    return c.json({ success: true })
  } catch (err) {
    console.error('Delete template error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})

// DB Ï¥àÍ∏∞Ìôî API (ÌÖåÏä§Ìä∏Ïö©)
app.post('/api/init-db', async (c) => {
  try {
    // users ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT UNIQUE NOT NULL,
        name TEXT NOT NULL,
        password TEXT NOT NULL,
        academy_id INTEGER NOT NULL DEFAULT 1,
        role TEXT DEFAULT 'teacher',
        balance INTEGER DEFAULT 0,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()

    // point_transactions ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS point_transactions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER NOT NULL,
        amount INTEGER NOT NULL,
        balance_before INTEGER DEFAULT 0,
        balance_after INTEGER NOT NULL,
        transaction_type TEXT NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id)
      )
    `).run()

    // sender_ids ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS sender_ids (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER NOT NULL,
        phone_number TEXT NOT NULL,
        verification_method TEXT NOT NULL,
        verification_date DATETIME DEFAULT CURRENT_TIMESTAMP,
        status TEXT DEFAULT 'verified',
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id)
      )
    `).run()

    // sms_pricing ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS sms_pricing (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        message_type TEXT NOT NULL,
        price INTEGER NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()

    // Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä (ÏóÜÏúºÎ©¥)
    const existingUser = await c.env.DB.prepare('SELECT id FROM users WHERE id = 1').first()
    if (!existingUser) {
      await c.env.DB.prepare(`
        INSERT INTO users (id, email, name, password, academy_id, role, balance)
        VALUES (1, 'test@test.com', 'ÌÖåÏä§Ìä∏ ÏÇ¨Ïö©Ïûê', 'password', 1, 'teacher', 0)
      `).run()
    }

    // Í∏∞Î≥∏ ÏöîÍ∏à Ï∂îÍ∞Ä (ÏóÜÏúºÎ©¥)
    const existingPricing = await c.env.DB.prepare('SELECT id FROM sms_pricing WHERE message_type = ?').bind('SMS').first()
    if (!existingPricing) {
      await c.env.DB.prepare(`
        INSERT INTO sms_pricing (message_type, price, description)
        VALUES ('SMS', 20, 'Îã®Î¨∏ SMS (90Î∞îÏù¥Ìä∏ Ïù¥Ìïò)'),
               ('LMS', 50, 'Ïû•Î¨∏ SMS (90Î∞îÏù¥Ìä∏ Ï¥àÍ≥º)')
      `).run()
    }

    return c.json({ 
      success: true, 
      message: 'DB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å',
      tables: ['users', 'point_transactions', 'sender_ids', 'sms_pricing']
    })
  } catch (err) {
    console.error('DB Init error:', err)
    return c.json({ success: false, error: 'DB Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ' + err.message }, 500)
  }
})

// üîß Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò API
app.get('/api/db/migrate', async (c) => {
  try {
    console.log('üîß [Migration] Starting database migrations...')
    const results = []
    
    // üî• Í∏¥Í∏â ÏàòÏ†ï: usage_tracking ÌÖåÏù¥Î∏î Ïû¨ÏÉùÏÑ± (FK Ï†úÏïΩ Ï†úÍ±∞)
    try {
      await c.env.DB.prepare(`DROP TABLE IF EXISTS usage_tracking`).run()
      console.log('‚úÖ [Migration] Dropped old usage_tracking table')
      results.push('‚úÖ Dropped old usage_tracking table')
    } catch (e) {
      console.log('‚ö†Ô∏è [Migration] Drop usage_tracking:', e.message)
      results.push('‚ö†Ô∏è Drop failed: ' + e.message.substring(0, 50))
    }
    
    // üî• Í∏¥Í∏â ÏàòÏ†ï: subscriptions ÌÖåÏù¥Î∏îÎèÑ FK ÏóÜÏù¥ Ïû¨ÏÉùÏÑ±
    try {
      await c.env.DB.prepare(`DROP TABLE IF EXISTS subscriptions`).run()
      console.log('‚úÖ [Migration] Dropped old subscriptions table')
      results.push('‚úÖ Dropped old subscriptions table')
    } catch (e) {
      console.log('‚ö†Ô∏è [Migration] Drop subscriptions:', e.message)
      results.push('‚ö†Ô∏è Drop subscriptions failed: ' + e.message.substring(0, 50))
    }
    
    // subscriptions ÌÖåÏù¥Î∏î Ïû¨ÏÉùÏÑ± (FK ÏóÜÏù¥)
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS subscriptions (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_id INTEGER NOT NULL,
          plan_name TEXT NOT NULL,
          plan_price INTEGER NOT NULL DEFAULT 0,
          student_limit INTEGER NOT NULL DEFAULT 30,
          ai_report_limit INTEGER NOT NULL DEFAULT 30,
          landing_page_limit INTEGER NOT NULL DEFAULT 40,
          teacher_limit INTEGER NOT NULL DEFAULT 2,
          subscription_start_date TEXT NOT NULL,
          subscription_end_date TEXT NOT NULL,
          status TEXT DEFAULT 'active',
          payment_method TEXT,
          merchant_uid TEXT,
          imp_uid TEXT,
          created_at TEXT DEFAULT CURRENT_TIMESTAMP,
          updated_at TEXT DEFAULT CURRENT_TIMESTAMP
        )
      `).run()
      console.log('‚úÖ [Migration] Created new subscriptions table (no FK)')
      results.push('‚úÖ Created new subscriptions table (no FK)')
    } catch (e) {
      console.log('‚ö†Ô∏è [Migration] Create subscriptions:', e.message)
      results.push('‚ö†Ô∏è Create subscriptions failed: ' + e.message.substring(0, 50))
    }
    
    // usage_tracking ÌÖåÏù¥Î∏î Ïû¨ÏÉùÏÑ± (FK ÏóÜÏù¥)
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS usage_tracking (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_id INTEGER,
          subscription_id INTEGER,
          current_students INTEGER DEFAULT 0,
          ai_reports_used_this_month INTEGER DEFAULT 0,
          last_ai_report_reset_date TEXT,
          landing_pages_created INTEGER DEFAULT 0,
          current_teachers INTEGER DEFAULT 0,
          sms_sent_this_month INTEGER DEFAULT 0,
          last_sms_reset_date TEXT,
          created_at TEXT DEFAULT CURRENT_TIMESTAMP,
          updated_at TEXT DEFAULT CURRENT_TIMESTAMP
        )
      `).run()
      console.log('‚úÖ [Migration] Created new usage_tracking table (no FK)')
      results.push('‚úÖ Created new usage_tracking table (no FK)')
    } catch (e) {
      console.log('‚ö†Ô∏è [Migration] Create usage_tracking:', e.message)
      results.push('‚ö†Ô∏è Create failed: ' + e.message.substring(0, 50))
    }
    
    // Migration 1: Add academy_id to users table if it doesn't exist
    try {
      await c.env.DB.prepare(`ALTER TABLE users ADD COLUMN academy_id INTEGER DEFAULT 1`).run()
      console.log('‚úÖ [Migration] Added academy_id column to users table')
      results.push('‚úÖ Added academy_id to users')
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] academy_id column in users:', e.message)
      results.push('‚ÑπÔ∏è users.academy_id: ' + e.message.substring(0, 50))
    }
    
    // Migration 2: Set default academy_id for users without it
    try {
      // First, try to update all users with NULL or 0 academy_id
      const updateResult = await c.env.DB.prepare(`UPDATE users SET academy_id = id WHERE academy_id IS NULL OR academy_id = 0`).run()
      console.log('‚úÖ [Migration] Set default academy_id for users (NULL/0):', updateResult.meta.changes)
      results.push('‚úÖ Updated ' + updateResult.meta.changes + ' users with academy_id from NULL/0')
      
      // Also ensure ALL users have academy_id (even if not NULL)
      const updateResult2 = await c.env.DB.prepare(`UPDATE users SET academy_id = id WHERE academy_id IS NULL`).run()
      console.log('‚úÖ [Migration] Double-check academy_id for users:', updateResult2.meta.changes)
      
      // Count users with academy_id
      const countResult = await c.env.DB.prepare(`SELECT COUNT(*) as count FROM users WHERE academy_id IS NOT NULL AND academy_id > 0`).first()
      results.push('‚úÖ Total users with academy_id: ' + (countResult?.count || 0))
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] Failed to set default academy_id:', e.message)
      results.push('‚ÑπÔ∏è Update users: ' + e.message.substring(0, 50))
    }
    
    // Migration 3: Ensure academies table exists
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS academies (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_name TEXT NOT NULL,
          owner_id INTEGER NOT NULL,
          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (owner_id) REFERENCES users(id)
        )
      `).run()
      console.log('‚úÖ [Migration] Created academies table')
      results.push('‚úÖ Created academies table')
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] Academies table:', e.message)
      results.push('‚ÑπÔ∏è academies: ' + e.message.substring(0, 50))
    }
    
    // Migration 4: Check if subscriptions table has user_id (old schema)
    let hasOldSchema = false
    try {
      const testQuery = await c.env.DB.prepare(`SELECT user_id FROM subscriptions LIMIT 1`).first()
      hasOldSchema = true
      console.log('üìã [Migration] Detected OLD subscriptions schema with user_id')
      results.push('üìã Old subscriptions schema detected')
    } catch (e) {
      console.log('üìã [Migration] New subscriptions schema detected (no user_id column)')
      results.push('üìã New subscriptions schema')
    }
    
    // Migration 5: Add academy_id to subscriptions if missing
    try {
      await c.env.DB.prepare(`ALTER TABLE subscriptions ADD COLUMN academy_id INTEGER`).run()
      console.log('‚úÖ [Migration] Added academy_id to subscriptions table')
      results.push('‚úÖ Added academy_id to subscriptions')
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] subscriptions.academy_id:', e.message)
      results.push('‚ÑπÔ∏è subscriptions.academy_id: ' + e.message.substring(0, 50))
    }
    
    // Migration 6: Populate academy_id from user_id if old schema
    if (hasOldSchema) {
      try {
        // Get academy_id from users table and update subscriptions
        const updateResult = await c.env.DB.prepare(`
          UPDATE subscriptions 
          SET academy_id = (SELECT academy_id FROM users WHERE users.id = subscriptions.user_id)
          WHERE academy_id IS NULL
        `).run()
        console.log('‚úÖ [Migration] Populated academy_id in subscriptions:', updateResult.meta.changes)
        results.push('‚úÖ Populated ' + updateResult.meta.changes + ' subscriptions with academy_id from users')
      } catch (e) {
        console.log('‚ö†Ô∏è [Migration] Failed to populate academy_id:', e.message)
        results.push('‚ö†Ô∏è Populate academy_id: ' + e.message.substring(0, 50))
      }
    }
    
    // Migration 7: Add new columns to subscriptions if missing
    const newColumns = [
      { name: 'plan_name', type: 'TEXT', default: "'Ïä§ÌÉÄÌÑ∞ ÌîåÎûú'" },
      { name: 'plan_price', type: 'INTEGER', default: '0' },
      { name: 'student_limit', type: 'INTEGER', default: '30' },
      { name: 'ai_report_limit', type: 'INTEGER', default: '30' },
      { name: 'landing_page_limit', type: 'INTEGER', default: '40' },
      { name: 'teacher_limit', type: 'INTEGER', default: '2' },
      { name: 'subscription_start_date', type: 'TEXT', default: null },
      { name: 'subscription_end_date', type: 'TEXT', default: null },
      { name: 'payment_method', type: 'TEXT', default: null },
      { name: 'merchant_uid', type: 'TEXT', default: null }
    ]
    
    for (const col of newColumns) {
      try {
        const defaultClause = col.default ? ` DEFAULT ${col.default}` : ''
        await c.env.DB.prepare(`ALTER TABLE subscriptions ADD COLUMN ${col.name} ${col.type}${defaultClause}`).run()
        console.log(`‚úÖ [Migration] Added ${col.name} to subscriptions`)
        results.push(`‚úÖ Added subscriptions.${col.name}`)
      } catch (e) {
        // Column already exists, skip
      }
    }
    
    // Migration 8: Populate subscription_start_date and subscription_end_date from start_date/end_date
    if (hasOldSchema) {
      try {
        await c.env.DB.prepare(`
          UPDATE subscriptions 
          SET subscription_start_date = start_date,
              subscription_end_date = end_date
          WHERE subscription_start_date IS NULL
        `).run()
        console.log('‚úÖ [Migration] Migrated date columns')
        results.push('‚úÖ Migrated date columns')
      } catch (e) {
        console.log('‚ÑπÔ∏è [Migration] Date migration:', e.message)
      }
    }
    
    // Migration 9: Ensure usage_tracking table exists
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS usage_tracking (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_id INTEGER,
          subscription_id INTEGER NOT NULL,
          current_students INTEGER DEFAULT 0,
          ai_reports_used_this_month INTEGER DEFAULT 0,
          landing_pages_created INTEGER DEFAULT 0,
          current_teachers INTEGER DEFAULT 0,
          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )
      `).run()
      console.log('‚úÖ [Migration] Created usage_tracking table')
      results.push('‚úÖ Created usage_tracking table')
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] usage_tracking table:', e.message)
      results.push('‚ÑπÔ∏è usage_tracking: ' + e.message.substring(0, 50))
    }
    
    // Migration 10: Add academy_id column to usage_tracking if missing (for old tables)
    try {
      await c.env.DB.prepare(`ALTER TABLE usage_tracking ADD COLUMN academy_id INTEGER`).run()
      console.log('‚úÖ [Migration] Added academy_id to existing usage_tracking table')
      results.push('‚úÖ Added academy_id to usage_tracking')
    } catch (e) {
      console.log('‚ÑπÔ∏è [Migration] usage_tracking.academy_id:', e.message)
      results.push('‚ÑπÔ∏è usage_tracking.academy_id: exists')
    }
    
    // Migration 11: Create usage_tracking for all existing subscriptions without tracking
    try {
      const subsWithoutUsage = await c.env.DB.prepare(`
        SELECT s.id as subscription_id, s.academy_id 
        FROM subscriptions s
        WHERE s.id NOT IN (SELECT COALESCE(subscription_id, 0) FROM usage_tracking)
        AND s.status = 'active'
        AND s.academy_id IS NOT NULL
      `).all()
      
      if (subsWithoutUsage.results && subsWithoutUsage.results.length > 0) {
        let created = 0
        for (const sub of subsWithoutUsage.results) {
          try {
            await c.env.DB.prepare(`
              INSERT INTO usage_tracking (
                academy_id, subscription_id, 
                current_students, ai_reports_used_this_month, 
                landing_pages_created, current_teachers,
                created_at, updated_at
              ) VALUES (?, ?, 0, 0, 0, 0, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
            `).bind(sub.academy_id, sub.subscription_id).run()
            created++
          } catch (insertError) {
            console.log('‚ö†Ô∏è Failed to create usage_tracking for subscription', sub.subscription_id, ':', insertError.message)
          }
        }
        console.log('‚úÖ [Migration] Created usage_tracking for', created, 'subscriptions')
        results.push('‚úÖ Created ' + created + ' usage_tracking records')
      } else {
        results.push('‚ÑπÔ∏è All subscriptions have usage_tracking')
      }
    } catch (e) {
      console.log('‚ö†Ô∏è [Migration] Failed to create usage_tracking:', e.message)
      results.push('‚ö†Ô∏è usage_tracking creation: ' + e.message.substring(0, 50))
    }
    
    return c.json({ 
      success: true, 
      message: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§',
      results: results,
      note: hasOldSchema ? '‚ö†Ô∏è Old schema detected - migrated to new schema' : '‚úÖ Using new schema'
    })
  } catch (err) {
    console.error('‚ùå [Migration] Error:', err)
    return c.json({ success: false, error: 'ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®: ' + err.message }, 500)
  }
})

// Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ API (ÌÖåÏä§Ìä∏Ïö©)
app.post('/api/points/charge', async (c) => {
  try {
    const { userId, amount } = await c.req.json()
    
    if (!userId || !amount) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÏôÄ Ï∂©Ï†Ñ Í∏àÏï°Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    const user = await c.env.DB.prepare('SELECT * FROM users WHERE id = ?').bind(userId).first()
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    const balanceBefore = user.balance || 0

    // Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ
    await c.env.DB.prepare('UPDATE users SET balance = balance + ? WHERE id = ?').bind(amount, userId).run()

    // Í±∞Îûò ÎÇ¥Ïó≠ Í∏∞Î°ù
    await c.env.DB.prepare(`
      INSERT INTO point_transactions (user_id, amount, balance_before, balance_after, transaction_type, description, created_at)
      VALUES (?, ?, ?, ?, 'charge', 'ÌÖåÏä§Ìä∏ Ï∂©Ï†Ñ', CURRENT_TIMESTAMP)
    `).bind(userId, amount, balanceBefore, balanceBefore + amount).run()

    const updatedUser = await c.env.DB.prepare('SELECT balance FROM users WHERE id = ?').bind(userId).first()

    return c.json({ 
      success: true, 
      message: 'Ìè¨Ïù∏Ìä∏Í∞Ä Ï∂©Ï†ÑÎêòÏóàÏäµÎãàÎã§.',
      balance: updatedUser.balance
    })
  } catch (err: any) {
    console.error('Charge points error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ Ïã§Ìå®: ' + err.message }, 500)
  }
})

// SMS Î∞úÏÜ° API (ÌïµÏã¨ Î°úÏßÅ - ÏÑ†Ï∞®Í∞ê ÌõÑÎ∞úÏÜ°)
app.post('/api/sms/send', async (c) => {
  try {
    const { userId, senderId, receivers, message, reserveTime } = await c.req.json()
    
    if (!userId || !senderId || !receivers || !message) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // 1. ÏÇ¨Ïö©Ïûê ÏûîÏï° Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT balance FROM users WHERE id = ?
    `).bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    // 2. Î©îÏãúÏßÄ ÌÉÄÏûÖ Í≤∞Ï†ï (Î∞îÏù¥Ìä∏ Ïàò Í≥ÑÏÇ∞)
    const byteSize = new Blob([message]).size
    let messageType = 'SMS'
    if (byteSize > 90) {
      messageType = 'LMS'
    }
    
    // 3. ÏöîÍ∏à Ï°∞Ìöå
    const pricing = await c.env.DB.prepare(`
      SELECT retail_price FROM sms_pricing WHERE message_type = ?
    `).bind(messageType).first()
    
    if (!pricing) {
      return c.json({ success: false, error: 'SMS ÏöîÍ∏à Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 500)
    }
    
    const costPerMessage = pricing.retail_price
    const totalCost = costPerMessage * receivers.length
    
    // 4. ÏûîÏï° ÌôïÏù∏
    if (user.balance < totalCost) {
      return c.json({ 
        success: false, 
        error: `Ìè¨Ïù∏Ìä∏Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. (ÌïÑÏöî: ${totalCost}P, Î≥¥Ïú†: ${user.balance}P)` 
      }, 400)
    }

    // 5. Ìè¨Ïù∏Ìä∏ ÏÑ†Ï∞®Í∞ê (Ìä∏ÎûúÏû≠ÏÖò ÏãúÏûë)
    const balanceBefor = user.balance
    const balanceAfter = user.balance - totalCost
    
    await c.env.DB.prepare(`
      UPDATE users SET balance = ? WHERE id = ?
    `).bind(balanceAfter, userId).run()
    
    // 6. Ìè¨Ïù∏Ìä∏ Í±∞Îûò ÎÇ¥Ïó≠ Í∏∞Î°ù
    await c.env.DB.prepare(`
      INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description)
      VALUES (?, 'sms_cost', ?, ?, ?, ?)
    `).bind(userId, -totalCost, balanceBefor, balanceAfter, `SMS ${receivers.length}Í±¥ Î∞úÏÜ°`).run()
    
    // 7. Î∞úÏã†Î≤àÌò∏ Ï°∞Ìöå
    const sender = await c.env.DB.prepare(`
      SELECT phone_number FROM sender_ids WHERE id = ? AND user_id = ? AND status = 'verified'
    `).bind(senderId, userId).first()
    
    if (!sender) {
      // Ïã§Ìå® Ïãú Ìè¨Ïù∏Ìä∏ ÌôòÎ∂à
      await c.env.DB.prepare(`
        UPDATE users SET balance = ? WHERE id = ?
      `).bind(balanceBefor, userId).run()
      
      return c.json({ success: false, error: 'Ïù∏Ï¶ùÎêú Î∞úÏã†Î≤àÌò∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    // 8. ÏïåÎ¶¨Í≥† API Ìò∏Ï∂ú (Ïã§Ï†ú Î∞úÏÜ°)
    const aligoApiKey = c.env.ALIGO_API_KEY || '4bbi3l27pb5qh11tkujl578bttz6vb5j'
    const aligoUserId = c.env.ALIGO_USER_ID || 'wangholy'
    
    console.log('Aligo ENV Check:', { 
      hasApiKey: !!c.env.ALIGO_API_KEY, 
      hasUserId: !!c.env.ALIGO_USER_ID,
      apiKeyLength: c.env.ALIGO_API_KEY?.length,
      userId: c.env.ALIGO_USER_ID
    })
    
    const formData = new URLSearchParams()
    formData.append('key', aligoApiKey)
    formData.append('user_id', aligoUserId)
    formData.append('sender', sender.phone_number)
    formData.append('receiver', receivers.map((r: any) => r.phone).join(','))
    formData.append('msg', message)
    formData.append('msg_type', messageType)
    
    if (reserveTime) {
      formData.append('rdate', reserveTime.split('T')[0].replace(/-/g, ''))
      formData.append('rtime', reserveTime.split('T')[1].substring(0, 5).replace(':', ''))
    }
    
    const aligoResponse = await fetch('https://apis.aligo.in/send/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: formData
    })
    
    const aligoResult = await aligoResponse.json()
    
    // 9. Î∞úÏÜ° Í≤∞Í≥º Ï≤òÎ¶¨
    if (aligoResult.result_code === '1') {
      // ÏÑ±Í≥µ: SMS Î°úÍ∑∏ Í∏∞Î°ù
      const logResult = await c.env.DB.prepare(`
        INSERT INTO sms_logs (user_id, sender_id, sender_number, receiver_number, message_type, message_content, byte_size, point_cost, status, alligo_response, alligo_msg_id, reserve_time, sent_at)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'success', ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(
        userId, 
        senderId, 
        sender.phone_number, 
        receivers.map((r: any) => r.phone).join(','),
        messageType,
        message,
        byteSize,
        totalCost,
        JSON.stringify(aligoResult),
        aligoResult.msg_id || null,
        reserveTime || null
      ).run()
      
      // ÏàòÏã†ÏûêÎ≥Ñ ÏÉÅÏÑ∏ Í∏∞Î°ù
      for (const receiver of receivers) {
        const personalizedMessage = message.replace(/#{Ïù¥Î¶Ñ}/g, receiver.name || '')
        await c.env.DB.prepare(`
          INSERT INTO sms_recipients (sms_log_id, receiver_number, receiver_name, message_content, status, sent_at)
          VALUES (?, ?, ?, ?, 'success', CURRENT_TIMESTAMP)
        `).bind(logResult.meta.last_row_id, receiver.phone, receiver.name || null, personalizedMessage).run()
      }
      
      return c.json({ 
        success: true, 
        message: 'Î¨∏Ïûê Î∞úÏÜ°Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
        sentCount: receivers.length,
        totalCost: totalCost,
        remainingBalance: balanceAfter
      })
    } else {
      // Ïã§Ìå®: Ìè¨Ïù∏Ìä∏ ÌôòÎ∂à
      await c.env.DB.prepare(`
        UPDATE users SET balance = ? WHERE id = ?
      `).bind(balanceBefor, userId).run()
      
      await c.env.DB.prepare(`
        INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description)
        VALUES (?, 'refund', ?, ?, ?, ?)
      `).bind(userId, totalCost, balanceAfter, balanceBefor, `SMS Î∞úÏÜ° Ïã§Ìå®Î°ú Ïù∏Ìïú ÌôòÎ∂à`).run()
      
      // Ïã§Ìå® Î°úÍ∑∏ Í∏∞Î°ù
      await c.env.DB.prepare(`
        INSERT INTO sms_logs (user_id, sender_id, sender_number, receiver_number, message_type, message_content, byte_size, point_cost, status, alligo_response)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'failed', ?)
      `).bind(
        userId, 
        senderId, 
        sender.phone_number, 
        receivers.map((r: any) => r.phone).join(','),
        messageType,
        message,
        byteSize,
        totalCost,
        JSON.stringify(aligoResult)
      ).run()
      
      return c.json({ 
        success: false, 
        error: aligoResult.message || 'Î¨∏Ïûê Î∞úÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.',
        aligoError: aligoResult
      }, 400)
    }
  } catch (err) {
    console.error('SMS send error:', err)
    return c.json({ success: false, error: 'Î¨∏Ïûê Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// SMS Î∞úÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/sms/logs', async (c) => {
  try {
    const userId = c.req.query('userId')
    const page = parseInt(c.req.query('page') || '1')
    const limit = parseInt(c.req.query('limit') || '20')
    const offset = (page - 1) * limit
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const logs = await c.env.DB.prepare(`
      SELECT 
        sms_logs.*,
        sender_ids.phone_number as sender_phone
      FROM sms_logs
      LEFT JOIN sender_ids ON sms_logs.sender_id = sender_ids.id
      WHERE sms_logs.user_id = ?
      ORDER BY sms_logs.created_at DESC
      LIMIT ? OFFSET ?
    `).bind(userId, limit, offset).all()

    const total = await c.env.DB.prepare(`
      SELECT COUNT(*) as count FROM sms_logs WHERE user_id = ?
    `).bind(userId).first()

    return c.json({ 
      success: true, 
      logs: logs.results,
      pagination: {
        page,
        limit,
        total: total?.count || 0,
        totalPages: Math.ceil((total?.count || 0) / limit)
      }
    })
  } catch (err) {
    console.error('Get SMS logs error:', err)
    return c.json({ success: false, error: 'SMS Î∞úÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ API (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
app.post('/api/sms/charge', async (c) => {
  try {
    const { userId, amount, adminId, description } = await c.req.json()
    
    if (!userId || !amount || !adminId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare(`
      SELECT role FROM users WHERE id = ?
    `).bind(adminId).first()
    
    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // ÏÇ¨Ïö©Ïûê ÏûîÏï° Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT balance FROM users WHERE id = ?
    `).bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    const balanceBefore = user.balance
    const balanceAfter = user.balance + amount
    
    // Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ
    await c.env.DB.prepare(`
      UPDATE users SET balance = ? WHERE id = ?
    `).bind(balanceAfter, userId).run()
    
    // Í±∞Îûò ÎÇ¥Ïó≠ Í∏∞Î°ù
    await c.env.DB.prepare(`
      INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description, admin_id)
      VALUES (?, 'charge', ?, ?, ?, ?, ?)
    `).bind(userId, amount, balanceBefore, balanceAfter, description || 'Í¥ÄÎ¶¨Ïûê Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ', adminId).run()
    
    return c.json({ 
      success: true, 
      message: 'Ìè¨Ïù∏Ìä∏ Ï∂©Ï†ÑÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
      balance: balanceAfter
    })
  } catch (err) {
    console.error('Point charge error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ============================================
// Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° API Routes
// ============================================

// Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° ÏöîÍ∏àÌëú Ï°∞Ìöå
app.get('/api/kakao/pricing', async (c) => {
  try {
    const { results } = await c.env.DB.prepare(`
      SELECT * FROM kakao_pricing ORDER BY wholesale_price ASC
    `).all()

    return c.json({ success: true, pricing: results })
  } catch (err) {
    console.error('Failed to load kakao pricing:', err)
    return c.json({ success: false, error: 'ÏöîÍ∏àÌëú Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏã† ÌîÑÎ°úÌïÑ Î™©Î°ù Ï°∞Ìöå
app.get('/api/kakao/profiles', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const { results } = await c.env.DB.prepare(`
      SELECT id, sender_key, profile_name, category_code, status, verification_date, created_at
      FROM kakao_sender_profiles
      WHERE user_id = ?
      ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ success: true, profiles: results || [] })
  } catch (err) {
    console.error('Failed to load kakao profiles:', err)
    return c.json({ success: false, error: 'Î∞úÏã† ÌîÑÎ°úÌïÑ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏã† ÌîÑÎ°úÌïÑ Îì±Î°ù
app.post('/api/kakao/profile/register', async (c) => {
  try {
    const { userId, senderKey, profileName, categoryCode } = await c.req.json()
    
    if (!userId || !senderKey || !profileName) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ï§ëÎ≥µ ÌôïÏù∏
    const existing = await c.env.DB.prepare(`
      SELECT id FROM kakao_sender_profiles WHERE sender_key = ? AND user_id = ?
    `).bind(senderKey, userId).first()

    if (existing) {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Îì±Î°ùÎêú Î∞úÏã† ÌîÑÎ°úÌïÑÏûÖÎãàÎã§.' }, 400)
    }

    const result = await c.env.DB.prepare(`
      INSERT INTO kakao_sender_profiles (user_id, sender_key, profile_name, category_code, status)
      VALUES (?, ?, ?, ?, 'active')
    `).bind(userId, senderKey, profileName, categoryCode || null).run()

    return c.json({ 
      success: true, 
      message: 'Î∞úÏã† ÌîÑÎ°úÌïÑÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.',
      profileId: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Failed to register kakao profile:', err)
    return c.json({ success: false, error: 'Î∞úÏã† ÌîÑÎ°úÌïÑ Îì±Î°ù Ïã§Ìå®' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° ÌÖúÌîåÎ¶ø Î™©Î°ù Ï°∞Ìöå
app.get('/api/kakao/templates', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const { results } = await c.env.DB.prepare(`
      SELECT * FROM kakao_templates
      WHERE user_id = ?
      ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ success: true, templates: results || [] })
  } catch (err) {
    console.error('Failed to load kakao templates:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° ÌÖúÌîåÎ¶ø Îì±Î°ù
app.post('/api/kakao/template/register', async (c) => {
  try {
    const { 
      userId, 
      templateCode, 
      templateName, 
      templateContent, 
      buttonsJson 
    } = await c.req.json()
    
    if (!userId || !templateCode || !templateName || !templateContent) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    const result = await c.env.DB.prepare(`
      INSERT INTO kakao_templates (
        user_id, template_code, template_name, template_content, 
        buttons_json, status
      ) VALUES (?, ?, ?, ?, ?, 'approved')
    `).bind(userId, templateCode, templateName, templateContent, buttonsJson || null).run()

    return c.json({ 
      success: true, 
      message: 'ÌÖúÌîåÎ¶øÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.',
      templateId: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Failed to register kakao template:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Îì±Î°ù Ïã§Ìå®' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° Î∞úÏÜ° API (ÏïåÎ¶¨Í≥† Ïó∞Îèô)
app.post('/api/kakao/send', async (c) => {
  try {
    const { 
      userId, 
      senderKey, 
      templateCode, 
      receivers,      // [{name: 'ÌôçÍ∏∏Îèô', phone: '01012345678', variables: {...}}]
      failover,       // Y/N (SMS ÎåÄÏ≤¥Î∞úÏÜ°)
      failoverSms,    // ÎåÄÏ≤¥Î∞úÏÜ° SMS ÎÇ¥Ïö©
      reserveTime     // ÏòàÏïΩÎ∞úÏÜ° ÏãúÍ∞Ñ (ÏÑ†ÌÉù)
    } = await c.req.json()

    console.log('Kakao send request:', { userId, senderKey, templateCode, receiversCount: receivers?.length })

    // 1. ÌïÑÏàò ÏûÖÎ†•Í∞í Í≤ÄÏ¶ù
    if (!userId || !senderKey || !templateCode || !receivers || receivers.length === 0) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // 2. ÌÖúÌîåÎ¶ø Ï°∞Ìöå
    const template = await c.env.DB.prepare(`
      SELECT * FROM kakao_templates WHERE template_code = ? AND user_id = ?
    `).bind(templateCode, userId).first()

    if (!template) {
      return c.json({ success: false, error: 'ÌÖúÌîåÎ¶øÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    // 3. ÏöîÍ∏à Ï°∞Ìöå
    const pricing = await c.env.DB.prepare(`
      SELECT retail_price FROM kakao_pricing WHERE message_type = 'ALIMTALK'
    `).first()

    const unitPrice = pricing?.retail_price || 15
    const totalCost = unitPrice * receivers.length

    // 4. ÏÇ¨Ïö©Ïûê ÏûîÏï° ÌôïÏù∏ Î∞è Ìè¨Ïù∏Ìä∏ ÏÑ†Ï∞®Í∞ê
    const user = await c.env.DB.prepare(`
      SELECT balance FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user || user.balance < totalCost) {
      return c.json({ 
        success: false, 
        error: `Ìè¨Ïù∏Ìä∏Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. (ÌïÑÏöî: ${totalCost}P, Î≥¥Ïú†: ${user?.balance || 0}P)`
      }, 400)
    }

    const balanceBefore = user.balance
    const balanceAfter = balanceBefore - totalCost

    // Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê
    await c.env.DB.prepare(`
      UPDATE users SET balance = ? WHERE id = ?
    `).bind(balanceAfter, userId).run()

    // Ìè¨Ïù∏Ìä∏ Í±∞Îûò ÎÇ¥Ïó≠ Í∏∞Î°ù
    await c.env.DB.prepare(`
      INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description)
      VALUES (?, 'kakao_cost', ?, ?, ?, ?)
    `).bind(
      userId, 
      -totalCost, 
      balanceBefore, 
      balanceAfter, 
      `Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° ${receivers.length}Í±¥ Î∞úÏÜ°`
    ).run()

    console.log('Points deducted:', balanceBefore, '->', balanceAfter)

    // 5. ÏïåÎ¶¨Í≥† API Ìò∏Ï∂ú (Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° Î∞úÏÜ°)
    try {
      const aligoApiKey = c.env.ALIGO_API_KEY
      const aligoUserId = c.env.ALIGO_USER_ID

      if (!aligoApiKey || !aligoUserId) {
        throw new Error('ÏïåÎ¶¨Í≥† API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.')
      }

      // ÏàòÏã†Ïûê Î™©Î°ùÏùÑ ÏïåÎ¶¨Í≥† ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
      const receiverList = receivers.map(r => ({
        rcv: r.phone.replace(/-/g, ''),
        rcv_name: r.name || '',
        emtitle_1: r.variables?.title || '',  // ÌÖúÌîåÎ¶ø Î≥ÄÏàò
        message: template.template_content    // Í∏∞Î≥∏ Î©îÏãúÏßÄ
      }))

      const aligoRequest = {
        apikey: aligoApiKey,
        userid: aligoUserId,
        senderkey: senderKey,
        tpl_code: templateCode,
        sender: senderKey,
        receiver_1: receiverList[0].rcv,
        recvname_1: receiverList[0].rcv_name,
        subject_1: receiverList[0].emtitle_1,
        message_1: receiverList[0].message,
        failover: failover || 'Y',
        fsubject_1: failoverSms || 'Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶º',
        fmessage_1: failoverSms || template.template_content
      }

      // ÏòàÏïΩ Î∞úÏÜ° ÏÑ§Ï†ï
      if (reserveTime) {
        const reserveDate = new Date(reserveTime)
        aligoRequest.rdate = reserveDate.toISOString().split('T')[0].replace(/-/g, '')
        aligoRequest.rtime = reserveDate.toTimeString().split(' ')[0].replace(/:/g, '').substring(0, 4)
      }

      const aligoResponse = await fetch('https://kakaoapi.aligo.in/akv10/alimtalk/send/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(aligoRequest)
      })

      const aligoData = await aligoResponse.json()
      console.log('Aligo kakao response:', aligoData)

      // 6. Î∞úÏÜ° Î°úÍ∑∏ Ï†ÄÏû•
      const logResult = await c.env.DB.prepare(`
        INSERT INTO kakao_logs (
          user_id, sender_key, template_code, receiver_phone, receiver_name, 
          message, buttons_json, fail_over, fail_over_sms, 
          status, result_code, result_message, msg_id, cost, reserved_date, sent_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(
        userId, senderKey, templateCode, 
        receivers[0].phone, receivers[0].name,
        template.template_content, template.buttons_json, 
        failover || 'Y', failoverSms,
        aligoData.result_code === 1 ? 'success' : 'failed',
        aligoData.result_code || 0,
        aligoData.message || '',
        aligoData.msg_id || '',
        totalCost,
        reserveTime || null
      ).run()

      const kakaoLogId = logResult.meta.last_row_id

      // ÏàòÏã†ÏûêÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Ï†ÄÏû•
      for (const receiver of receivers) {
        await c.env.DB.prepare(`
          INSERT INTO kakao_recipients (
            kakao_log_id, receiver_phone, receiver_name, status, sent_at
          ) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)
        `).bind(
          kakaoLogId, 
          receiver.phone, 
          receiver.name,
          aligoData.result_code === 1 ? 'success' : 'pending'
        ).run()
      }

      if (aligoData.result_code === 1) {
        return c.json({ 
          success: true, 
          message: `Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° ${receivers.length}Í±¥Ïù¥ Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§.`,
          balance: balanceAfter,
          cost: totalCost,
          msgId: aligoData.msg_id
        })
      } else {
        // Î∞úÏÜ° Ïã§Ìå® Ïãú Ìè¨Ïù∏Ìä∏ ÌôòÎ∂à
        await c.env.DB.prepare(`
          UPDATE users SET balance = ? WHERE id = ?
        `).bind(balanceBefore, userId).run()

        await c.env.DB.prepare(`
          INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description)
          VALUES (?, 'refund', ?, ?, ?, ?)
        `).bind(
          userId, 
          totalCost, 
          balanceAfter, 
          balanceBefore, 
          'Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ïã§Ìå®Î°ú Ïù∏Ìïú ÌôòÎ∂à'
        ).run()

        return c.json({ 
          success: false, 
          error: aligoData.message || 'ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ïã§Ìå®',
          aligoError: aligoData
        }, 500)
      }

    } catch (aligoError) {
      console.error('Aligo kakao API error:', aligoError)
      
      // API Ïò§Î•ò Ïãú Ìè¨Ïù∏Ìä∏ ÌôòÎ∂à
      await c.env.DB.prepare(`
        UPDATE users SET balance = ? WHERE id = ?
      `).bind(balanceBefore, userId).run()

      await c.env.DB.prepare(`
        INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description)
        VALUES (?, 'refund', ?, ?, ?, ?)
      `).bind(
        userId, 
        totalCost, 
        balanceAfter, 
        balanceBefore, 
        'Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° API Ïò§Î•òÎ°ú Ïù∏Ìïú ÌôòÎ∂à'
      ).run()

      return c.json({ 
        success: false, 
        error: 'ÏïåÎ¶¨Í≥† API Ìò∏Ï∂ú Ïã§Ìå®',
        details: aligoError.message
      }, 500)
    }

  } catch (err) {
    console.error('Kakao send error:', err)
    return c.json({ success: false, error: 'ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå
app.get('/api/kakao/logs', async (c) => {
  try {
    const userId = c.req.query('userId')
    const page = parseInt(c.req.query('page') || '1')
    const limit = parseInt(c.req.query('limit') || '20')
    const offset = (page - 1) * limit

    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const { results } = await c.env.DB.prepare(`
      SELECT * FROM kakao_logs
      WHERE user_id = ?
      ORDER BY created_at DESC
      LIMIT ? OFFSET ?
    `).bind(userId, limit, offset).all()

    const total = await c.env.DB.prepare(`
      SELECT COUNT(*) as count FROM kakao_logs WHERE user_id = ?
    `).bind(userId).first()

    // ÌÜµÍ≥Ñ Ï°∞Ìöå
    const stats = await c.env.DB.prepare(`
      SELECT 
        COUNT(*) as total_sent,
        SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success_count,
        SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed_count,
        SUM(cost) as total_cost
      FROM kakao_logs
      WHERE user_id = ?
    `).bind(userId).first()

    return c.json({ 
      success: true, 
      logs: results || [],
      pagination: {
        page,
        limit,
        total: total?.count || 0,
        totalPages: Math.ceil((total?.count || 0) / limit)
      },
      stats: {
        totalSent: stats?.total_sent || 0,
        successCount: stats?.success_count || 0,
        failedCount: stats?.failed_count || 0,
        totalCost: stats?.total_cost || 0
      }
    })
  } catch (err) {
    console.error('Failed to load kakao logs:', err)
    return c.json({ success: false, error: 'Î∞úÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ============================================
// End of Ïπ¥Ïπ¥Ïò§ÌÜ° ÏïåÎ¶ºÌÜ° API Routes
// ============================================

// ÏûÖÍ∏à Ïã†Ï≤≠ API
app.post('/api/deposit/request', async (c) => {
  try {
    const { userId, userName, userEmail, amount, bankName, accountNumber, depositorName, message } = await c.req.json()

    if (!userId || !amount || amount <= 0) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    const result = await c.env.DB.prepare(`
      INSERT INTO deposit_requests (user_id, user_name, user_email, amount, bank_name, account_number, depositor_name, message, status)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'pending')
    `).bind(userId, userName, userEmail, amount, bankName || null, accountNumber || null, depositorName || null, message || null).run()

    return c.json({ 
      success: true, 
      message: 'ÏûÖÍ∏à Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
      requestId: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Deposit request error:', err)
    return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏÇ¨Ïö©ÏûêÎ≥Ñ ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/deposit/my-requests/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const { results } = await c.env.DB.prepare(`
      SELECT 
        id,
        amount,
        bank_name,
        account_number,
        depositor_name,
        message,
        status,
        created_at,
        processed_at
      FROM deposit_requests
      WHERE user_id = ?
      ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ 
      success: true, 
      requests: results || []
    })
  } catch (err) {
    console.error('Failed to load deposit requests:', err)
    return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Ìè¨Ïù∏Ìä∏ Í±∞Îûò ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/point-transactions/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    const limit = parseInt(c.req.query('limit') || '50')
    const offset = parseInt(c.req.query('offset') || '0')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const { results } = await c.env.DB.prepare(`
      SELECT 
        id,
        transaction_type,
        amount,
        balance_before,
        balance_after,
        description,
        created_at
      FROM point_transactions
      WHERE user_id = ?
      ORDER BY created_at DESC
      LIMIT ? OFFSET ?
    `).bind(userId, limit, offset).all()

    // ÌÜµÍ≥Ñ Ï†ïÎ≥¥
    const stats = await c.env.DB.prepare(`
      SELECT 
        SUM(CASE WHEN amount > 0 THEN amount ELSE 0 END) as total_charged,
        SUM(CASE WHEN amount < 0 THEN ABS(amount) ELSE 0 END) as total_used,
        COUNT(*) as total_transactions
      FROM point_transactions
      WHERE user_id = ?
    `).bind(userId).first()

    return c.json({ 
      success: true, 
      transactions: results || [],
      stats: {
        totalCharged: stats?.total_charged || 0,
        totalUsed: stats?.total_used || 0,
        totalTransactions: stats?.total_transactions || 0
      }
    })
  } catch (err) {
    console.error('Failed to load point transactions:', err)
    return c.json({ success: false, error: 'Í±∞Îûò ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// R2 Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú API (Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù ÏÑúÎ•òÏö©)
app.post('/api/upload/document', async (c) => {
  try {
    const { userId, fileName, fileData, fileType } = await c.req.json()
    
    if (!userId || !fileName || !fileData || !fileType) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }

    // Base64 Îç∞Ïù¥ÌÑ∞Î•º ArrayBufferÎ°ú Î≥ÄÌôò
    const base64Data = fileData.split(',')[1] // "data:image/png;base64," Ï†úÍ±∞
    const binaryString = atob(base64Data)
    const bytes = new Uint8Array(binaryString.length)
    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i)
    }

    // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (5MB)
    if (bytes.length > 5 * 1024 * 1024) {
      return c.json({ success: false, error: 'ÌååÏùº ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.' }, 400)
    }

    // R2Ïóê ÏóÖÎ°úÎìú (Í≤ΩÎ°ú: documents/{userId}/{timestamp}-{fileName})
    const timestamp = Date.now()
    const key = `documents/${userId}/${timestamp}-${fileName}`
    
    await c.env.R2.put(key, bytes, {
      httpMetadata: {
        contentType: fileType
      }
    })

    // Public URL Î∞òÌôò (ÏûêÏ≤¥ ÎèÑÎ©îÏù∏ ÏÇ¨Ïö©)
    const publicUrl = `https://superplace-academy.pages.dev/api/document/${key}`

    return c.json({ 
      success: true, 
      url: publicUrl,
      key: key
    })
  } catch (err) {
    console.error('R2 upload error:', err)
    return c.json({ success: false, error: 'Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// R2 Ïù¥ÎØ∏ÏßÄ Ï°∞Ìöå API (Public Access)
app.get('/api/document/:path{.+}', async (c) => {
  try {
    const path = c.req.param('path')
    
    if (!path) {
      return c.text('File not found', 404)
    }

    const object = await c.env.R2.get(path)
    
    if (!object) {
      return c.text('File not found', 404)
    }

    return new Response(object.body, {
      headers: {
        'Content-Type': object.httpMetadata?.contentType || 'application/octet-stream',
        'Cache-Control': 'public, max-age=31536000'
      }
    })
  } catch (err) {
    console.error('R2 get error:', err)
    return c.text('Error retrieving file', 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ API (ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù Ìè¨Ìï®)
app.post('/api/sms/sender/verification-request', async (c) => {
  try {
    const { 
      userId, phoneNumber, businessName, businessRegistrationNumber, 
      businessRegistrationImage, certificateImage, employmentCertImage, contractImage 
    } = await c.req.json()
    
    console.log('Verification request received:', { userId, phoneNumber, businessName })
    
    if (!userId || !phoneNumber || !businessName || !businessRegistrationNumber || 
        !businessRegistrationImage || !certificateImage || !employmentCertImage || !contractImage) {
      return c.json({ success: false, error: 'Î™®Îì† ÌïÑÏàò ÏÑúÎ•òÎ•º ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Ï†ÑÌôîÎ≤àÌò∏ ÌòïÏãù Í≤ÄÏ¶ù (ÌïòÏù¥Ìîà Ï†úÍ±∞)
    const cleanNumber = phoneNumber.replace(/-/g, '')
    if (!/^01[0-9]{8,9}$/.test(cleanNumber)) {
      return c.json({ success: false, error: 'Ïò¨Î∞îÎ•∏ Ìú¥ÎåÄÌè∞ Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    console.log('Checking existing request...')
    
    // Ïù¥ÎØ∏ Ïã†Ï≤≠ Ï§ëÏù¥Í±∞ÎÇò ÏäπÏù∏Îêú Î≤àÌò∏Ïù∏ÏßÄ ÌôïÏù∏
    const existingRequest = await c.env.DB.prepare(`
      SELECT id, status FROM sender_verification_requests
      WHERE phone_number = ? AND user_id = ? AND status IN ('pending', 'approved')
      ORDER BY request_date DESC
      LIMIT 1
    `).bind(cleanNumber, userId).first()

    if (existingRequest) {
      if (existingRequest.status === 'pending') {
        return c.json({ success: false, error: 'Ïù¥ÎØ∏ Ïã†Ï≤≠ Ï§ëÏù∏ Î≤àÌò∏ÏûÖÎãàÎã§.' }, 400)
      }
      if (existingRequest.status === 'approved') {
        return c.json({ success: false, error: 'Ïù¥ÎØ∏ ÏäπÏù∏Îêú Î≤àÌò∏ÏûÖÎãàÎã§.' }, 400)
      }
    }

    console.log('Inserting new request...')
    
    // Ïã†Ï≤≠ Ï†ÄÏû• (4Í∞ú ÏÑúÎ•ò Ìè¨Ìï®)
    const result = await c.env.DB.prepare(`
      INSERT INTO sender_verification_requests 
      (user_id, phone_number, business_name, business_registration_number, 
       business_registration_image, certificate_image, employment_cert_image, contract_image, status)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'pending')
    `).bind(userId, cleanNumber, businessName, businessRegistrationNumber, 
            businessRegistrationImage, certificateImage, employmentCertImage, contractImage).run()

    console.log('Insert successful, ID:', result.meta.last_row_id)

    return c.json({ 
      success: true, 
      message: 'Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî. (ÌèâÏùº Í∏∞Ï§Ä 2~3Ïùº ÏÜåÏöî)',
      requestId: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Sender verification request error:', err)
    console.error('Error stack:', err.stack)
    console.error('Error message:', err.message)
    return c.json({ success: false, error: 'Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', details: err.message }, 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå API (ÏÇ¨Ïö©Ïûê)
app.get('/api/sms/sender/verification-requests', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    const requests = await c.env.DB.prepare(`
      SELECT 
        id, phone_number, business_name, business_registration_number, 
        business_registration_image, certificate_image, employment_cert_image, contract_image,
        request_date, status, admin_note, rejection_reason, processed_date
      FROM sender_verification_requests
      WHERE user_id = ?
      ORDER BY request_date DESC
    `).bind(userId).all()

    return c.json({ success: true, requests: requests.results })
  } catch (err) {
    console.error('Get verification requests error:', err)
    return c.json({ success: false, error: 'Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ ÏäπÏù∏/Í±∞Ï†à API (Í¥ÄÎ¶¨Ïûê)
app.post('/api/sms/sender/verification-process', async (c) => {
  try {
    const { requestId, action, adminNote, adminId } = await c.req.json()
    
    if (!requestId || !action || !adminId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    if (!['approve', 'reject'].includes(action)) {
      return c.json({ success: false, error: 'Ïò¨Î∞îÎ•∏ Ïï°ÏÖòÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare(`
      SELECT role FROM users WHERE id = ?
    `).bind(adminId).first()

    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    // Ïã†Ï≤≠ Ï†ïÎ≥¥ Ï°∞Ìöå
    const request = await c.env.DB.prepare(`
      SELECT * FROM sender_verification_requests WHERE id = ?
    `).bind(requestId).first()

    if (!request) {
      return c.json({ success: false, error: 'Ïã†Ï≤≠ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    if (request.status !== 'pending') {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Ï≤òÎ¶¨Îêú Ïã†Ï≤≠ÏûÖÎãàÎã§.' }, 400)
    }

    const newStatus = action === 'approve' ? 'approved' : 'rejected'
    const processedDate = new Date().toISOString()

    // Ïã†Ï≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE sender_verification_requests
      SET status = ?, admin_note = ?, processed_by = ?, processed_date = ?
      WHERE id = ?
    `).bind(newStatus, adminNote || null, adminId, processedDate, requestId).run()

    // ÏäπÏù∏Îêú Í≤ΩÏö∞ sender_ids ÌÖåÏù¥Î∏îÏóê Ï∂îÍ∞Ä & Aligo API Îì±Î°ù
    if (action === 'approve') {
      // 1. DBÏóê Î∞úÏã†Î≤àÌò∏ Ï†ÄÏû•
      await c.env.DB.prepare(`
        INSERT INTO sender_ids 
        (user_id, phone_number, verification_method, status, verification_request_id, business_name, business_registration_number)
        VALUES (?, ?, 'business_registration', 'verified', ?, ?, ?)
      `).bind(
        request.user_id, 
        request.phone_number, 
        requestId, 
        request.business_name, 
        request.business_registration_number
      ).run()

      // 2. Aligo APIÎ°ú Î∞úÏã†Î≤àÌò∏ Îì±Î°ù
      try {
        const aligoUserId = c.env.ALIGO_USER_ID || ''
        const aligoApiKey = c.env.ALIGO_API_KEY || ''
        
        if (!aligoUserId || !aligoApiKey) {
          console.warn('Aligo API credentials not configured')
        } else {
          const aligoResponse = await fetch('https://apis.aligo.in/sender/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
              user_id: aligoUserId,
              key: aligoApiKey,
              sender: request.phone_number.replace(/-/g, ''),
              comment: `${request.business_name} - ÏäπÏù∏Ïùº: ${new Date().toLocaleDateString('ko-KR')}`
            })
          })

          const aligoData = await aligoResponse.json()
          console.log('Aligo API response:', aligoData)

          if (aligoData.result_code !== '1') {
            console.error('Aligo sender registration failed:', aligoData)
            // Ïã§Ìå®Ìï¥ÎèÑ Ïã†Ï≤≠ÏùÄ ÏäπÏù∏ ÏÉÅÌÉú Ïú†ÏßÄ (ÏàòÎèôÏúºÎ°ú Ï≤òÎ¶¨ Í∞ÄÎä•)
          }
        }
      } catch (aligoErr) {
        console.error('Aligo API error:', aligoErr)
        // ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï¥ÎèÑ Ïã†Ï≤≠ÏùÄ ÏäπÏù∏ ÏÉÅÌÉú Ïú†ÏßÄ
      }
    }

    return c.json({ 
      success: true, 
      message: action === 'approve' ? 'Î∞úÏã†Î≤àÌò∏Í∞Ä ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§.' : 'Î∞úÏã†Î≤àÌò∏ Ïã†Ï≤≠Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (err) {
    console.error('Process verification error:', err)
    return c.json({ success: false, error: 'Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨ÏûêÏö© Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ Ï†ÑÏ≤¥ Î™©Î°ù Ï°∞Ìöå API
app.get('/api/admin/sender/verification-requests', async (c) => {
  try {
    const adminId = c.req.query('adminId')
    
    if (!adminId) {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare(`
      SELECT role FROM users WHERE id = ?
    `).bind(adminId).first()

    if (!admin || admin.role !== 'admin') {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    const requests = await c.env.DB.prepare(`
      SELECT 
        svr.id, svr.user_id, svr.phone_number, svr.business_name, 
        svr.business_registration_number, svr.business_registration_image,
        svr.certificate_image, svr.employment_cert_image, svr.contract_image,
        svr.request_date, svr.status, svr.admin_note, svr.rejection_reason, svr.processed_date,
        u.name as user_name, u.email as user_email
      FROM sender_verification_requests svr
      LEFT JOIN users u ON svr.user_id = u.id
      ORDER BY 
        CASE svr.status 
          WHEN 'pending' THEN 1 
          WHEN 'approved' THEN 2 
          WHEN 'rejected' THEN 3 
        END,
        svr.request_date DESC
    `).all()

    return c.json({ success: true, requests: requests.results })
  } catch (err) {
    console.error('Get admin verification requests error:', err)
    return c.json({ success: false, error: 'Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏÑúÎ•ò ÏñëÏãù Îã§Ïö¥Î°úÎìú API
app.get('/api/downloads/consent-form', async (c) => {
  // Î∞úÏã†Î≤àÌò∏ ÏÇ¨Ï†ÑÎì±Î°ù ÎåÄÎ¶¨ Ïã†Ï≤≠ÏÑú (ÏÇ¨Ïö©Ïûê ÏóÖÎ°úÎìú ÌååÏùº)
  const docxUrl = 'https://www.genspark.ai/api/files/s/lIFq9l1L'
  const response = await fetch(docxUrl)
  const blob = await response.arrayBuffer()
  
  return new Response(blob, {
    headers: {
      'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      'Content-Disposition': 'attachment; filename="Î∞úÏã†Î≤àÌò∏_ÏÇ¨Ï†ÑÎì±Î°ù_ÎåÄÎ¶¨_Ïã†Ï≤≠ÏÑú.docx"'
    }
  })
})

app.get('/api/downloads/contract', async (c) => {
  // Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú (ÏÇ¨Ïö©Ïûê ÏóÖÎ°úÎìú ÌååÏùº)
  const docxUrl = 'https://www.genspark.ai/api/files/s/aKg3VCJT'
  const response = await fetch(docxUrl)
  const blob = await response.arrayBuffer()
  
  return new Response(blob, {
    headers: {
      'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      'Content-Disposition': 'attachment; filename="Î¨∏ÏûêÎ©îÏãúÏßÄ_Ïù¥Ïö©Í≥ÑÏïΩÏÑú.docx"'
    }
  })
})

app.get('/api/downloads/employment-cert', async (c) => {
  // Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú ÏñëÏãù (Í∞ÑÎã®Ìïú HTML ÌÖúÌîåÎ¶ø)
  return c.html(`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú</title>
      <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 60px; }
        h1 { text-align: center; font-size: 32px; margin-bottom: 40px; }
        table { width: 100%; border-collapse: collapse; margin: 30px 0; }
        th, td { border: 1px solid #000; padding: 12px; text-align: left; }
        th { background-color: #f0f0f0; font-weight: bold; }
        .info { margin: 30px 0; line-height: 2; }
        .signature { text-align: right; margin-top: 60px; }
      </style>
    </head>
    <body>
      <h1>Ïû¨ ÏßÅ Ï¶ù Î™Ö ÏÑú</h1>
      
      <div class="info">
        <table>
          <tr>
            <th width="30%">ÏÑ±Î™Ö (ÌïúÍ∏Ä)</th>
            <td></td>
            <th width="30%">Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏</th>
            <td></td>
          </tr>
          <tr>
            <th>Ï£ºÏÜå</th>
            <td colspan="3"></td>
          </tr>
        </table>
        
        <table>
          <tr>
            <th width="30%">Í∑ºÎ¨¥Î∂ÄÏÑú</th>
            <td></td>
            <th width="30%">ÏßÅÏúÑ</th>
            <td></td>
          </tr>
          <tr>
            <th>Ïû¨ÏßÅÍ∏∞Í∞Ñ</th>
            <td colspan="3">20   ÎÖÑ   Ïõî   Ïùº Î∂ÄÌÑ∞ 20   ÎÖÑ   Ïõî   Ïùº ÌòÑÏû¨ÍπåÏßÄ</td>
          </tr>
          <tr>
            <th>Ï†úÏ∂úÏö©ÎèÑ</th>
            <td colspan="3"></td>
          </tr>
        </table>
      </div>
      
      <p style="text-align: center; margin: 40px 0;">
        ÏúÑÏùò Í∏∞Ïû¨ÏÇ¨Ìï≠Ïù¥ ÏÇ¨Ïã§Í≥º Îã§Î¶ÑÏóÜÏùåÏùÑ Ï¶ùÎ™ÖÌï©ÎãàÎã§.
      </p>
      
      <div class="signature">
        <p>ÎÖÑ &nbsp;&nbsp;&nbsp; Ïõî &nbsp;&nbsp;&nbsp; Ïùº</p>
        <br><br>
        <p>Ìöå ÏÇ¨ Î™Ö: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Ïù∏)</p>
        <p>ÎåÄ Ìëú Ïûê: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Ïù∏)</p>
        <p>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏:</p>
        <p>Ï£º ÏÜå:</p>
        <p>Ï†Ñ Ìôî:</p>
      </div>
    </body>
    </html>
  `)
})

// ÎÇ¥ ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/deposit/my-requests/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    
    const requests = await c.env.DB.prepare(`
      SELECT * FROM deposit_requests WHERE user_id = ? ORDER BY created_at DESC
    `).bind(userId).all()

    return c.json({ success: true, requests: requests.results })
  } catch (err) {
    console.error('Get deposit requests error:', err)
    return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏûÖÍ∏à Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå API
app.get('/api/admin/deposit/requests', async (c) => {
  try {
    const requests = await c.env.DB.prepare(`
      SELECT * FROM deposit_requests ORDER BY created_at DESC
    `).all()

    return c.json({ success: true, requests: requests.results })
  } catch (err) {
    console.error('Get all deposit requests error:', err)
    return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏûÖÍ∏à Ïã†Ï≤≠ Ï≤òÎ¶¨ API
app.put('/api/admin/deposit/requests/:id/process', async (c) => {
  try {
    const requestId = c.req.param('id')
    const { status, adminId } = await c.req.json()

    console.log('Processing deposit:', { requestId, status, adminId })

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    if (adminId) {
      const admin = await c.env.DB.prepare(`
        SELECT role FROM users WHERE id = ?
      `).bind(adminId).first()

      if (!admin || admin.role !== 'admin') {
        return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
      }
    }

    // ÏûÖÍ∏à Ïã†Ï≤≠ Ï†ïÎ≥¥ Ï°∞Ìöå
    const request = await c.env.DB.prepare(`
      SELECT * FROM deposit_requests WHERE id = ?
    `).bind(requestId).first()

    console.log('Found request:', request)

    if (!request) {
      return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    if (request.status !== 'pending') {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ Ï≤òÎ¶¨Îêú Ïã†Ï≤≠ÏûÖÎãàÎã§.' }, 400)
    }

    let balanceAfter = 0

    // ÏäπÏù∏Ïù∏ Í≤ΩÏö∞ Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â
    if (status === 'approved') {
      const points = request.amount
      console.log('Approving deposit for user:', request.user_id, 'adding:', points)
      
      // ÌòÑÏû¨ ÏûîÏï° Ï°∞Ìöå (pointsÏôÄ balance Î™®Îëê ÌôïÏù∏)
      const user = await c.env.DB.prepare(`
        SELECT points, balance FROM users WHERE id = ?
      `).bind(request.user_id).first()

      const currentPoints = user?.points || 0
      const currentBalance = user?.balance || 0
      const balanceBefore = currentPoints || currentBalance
      balanceAfter = balanceBefore + points

      // Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ (pointsÏôÄ balance Îëò Îã§ ÏóÖÎç∞Ïù¥Ìä∏)
      await c.env.DB.prepare(`
        UPDATE users SET points = ?, balance = ? WHERE id = ?
      `).bind(balanceAfter, balanceAfter, request.user_id).run()
      
      console.log('Points/Balance updated:', balanceBefore, '->', balanceAfter)

      // Ìè¨Ïù∏Ìä∏ Í±∞Îûò ÎÇ¥Ïó≠ Í∏∞Î°ù
      await c.env.DB.prepare(`
        INSERT INTO point_transactions (user_id, transaction_type, amount, balance_before, balance_after, description, admin_id)
        VALUES (?, 'deposit_approval', ?, ?, ?, ?, ?)
      `).bind(
        request.user_id, 
        points, 
        balanceBefore, 
        balanceAfter, 
        `ÏûÖÍ∏à Ïã†Ï≤≠ ÏäπÏù∏ (Ïã†Ï≤≠ ID: ${requestId})`,
        adminId || null
      ).run()

      // Ïù¥Î©îÏùº ÏïåÎ¶º Î∞úÏÜ° (Resend API)
      if (request.user_email) {
        try {
          const resendApiKey = c.env.RESEND_API_KEY
          
          if (resendApiKey) {
            const emailResponse = await fetch('https://api.resend.com/emails', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${resendApiKey}`
              },
              body: JSON.stringify({
                from: 'ÏäàÌçºÌîåÎ†àÏù¥Ïä§ <noreply@superplace.co.kr>',
                to: request.user_email,
                subject: '‚úÖ Ìè¨Ïù∏Ìä∏ Ï∂©Ï†ÑÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§',
                html: `
                  <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                    <div style="background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%); padding: 30px; border-radius: 10px 10px 0 0; text-align: center;">
                      <h1 style="color: white; margin: 0; font-size: 24px;">üí∞ Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ ÏôÑÎ£å</h1>
                    </div>
                    
                    <div style="background: white; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 10px 10px;">
                      <p style="font-size: 16px; color: #374151; margin-bottom: 20px;">
                        ÏïàÎÖïÌïòÏÑ∏Ïöî, <strong>${request.user_name || 'ÌöåÏõê'}</strong>Îãò!
                      </p>
                      
                      <p style="font-size: 16px; color: #374151; margin-bottom: 30px;">
                        ÏûÖÍ∏à Ïã†Ï≤≠ÌïòÏã† Ìè¨Ïù∏Ìä∏Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂©Ï†ÑÎêòÏóàÏäµÎãàÎã§. üéâ
                      </p>
                      
                      <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                          <span style="color: #6b7280;">Ï∂©Ï†Ñ Í∏àÏï°</span>
                          <strong style="color: #9333ea; font-size: 20px;">${points.toLocaleString()}P</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                          <span style="color: #6b7280;">ÌòÑÏû¨ ÏûîÏï°</span>
                          <strong style="color: #1f2937; font-size: 18px;">${balanceAfter.toLocaleString()}P</strong>
                        </div>
                      </div>
                      
                      <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 30px;">
                        <p style="margin: 0; color: #1e40af; font-size: 14px;">
                          üí° <strong>SMS Î∞úÏÜ° Í∞ÄÎä• Í±¥Ïàò</strong><br>
                          ‚Ä¢ SMS (90Ïûê): ÏïΩ ${Math.floor(balanceAfter / 20).toLocaleString()}Í±¥<br>
                          ‚Ä¢ LMS (2000Ïûê): ÏïΩ ${Math.floor(balanceAfter / 50).toLocaleString()}Í±¥<br>
                          ‚Ä¢ MMS (ÏÇ¨ÏßÑ Ìè¨Ìï®): ÏïΩ ${Math.floor(balanceAfter / 150).toLocaleString()}Í±¥
                        </p>
                      </div>
                      
                      <div style="text-align: center;">
                        <a href="https://superplace-academy.pages.dev/sms/compose" 
                           style="display: inline-block; background: #9333ea; color: white; padding: 14px 30px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px;">
                          ÏßÄÍ∏à Î¨∏Ïûê Î≥¥ÎÇ¥Í∏∞ üì§
                        </a>
                      </div>
                      
                      <p style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px; text-align: center;">
                        Î¨∏ÏùòÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì†ÏßÄ Ïó∞ÎùΩÏ£ºÏÑ∏Ïöî.<br>
                        Í∞êÏÇ¨Ìï©ÎãàÎã§!
                      </p>
                    </div>
                  </div>
                `
              })
            })

            if (emailResponse.ok) {
              console.log('Email notification sent successfully')
            } else {
              console.error('Failed to send email notification:', await emailResponse.text())
            }
          }
        } catch (emailError) {
          console.error('Email sending error:', emailError)
          // Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®Ìï¥ÎèÑ ÏäπÏù∏ Ï≤òÎ¶¨Îäî Í≥ÑÏÜç ÏßÑÌñâ
        }
      }
    }

    // ÏûÖÍ∏à Ïã†Ï≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE deposit_requests SET status = ?, processed_at = CURRENT_TIMESTAMP WHERE id = ?
    `).bind(status, requestId).run()

    return c.json({ 
      success: true, 
      message: status === 'approved' ? 'ÏûÖÍ∏àÏù¥ ÏäπÏù∏ÎêòÍ≥† Ìè¨Ïù∏Ìä∏Í∞Ä Ï∂©Ï†ÑÎêòÏóàÏäµÎãàÎã§.' : 'ÏûÖÍ∏à Ïã†Ï≤≠Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (err) {
    console.error('Process deposit request error:', err)
    return c.json({ success: false, error: 'ÏûÖÍ∏à Ïã†Ï≤≠ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', details: error.message }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
app.put('/api/admin/users/:id/password', async (c) => {
  try {
    const userId = c.req.param('id')
    const { newPassword } = await c.req.json()

    if (!newPassword || newPassword.length < 6) {
      return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.' }, 400)
    }

    await c.env.DB.prepare(`
      UPDATE users SET password = ? WHERE id = ?
    `).bind(newPassword, userId).run()

    return c.json({ success: true, message: 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Change password error:', err)
    return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê Ìè¨Ïù∏Ìä∏ Ï∂îÍ∞Ä/Ï∞®Í∞ê
app.put('/api/admin/users/:id/points', async (c) => {
  try {
    const userId = c.req.param('id')
    const { points, action } = await c.req.json() // action: 'add' or 'subtract'

    if (!points || points <= 0) {
      return c.json({ success: false, error: 'Ïú†Ìö®Ìïú Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // ÌòÑÏû¨ Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå
    const user = await c.env.DB.prepare(`
      SELECT points FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    let newPoints = (user.points || 0)
    if (action === 'add') {
      newPoints += points
    } else if (action === 'subtract') {
      newPoints = Math.max(0, newPoints - points) // 0 ÎØ∏ÎßåÏúºÎ°ú Îñ®Ïñ¥ÏßÄÏßÄ ÏïäÏùå
    }

    await c.env.DB.prepare(`
      UPDATE users SET points = ? WHERE id = ?
    `).bind(newPoints, userId).run()

    return c.json({ success: true, message: 'Ìè¨Ïù∏Ìä∏Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.', newPoints })
  } catch (err) {
    console.error('Update points error:', err)
    return c.json({ success: false, error: 'Ìè¨Ïù∏Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê ÏïÑÏù¥ÎîîÎ°ú Î°úÍ∑∏Ïù∏
app.post('/api/admin/login-as/:id', async (c) => {
  try {
    const userId = c.req.param('id')

    const user = await c.env.DB.prepare(`
      SELECT id, email, name, role, points FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    return c.json({ 
      success: true, 
      message: 'Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ',
      user: { id: user.id, email: user.email, name: user.name, role: user.role, points: user.points }
    })
  } catch (err) {
    console.error('Login as user error:', err)
    return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î¨∏Ïùò Î™©Î°ù Ï°∞Ìöå API (Í¥ÄÎ¶¨ÏûêÏö©)
app.get('/api/contacts', async (c) => {
  try {
    const { results } = await c.env.DB.prepare(`
      SELECT * FROM contacts ORDER BY created_at DESC LIMIT 50
    `).all()

    return c.json({ success: true, contacts: results })
  } catch (err) {
    console.error('Fetch contacts error:', err)
    return c.json({ success: false, error: 'Î¨∏Ïùò Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î¨∏Ïùò ÏÉÅÌÉú Î≥ÄÍ≤Ω Î∞è ÎãµÎ≥Ä Î©îÎ™® ÏóÖÎç∞Ïù¥Ìä∏
app.put('/api/admin/contacts/:id', async (c) => {
  try {
    const id = c.req.param('id')
    const { status, reply_memo, handled_by } = await c.req.json()
    
    let query = 'UPDATE contacts SET '
    const updates = []
    const bindings = []
    
    if (status) {
      updates.push('status = ?')
      bindings.push(status)
    }
    if (reply_memo !== undefined) {
      updates.push('reply_memo = ?')
      bindings.push(reply_memo)
    }
    if (handled_by) {
      updates.push('handled_by = ?, handled_at = CURRENT_TIMESTAMP')
      bindings.push(handled_by)
    }
    
    query += updates.join(', ') + ' WHERE id = ?'
    bindings.push(id)
    
    await c.env.DB.prepare(query).bind(...bindings).run()
    
    return c.json({ success: true, message: 'Î¨∏ÏùòÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Update contact error:', err)
    return c.json({ success: false, error: 'Î¨∏Ïùò ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®' }, 500)
  }
})

// ==================== Í¥ÄÎ¶¨Ïûê API ====================

// Í¥ÄÎ¶¨Ïûê - Î∞ò ÏÜåÏú†Í∂å ÏàòÏ†ï (ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò)
app.post('/api/admin/fix-class-ownership', async (c) => {
  try {
    const { email, targetUserId } = await c.req.json()
    
    if (!email && !targetUserId) {
      return c.json({ success: false, error: 'Ïù¥Î©îÏùº ÎòêÎäî ÎåÄÏÉÅ ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('üîß [FixClassOwnership] Request:', { email, targetUserId })
    
    // Ïù¥Î©îÏùºÎ°ú ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    let userId = targetUserId
    if (email && !userId) {
      const user = await c.env.DB.prepare('SELECT id FROM users WHERE email = ?').bind(email).first()
      if (!user) {
        return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
      }
      userId = user.id
    }
    
    console.log('üë§ [FixClassOwnership] Target user_id:', userId)
    
    // Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÏùò Î∞ò Ï∞æÍ∏∞ (teacher_idÎ°ú)
    const classesAsTeacher = await c.env.DB.prepare(
      'SELECT id, name, user_id, teacher_id FROM classes WHERE teacher_id = ?'
    ).bind(userId).all()
    
    console.log('üìö [FixClassOwnership] Found', classesAsTeacher.results?.length || 0, 'classes as teacher')
    
    if (!classesAsTeacher.results || classesAsTeacher.results.length === 0) {
      return c.json({ 
        success: true, 
        message: 'ÏàòÏ†ïÌï† Î∞òÏù¥ ÏóÜÏäµÎãàÎã§.',
        updated: 0
      })
    }
    
    // user_idÎ•º teacher_idÏôÄ Í∞ôÍ≤å ÏàòÏ†ï
    let updated = 0
    for (const cls of classesAsTeacher.results) {
      if (cls.user_id !== cls.teacher_id) {
        await c.env.DB.prepare(
          'UPDATE classes SET user_id = ? WHERE id = ?'
        ).bind(cls.teacher_id, cls.id).run()
        updated++
        console.log(`‚úÖ [FixClassOwnership] Updated class ${cls.id} (${cls.name}): user_id ${cls.user_id} ‚Üí ${cls.teacher_id}`)
      }
    }
    
    return c.json({ 
      success: true, 
      message: `${updated}Í∞úÏùò Î∞ò ÏÜåÏú†Í∂åÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.`,
      updated,
      details: classesAsTeacher.results.map(c => ({
        id: c.id,
        name: c.name,
        old_user_id: c.user_id,
        new_user_id: c.teacher_id
      }))
    })
  } catch (error) {
    console.error('‚ùå [FixClassOwnership] Error:', error)
    return c.json({ success: false, error: 'Î∞ò ÏÜåÏú†Í∂å ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - Î∞ò ÏÜåÏú†Í∂å Ïù¥Ï†Ñ (Í¥ÄÎ¶¨Ïûê ‚Üí ÌäπÏ†ï ÏÇ¨Ïö©Ïûê)
// Í¥ÄÎ¶¨Ïûê - Î™®Îì† Î∞ò Ï°∞Ìöå (ÎîîÎ≤ÑÍ∑∏Ïö©)
app.get('/api/admin/classes/all', async (c) => {
  try {
    console.log('üîç [AdminClasses] Fetching ALL classes from database')
    
    // Î®ºÏ†Ä classes ÌÖåÏù¥Î∏îÏùò Ïä§ÌÇ§Îßà ÌôïÏù∏
    let schemaInfo
    try {
      schemaInfo = await c.env.DB.prepare(`
        PRAGMA table_info(classes)
      `).all()
      console.log('üìã [AdminClasses] Table schema:', JSON.stringify(schemaInfo.results))
    } catch (schemaError) {
      console.error('‚ö†Ô∏è [AdminClasses] Schema check failed:', schemaError.message)
    }
    
    // academy_id ÎòêÎäî user_id Ïª¨Îüº ÌôïÏù∏
    const hasUserId = schemaInfo?.results?.some(col => col.name === 'user_id')
    const hasAcademyId = schemaInfo?.results?.some(col => col.name === 'academy_id')
    const ownerColumn = hasUserId ? 'user_id' : (hasAcademyId ? 'academy_id' : null)
    
    console.log('üîç [AdminClasses] Owner column:', ownerColumn)
    
    if (!ownerColumn) {
      // ÏÜåÏú†Ïûê Ïª¨ÎüºÏù¥ ÏóÜÏúºÎ©¥ Îã®Ïàú Ï°∞Ìöå
      const classes = await c.env.DB.prepare(`SELECT * FROM classes ORDER BY created_at DESC`).all()
      return c.json({ 
        success: true, 
        classes: classes.results || [],
        total: classes.results?.length || 0,
        note: 'ÏÜåÏú†Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. classes ÌÖåÏù¥Î∏îÏóê user_id ÎòêÎäî academy_id Ïª¨ÎüºÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
      })
    }
    
    // ÏÜåÏú†Ïûê Ï†ïÎ≥¥ÏôÄ Ìï®Íªò Ï°∞Ìöå
    const classes = await c.env.DB.prepare(`
      SELECT c.*, 
             u.email as owner_email, 
             u.name as owner_name,
             t.email as teacher_email,
             t.name as teacher_name
      FROM classes c
      LEFT JOIN users u ON c.${ownerColumn} = u.id
      LEFT JOIN users t ON c.teacher_id = t.id
      ORDER BY c.created_at DESC
    `).all()
    
    console.log('üìö [AdminClasses] Found', classes.results?.length || 0, 'total classes')
    
    return c.json({ 
      success: true, 
      classes: classes.results || [],
      total: classes.results?.length || 0,
      ownerColumn
    })
  } catch (error) {
    console.error('‚ùå [AdminClasses] Error:', error)
    return c.json({ 
      success: false, 
      error: 'Î∞ò Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message 
    }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÌäπÏ†ï ÏÇ¨Ïö©ÏûêÏóêÍ≤å Î∞ò ÏßÅÏ†ë ÏÉùÏÑ± (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
app.post('/api/admin/classes/create-for-user', async (c) => {
  try {
    const { targetEmail, className, gradeLevel, subject, description } = await c.req.json()
    
    if (!targetEmail || !className) {
      return c.json({ success: false, error: 'targetEmailÍ≥º classNameÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('üè´ [AdminCreateClass] Creating class for user:', targetEmail)
    
    // ÎåÄÏÉÅ ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    const targetUser = await c.env.DB.prepare(
      'SELECT id, email, name FROM users WHERE email = ?'
    ).bind(targetEmail).first()
    
    if (!targetUser) {
      return c.json({ success: false, error: 'ÎåÄÏÉÅ ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('üë§ [AdminCreateClass] Target user:', targetUser)
    
    // ÌÖåÏù¥Î∏î Ïä§ÌÇ§Îßà ÌôïÏù∏
    const schemaInfo = await c.env.DB.prepare(`PRAGMA table_info(classes)`).all()
    const hasUserId = schemaInfo.results?.some(col => col.name === 'user_id')
    const hasAcademyId = schemaInfo.results?.some(col => col.name === 'academy_id')
    const ownerColumn = hasUserId ? 'user_id' : (hasAcademyId ? 'academy_id' : 'user_id')
    
    console.log('üîç [AdminCreateClass] Using owner column:', ownerColumn)
    
    // Î∞ò ÏÉùÏÑ± (ÎèôÏ†Å Ïª¨ÎüºÎ™Ö ÏÇ¨Ïö©)
    const result = await c.env.DB.prepare(`
      INSERT INTO classes (name, description, ${ownerColumn}, grade_level, subject, max_students, status, created_at)
      VALUES (?, ?, ?, ?, ?, 20, 'active', datetime('now'))
    `).bind(
      className,
      description || null,
      targetUser.id,
      gradeLevel || null,
      subject || null
    ).run()
    
    const classId = result.meta.last_row_id
    
    console.log('‚úÖ [AdminCreateClass] Class created:', { classId, name: className, owner: targetUser.email })
    
    return c.json({
      success: true,
      message: `${targetUser.email}ÏóêÍ≤å Î∞òÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`,
      classId,
      class: {
        id: classId,
        name: className,
        owner_id: targetUser.id,
        owner_email: targetUser.email,
        owner_name: targetUser.name
      }
    })
  } catch (error) {
    console.error('‚ùå [AdminCreateClass] Error:', error)
    return c.json({ 
      success: false, 
      error: 'Î∞ò ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message 
    }, 500)
  }
})

app.post('/api/admin/transfer-classes', async (c) => {
  try {
    const { fromUserId, toEmail } = await c.req.json()
    
    if (!fromUserId || !toEmail) {
      return c.json({ success: false, error: 'fromUserIdÏôÄ toEmailÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('üîÑ [TransferClasses] Transfer request:', { fromUserId, toEmail })
    
    // ÎåÄÏÉÅ ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    const toUser = await c.env.DB.prepare('SELECT id, email, name FROM users WHERE email = ?').bind(toEmail).first()
    if (!toUser) {
      return c.json({ success: false, error: 'ÎåÄÏÉÅ ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('üë§ [TransferClasses] Target user:', toUser)
    
    // ÌÖåÏù¥Î∏î Ïä§ÌÇ§Îßà ÌôïÏù∏
    const schemaInfo = await c.env.DB.prepare(`PRAGMA table_info(classes)`).all()
    const hasUserId = schemaInfo.results?.some(col => col.name === 'user_id')
    const hasAcademyId = schemaInfo.results?.some(col => col.name === 'academy_id')
    const ownerColumn = hasUserId ? 'user_id' : (hasAcademyId ? 'academy_id' : 'user_id')
    
    console.log('üîç [TransferClasses] Using owner column:', ownerColumn)
    
    // ÏõêÎ≥∏ ÏÇ¨Ïö©ÏûêÏùò Î∞ò Ï∞æÍ∏∞
    const classes = await c.env.DB.prepare(
      `SELECT id, name, ${ownerColumn} as owner_id, teacher_id FROM classes WHERE ${ownerColumn} = ?`
    ).bind(fromUserId).all()
    
    console.log('üìö [TransferClasses] Found', classes.results?.length || 0, 'classes to transfer')
    
    if (!classes.results || classes.results.length === 0) {
      return c.json({ 
        success: true, 
        message: 'Ïù¥Ï†ÑÌï† Î∞òÏù¥ ÏóÜÏäµÎãàÎã§.',
        transferred: 0
      })
    }
    
    // owner_idÎ•º ÎåÄÏÉÅ ÏÇ¨Ïö©ÏûêÎ°ú Î≥ÄÍ≤Ω
    let transferred = 0
    const details = []
    
    for (const cls of classes.results) {
      await c.env.DB.prepare(
        `UPDATE classes SET ${ownerColumn} = ? WHERE id = ?`
      ).bind(toUser.id, cls.id).run()
      
      transferred++
      details.push({
        id: cls.id,
        name: cls.name,
        from_user_id: cls.owner_id,
        to_user_id: toUser.id,
        to_email: toUser.email
      })
      
      console.log(`‚úÖ [TransferClasses] Transferred class ${cls.id} (${cls.name}): ${ownerColumn} ${cls.owner_id} ‚Üí ${toUser.id}`)
    }
    
    return c.json({ 
      success: true, 
      message: `${transferred}Í∞úÏùò Î∞òÏù¥ ${toUser.email}Î°ú Ïù¥Ï†ÑÎêòÏóàÏäµÎãàÎã§.`,
      transferred,
      target_user: {
        id: toUser.id,
        email: toUser.email,
        name: toUser.name
      },
      details
    })
  } catch (error) {
    console.error('‚ùå [TransferClasses] Error:', error)
    return c.json({ success: false, error: 'Î∞ò Ïù¥Ï†Ñ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', details: error.message }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - Î™®Îì† Î∞òÏùÑ ÌäπÏ†ï ÏÇ¨Ïö©ÏûêÎ°ú Ïù¥Ï†Ñ (Í∏¥Í∏â ÏàòÏ†ïÏö©)
app.post('/api/admin/transfer-all-classes-to-user', async (c) => {
  try {
    const { toEmail } = await c.req.json()
    
    if (!toEmail) {
      return c.json({ success: false, error: 'toEmailÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('üö® [EmergencyTransfer] Transferring ALL classes to:', toEmail)
    
    // ÎåÄÏÉÅ ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    const toUser = await c.env.DB.prepare('SELECT id, email, name FROM users WHERE email = ?').bind(toEmail).first()
    if (!toUser) {
      return c.json({ success: false, error: 'ÎåÄÏÉÅ ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('üë§ [EmergencyTransfer] Target user:', toUser)
    
    // Î™®Îì† Î∞ò Ï°∞Ìöå
    let allClasses
    try {
      allClasses = await c.env.DB.prepare('SELECT * FROM classes ORDER BY id').all()
    } catch (e) {
      return c.json({ success: false, error: 'classes ÌÖåÏù¥Î∏îÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§: ' + e.message }, 500)
    }
    
    console.log('üìö [EmergencyTransfer] Found', allClasses.results?.length || 0, 'total classes')
    
    if (!allClasses.results || allClasses.results.length === 0) {
      return c.json({ 
        success: true, 
        message: 'Ïù¥Ï†ÑÌï† Î∞òÏù¥ ÏóÜÏäµÎãàÎã§.',
        transferred: 0
      })
    }
    
    // academy_id ÎòêÎäî user_id Ïª¨Îüº ÌôïÏù∏
    const firstClass = allClasses.results[0]
    const hasAcademyId = 'academy_id' in firstClass
    const hasUserId = 'user_id' in firstClass
    const ownerColumn = hasUserId ? 'user_id' : (hasAcademyId ? 'academy_id' : null)
    
    console.log('üîç [EmergencyTransfer] Owner column:', ownerColumn)
    
    if (!ownerColumn) {
      return c.json({ success: false, error: 'ÏÜåÏú†Ïûê Ïª¨Îüº(academy_id ÎòêÎäî user_id)ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 500)
    }
    
    // Î™®Îì† Î∞òÏùÑ ÎåÄÏÉÅ ÏÇ¨Ïö©ÏûêÎ°ú Î≥ÄÍ≤Ω
    let transferred = 0
    const details = []
    
    for (const cls of allClasses.results) {
      try {
        await c.env.DB.prepare(
          `UPDATE classes SET ${ownerColumn} = ? WHERE id = ?`
        ).bind(toUser.id, cls.id).run()
        
        transferred++
        details.push({
          id: cls.id,
          name: cls.class_name || cls.name,
          from_owner_id: cls[ownerColumn],
          to_owner_id: toUser.id
        })
        
        console.log(`‚úÖ [EmergencyTransfer] Transferred class ${cls.id} (${cls.class_name || cls.name}): ${ownerColumn} ${cls[ownerColumn]} ‚Üí ${toUser.id}`)
      } catch (e) {
        console.error(`‚ùå [EmergencyTransfer] Failed to transfer class ${cls.id}:`, e.message)
      }
    }
    
    return c.json({ 
      success: true, 
      message: `${transferred}Í∞úÏùò Î∞òÏù¥ ${toUser.email}Î°ú Ïù¥Ï†ÑÎêòÏóàÏäµÎãàÎã§.`,
      transferred,
      total: allClasses.results.length,
      target_user: {
        id: toUser.id,
        email: toUser.email,
        name: toUser.name
      },
      details: details.slice(0, 10)  // Ï≤òÏùå 10Í∞úÎßå Î∞òÌôò
    })
  } catch (error) {
    console.error('‚ùå [EmergencyTransfer] Error:', error)
    return c.json({ success: false, error: 'Î∞ò Ïù¥Ï†Ñ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÏÇ¨Ïö©Ïûê Î™©Î°ù
app.get('/api/admin/users', async (c) => {
  try {
    const { results } = await c.env.DB.prepare('SELECT id, email, name, phone, academy_name, role, created_at FROM users ORDER BY created_at DESC').all()
    return c.json({ success: true, users: results })
  } catch (err) {
    return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
app.delete('/api/admin/users/:id', async (c) => {
  try {
    const userId = c.req.param('id')
    console.log('üóëÔ∏è Delete user request:', userId)
    
    // Í¥ÄÎ¶¨ÏûêÎäî ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏùå
    const user = await c.env.DB.prepare('SELECT role FROM users WHERE id = ?').bind(userId).first()
    if (!user) {
      console.error('‚ùå User not found:', userId)
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    if (user.role === 'admin') {
      console.error('‚ùå Cannot delete admin:', userId)
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    console.log('‚úÖ User found, starting deletion:', userId)
    
    // Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú (Ïô∏Îûò ÌÇ§ Ï†úÏïΩ Ï°∞Í±¥ Í≥†Î†§) - ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïÑÎèÑ ÏóêÎü¨ Î¨¥Ïãú
    try { await c.env.DB.prepare('DELETE FROM user_permissions WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip user_permissions:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM user_programs WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip user_programs:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM sender_ids WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip sender_ids:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM sender_verification_requests WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip sender_verification_requests:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM sms_logs WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip sms_logs:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM landing_pages WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip landing_pages:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM students WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip students:', e.message) }
    try { await c.env.DB.prepare('DELETE FROM deposit_requests WHERE user_id = ?').bind(userId).run() } catch (e) { console.log('Skip deposit_requests:', e.message) }
    
    console.log('‚úÖ Related data deleted, deleting user:', userId)
    
    // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
    const deleteResult = await c.env.DB.prepare('DELETE FROM users WHERE id = ?').bind(userId).run()
    console.log('‚úÖ User deleted successfully:', userId, deleteResult)
    
    return c.json({ success: true, message: 'ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('‚ùå Delete user error:', err)
    console.error('Error details:', err.message, err.stack)
    return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú Ïã§Ìå®: ' + err.message }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù
app.get('/api/admin/programs', async (c) => {
  try {
    const { results } = await c.env.DB.prepare('SELECT * FROM programs ORDER BY created_at DESC').all()
    return c.json({ success: true, programs: results })
  } catch (err) {
    console.error('Programs error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌîÑÎ°úÍ∑∏Îû® Ï∂îÍ∞Ä
app.post('/api/admin/programs', async (c) => {
  try {
    const { name, description, price, duration_days, max_students } = await c.req.json()
    
    const result = await c.env.DB.prepare(`
      INSERT INTO programs (name, description, price, duration_days, max_students, status, is_active)
      VALUES (?, ?, ?, ?, ?, 'active', 1)
    `).bind(name, description || '', price || 0, duration_days || 30, max_students || null).run()
    
    return c.json({ success: true, message: 'ÌîÑÎ°úÍ∑∏Îû®Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', id: result.meta.last_row_id })
  } catch (err) {
    console.error('Add program error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® Ï∂îÍ∞Ä Ïã§Ìå®' }, 500)
  }
})

// ÌîÑÎ°úÍ∑∏Îû® ÏàòÏ†ï
app.put('/api/admin/programs/:id', async (c) => {
  try {
    const id = c.req.param('id')
    const { name, description, price, duration_days, max_students, status } = await c.req.json()
    
    await c.env.DB.prepare(`
      UPDATE programs 
      SET name = ?, description = ?, price = ?, duration_days = ?, max_students = ?, status = ?
      WHERE id = ?
    `).bind(name, description, price, duration_days, max_students, status, id).run()
    
    return c.json({ success: true, message: 'ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Update program error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® ÏàòÏ†ï Ïã§Ìå®' }, 500)
  }
})

// ÌîÑÎ°úÍ∑∏Îû® ÏÇ≠Ï†ú
app.delete('/api/admin/programs/:id', async (c) => {
  try {
    const id = c.req.param('id')
    // ÏÜåÌîÑÌä∏ ÏÇ≠Ï†ú (statusÎ•º inactiveÎ°ú Î≥ÄÍ≤Ω)
    await c.env.DB.prepare('UPDATE programs SET status = ?, is_active = 0 WHERE id = ?').bind('inactive', id).run()
    
    return c.json({ success: true, message: 'ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Delete program error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})


// Í¥ÄÎ¶¨Ïûê - ÏàòÍ∞ï ÌòÑÌô©
app.get('/api/admin/enrollments', async (c) => {
  try {
    const query = 'SELECT up.*, u.name as user_name, p.name as program_name FROM user_programs up JOIN users u ON up.user_id = u.id JOIN programs p ON up.program_id = p.id WHERE up.status = ? ORDER BY up.created_at DESC'
    const { results } = await c.env.DB.prepare(query).bind('active').all()
    return c.json({ success: true, enrollments: results })
  } catch (err) {
    return c.json({ success: false, error: 'ÏàòÍ∞ï ÌòÑÌô© Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌÜµÍ≥Ñ - ÏõîÎ≥Ñ Í∞ÄÏûÖÏûê Ï∂îÏù¥ (ÏµúÍ∑º 6Í∞úÏõî)
app.get('/api/admin/stats/monthly-users', async (c) => {
  try {
    const query = `
      SELECT 
        strftime('%Y-%m', created_at) as month,
        COUNT(*) as count
      FROM users
      WHERE created_at >= date('now', '-6 months')
      GROUP BY month
      ORDER BY month ASC
    `
    const { results } = await c.env.DB.prepare(query).all()
    return c.json({ success: true, data: results })
  } catch (err) {
    console.error('Monthly users stats error:', err)
    return c.json({ success: false, error: 'ÌÜµÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌÜµÍ≥Ñ - ÌîÑÎ°úÍ∑∏Îû®Î≥Ñ ÏàòÍ∞ïÏÉù Ïàò
app.get('/api/admin/stats/program-enrollments', async (c) => {
  try {
    const query = `
      SELECT 
        p.name as program_name,
        p.price,
        COUNT(up.id) as enrollment_count,
        SUM(p.price) as revenue
      FROM programs p
      LEFT JOIN user_programs up ON p.id = up.program_id AND up.status = 'active'
      WHERE p.status = 'active'
      GROUP BY p.id, p.name, p.price
      ORDER BY enrollment_count DESC
    `
    const { results } = await c.env.DB.prepare(query).all()
    return c.json({ success: true, data: results })
  } catch (err) {
    console.error('Program enrollments stats error:', err)
    return c.json({ success: false, error: 'ÌÜµÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌÜµÍ≥Ñ - ÎåÄÏãúÎ≥¥Îìú ÏöîÏïΩ
app.get('/api/admin/stats/dashboard-summary', async (c) => {
  try {
    // Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê Ïàò
    const totalUsers = await c.env.DB.prepare('SELECT COUNT(*) as count FROM users').first()
    
    // ÌôúÏÑ± ÏÇ¨Ïö©Ïûê Ïàò (ÏµúÍ∑º 30Ïùº Î°úÍ∑∏Ïù∏)
    const activeUsers = await c.env.DB.prepare('SELECT COUNT(*) as count FROM users WHERE updated_at >= date("now", "-30 days")').first()
    
    // Ïã†Í∑ú Î¨∏Ïùò Ïàò (ÎåÄÍ∏∞Ï§ë)
    const pendingContacts = await c.env.DB.prepare('SELECT COUNT(*) as count FROM contacts WHERE status = ?').bind('pending').first()
    
    // Ï†ÑÏ≤¥ Î¨∏Ïùò Ïàò
    const totalContacts = await c.env.DB.prepare('SELECT COUNT(*) as count FROM contacts').first()
    
    // ÌôúÏÑ± ÌîÑÎ°úÍ∑∏Îû® Ïàò
    const activePrograms = await c.env.DB.prepare('SELECT COUNT(*) as count FROM programs WHERE status = ?').bind('active').first()
    
    // Ï†ÑÏ≤¥ ÏàòÍ∞ï Ïàò
    const totalEnrollments = await c.env.DB.prepare('SELECT COUNT(*) as count FROM user_programs WHERE status = ?').bind('active').first()
    
    // Ï¥ù Îß§Ï∂ú (ÏòàÏÉÅ)
    const totalRevenue = await c.env.DB.prepare(`
      SELECT SUM(p.price) as total
      FROM user_programs up
      JOIN programs p ON up.program_id = p.id
      WHERE up.status = 'active'
    `).first()
    
    return c.json({
      success: true,
      data: {
        totalUsers: totalUsers?.count || 0,
        activeUsers: activeUsers?.count || 0,
        pendingContacts: pendingContacts?.count || 0,
        totalContacts: totalContacts?.count || 0,
        activePrograms: activePrograms?.count || 0,
        totalEnrollments: totalEnrollments?.count || 0,
        totalRevenue: totalRevenue?.total || 0
      }
    })
  } catch (err) {
    console.error('Dashboard summary error:', err)
    return c.json({ success: false, error: 'ÌÜµÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÏÇ¨Ïö©ÏûêÎ≥Ñ ÌîÑÎ°úÍ∑∏Îû® Ï°∞Ìöå
app.get('/api/admin/users/:id/programs', async (c) => {
  try {
    const userId = c.req.param('id')
    const query = 'SELECT up.*, p.name as program_name, p.duration_days FROM user_programs up JOIN programs p ON up.program_id = p.id WHERE up.user_id = ? AND up.status = ? ORDER BY up.created_at DESC'
    const { results } = await c.env.DB.prepare(query).bind(userId, 'active').all()
    return c.json({ success: true, programs: results })
  } catch (err) {
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÌîÑÎ°úÍ∑∏Îû® Î∂ÄÏó¨
app.post('/api/admin/assign-program', async (c) => {
  try {
    const { user_id, program_id, end_date } = await c.req.json()
    const query = 'INSERT INTO user_programs (user_id, program_id, end_date, status) VALUES (?, ?, ?, ?)'
    await c.env.DB.prepare(query).bind(user_id, program_id, end_date || null, 'active').run()
    return c.json({ success: true, message: 'ÌîÑÎ°úÍ∑∏Îû®Ïù¥ Î∂ÄÏó¨ÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® Î∂ÄÏó¨ Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÌîÑÎ°úÍ∑∏Îû® ÏÇ≠Ï†ú
app.delete('/api/admin/remove-program/:id', async (c) => {
  try {
    const id = c.req.param('id')
    await c.env.DB.prepare('DELETE FROM user_programs WHERE id = ?').bind(id).run()
    return c.json({ success: true, message: 'ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    return c.json({ success: false, error: 'ÌîÑÎ°úÍ∑∏Îû® ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî
app.post('/api/admin/reset-password', async (c) => {
  try {
    const { user_id } = await c.req.json()
    const newPassword = 'academy1234' // Í∏∞Î≥∏ Ï¥àÍ∏∞Ìôî ÎπÑÎ∞ÄÎ≤àÌò∏
    const query = 'UPDATE users SET password = ? WHERE id = ?'
    await c.env.DB.prepare(query).bind(newPassword, user_id).run()
    return c.json({ success: true, message: `ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. (Ï¥àÍ∏∞ ÎπÑÎ∞ÄÎ≤àÌò∏: ${newPassword})` })
  } catch (err) {
    return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÏÇ¨Ïö©Ïûê ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
app.post('/api/admin/toggle-user-status', async (c) => {
  try {
    const { user_id, is_active } = await c.req.json()
    const status = is_active ? 'active' : 'inactive'
    const query = 'UPDATE users SET status = ? WHERE id = ?'
    await c.env.DB.prepare(query).bind(status, user_id).run()
    return c.json({ success: true, message: `ÏÇ¨Ïö©ÏûêÍ∞Ä ${is_active ? 'ÌôúÏÑ±Ìôî' : 'ÎπÑÌôúÏÑ±Ìôî'}ÎêòÏóàÏäµÎãàÎã§.` })
  } catch (err) {
    return c.json({ success: false, error: 'ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - Î¨∏Ïùò ÏÉÅÌÉú Î≥ÄÍ≤Ω
app.put('/api/admin/contacts/:id/status', async (c) => {
  try {
    const id = c.req.param('id')
    const { status } = await c.req.json()
    await c.env.DB.prepare('UPDATE contacts SET status = ? WHERE id = ?').bind(status, id).run()
    return c.json({ success: true, message: 'ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    return c.json({ success: false, error: 'ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïã§Ìå®' }, 500)
  }
})

// ========================================
// ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞ API
// ========================================

// ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±
app.post('/api/landing/create', async (c) => {
  try {
    const { title, template_type, input_data, thumbnail_url, og_title, og_description, folder_id } = await c.req.json()
    
    // ÎîîÎ≤ÑÍπÖ: Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
    console.log('üîç APIÏóêÏÑú Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞:', {
      title,
      template_type,
      thumbnail_url: thumbnail_url ? (thumbnail_url.length > 100 ? thumbnail_url.substring(0, 100) + '...' : thumbnail_url) : null,
      og_title,
      og_description,
      folder_id
    })
    
    // Base64 Ïù∏ÏΩîÎî©Îêú ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ ÎîîÏΩîÎî©
    const userHeaderBase64 = c.req.header('X-User-Data-Base64')
    let user = { id: 1 }
    if (userHeaderBase64) {
      try {
        const userDataStr = atob(userHeaderBase64)
        user = JSON.parse(userDataStr)
      } catch (e) {
        console.warn('Failed to decode user data:', e)
      }
    }
    
    // üî• ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± ÌïúÎèÑ Ï≤¥ÌÅ¨
    // First, get the user's academy_id and ensure it exists
    const userRecord = await c.env.DB.prepare(`SELECT id, academy_id FROM users WHERE id = ?`).bind(user.id).first()
    
    let academyIdToUse = userRecord?.academy_id
    if (!academyIdToUse) {
      // If user doesn't have academy_id, set it to user.id
      academyIdToUse = user.id
      try {
        await c.env.DB.prepare(`UPDATE users SET academy_id = ? WHERE id = ?`).bind(academyIdToUse, user.id).run()
        console.log('üîß [Landing] Auto-set academy_id for user:', user.id)
      } catch (e) {
        console.error('Failed to set academy_id:', e)
      }
    }
    
    const activeSubscription = await c.env.DB.prepare(`
      SELECT id, landing_page_limit 
      FROM subscriptions 
      WHERE academy_id = ?
        AND status = 'active' 
        AND subscription_end_date >= date('now')
      ORDER BY created_at DESC 
      LIMIT 1
    `).bind(academyIdToUse).first()
    
    if (!activeSubscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ±ÌôîÎêú Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§. ÌîåÎûúÏùÑ Íµ¨Îß§Ìï¥Ï£ºÏÑ∏Ïöî.' 
      }, 403)
    }
    
    const usage = await c.env.DB.prepare(`
      SELECT landing_pages_created 
      FROM usage_tracking 
      WHERE subscription_id = ?
    `).bind(activeSubscription.id).first()
    
    const currentPages = usage?.landing_pages_created || 0
    const pageLimit = activeSubscription.landing_page_limit
    
    if (currentPages >= pageLimit) {
      return c.json({ 
        success: false, 
        error: `‚õî ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä Î™®Îëê ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§.\n\nÏÉùÏÑ±Îêú ÎûúÎî©ÌéòÏù¥ÏßÄ: ${currentPages}Í∞ú / ÌïúÎèÑ: ${pageLimit}Í∞ú\n\nÎçî ÎßéÏùÄ ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º ÏÉùÏÑ±ÌïòÏãúÎ†§Î©¥ ÏÉÅÏúÑ ÌîåÎûúÏúºÎ°ú ÏóÖÍ∑∏Î†àÏù¥ÎìúÌï¥Ï£ºÏÑ∏Ïöî.` 
      }, 403)
    }
    
    // Í≥†Ïú† slug ÏÉùÏÑ± (ÎûúÎç§ 8ÏûêÎ¶¨)
    const slug = Math.random().toString(36).substring(2, 10)
    
    // AIÍ∞Ä HTML ÏÉùÏÑ± (ÌÖúÌîåÎ¶ø Í∏∞Î∞ò)
    const htmlContent = generateLandingPageHTML(template_type, input_data)
    
    // QR ÏΩîÎìú URL ÏÉùÏÑ± (Google Charts API ÏÇ¨Ïö©)
    const landingUrl = `${c.req.header('origin') || 'https://example.com'}/landing/${slug}`
    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(landingUrl)}`
    
    // DB Ï†ÄÏû•
    const query = `
      INSERT INTO landing_pages (user_id, slug, title, template_type, content_json, html_content, qr_code_url, thumbnail_url, og_title, og_description, folder_id, status)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'active')
    `
    const result = await c.env.DB.prepare(query)
      .bind(user.id, slug, title, template_type, JSON.stringify(input_data), htmlContent, qrCodeUrl, thumbnail_url || null, og_title || null, og_description || null, folder_id || null)
      .run()
    
    // üî• ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET landing_pages_created = landing_pages_created + 1, 
          updated_at = CURRENT_TIMESTAMP
      WHERE subscription_id = ?
    `).bind(activeSubscription.id).run()
    
    console.log('‚úÖ Landing page created and usage incremented:', currentPages + 1, '/', pageLimit)
    
    return c.json({ 
      success: true, 
      message: 'ÎûúÎî©ÌéòÏù¥ÏßÄÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.',
      slug,
      url: `/landing/${slug}`,
      usage: {
        current: currentPages + 1,
        limit: pageLimit
      },
      qrCodeUrl,
      id: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Landing page creation error:', err)
    return c.json({ success: false, error: 'ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± Ïã§Ìå®: ' + (error as Error).message }, 500)
  }
})

// ÏÇ¨Ïö©Ïûê ÎûúÎî©ÌéòÏù¥ÏßÄ Î™©Î°ù
app.get('/api/landing/my-pages', async (c) => {
  try {
    const userId = c.req.query('userId')
    const folderId = c.req.query('folderId')
    
    let query = 'SELECT id, slug, title, template_type, view_count, status, folder_id, created_at FROM landing_pages WHERE user_id = ?'
    let params = [userId]
    
    if (folderId) {
      query += ' AND folder_id = ?'
      params.push(folderId)
    } else if (folderId === null || folderId === 'null') {
      // Ìè¥ÎçîÍ∞Ä ÏóÜÎäî ÌéòÏù¥ÏßÄÎßå Ï°∞Ìöå
      query += ' AND folder_id IS NULL'
    }
    
    query += ' ORDER BY created_at DESC'
    
    const { results } = await c.env.DB.prepare(query).bind(...params).all()
    return c.json({ success: true, pages: results })
  } catch (err) {
    console.error('Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå
app.get('/api/landing/folders', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    // Ìè¥Îçî Î™©Î°ù
    const foldersQuery = 'SELECT id, name, created_at FROM landing_folders WHERE user_id = ? ORDER BY created_at DESC'
    const { results: folders } = await c.env.DB.prepare(foldersQuery).bind(userId).all()
    
    // Í∞Å Ìè¥ÎçîÏùò ÌéòÏù¥ÏßÄ Ïàò Í≥ÑÏÇ∞
    const foldersWithCount = await Promise.all(folders.map(async (folder) => {
      const countQuery = 'SELECT COUNT(*) as count FROM landing_pages WHERE folder_id = ?'
      const count = await c.env.DB.prepare(countQuery).bind(folder.id).first()
      return { ...folder, page_count: count.count || 0 }
    }))
    
    // Ï†ÑÏ≤¥ ÌéòÏù¥ÏßÄ Ïàò
    const totalQuery = 'SELECT COUNT(*) as count FROM landing_pages WHERE user_id = ?'
    const total = await c.env.DB.prepare(totalQuery).bind(userId).first()
    
    return c.json({ 
      success: true, 
      folders: foldersWithCount,
      totalPages: total.count || 0
    })
  } catch (err) {
    console.error('Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî ÏÉùÏÑ±
app.post('/api/landing/folders', async (c) => {
  try {
    const { userId, name, description } = await c.req.json()
    
    if (!name || !name.trim()) {
      return c.json({ success: false, error: 'Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.' }, 400)
    }
    
    const query = 'INSERT INTO landing_folders (user_id, name, description) VALUES (?, ?, ?)'
    const result = await c.env.DB.prepare(query).bind(userId, name.trim(), description || null).run()
    
    return c.json({ 
      success: true, 
      folderId: result.meta.last_row_id,
      message: 'Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (err) {
    console.error('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî ÏàòÏ†ï
app.put('/api/landing/folders/:id', async (c) => {
  try {
    const folderId = c.req.param('id')
    const { name, description } = await c.req.json()
    
    if (!name || !name.trim()) {
      return c.json({ success: false, error: 'Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.' }, 400)
    }
    
    const query = 'UPDATE landing_folders SET name = ?, description = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'
    await c.env.DB.prepare(query).bind(name.trim(), description || null, folderId).run()
    
    return c.json({ 
      success: true, 
      message: 'Ìè¥ÎçîÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (err) {
    console.error('Ìè¥Îçî ÏàòÏ†ï Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî ÏàòÏ†ï Ïã§Ìå®' }, 500)
  }
})

// Ìè¥Îçî ÏÇ≠Ï†ú
app.delete('/api/landing/folders/:id', async (c) => {
  try {
    const folderId = c.req.param('id')
    const userId = c.req.query('userId')
    
    // Ìè¥ÎçîÏóê ÏûàÎäî ÌéòÏù¥ÏßÄÎì§Ïùò folder_idÎ•º NULLÎ°ú Î≥ÄÍ≤Ω
    await c.env.DB.prepare('UPDATE landing_pages SET folder_id = NULL WHERE folder_id = ?')
      .bind(folderId).run()
    
    // Ìè¥Îçî ÏÇ≠Ï†ú
    await c.env.DB.prepare('DELETE FROM landing_folders WHERE id = ? AND user_id = ?')
      .bind(folderId, userId).run()
    
    return c.json({ 
      success: true, 
      message: 'Ìè¥ÎçîÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (err) {
    console.error('Ìè¥Îçî ÏÇ≠Ï†ú Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º Ìè¥ÎçîÎ°ú Ïù¥Îèô
app.put('/api/landing/move-to-folder', async (c) => {
  try {
    const { pageId, folderId } = await c.req.json()
    
    const query = 'UPDATE landing_pages SET folder_id = ? WHERE id = ?'
    await c.env.DB.prepare(query).bind(folderId, pageId).run()
    
    return c.json({ 
      success: true, 
      message: 'Ìè¥ÎçîÎ°ú Ïù¥ÎèôÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (err) {
    console.error('Ìè¥Îçî Ïù¥Îèô Ïã§Ìå®:', err)
    return c.json({ success: false, error: 'Ìè¥Îçî Ïù¥Îèô Ïã§Ìå®' }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ Ï°∞Ìöå
app.get('/api/landing/:slug', async (c) => {
  try {
    const slug = c.req.param('slug')
    const query = 'SELECT * FROM landing_pages WHERE slug = ? AND status = ?'
    const result = await c.env.DB.prepare(query).bind(slug, 'active').first()
    
    if (!result) {
      return c.json({ success: false, error: 'ÌéòÏù¥ÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Ï°∞ÌöåÏàò Ï¶ùÍ∞Ä
    await c.env.DB.prepare('UPDATE landing_pages SET view_count = view_count + 1 WHERE slug = ?').bind(slug).run()
    
    // ÏÉÅÏÑ∏ Ï°∞Ìöå Î°úÍ∑∏ Ï†ÄÏû•
    const viewQuery = 'INSERT INTO landing_page_views (landing_page_id, user_agent, referrer) VALUES (?, ?, ?)'
    await c.env.DB.prepare(viewQuery).bind(
      result.id,
      c.req.header('user-agent') || '',
      c.req.header('referer') || ''
    ).run()
    
    return c.json({ success: true, page: result })
  } catch (err) {
    return c.json({ success: false, error: 'ÌéòÏù¥ÏßÄ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ ÌÜµÍ≥Ñ
app.get('/api/landing/stats/summary', async (c) => {
  try {
    const userHeader = c.req.header('X-User-Data')
    const user = userHeader ? JSON.parse(userHeader) : { id: 1 }
    
    // Ï¥ù ÌéòÏù¥ÏßÄ Ïàò
    const totalPages = await c.env.DB.prepare('SELECT COUNT(*) as count FROM landing_pages WHERE user_id = ?').bind(user.id).first()
    
    // Ï¥ù Ï°∞ÌöåÏàò
    const totalViews = await c.env.DB.prepare('SELECT SUM(view_count) as total FROM landing_pages WHERE user_id = ?').bind(user.id).first()
    
    // Í∞ÄÏû• Ïù∏Í∏∞ÏûàÎäî ÌéòÏù¥ÏßÄ top 5
    const topPages = await c.env.DB.prepare('SELECT id, title, slug, view_count FROM landing_pages WHERE user_id = ? ORDER BY view_count DESC LIMIT 5').bind(user.id).all()
    
    return c.json({
      success: true,
      stats: {
        totalPages: totalPages?.count || 0,
        totalViews: totalViews?.total || 0,
        topPages: topPages.results || []
      }
    })
  } catch (err) {
    return c.json({ success: false, error: 'ÌÜµÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÇ≠Ï†ú
app.delete('/api/landing/:id', async (c) => {
  try {
    const id = c.req.param('id')
    const userId = c.req.query('userId')
    const userHeader = c.req.header('X-User-Data')
    
    let user
    if (userId) {
      user = { id: parseInt(userId) }
    } else if (userHeader) {
      user = JSON.parse(userHeader)
    } else {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.' }, 401)
    }
    
    console.log('Deleting landing page:', { id, userId: user.id })
    const result = await c.env.DB.prepare('DELETE FROM landing_pages WHERE id = ? AND user_id = ?').bind(id, user.id).run()
    console.log('Delete result:', result)
    
    if (result.meta.changes === 0) {
      return c.json({ success: false, error: 'ÏÇ≠Ï†úÌï† ÌéòÏù¥ÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    return c.json({ success: true, message: 'ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err: any) {
    console.error('Landing page delete error:', err)
    return c.json({ success: false, error: err.message || 'ÏÇ≠Ï†ú Ïã§Ìå®' }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ HTML ÏÉùÏÑ± Ìï®Ïàò
function generateLandingPageHTML(template_type: string, data: any): string {
  const templates: any = {
    'academy-intro': generateAcademyIntroHTML,
    'program-promo': generateProgramPromoHTML,
    'event-promo': generateEventPromoHTML,
    'parent-letter': generateParentLetterHTML,
    'student-report': generateStudentReportHTML,
    'admission-info': generateAdmissionInfoHTML,
    'academy-stats': generateAcademyStatsHTML,
    'teacher-intro': generateTeacherIntroHTML
  }
  
  const generator = templates[template_type] || templates['academy-intro']
  return generator(data)
}

// ÌïôÏõê ÏÜåÍ∞ú ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø (Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† ÏÉÅÏÑ∏Ìïú Î≤ÑÏ†Ñ)
function generateAcademyIntroHTML(data: any): string {
  const { academyName, location, features, specialties, contact } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${academyName} - ÌïôÏõê ÏÜåÍ∞ú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
      .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .pattern-bg { background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0); background-size: 40px 40px; }
      @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
      .float-animation { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Hero Section with Enhanced Design -->
    <div class="gradient-bg pattern-bg text-white py-24 px-6 relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="max-w-6xl mx-auto relative z-10">
            <div class="text-center mb-16">
                <div class="inline-block bg-white/20 backdrop-blur-sm px-6 py-3 rounded-full text-sm font-bold mb-6 float-animation">
                    <i class="fas fa-graduation-cap mr-2"></i>ÎØøÏùÑ Ïàò ÏûàÎäî ÍµêÏú° ÌååÌä∏ÎÑà
                </div>
                <h1 class="text-6xl font-bold mb-6 leading-tight">${academyName}</h1>
                <div class="flex items-center justify-center gap-4 text-xl mb-8">
                    <i class="fas fa-map-marker-alt"></i>
                    <p class="text-2xl">${location}</p>
                </div>
                <p class="text-2xl opacity-95 max-w-3xl mx-auto leading-relaxed">${features || 'ÌïôÏÉù Ìïú Î™Ö Ìïú Î™ÖÏùò ÍøàÏùÑ ÏùëÏõêÌïòÎäî ÍµêÏú° ÌååÌä∏ÎÑà'}</p>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid md:grid-cols-4 gap-6 mt-12">
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 text-center">
                    <div class="text-4xl font-bold mb-2">500+</div>
                    <div class="text-sm opacity-90">ÌïôÏÉù Ïàò</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 text-center">
                    <div class="text-4xl font-bold mb-2">98%</div>
                    <div class="text-sm opacity-90">ÌïôÎ∂ÄÎ™® ÎßåÏ°±ÎèÑ</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 text-center">
                    <div class="text-4xl font-bold mb-2">15ÎÖÑ</div>
                    <div class="text-sm opacity-90">ÍµêÏú° Í≤ΩÎ†•</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 text-center">
                    <div class="text-4xl font-bold mb-2">1:1</div>
                    <div class="text-sm opacity-90">ÎßûÏ∂§ Í¥ÄÎ¶¨</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-6 py-20">
        <!-- ÌïôÏõê ÏÜåÍ∞ú -->
        <div class="mb-20">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-school text-purple-600 mr-3"></i>
                    Ïö∞Î¶¨ ÌïôÏõêÏùÑ ÏÜåÍ∞úÌï©ÎãàÎã§
                </h2>
                <p class="text-xl text-gray-600">${academyName}Îäî ÌïôÏÉù Í∞úÍ∞úÏù∏Ïùò ÏÑ±Ïû•ÏùÑ ÏµúÏö∞ÏÑ†ÏúºÎ°ú ÏÉùÍ∞ÅÌï©ÎãàÎã§</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl p-8 shadow-lg">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center text-white text-2xl">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">Ïö∞Î¶¨Ïùò Î™©Ìëú</h3>
                    </div>
                    <p class="text-gray-700 text-lg leading-relaxed">
                        Îã®ÏàúÌûà ÏÑ±Ï†Å Ìñ•ÏÉÅÏùÑ ÎÑòÏñ¥, ÌïôÏÉùÎì§Ïù¥ Ïä§Ïä§Î°ú ÌïôÏäµÌïòÎäî ÌûòÏùÑ Í∏∞Î•¥Í≥† 
                        ÏûêÏã†Ïùò ÍøàÏùÑ Ìñ•Ìï¥ ÎÇòÏïÑÍ∞à Ïàò ÏûàÎèÑÎ°ù ÎèïÎäî Í≤ÉÏù¥ Ïö∞Î¶¨Ïùò Î™©ÌëúÏûÖÎãàÎã§. 
                        Ï≤¥Í≥ÑÏ†ÅÏù∏ Ïª§Î¶¨ÌÅòÎüºÍ≥º Í∞úÎ≥Ñ ÎßûÏ∂§ ÌïôÏäµÏúºÎ°ú ÏµúÏÉÅÏùò Í≤∞Í≥ºÎ•º ÎßåÎì§Ïñ¥ÎÉÖÎãàÎã§.
                    </p>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-green-50 rounded-2xl p-8 shadow-lg">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white text-2xl">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">Ïö∞Î¶¨Ïùò ÏïΩÏÜç</h3>
                    </div>
                    <p class="text-gray-700 text-lg leading-relaxed">
                        Î™®Îì† ÌïôÏÉùÏùÑ ÎÇ¥ ÏûêÎÖÄÏ≤òÎüº ÏÉùÍ∞ÅÌïòÎ©∞, Ìïú Î™Ö Ìïú Î™ÖÏóêÍ≤å ÏµúÏÑ†ÏùÑ Îã§Ìï©ÎãàÎã§. 
                        Ï†ïÍ∏∞Ï†ÅÏù∏ ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥Í≥º Ïã§ÏãúÍ∞Ñ ÌïôÏäµ Î¶¨Ìè¨Ìä∏Î•º ÌÜµÌï¥ 
                        ÌïôÏÉùÏùò ÏÑ±Ïû• Í≥ºÏ†ïÏùÑ Ìà¨Î™ÖÌïòÍ≤å Í≥µÏú†Ìï©ÎãàÎã§.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- ÌäπÎ≥ÑÌïú Í∞ïÏ†ê -->
        <div class="bg-white rounded-3xl shadow-2xl p-12 mb-20">
            <h2 class="text-4xl font-bold text-gray-900 mb-12 text-center">
                <i class="fas fa-star text-yellow-500 mr-3"></i>
                ${academyName}Ïùò ÌäπÎ≥ÑÌïú Í∞ïÏ†ê
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                ${(specialties || []).map((s: string, i: number) => `
                    <div class="group hover:transform hover:scale-105 transition-all duration-300">
                        <div class="flex items-start gap-6 p-8 bg-gradient-to-br from-purple-50 to-white rounded-2xl border-2 border-purple-100 hover:border-purple-300 hover:shadow-xl">
                            <div class="w-14 h-14 bg-gradient-to-br from-purple-600 to-purple-800 rounded-2xl flex items-center justify-center text-white font-bold text-2xl flex-shrink-0 shadow-lg group-hover:scale-110 transition-transform">
                                ${i + 1}
                            </div>
                            <div class="flex-1">
                                <p class="text-gray-800 text-xl leading-relaxed font-medium">${s}</p>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <!-- ÌïôÏäµ ÏãúÏä§ÌÖú -->
        <div class="mb-20">
            <h2 class="text-4xl font-bold text-gray-900 mb-12 text-center">
                <i class="fas fa-cogs text-purple-600 mr-3"></i>
                Ï≤¥Í≥ÑÏ†ÅÏù∏ ÌïôÏäµ ÏãúÏä§ÌÖú
            </h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white rounded-2xl p-8 shadow-lg border-t-4 border-purple-600">
                    <div class="text-5xl mb-6 text-center">üìù</div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 text-center">1Îã®Í≥Ñ: ÏßÑÎã® ÌèâÍ∞Ä</h3>
                    <p class="text-gray-600 text-center leading-relaxed">
                        ÌïôÏÉùÏùò ÌòÑÏû¨ Ïã§Î†•Í≥º ÌïôÏäµ Ïä§ÌÉÄÏùºÏùÑ Ï†ïÌôïÌûà ÌååÏïÖÌïòÏó¨ 
                        ÎßûÏ∂§Ìòï ÌïôÏäµ Í≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌï©ÎãàÎã§.
                    </p>
                </div>
                <div class="bg-white rounded-2xl p-8 shadow-lg border-t-4 border-blue-600">
                    <div class="text-5xl mb-6 text-center">üìö</div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 text-center">2Îã®Í≥Ñ: ÎßûÏ∂§ ÏàòÏóÖ</h3>
                    <p class="text-gray-600 text-center leading-relaxed">
                        Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ Ïª§Î¶¨ÌÅòÎüºÏúºÎ°ú ÏïΩÏ†êÏùÑ ÏßëÏ§ë Î≥¥ÏôÑÌïòÍ≥† 
                        Í∞ïÏ†êÏùÑ ÎçîÏö± Î∞úÏ†ÑÏãúÌÇµÎãàÎã§.
                    </p>
                </div>
                <div class="bg-white rounded-2xl p-8 shadow-lg border-t-4 border-green-600">
                    <div class="text-5xl mb-6 text-center">üìä</div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 text-center">3Îã®Í≥Ñ: ÏÑ±Í≥º Í¥ÄÎ¶¨</h3>
                    <p class="text-gray-600 text-center leading-relaxed">
                        Ï†ïÍ∏∞ ÌÖåÏä§Ìä∏ÏôÄ ÌïôÏäµ Î¶¨Ìè¨Ìä∏Î°ú 
                        ÏßÄÏÜçÏ†ÅÏù∏ ÏÑ±Ïû•ÏùÑ ÌôïÏù∏ÌïòÍ≥† Í¥ÄÎ¶¨Ìï©ÎãàÎã§.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- ÌïôÎ∂ÄÎ™® ÌõÑÍ∏∞ -->
        <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-3xl p-12 mb-20">
            <h2 class="text-4xl font-bold text-gray-900 mb-12 text-center">
                <i class="fas fa-comments text-purple-600 mr-3"></i>
                ÌïôÎ∂ÄÎ™®ÎãòÎì§Ïùò ÏÉùÏÉùÌïú ÌõÑÍ∏∞
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl p-8 shadow-lg">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 text-2xl font-bold">
                            ÍπÄ
                        </div>
                        <div>
                            <div class="font-bold text-lg">ÍπÄÏßÄÌòÑ ÌïôÎ∂ÄÎ™®Îãò</div>
                            <div class="text-gray-500 text-sm">Ï§ë3 ÌïôÏÉù Ïñ¥Î®∏Îãà</div>
                        </div>
                    </div>
                    <div class="text-yellow-400 text-xl mb-4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p class="text-gray-700 leading-relaxed">
                        "ÏïÑÏù¥Í∞Ä Í≥µÎ∂ÄÏóê Ìù•ÎØ∏Î•º ÏûÉÏñ¥ Í≥†ÎØºÏù¥ÏóàÎäîÎç∞, ${academyName}ÏóêÏÑú 
                        1:1 ÎßûÏ∂§ Í¥ÄÎ¶¨Î•º Î∞õÏúºÎ©¥ÏÑú ÏÑ±Ï†ÅÎèÑ Ïò§Î•¥Í≥† ÏûêÏã†Í∞êÎèÑ ÏÉùÍ≤ºÏñ¥Ïöî. 
                        ÏÑ†ÏÉùÎãòÎì§Ïùò ÏÑ∏Ïã¨Ìïú Í¥ÄÎ¶¨Ïóê Ï†ïÎßê Í∞êÏÇ¨ÎìúÎ¶ΩÎãàÎã§!"
                    </p>
                </div>
                <div class="bg-white rounded-2xl p-8 shadow-lg">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-2xl font-bold">
                            Î∞ï
                        </div>
                        <div>
                            <div class="font-bold text-lg">Î∞ïÏ§ÄÏòÅ ÌïôÎ∂ÄÎ™®Îãò</div>
                            <div class="text-gray-500 text-sm">Í≥†2 ÌïôÏÉù ÏïÑÎ≤ÑÏßÄ</div>
                        </div>
                    </div>
                    <div class="text-yellow-400 text-xl mb-4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p class="text-gray-700 leading-relaxed">
                        "ÏûÖÏãú Ïª®ÏÑ§ÌåÖÍπåÏßÄ Ìï®ÍªòÌï¥Ï£ºÏÖîÏÑú Ï†ïÎßê ÎßåÏ°±Ïä§ÎüΩÏäµÎãàÎã§. 
                        Ï≤¥Í≥ÑÏ†ÅÏù∏ ÌïôÏäµ Í¥ÄÎ¶¨ÏôÄ Ï†ïÍ∏∞Ï†ÅÏù∏ ÌîºÎìúÎ∞±ÏúºÎ°ú 
                        ÏïÑÏù¥Ïùò ÏÑ±Ïû•ÏùÑ ÎààÏúºÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÏñ¥Ïöî."
                    </p>
                </div>
            </div>
        </div>
        
        <!-- CTA Section -->
        <div class="bg-gradient-to-br from-purple-600 to-purple-900 rounded-3xl shadow-2xl p-12 text-white text-center">
            <h2 class="text-4xl font-bold mb-6">
                <i class="fas fa-phone-alt mr-3"></i>
                ÏßÄÍ∏à Î∞îÎ°ú ÏÉÅÎã¥ Î∞õÏúºÏÑ∏Ïöî!
            </h2>
            <p class="text-2xl mb-8 opacity-95">
                Î¨¥Î£å ÌïôÏäµ ÏßÑÎã® Î∞è ÎßûÏ∂§ ÏÉÅÎã¥ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§
            </p>
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 mb-8 max-w-2xl mx-auto">
                <div class="text-3xl font-bold mb-4">
                    <i class="fas fa-phone text-yellow-300 mr-3"></i>
                    ${contact || 'ÏÉÅÎã¥ Î¨∏Ïùò'}
                </div>
                <p class="text-lg opacity-90">ÌèâÏùº Ïò§Ï†Ñ 9Ïãú ~ Ïò§ÌõÑ 10Ïãú | Ï£ºÎßê Ïò§Ï†Ñ 10Ïãú ~ Ïò§ÌõÑ 6Ïãú</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="tel:${contact}" class="inline-flex items-center justify-center bg-white text-purple-600 px-10 py-5 rounded-full text-xl font-bold hover:bg-gray-100 transition-all transform hover:scale-105 shadow-lg">
                    <i class="fas fa-phone mr-3"></i>
                    Ï†ÑÌôî ÏÉÅÎã¥ÌïòÍ∏∞
                </a>
                <a href="javascript:alert('Ïπ¥Ïπ¥Ïò§ÌÜ° ÏÉÅÎã¥ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§')" class="inline-flex items-center justify-center bg-yellow-300 text-gray-900 px-10 py-5 rounded-full text-xl font-bold hover:bg-yellow-200 transition-all transform hover:scale-105 shadow-lg">
                    <i class="fab fa-comment mr-3"></i>
                    Ïπ¥Ïπ¥Ïò§ÌÜ° Î¨∏Ïùò
                </a>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-12 px-6">
        <div class="max-w-6xl mx-auto text-center">
            <h3 class="text-2xl font-bold text-white mb-4">${academyName}</h3>
            <p class="mb-4">
                <i class="fas fa-map-marker-alt mr-2"></i>${location}
            </p>
            <p class="mb-4">
                <i class="fas fa-phone mr-2"></i>${contact || 'ÏÉÅÎã¥ Î¨∏Ïùò'}
            </p>
            <p class="text-sm opacity-75 mt-8">¬© 2026 ${academyName}. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
  `
}

// ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateProgramPromoHTML(data: any): string {
  const { programName, target, features, price, duration, cta } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${programName} - ÌîÑÎ°úÍ∑∏Îû® ÏïàÎÇ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen py-12 px-6">
    <div class="max-w-3xl mx-auto">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-12 text-center">
                <div class="inline-block bg-white/20 px-6 py-2 rounded-full text-sm font-medium mb-6">
                    ${target || 'ÎàÑÍµ¨ÎÇò Ï∞∏Ïó¨ Í∞ÄÎä•'}
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4">${programName}</h1>
                <p class="text-xl opacity-90">${duration || 'ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî'}</p>
            </div>
            
            <div class="p-10">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üéØ Ïù¥Îü∞ Î∂ÑÎì§ÏóêÍ≤å Ï∂îÏ≤úÌï©ÎãàÎã§</h2>
                <div class="space-y-4 mb-10">
                    ${(features || []).map((f: string) => `
                        <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-xl">
                            <span class="text-2xl">‚úÖ</span>
                            <span class="text-lg text-gray-800">${f}</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl p-8 mb-10 border-2 border-yellow-200">
                    <div class="text-center">
                        <p class="text-gray-600 text-lg mb-2">ÌäπÎ≥Ñ Í∞ÄÍ≤©</p>
                        <p class="text-5xl font-bold text-gray-900 mb-2">${price}Ïõê</p>
                        <p class="text-gray-500">${duration}</p>
                    </div>
                </div>
                
                <a href="${cta || '#'}" class="block w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white text-center py-5 rounded-xl text-xl font-bold hover:shadow-2xl transition transform hover:scale-105">
                    üöÄ ÏßÄÍ∏à Î∞îÎ°ú Ïã†Ï≤≠ÌïòÍ∏∞
                </a>
            </div>
        </div>
    </div>
</body>
</html>
  `
}

// Ïù¥Î≤§Ìä∏ ÌîÑÎ°úÎ™®ÏÖò ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateEventPromoHTML(data: any): string {
  const { eventName, period, benefits, urgency, cta } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${eventName} - ÌäπÎ≥Ñ Ïù¥Î≤§Ìä∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
      @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
      .pulse-animation { animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <div class="min-h-screen flex items-center justify-center px-6 py-12">
        <div class="max-w-2xl w-full">
            <div class="bg-gradient-to-br from-red-600 via-pink-600 to-purple-600 rounded-3xl p-1">
                <div class="bg-black rounded-3xl p-10">
                    <div class="text-center mb-10">
                        <div class="inline-block bg-red-600 px-6 py-2 rounded-full text-sm font-bold mb-6 pulse-animation">
                            ‚ö° ${urgency || 'ÌïúÏ†ï ÌäπÍ∞Ä'}
                        </div>
                        <h1 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-yellow-300 to-red-300 bg-clip-text text-transparent">
                            ${eventName}
                        </h1>
                        <p class="text-2xl text-gray-300 mb-4">üìÖ ${period}</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-500/10 to-red-500/10 rounded-2xl p-8 mb-10 border border-yellow-500/30">
                        <h2 class="text-2xl font-bold mb-6 text-yellow-300">üéÅ ÌäπÎ≥Ñ ÌòúÌÉù</h2>
                        <div class="space-y-4">
                            ${(benefits || []).map((b: string) => `
                                <div class="flex items-center gap-3">
                                    <span class="text-3xl">‚≠ê</span>
                                    <span class="text-lg">${b}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <a href="${cta || '#'}" class="block w-full bg-gradient-to-r from-yellow-400 to-red-500 text-black text-center py-6 rounded-xl text-2xl font-bold hover:shadow-2xl transition transform hover:scale-105">
                        üî• ÏßÄÍ∏à Î∞îÎ°ú Ïã†Ï≤≠ÌïòÍ∏∞
                    </a>
                    
                    <p class="text-center text-gray-400 text-sm mt-6">‚è∞ ÏÑúÎëêÎ•¥ÏÑ∏Ïöî! Ï°∞Í∏∞ ÎßàÍ∞êÎê† Ïàò ÏûàÏäµÎãàÎã§</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
  `
}

// Í∞ÄÏ†ïÌÜµÏã†Î¨∏ ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateParentLetterHTML(data: any): string {
  const { academyName, noticeTitle, noticeDate, noticeContent, keyPoints, contactInfo, staffName } = data
  const keyPointsList = keyPoints ? keyPoints.split('\n').filter((p: string) => p.trim()) : []
  
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${noticeTitle} - ${academyName}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
      .notice-border { border-left: 4px solid #10b981; }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen py-8 px-4">
    <div class="max-w-3xl mx-auto">
        <!-- Ìó§Îçî -->
        <div class="bg-white rounded-t-2xl p-8 shadow-lg">
            <div class="text-center border-b-2 border-green-500 pb-6">
                <div class="inline-block bg-green-100 px-6 py-2 rounded-full mb-4">
                    <span class="text-green-800 font-bold text-sm">üìß Í∞ÄÏ†ïÌÜµÏã†Î¨∏</span>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
                    ${academyName}
                </h1>
                <p class="text-gray-600 text-lg">${noticeDate}</p>
            </div>
        </div>

        <!-- Î≥∏Î¨∏ -->
        <div class="bg-white p-8 shadow-lg">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6 pb-3 border-b-2 border-gray-200">
                    ${noticeTitle}
                </h2>
                <div class="text-lg text-gray-700 leading-relaxed whitespace-pre-wrap mb-8">
                    ${noticeContent}
                </div>
            </div>

            ${keyPointsList.length > 0 ? `
            <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-8 notice-border">
                <h3 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                    <span class="text-2xl">üìå</span>
                    Ï£ºÏöî ÏïàÎÇ¥ÏÇ¨Ìï≠
                </h3>
                <div class="space-y-3">
                    ${keyPointsList.map((point: string) => `
                        <div class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                            <span class="text-green-600 font-bold text-lg flex-shrink-0">‚Ä¢</span>
                            <span class="text-gray-800 leading-relaxed">${point}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}

            <!-- Î¨∏ÏùòÏ≤ò -->
            <div class="bg-gradient-to-r from-blue-500 to-green-500 rounded-xl p-6 text-white">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <p class="font-bold text-lg mb-2">üìû Î¨∏ÏùòÌïòÍ∏∞</p>
                        <p class="text-2xl font-bold">${contactInfo}</p>
                        ${staffName ? `<p class="text-sm opacity-90 mt-1">${staffName}</p>` : ''}
                    </div>
                    <a href="tel:${contactInfo.replace(/[^0-9]/g, '')}" class="bg-white text-green-600 px-6 py-3 rounded-xl font-bold hover:shadow-lg transition transform hover:scale-105">
                        Ï†ÑÌôîÌïòÍ∏∞
                    </a>
                </div>
            </div>
        </div>

        <!-- Ìë∏ÌÑ∞ -->
        <div class="bg-gray-100 rounded-b-2xl p-6 shadow-lg text-center">
            <p class="text-gray-600 text-sm">Ìï≠ÏÉÅ ÏµúÏÑ†ÏùÑ Îã§ÌïòÎäî ${academyName}Ïù¥ ÎêòÍ≤†ÏäµÎãàÎã§.</p>
            <p class="text-gray-500 text-xs mt-2">Í∞êÏÇ¨Ìï©ÎãàÎã§ üôè</p>
        </div>
    </div>
</body>
</html>
  `
}

// ÌïôÏÉù ÏÑ±Í≥º Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø (Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† ÏÉÅÏÑ∏Ìïú Î≤ÑÏ†Ñ)
// ÌïôÏÉù ÏÑ±Í≥º Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø (Î™®Î∞îÏùº ÏµúÏ†ÅÌôî + ÍµêÏû¨/Ï∂úÏÑù Ï∂îÍ∞Ä)
function generateStudentReportHTML(data: any): string {
  const { 
    studentName, month, achievements, improvements, nextGoals, teacherName,
    textbooks, attendanceRate, attendanceDays, totalDays
  } = data
  
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>${studentName} ÌïôÏÉù ${month} ÌïôÏäµ Î¶¨Ìè¨Ìä∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
      @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      .animate-slide { animation: slideInUp 0.6s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen py-4 sm:py-8 px-3 sm:px-6">
    <div class="max-w-4xl mx-auto">
        <!-- Header Card -->
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-xl sm:shadow-2xl overflow-hidden mb-4 sm:mb-8 animate-slide">
            <div class="bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 text-white p-6 sm:p-10 text-center relative">
                <div class="absolute top-2 right-2 sm:top-4 sm:right-4 bg-white/20 backdrop-blur-sm px-3 py-1.5 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-bold">
                    <i class="fas fa-calendar-alt mr-1 sm:mr-2"></i>${month}
                </div>
                <div class="mb-4 sm:mb-6">
                    <div class="inline-block bg-white/20 backdrop-blur-sm px-4 py-1.5 sm:px-6 sm:py-2 rounded-full text-xs sm:text-sm font-bold mb-2 sm:mb-4">
                        üìä Monthly Learning Report
                    </div>
                </div>
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-3 sm:mb-4">${month} ÌïôÏäµ Î¶¨Ìè¨Ìä∏</h1>
                <div class="flex items-center justify-center gap-2 sm:gap-3 text-2xl sm:text-3xl font-bold">
                    <i class="fas fa-user-graduate"></i>
                    <span>${studentName} ÌïôÏÉù</span>
                </div>
                <p class="text-sm sm:text-lg mt-3 sm:mt-4 opacity-90">Ïó¥Ïã¨Ìûà ÎÖ∏Î†•Ìïú Ìïú Îã¨Ïùò Í∏∞Î°ùÏûÖÎãàÎã§</p>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-3 divide-x divide-gray-200 bg-gray-50">
                <div class="p-3 sm:p-6 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-green-600 mb-0.5 sm:mb-1">${(achievements || []).length}</div>
                    <div class="text-xs sm:text-sm text-gray-600">Ïù¥Îã¨Ïùò ÏÑ±Í≥º</div>
                </div>
                <div class="p-3 sm:p-6 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-blue-600 mb-0.5 sm:mb-1">${attendanceRate || 95}%</div>
                    <div class="text-xs sm:text-sm text-gray-600">Ï∂úÏÑùÎ•†</div>
                </div>
                <div class="p-3 sm:p-6 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-purple-600 mb-0.5 sm:mb-1">${(nextGoals || []).length}</div>
                    <div class="text-xs sm:text-sm text-gray-600">Îã§Ïùå Î™©Ìëú</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-lg sm:shadow-xl p-4 sm:p-6 md:p-10 mb-4 sm:mb-8 space-y-6 sm:space-y-10">
            
            <!-- ÍµêÏû¨ Ï†ïÎ≥¥ -->
            ${(textbooks && textbooks.length > 0) ? `
            <div class="p-4 sm:p-6 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl sm:rounded-2xl border-2 border-amber-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4 flex items-center gap-2 sm:gap-3">
                    <i class="fas fa-book text-amber-600 text-2xl sm:text-3xl"></i>
                    ÏÇ¨Ïö© ÍµêÏû¨
                </h2>
                <div class="space-y-2 sm:space-y-3">
                    ${(textbooks || []).map((book: string) => `
                        <div class="flex items-center gap-2 sm:gap-3 p-3 sm:p-4 bg-white rounded-lg sm:rounded-xl shadow-sm">
                            <i class="fas fa-check-circle text-amber-600 text-lg sm:text-xl flex-shrink-0"></i>
                            <span class="text-sm sm:text-base text-gray-800 font-medium">${book}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Ï∂úÏÑù ÌòÑÌô© -->
            <div class="p-4 sm:p-6 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl sm:rounded-2xl border-2 border-blue-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4 flex items-center gap-2 sm:gap-3">
                    <i class="fas fa-calendar-check text-blue-600 text-2xl sm:text-3xl"></i>
                    Ï∂úÏÑù ÌòÑÌô©
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div class="bg-white rounded-lg sm:rounded-xl p-4 sm:p-5 shadow-sm">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm sm:text-base text-gray-700 font-medium">Ï∂úÏÑùÎ•†</span>
                            <span class="text-2xl sm:text-3xl font-bold text-blue-600">${attendanceRate || 95}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 sm:h-3">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2.5 sm:h-3 rounded-full" style="width: ${attendanceRate || 95}%"></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg sm:rounded-xl p-4 sm:p-5 shadow-sm">
                        <div class="text-center">
                            <div class="text-sm sm:text-base text-gray-600 mb-2">Ï∂úÏÑù ÏùºÏàò</div>
                            <div class="text-2xl sm:text-3xl font-bold text-blue-600">${attendanceDays || 19}Ïùº / ${totalDays || 20}Ïùº</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ïù¥Îã¨Ïùò ÏÑ±Í≥º -->
            <div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4 sm:mb-6 flex flex-wrap items-center gap-2 sm:gap-3">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center text-white flex-shrink-0">
                        <i class="fas fa-trophy text-base sm:text-lg"></i>
                    </div>
                    <span class="text-xl sm:text-2xl md:text-3xl">Ïù¥Îã¨Ïùò ÏÑ±Í≥º</span>
                    <span class="hidden sm:inline text-base sm:text-lg text-gray-500 font-normal">Outstanding Achievements</span>
                </h2>
                <div class="space-y-3 sm:space-y-4">
                    ${(achievements || []).map((a: string, idx: number) => `
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 p-4 sm:p-6 rounded-r-xl sm:rounded-r-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-start gap-3 sm:gap-4">
                                <div class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm sm:text-base">
                                    ${idx + 1}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-gray-800 text-base sm:text-lg md:text-xl leading-relaxed font-medium break-words">${a}</p>
                                    <div class="mt-2 sm:mt-3">
                                        <span class="inline-block text-xs bg-green-100 text-green-700 px-2 sm:px-3 py-1 rounded-full font-medium">
                                            <i class="fas fa-check-circle mr-1"></i>Îã¨ÏÑ± ÏôÑÎ£å
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂Ñ -->
            ${(improvements && improvements.length > 0) ? `
            <div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4 sm:mb-6 flex flex-wrap items-center gap-2 sm:gap-3">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-600 rounded-full flex items-center justify-center text-white flex-shrink-0">
                        <i class="fas fa-chart-line text-base sm:text-lg"></i>
                    </div>
                    <span class="text-xl sm:text-2xl md:text-3xl">Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂Ñ</span>
                    <span class="hidden sm:inline text-base sm:text-lg text-gray-500 font-normal">Areas for Improvement</span>
                </h2>
                <div class="space-y-3 sm:space-y-4">
                    ${(improvements || []).map((i: string, idx: number) => `
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border-l-4 border-blue-500 p-4 sm:p-6 rounded-r-xl sm:rounded-r-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-start gap-3 sm:gap-4">
                                <div class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm sm:text-base">
                                    ${idx + 1}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-gray-800 text-base sm:text-lg md:text-xl leading-relaxed font-medium break-words">${i}</p>
                                    <div class="mt-2 sm:mt-3">
                                        <span class="inline-block text-xs bg-blue-100 text-blue-700 px-2 sm:px-3 py-1 rounded-full font-medium">
                                            <i class="fas fa-lightbulb mr-1"></i>Í∞úÏÑ† Î∞©Ìñ•
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Îã§Ïùå Îã¨ Î™©Ìëú -->
            <div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4 sm:mb-6 flex flex-wrap items-center gap-2 sm:gap-3">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-purple-600 rounded-full flex items-center justify-center text-white flex-shrink-0">
                        <i class="fas fa-bullseye text-base sm:text-lg"></i>
                    </div>
                    <span class="text-xl sm:text-2xl md:text-3xl">Îã§Ïùå Îã¨ ÌïôÏäµ Î™©Ìëú</span>
                    <span class="hidden sm:inline text-base sm:text-lg text-gray-500 font-normal">Next Month Goals</span>
                </h2>
                <div class="space-y-3 sm:space-y-4">
                    ${(nextGoals || []).map((g: string, idx: number) => `
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 p-4 sm:p-6 rounded-r-xl sm:rounded-r-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-start gap-3 sm:gap-4">
                                <div class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm sm:text-base">
                                    ${idx + 1}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-gray-800 text-base sm:text-lg md:text-xl leading-relaxed font-medium break-words">${g}</p>
                                    <div class="mt-2 sm:mt-3">
                                        <span class="inline-block text-xs bg-purple-100 text-purple-700 px-2 sm:px-3 py-1 rounded-full font-medium">
                                            <i class="fas fa-star mr-1"></i>Î™©Ìëú ÏÑ§Ï†ï
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-lg p-4 sm:p-6 md:p-8 text-center">
            <p class="text-base sm:text-lg text-gray-700 mb-2 sm:mb-3">Îã¥Îãπ ÏÑ†ÏÉùÎãò: <span class="font-bold text-purple-600">${teacherName || 'Îã¥Îãπ ÍµêÏÇ¨'}</span></p>
            <p class="text-xs sm:text-sm text-gray-500">Ïù¥ Î¶¨Ìè¨Ìä∏Îäî ÌïôÏÉùÏùò ÌïôÏäµ ÏÑ±Ïû•ÏùÑ ÏúÑÌïú Í∏∞Î°ùÏûÖÎãàÎã§</p>
        </div>
    </div>
</body>
</html>
  `
}

// ÏûÖÌïô ÏÑ§Î™ÖÌöå ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateAdmissionInfoHTML(data: any): string {
  const { eventTitle, eventDate, eventTime, location, agenda, benefits, targetGrade, contact } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${eventTitle} - ÏûÖÌïô ÏÑ§Î™ÖÌöå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen py-12 px-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white p-12 text-center">
                <div class="inline-block bg-white/20 px-6 py-2 rounded-full text-sm font-bold mb-6">
                    üéì ${targetGrade || 'Ï†ÑÏ≤¥ ÌïôÎÖÑ'} ÎåÄÏÉÅ
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4">${eventTitle}</h1>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-xl mt-8">
                    <div class="flex items-center gap-2">
                        <span>üìÖ</span>
                        <span>${eventDate}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span>üïê</span>
                        <span>${eventTime}</span>
                    </div>
                </div>
                <p class="text-lg mt-4 opacity-90">üìç ${location}</p>
            </div>
            
            <div class="p-10">
                <div class="mb-10">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">üìã ÏÑ§Î™ÖÌöå ÏïàÎÇ¥</h2>
                    <div class="space-y-4">
                        ${(agenda || []).map((item: string, i: number) => `
                            <div class="flex items-start gap-4 p-5 bg-indigo-50 rounded-xl">
                                <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                                    ${i + 1}
                                </div>
                                <div class="flex-1">
                                    <p class="text-gray-800 text-lg leading-relaxed">${item}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="mb-10">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">üéÅ Ï∞∏ÏÑù ÌòúÌÉù</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        ${(benefits || []).map((benefit: string) => `
                            <div class="flex items-center gap-3 p-5 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200">
                                <span class="text-3xl">‚≠ê</span>
                                <span class="text-gray-800 font-medium">${benefit}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white text-center">
                    <h3 class="text-2xl font-bold mb-4">Ï∞∏ÏÑù Ïã†Ï≤≠</h3>
                    <p class="text-lg mb-6">Ï†ÑÌôî ÎòêÎäî Ïπ¥Ïπ¥Ïò§ÌÜ°ÏúºÎ°ú Ïã†Ï≤≠ÌïòÏÑ∏Ïöî</p>
                    <a href="tel:${contact}" class="inline-block bg-white text-purple-600 px-10 py-4 rounded-full text-xl font-bold hover:bg-gray-100 transition">
                        üìû ${contact}
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
  `
}

// ÌïôÏõê ÏÑ±Í≥º ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateAcademyStatsHTML(data: any): string {
  const { academyName, period, totalStudents, achievements, testimonials, gradeImprovement } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${academyName} - ÏÑ±Í≥º ÌÜµÍ≥Ñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 py-12 px-6">
    <div class="max-w-5xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-gray-900 mb-4">${academyName}</h1>
            <p class="text-2xl text-gray-600">${period} ÏÑ±Í≥º Î≥¥Í≥†ÏÑú</p>
        </div>
        
        <div class="grid md:grid-cols-3 gap-6 mb-12">
            <div class="bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl p-8 text-white text-center">
                <div class="text-5xl font-bold mb-2">${totalStudents || 0}</div>
                <div class="text-xl opacity-90">Ï¥ù Ïû¨ÌïôÏÉù</div>
            </div>
            <div class="bg-gradient-to-br from-green-500 to-green-700 rounded-2xl p-8 text-white text-center">
                <div class="text-5xl font-bold mb-2">${gradeImprovement || '2'}Îì±Í∏â</div>
                <div class="text-xl opacity-90">ÌèâÍ∑† ÏÑ±Ï†Å Ìñ•ÏÉÅ</div>
            </div>
            <div class="bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl p-8 text-white text-center">
                <div class="text-5xl font-bold mb-2">95%</div>
                <div class="text-xl opacity-90">Ïû¨Îì±Î°ùÎ•†</div>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl shadow-xl p-10 mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">üèÜ Ï£ºÏöî ÏÑ±Í≥º</h2>
            <div class="space-y-4">
                ${(achievements || []).map((ach: string) => `
                    <div class="flex items-start gap-4 p-5 bg-yellow-50 border-l-4 border-yellow-500 rounded-r-xl">
                        <span class="text-3xl">üéØ</span>
                        <p class="text-gray-800 text-lg leading-relaxed flex-1">${ach}</p>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <div class="bg-white rounded-2xl shadow-xl p-10">
            <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">üí¨ ÌïôÎ∂ÄÎ™® ÌõÑÍ∏∞</h2>
            <div class="space-y-6">
                ${(testimonials || []).map((test: string) => `
                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="flex text-yellow-400">
                                ${'‚≠ê'.repeat(5)}
                            </div>
                        </div>
                        <p class="text-gray-700 leading-relaxed">"${test}"</p>
                    </div>
                `).join('')}
            </div>
        </div>
    </div>
</body>
</html>
  `
}

// ÏÑ†ÏÉùÎãò ÏÜåÍ∞ú ÌéòÏù¥ÏßÄ ÌÖúÌîåÎ¶ø
function generateTeacherIntroHTML(data: any): string {
  const { teacherName, subject, experience, education, specialty, achievements, teachingStyle, contact } = data
  return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${teacherName} ÏÑ†ÏÉùÎãò - ÏÜåÍ∞ú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-teal-50 to-cyan-50 min-h-screen py-12 px-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 text-white p-12 text-center">
                <div class="w-32 h-32 bg-white/20 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-6xl">üë®‚Äçüè´</span>
                </div>
                <h1 class="text-4xl font-bold mb-3">${teacherName} ÏÑ†ÏÉùÎãò</h1>
                <p class="text-2xl opacity-90">${subject} Ï†ÑÎ¨∏</p>
                <div class="mt-6 inline-block bg-white/20 px-6 py-2 rounded-full">
                    <span class="text-lg font-medium">Í≤ΩÎ†• ${experience}ÎÖÑ</span>
                </div>
            </div>
            
            <div class="p-10">
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">üéì ÌïôÎ†•</h2>
                    <div class="bg-teal-50 rounded-xl p-6">
                        <p class="text-gray-800 text-lg leading-relaxed">${education}</p>
                    </div>
                </div>
                
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">üí° Ï†ÑÎ¨∏ Î∂ÑÏïº</h2>
                    <div class="bg-cyan-50 rounded-xl p-6">
                        <p class="text-gray-800 text-lg leading-relaxed">${specialty}</p>
                    </div>
                </div>
                
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">üèÜ Ï£ºÏöî Ïã§Ï†Å</h2>
                    <div class="space-y-3">
                        ${(achievements || []).map((ach: string) => `
                            <div class="flex items-center gap-3 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl">
                                <span class="text-2xl">üéØ</span>
                                <span class="text-gray-800">${ach}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">üìö ÏàòÏóÖ Î∞©Ïãù</h2>
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200">
                        <p class="text-gray-700 text-lg leading-relaxed">${teachingStyle}</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl p-8 text-white text-center">
                    <h3 class="text-2xl font-bold mb-4">ÏàòÏóÖ Î¨∏Ïùò</h3>
                    <a href="tel:${contact}" class="inline-block bg-white text-teal-600 px-10 py-4 rounded-full text-xl font-bold hover:bg-gray-100 transition">
                        üìû ${contact || 'Î¨∏ÏùòÌïòÍ∏∞'}
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
  `
}

// AI ÌïôÎ∂ÄÎ™® Î©îÏãúÏßÄ ÏÉùÏÑ± API
app.post('/api/generate-parent-message', async (c) => {
  try {
    const { studentName, grade, subject, shortMessage } = await c.req.json()
    
    if (!studentName || !grade || !subject || !shortMessage) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î©îÏãúÏßÄ ÏÉùÏÑ± (ÌòÑÏû¨Îäî API ÌÇ§ ÏóÜÏù¥ ÏûëÎèô)
    const templateMessage = generateTemplateMessage(studentName, grade, subject, shortMessage)
    return c.json({ 
      success: true, 
      message: templateMessage,
      metadata: {
        studentName,
        grade,
        subject,
        originalMessage: shortMessage,
        mode: 'template'
      }
    })

    // API ÌÇ§Í∞Ä ÏûàÏúºÎ©¥ Ïã§Ï†ú AI Ìò∏Ï∂ú
    try {
      const response = await fetch(`${baseURL}/chat/completions`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-5-mini',
          messages: [
            {
              role: 'system',
              content: `ÎãπÏã†ÏùÄ ÌïôÏõê ÏõêÏû•ÎãòÏûÖÎãàÎã§. ÌïôÎ∂ÄÎ™®ÎãòÍªò ÌïôÏÉùÏùò ÌïôÏäµ ÌòÑÌô©ÏùÑ Îî∞ÎúªÌïòÍ≥† Í≤©Î†§ÌïòÎäî ÎßêÌà¨Î°ú Ï†ÑÎã¨ÌïòÎäî Î©îÏãúÏßÄÎ•º ÏûëÏÑ±Ìï©ÎãàÎã§.

Í∑úÏπô:
1. Ï°¥ÎåìÎßê ÏÇ¨Ïö© (ÌïôÎ∂ÄÎ™®ÎãòÍªò)
2. Îî∞ÎúªÌïòÍ≥† Í∏çÏ†ïÏ†ÅÏù∏ ÌÜ§
3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ïπ≠Ï∞¨ Ìè¨Ìï®
4. ÏïûÏúºÎ°úÏùò ÌïôÏäµ Î∞©Ìñ• Ï†úÏãú
5. 200-300Ïûê Ï†ïÎèÑÏùò Ï†ÅÏ†àÌïú Í∏∏Ïù¥
6. Ïù¥Î™®ÏßÄ 2-3Í∞ú ÏûêÏó∞Ïä§ÎüΩÍ≤å ÏÇ¨Ïö©
7. ÌïôÎ∂ÄÎ™®ÎãòÏù¥ ÏïàÏã¨ÌïòÍ≥† Ïã†Î¢∞Ìï† Ïàò ÏûàÎäî ÎÇ¥Ïö©`
            },
            {
              role: 'user',
              content: `ÌïôÏÉù Ïù¥Î¶Ñ: ${studentName}
ÌïôÎÖÑ: ${grade}
Í≥ºÎ™©: ${subject}
ÏõêÏû•ÎãòÏùò ÏßßÏùÄ Î©îÎ™®: ${shortMessage}

ÏúÑ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú ÌïôÎ∂ÄÎ™®ÎãòÍªò Î≥¥ÎÇº Îî∞ÎúªÌïú Î©îÏãúÏßÄÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.`
            }
          ],
          temperature: 0.8,
          max_tokens: 500
        })
      })

      const data = await response.json()
      
      if (!response.ok) {
        console.error('OpenAI API error:', data)
        // API Ïò§Î•ò Ïãú ÌÖúÌîåÎ¶ø Î©îÏãúÏßÄÎ°ú Ìè¥Î∞±
        const templateMessage = generateTemplateMessage(studentName, grade, subject, shortMessage)
        return c.json({ 
          success: true, 
          message: templateMessage,
          metadata: {
            studentName,
            grade,
            subject,
            originalMessage: shortMessage,
            mode: 'template_fallback'
          }
        })
      }

      const generatedMessage = data.choices[0]?.message?.content || ''

      return c.json({ 
        success: true, 
        message: generatedMessage,
        metadata: {
          studentName,
          grade,
          subject,
          originalMessage: shortMessage,
          mode: 'ai'
        }
      })
    } catch (apiError) {
      console.error('API call error:', apiError)
      // API Ìò∏Ï∂ú Ïã§Ìå® Ïãú ÌÖúÌîåÎ¶ø Î©îÏãúÏßÄÎ°ú Ìè¥Î∞±
      const templateMessage = generateTemplateMessage(studentName, grade, subject, shortMessage)
      return c.json({ 
        success: true, 
        message: templateMessage,
        metadata: {
          studentName,
          grade,
          subject,
          originalMessage: shortMessage,
          mode: 'template_fallback'
        }
      })
    }
  } catch (err) {
    console.error('Generate message error:', err)
    return c.json({ success: false, error: 'Î©îÏãúÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÌïôÏÉù Í∏∞Î°ù Í∏∞Î∞ò ÌïôÎ∂ÄÎ™® Î©îÏãúÏßÄ ÏÉùÏÑ± API (Ïã†Í∑ú)
app.post('/api/generate-parent-message-from-records', async (c) => {
  try {
    const { studentId, studentName, grade, subjects, parentName, records, additionalMessage } = await c.req.json()
    
    if (!studentId || !studentName) {
      return c.json({ success: false, error: 'ÌïôÏÉù Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }

    // Í∏∞Î°ù Î∂ÑÏÑù
    const recordsSummary = analyzeRecords(records)
    
    // AI ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
    const aiPrompt = generateAIPrompt(studentName, grade, subjects, parentName, recordsSummary, additionalMessage)
    
    // OpenAI API Ìò∏Ï∂ú (ÌôòÍ≤Ω Î≥ÄÏàòÏóê API ÌÇ§Í∞Ä ÏûàÏúºÎ©¥)
    const apiKey = c.env.OPENAI_API_KEY
    const baseURL = c.env.OPENAI_BASE_URL || 'https://api.openai.com/v1'

    if (apiKey) {
      try {
        const response = await fetch(`${baseURL}/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: [
              {
                role: 'system',
                content: `ÎãπÏã†ÏùÄ ÌïôÏõê ÏõêÏû•ÎãòÏûÖÎãàÎã§. ÌïôÎ∂ÄÎ™®ÎãòÍªò ÌïôÏÉùÏùò ÌïôÏäµ ÌòÑÌô©ÏùÑ Îî∞ÎúªÌïòÍ≥† Í≤©Î†§ÌïòÎäî ÎßêÌà¨Î°ú Ï†ÑÎã¨ÌïòÎäî Î©îÏãúÏßÄÎ•º ÏûëÏÑ±Ìï©ÎãàÎã§.

Í∑úÏπô:
1. Ï°¥ÎåìÎßê ÏÇ¨Ïö© (ÌïôÎ∂ÄÎ™®ÎãòÍªò)
2. Îî∞ÎúªÌïòÍ≥† Í∏çÏ†ïÏ†ÅÏù∏ ÌÜ§
3. Íµ¨Ï≤¥Ï†ÅÏù∏ Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Ïπ≠Ï∞¨ (Ï∂úÏÑùÎ•†, Í≥ºÏ†ú ÏôÑÏÑ±Î•†, Ïù¥Ìï¥ÎèÑ Îì±)
4. Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÎèÑ Í≤©Î†§ÏôÄ Ìï®Íªò Ï†ÑÎã¨
5. ÏïûÏúºÎ°úÏùò ÌïôÏäµ Î∞©Ìñ• Ï†úÏãú
6. 250-350Ïûê Ï†ïÎèÑÏùò Ï†ÅÏ†àÌïú Í∏∏Ïù¥
7. Ïù¥Î™®ÏßÄ 2-3Í∞ú ÏûêÏó∞Ïä§ÎüΩÍ≤å ÏÇ¨Ïö©
8. ÌïôÎ∂ÄÎ™®ÎãòÏù¥ ÏïàÏã¨ÌïòÍ≥† Ïã†Î¢∞Ìï† Ïàò ÏûàÎäî ÎÇ¥Ïö©
9. ÏµúÍ∑º 7ÏùºÍ∞ÑÏùò Íµ¨Ï≤¥Ï†ÅÏù∏ ÌïôÏäµ Í∏∞Î°ùÏùÑ Î∞îÌÉïÏúºÎ°ú ÏûëÏÑ±`
              },
              {
                role: 'user',
                content: aiPrompt
              }
            ],
            temperature: 0.8,
            max_tokens: 600
          })
        })

        const data = await response.json()
        
        if (response.ok && data.choices && data.choices[0]) {
          return c.json({ 
            success: true, 
            message: data.choices[0].message.content,
            metadata: {
              studentName,
              grade,
              subjects,
              mode: 'ai',
              recordsCount: records.length
            }
          })
        }
      } catch (apiError) {
        console.error('OpenAI API error:', apiError)
        // API Ïã§Ìå® Ïãú ÌÖúÌîåÎ¶øÏúºÎ°ú Ìè¥Î∞±
      }
    }

    // ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î©îÏãúÏßÄ ÏÉùÏÑ± (Ìè¥Î∞±)
    const templateMessage = generateTemplateMessageFromRecords(
      studentName, 
      grade, 
      subjects, 
      parentName, 
      recordsSummary, 
      additionalMessage
    )
    
    return c.json({ 
      success: true, 
      message: templateMessage,
      metadata: {
        studentName,
        grade,
        subjects,
        mode: 'template',
        recordsCount: records.length
      }
    })
  } catch (err) {
    console.error('Generate message from records error:', err)
    return c.json({ success: false, error: 'Î©îÏãúÏßÄ ÏÉùÏÑ± Ïã§Ìå®: ' + (err as Error).message }, 500)
  }
})

// Í∏∞Î°ù Î∂ÑÏÑù Ìï®Ïàò
function analyzeRecords(records: any[]) {
  if (!records || records.length === 0) {
    return {
      totalDays: 0,
      attendanceRate: 0,
      homeworkRate: 0,
      avgUnderstanding: 0,
      avgParticipation: 0,
      achievements: [],
      memos: [],
      latestRecords: []
    }
  }

  const totalDays = records.length
  const attendanceCount = records.filter(r => r.attendance === 'Ï∂úÏÑù').length
  const homeworkCompleted = records.filter(r => r.homework_status === 'ÏôÑÎ£å').length
  
  const understandingScores = records.filter(r => r.understanding_level).map(r => r.understanding_level)
  const participationScores = records.filter(r => r.participation_level).map(r => r.participation_level)
  
  const avgUnderstanding = understandingScores.length > 0 
    ? (understandingScores.reduce((a, b) => a + b, 0) / understandingScores.length).toFixed(1)
    : '0'
  
  const avgParticipation = participationScores.length > 0
    ? (participationScores.reduce((a, b) => a + b, 0) / participationScores.length).toFixed(1)
    : '0'

  const achievements = records.filter(r => r.achievement).map(r => r.achievement)
  const memos = records.filter(r => r.memo).map(r => r.memo)

  return {
    totalDays,
    attendanceRate: ((attendanceCount / totalDays) * 100).toFixed(0),
    homeworkRate: totalDays > 0 ? ((homeworkCompleted / totalDays) * 100).toFixed(0) : '0',
    avgUnderstanding,
    avgParticipation,
    achievements,
    memos,
    latestRecords: records.slice(0, 3)
  }
}

// AI ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
function generateAIPrompt(studentName: string, grade: string, subjects: string, parentName: string, summary: any, additionalMessage: string) {
  const achievementsList = summary.achievements.length > 0 
    ? `Ï£ºÏöî ÏÑ±Í≥º:\n${summary.achievements.slice(0, 3).map((a: string) => `- ${a}`).join('\n')}` 
    : ''
  
  const memosList = summary.memos.length > 0 
    ? `ÏÑ†ÏÉùÎãò Î©îÎ™®:\n${summary.memos.slice(0, 3).map((m: string) => `- ${m}`).join('\n')}` 
    : ''
  
  const additionalPart = additionalMessage ? `Ï∂îÍ∞Ä Ï†ÑÎã¨ ÏÇ¨Ìï≠: ${additionalMessage}` : ''
  
  return `ÌïôÏÉù Ïù¥Î¶Ñ: ${studentName}
ÌïôÎÖÑ: ${grade}
Í≥ºÎ™©: ${subjects}
ÌïôÎ∂ÄÎ™®: ${parentName || 'ÌïôÎ∂ÄÎ™®'} Îãò

ÏµúÍ∑º 7ÏùºÍ∞Ñ ÌïôÏäµ Í∏∞Î°ù Î∂ÑÏÑù:
- Ï¥ù ÏàòÏóÖ ÏùºÏàò: ${summary.totalDays}Ïùº
- Ï∂úÏÑùÎ•†: ${summary.attendanceRate}%
- Í≥ºÏ†ú ÏôÑÏÑ±Î•†: ${summary.homeworkRate}%
- ÌèâÍ∑† Ïù¥Ìï¥ÎèÑ: ${summary.avgUnderstanding}/5Ï†ê
- ÌèâÍ∑† Ï∞∏Ïó¨ÎèÑ: ${summary.avgParticipation}/5Ï†ê

${achievementsList}

${memosList}

${additionalPart}

ÏúÑ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú ${parentName || 'ÌïôÎ∂ÄÎ™®'} ÎãòÍªò Î≥¥ÎÇº Îî∞ÎúªÌïòÍ≥† Íµ¨Ï≤¥Ï†ÅÏù∏ Î©îÏãúÏßÄÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. 
ÌïôÏÉùÏùò Í∞ïÏ†êÏùÑ Íµ¨Ï≤¥Ï†ÅÏù∏ ÏàòÏπòÏôÄ Ìï®Íªò Ïπ≠Ï∞¨ÌïòÍ≥†, Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÏùÄ Í≤©Î†§ÏôÄ Ìï®Íªò Ï†úÏãúÌï¥Ï£ºÏÑ∏Ïöî.`
}

// ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î©îÏãúÏßÄ ÏÉùÏÑ± (Í∏∞Î°ù Í∏∞Î∞ò)
function generateTemplateMessageFromRecords(studentName: string, grade: string, subjects: string, parentName: string, summary: any, additionalMessage: string) {
  const parentTitle = parentName ? `${parentName} ÌïôÎ∂ÄÎ™®Îãò` : 'ÌïôÎ∂ÄÎ™®Îãò'
  
  let message = `ÏïàÎÖïÌïòÏÑ∏Ïöî, ${parentTitle}! üòä\n\n`
  message += `${studentName} ÌïôÏÉùÏùò ÏµúÍ∑º ÏùºÏ£ºÏùº ÌïôÏäµ ÌòÑÌô©ÏùÑ Ï†ÑÎã¨ÎìúÎ¶ΩÎãàÎã§.\n\n`
  
  // Í∏çÏ†ïÏ†ÅÏù∏ Î∂ÄÎ∂Ñ Í∞ïÏ°∞
  if (parseInt(summary.attendanceRate) >= 80) {
    message += `‚úÖ Ï∂úÏÑùÎ•† ${summary.attendanceRate}%Î°ú ÏÑ±Ïã§ÌïòÍ≤å ÏàòÏóÖÏóê Ï∞∏Ïó¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§. `
  }
  
  if (parseInt(summary.homeworkRate) >= 70) {
    message += `Í≥ºÏ†ú ÏôÑÏÑ±Î•†ÎèÑ ${summary.homeworkRate}%Î°ú Íæ∏Ï§ÄÌûà Í≥ºÏ†úÎ•º ÏôÑÏàòÌïòÍ≥† ÏûàÏñ¥Ïöî. `
  }
  
  if (parseFloat(summary.avgUnderstanding) >= 4.0) {
    message += `\n\nÌäπÌûà Ïù¥Ìï¥ÎèÑÍ∞Ä ${summary.avgUnderstanding}/5Ï†êÏúºÎ°ú ÏàòÏóÖ ÎÇ¥Ïö©ÏùÑ Ïûò ÏÜåÌôîÌïòÍ≥† ÏûàÏäµÎãàÎã§! üëç `
  } else if (parseFloat(summary.avgUnderstanding) >= 3.0) {
    message += `\n\nÏù¥Ìï¥ÎèÑÎäî ${summary.avgUnderstanding}/5Ï†êÏúºÎ°ú Íæ∏Ï§ÄÌûà Î∞úÏ†ÑÌïòÍ≥† ÏûàÏäµÎãàÎã§. `
  }
  
  if (parseFloat(summary.avgParticipation) >= 4.0) {
    message += `ÏàòÏóÖ Ï∞∏Ïó¨ÎèÑÎèÑ ${summary.avgParticipation}/5Ï†êÏúºÎ°ú Îß§Ïö∞ Ï†ÅÍ∑πÏ†ÅÏù¥ÏóêÏöî! `
  }
  
  // ÏÑ±Í≥º Ï∂îÍ∞Ä
  if (summary.achievements.length > 0) {
    message += `\n\nüéØ ÏµúÍ∑º ÏÑ±Í≥º:\n${summary.achievements.slice(0, 2).map((a: string) => `- ${a}`).join('\n')}\n`
  }
  
  // Ï∂îÍ∞Ä Î©îÏãúÏßÄ
  if (additionalMessage) {
    message += `\n${additionalMessage}\n`
  }
  
  // ÎßàÎ¨¥Î¶¨ Í≤©Î†§
  message += `\nÏïûÏúºÎ°úÎèÑ ${studentName} ÌïôÏÉùÏù¥ ÎçîÏö± ÏÑ±Ïû•Ìï† Ïàò ÏûàÎèÑÎ°ù ÏµúÏÑ†ÏùÑ Îã§Ìï¥ ÏßÄÎèÑÌïòÍ≤†ÏäµÎãàÎã§. üí™`
  
  return message
}

// ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î©îÏãúÏßÄ ÏÉùÏÑ± Ìï®Ïàò
function generateTemplateMessage(studentName: string, grade: string, subject: string, shortMessage: string): string {
  const templates = [
    `ÏïàÎÖïÌïòÏÑ∏Ïöî, ${studentName} ÌïôÎ∂ÄÎ™®Îãò! üòä

Ïò§Îäò ${subject} ÏàòÏóÖÏóêÏÑú ${studentName} ÌïôÏÉùÏùò Î™®ÏäµÏùÑ Ï†ÑÌï¥ÎìúÎ¶ΩÎãàÎã§.

${shortMessage}

${studentName}Ïùò ÏÑ±Ïû• Î™®ÏäµÏù¥ Ï†ïÎßê Î≥¥Í∏∞ Ï¢ãÏäµÎãàÎã§. ÏïûÏúºÎ°úÎèÑ Ïù¥Î†áÍ≤å Íæ∏Ï§ÄÌûà ÎÖ∏Î†•ÌïúÎã§Î©¥ ${subject} Ïã§Î†•Ïù¥ ÎçîÏö± ÌÉÑÌÉÑÌï¥Ïßà Í≤ÉÏûÖÎãàÎã§! üí™

Ìï≠ÏÉÅ ÏùëÏõêÌïòÍ≤†ÏäµÎãàÎã§. Í∞êÏÇ¨Ìï©ÎãàÎã§!`,
    
    `${studentName} ÌïôÎ∂ÄÎ™®Îãò, ÏïàÎÖïÌïòÏÑ∏Ïöî! üëã

${grade} ${subject} ÏàòÏóÖ ÏÜåÏãùÏùÑ Ï†ÑÌï¥ÎìúÎ¶ΩÎãàÎã§.

${shortMessage}

${studentName}Ïùò Ïù¥Îü¨Ìïú Î™®ÏäµÏù¥ Ï†ïÎßê ÏûêÎûëÏä§ÎüΩÏäµÎãàÎã§. Í≥ÑÏÜçÌï¥ÏÑú Ïù¥Îü∞ Í∏çÏ†ïÏ†ÅÏù∏ ÏûêÏÑ∏Î°ú ÌïôÏäµÏóê ÏûÑÌïúÎã§Î©¥ Î™©ÌëúÌïú ÏÑ±Í≥ºÎ•º Íº≠ Ïù¥Î£∞ Ïàò ÏûàÏùÑ Í±∞ÏòàÏöî! üéØ

Í∂ÅÍ∏àÌïòÏã† Ï†ê ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Ïó∞ÎùΩ Ï£ºÏÑ∏Ïöî!`,
    
    `ÌïôÎ∂ÄÎ™®Îãò, ÏïàÎÖïÌïòÏÑ∏Ïöî! üòä

Ïò§Îäò ${studentName} ÌïôÏÉùÏùò ${subject} ÏàòÏóÖ ÌòÑÌô©ÏùÑ ÎßêÏîÄÎìúÎ¶ΩÎãàÎã§.

${shortMessage}

${studentName}Í∞Ä Î≥¥Ïó¨Ï§Ä Ïù¥Îü∞ Î™®ÏäµÎì§Ïù¥ Ï†ïÎßê Ïù∏ÏÉÅ ÍπäÏóàÏäµÎãàÎã§. Ïù¥ÎåÄÎ°úÎßå Íæ∏Ï§ÄÌûà ÎÖ∏Î†•ÌïúÎã§Î©¥ ${subject} Í≥ºÎ™©ÏóêÏÑú Îçî ÌÅ∞ Î∞úÏ†ÑÏùÑ Í∏∞ÎåÄÌï† Ïàò ÏûàÍ≤†ÏäµÎãàÎã§! ‚ú®

ÏïûÏúºÎ°úÎèÑ ${studentName}Ïùò ÏÑ±Ïû•ÏùÑ Ìï®Íªò ÏùëÏõêÌïòÍ≤†ÏäµÎãàÎã§!`
  ]
  
  // ÎûúÎç§ÌïòÍ≤å ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù
  const randomIndex = Math.floor(Math.random() * templates.length)
  return templates[randomIndex]
}

// AI Î∏îÎ°úÍ∑∏ Í∏Ä ÏÉùÏÑ± API
app.post('/api/generate-blog-post', async (c) => {
  try {
    const { topic, keywords, tone } = await c.req.json()
    
    if (!topic) {
      return c.json({ success: false, error: 'Ï£ºÏ†úÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    // ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î∏îÎ°úÍ∑∏ ÏÉùÏÑ± (ÌòÑÏû¨Îäî API ÌÇ§ ÏóÜÏù¥ ÏûëÎèô)
    const templateBlog = generateTemplateBlog(topic, keywords, tone)
    return c.json({ 
      success: true, 
      content: templateBlog,
      metadata: {
        topic,
        keywords,
        tone,
        wordCount: templateBlog.length,
        mode: 'template'
      }
    })

    // API ÌÇ§Í∞Ä ÏûàÏúºÎ©¥ Ïã§Ï†ú AI Ìò∏Ï∂ú
    try {
      const response = await fetch(`${baseURL}/chat/completions`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-5',
          messages: [
            {
              role: 'system',
              content: `ÎãπÏã†ÏùÄ ÌïôÏõê ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏ Î∏îÎ°úÍ∑∏ ÏûëÍ∞ÄÏûÖÎãàÎã§. ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ SEOÏóê ÏµúÏ†ÅÌôîÎêú Í∏ÄÏùÑ ÏûëÏÑ±Ìï©ÎãàÎã§.

Í∏ÄÏì∞Í∏∞ ÏõêÏπô:
1. Ï†úÎ™©: Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÎ•º Ìè¨Ìï®Ìïú Îß§Î†•Ï†ÅÏù∏ Ï†úÎ™©
2. ÏÑúÎ°†: ÎèÖÏûêÏùò Í¥ÄÏã¨ÏùÑ ÎÅÑÎäî Í≥µÍ∞ê ÎÇ¥Ïö©
3. Î≥∏Î°†: Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Ïã§Ïö©Ï†ÅÏù∏ Ï†ïÎ≥¥ (3-5Í∞ÄÏßÄ ÌïµÏã¨ Ìè¨Ïù∏Ìä∏)
4. Í≤∞Î°†: ÌñâÎèôÏùÑ Ïú†ÎèÑÌïòÎäî ÎßàÎ¨¥Î¶¨
5. ÌÇ§ÏõåÎìú: ÏûêÏó∞Ïä§ÎüΩÍ≤å 3-5Ìöå Î∞òÎ≥µ
6. Í∏∏Ïù¥: 1500-2000Ïûê
7. ÌÜ§: ${tone || 'ÏπúÍ∑ºÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏù∏'}
8. Î¨∏Îã®: 3-4Î¨∏Ïû•ÏúºÎ°ú Íµ¨ÏÑ±, Í∞ÄÎèÖÏÑ± ÎÜíÍ≤å
9. Ïù¥Î™®ÏßÄ Ï†ÅÏ†àÌûà ÏÇ¨Ïö©`
            },
            {
              role: 'user',
              content: `Î∏îÎ°úÍ∑∏ Ï£ºÏ†ú: ${topic}
${keywords ? `Ìè¨Ìï®Ìï† ÌÇ§ÏõåÎìú: ${keywords}` : ''}

ÏúÑ Ï£ºÏ†úÎ°ú ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏Ïóê Ïò¨Î¶¥ Í∏ÄÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.
Ï†úÎ™©, ÏÑúÎ°†, Î≥∏Î°†, Í≤∞Î°†ÏùÑ Î™ÖÌôïÌûà Íµ¨Î∂ÑÌï¥ÏÑú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.`
            }
          ],
          temperature: 0.9,
          max_tokens: 2500
        })
      })

      const data = await response.json()
      
      if (!response.ok) {
        console.error('OpenAI API error:', data)
        // API Ïò§Î•ò Ïãú ÌÖúÌîåÎ¶øÏúºÎ°ú Ìè¥Î∞±
        const templateBlog = generateTemplateBlog(topic, keywords, tone)
        return c.json({ 
          success: true, 
          content: templateBlog,
          metadata: {
            topic,
            keywords,
            tone,
            wordCount: templateBlog.length,
            mode: 'template_fallback'
          }
        })
      }

      const generatedPost = data.choices[0]?.message?.content || ''

      return c.json({ 
        success: true, 
        content: generatedPost,
        metadata: {
          topic,
          keywords,
          tone,
          wordCount: generatedPost.length,
          mode: 'ai'
        }
      })
    } catch (apiError) {
      console.error('API call error:', apiError)
      // API Ìò∏Ï∂ú Ïã§Ìå® Ïãú ÌÖúÌîåÎ¶øÏúºÎ°ú Ìè¥Î∞±
      const templateBlog = generateTemplateBlog(topic, keywords, tone)
      return c.json({ 
        success: true, 
        content: templateBlog,
        metadata: {
          topic,
          keywords,
          tone,
          wordCount: templateBlog.length,
          mode: 'template_fallback'
        }
      })
    }
  } catch (err) {
    console.error('Generate blog post error:', err)
    return c.json({ success: false, error: 'Î∏îÎ°úÍ∑∏ Í∏Ä ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÌÖúÌîåÎ¶ø Í∏∞Î∞ò Î∏îÎ°úÍ∑∏ ÏÉùÏÑ± Ìï®Ïàò
function generateTemplateBlog(topic: string, keywords: string | undefined, tone: string | undefined): string {
  const keywordList = keywords ? keywords.split(',').map(k => k.trim()) : [topic]
  const mainKeyword = keywordList[0]
  
  return `üìå ${topic} - ÌïôÏõêÏû•Ïù¥ ÏïåÎ†§ÎìúÎ¶¨Îäî Ïã§Ï†Ñ Í∞ÄÏù¥Îìú

ÏïàÎÖïÌïòÏÑ∏Ïöî! Ïò§ÎäòÏùÄ ÎßéÏùÄ ÌïôÎ∂ÄÎ™®ÎãòÎì§Ïù¥ Í∂ÅÍ∏àÌï¥ÌïòÏãúÎäî "${topic}"Ïóê ÎåÄÌï¥ ÏÉÅÏÑ∏Ìûà ÏïåÎ†§ÎìúÎ¶¨Î†§Í≥† Ìï©ÎãàÎã§. üòä

Ïã§Ï†ú ÌïôÏõêÏùÑ Ïö¥ÏòÅÌïòÎ©¥ÏÑú Í≤™ÏùÄ Í≤ΩÌóòÏùÑ Î∞îÌÉïÏúºÎ°ú Ï†ïÎßê ÎèÑÏõÄÏù¥ ÎêòÎäî Ï†ïÎ≥¥Îßå Î™®ÏïòÏúºÎãà, ÎÅùÍπåÏßÄ ÏùΩÏñ¥Î≥¥ÏãúÎ©¥ ÌÅ∞ ÎèÑÏõÄÏù¥ ÎêòÏã§ Í±∞ÏòàÏöî!


üéØ Ïôú ${mainKeyword}Ïù¥(Í∞Ä) Ï§ëÏöîÌï†ÍπåÏöî?

ÏöîÏ¶ò ÌïôÎ∂ÄÎ™®ÎãòÎì§Í≥º ÏÉÅÎã¥ÌïòÎã§ Î≥¥Î©¥ "${mainKeyword}"Ïóê ÎåÄÌïú Í≥†ÎØºÏù¥ Ï†ïÎßê ÎßéÏúºÏã≠ÎãàÎã§. Í∑∏ÎßåÌÅº Ï§ëÏöîÌïú Ï£ºÏ†úÏù¥Í∏∞ ÎïåÎ¨∏Ïù¥Ï£†.

ÌäπÌûà Ï¥àÎì±ÌïôÏÉùÎ∂ÄÌÑ∞ Í≥†Îì±ÌïôÏÉùÍπåÏßÄ, ÌïôÎÖÑÎ≥ÑÎ°ú Ï†ëÍ∑º Î∞©Î≤ïÏù¥ Îã§Î•¥Í∏∞ ÎïåÎ¨∏Ïóê Ïö∞Î¶¨ ÏïÑÏù¥ÏóêÍ≤å ÎßûÎäî Î∞©Î≤ïÏùÑ Ï∞æÎäî Í≤ÉÏù¥ ÌïµÏã¨ÏûÖÎãàÎã§.


‚ú® ${topic} - ÌïµÏã¨ Ìè¨Ïù∏Ìä∏ 3Í∞ÄÏßÄ

1Ô∏è‚É£ Ï≤´ Î≤àÏß∏ ÌïµÏã¨ Ìè¨Ïù∏Ìä∏

${mainKeyword}ÏùÑ(Î•º) ÏãúÏûëÌï† Îïå Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ Í∏∞Ï¥àÎ•º ÌÉÑÌÉÑÌûà ÌïòÎäî Í≤ÉÏûÖÎãàÎã§. ÎßéÏùÄ ÌïôÏÉùÎì§Ïù¥ Îπ®Î¶¨ ÏßÑÎèÑÎ•º ÎÇòÍ∞ÄÎ†§Í≥† ÌïòÏßÄÎßå, Í∏∞Ï¥àÍ∞Ä ÏïΩÌïòÎ©¥ ÎÇòÏ§ëÏóê Ïñ¥Î†§ÏõÄÏùÑ Í≤™Í≤å Îê©ÎãàÎã§.

Ïã§Ï†úÎ°ú Ï†ÄÌù¨ ÌïôÏõêÏóêÏÑúÎèÑ Í∏∞Ï¥àÎ∂ÄÌÑ∞ Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú ÌïôÏäµÌïú ÌïôÏÉùÎì§Ïù¥ Ïû•Í∏∞Ï†ÅÏúºÎ°ú Ìõ®Ïî¨ Ï¢ãÏùÄ ÏÑ±Í≥ºÎ•º ÎÇ¥Îäî Í≤ÉÏùÑ ÌôïÏù∏ÌñàÏäµÎãàÎã§.


2Ô∏è‚É£ Îëê Î≤àÏß∏ ÌïµÏã¨ Ìè¨Ïù∏Ìä∏

Íæ∏Ï§ÄÌï®Ïù¥ Ï†ïÎßê Ï§ëÏöîÌï©ÎãàÎã§. ${mainKeyword}ÏùÄ(Îäî) Îã®Í∏∞Í∞ÑÏóê Ìö®Í≥ºÎ•º Î≥¥Í∏∞ Ïñ¥Î†µÏäµÎãàÎã§. ÏµúÏÜå 3Í∞úÏõî Ïù¥ÏÉÅ Íæ∏Ï§ÄÌûà ÌïôÏäµÌï¥Ïïº ÌôïÏã§Ìïú Î≥ÄÌôîÎ•º ÎäêÎÇÑ Ïàò ÏûàÏñ¥Ïöî.

ÌïòÎ£® 30Î∂ÑÏù¥ÎùºÎèÑ Îß§Ïùº Íæ∏Ï§ÄÌûà ÌïòÎäî Í≤ÉÏù¥ Ï£ºÎßêÏóê 3ÏãúÍ∞Ñ Î™∞ÏïÑÏÑú ÌïòÎäî Í≤ÉÎ≥¥Îã§ Ìõ®Ïî¨ Ìö®Í≥ºÏ†ÅÏûÖÎãàÎã§. üí™


3Ô∏è‚É£ ÏÑ∏ Î≤àÏß∏ ÌïµÏã¨ Ìè¨Ïù∏Ìä∏

Ï†ÑÎ¨∏Í∞ÄÏùò ÎèÑÏõÄÏùÑ Î∞õÎäî Í≤ÉÎèÑ Ï¢ãÏùÄ Î∞©Î≤ïÏûÖÎãàÎã§. ÌòºÏûêÏÑú ÌïòÎã§ Î≥¥Î©¥ Î∞©Ìñ•ÏùÑ ÏûÉÍ∏∞ ÏâΩÍ≥†, ÏûòÎ™ªÎêú ÏäµÍ¥ÄÏù¥ ÏÉùÍ∏∏ Ïàò ÏûàÏäµÎãàÎã§.

${keywords ? keywords.split(',').map(k => k.trim()).join(', ') : topic}Í≥º Í¥ÄÎ†®Ìï¥ÏÑú Ï≤¥Í≥ÑÏ†ÅÏù∏ Ïª§Î¶¨ÌÅòÎüºÏùÑ Í∞ñÏ∂ò Í≥≥ÏóêÏÑú ÌïôÏäµÌïòÎ©¥ ÏãúÍ∞ÑÍ≥º ÎÖ∏Î†•ÏùÑ ÏïÑÎÇÑ Ïàò ÏûàÏäµÎãàÎã§.


üìö Ïã§Ï†Ñ ÌôúÏö© ÌåÅ

Ïù¥Î°†Îßå ÏïÑÎäî Í≤ÉÏù¥ ÏïÑÎãàÎùº Ïã§Ï†úÎ°ú Ï†ÅÏö©ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§. 

Îß§Ïùº ÏûëÏùÄ Î™©ÌëúÎ•º ÏÑ∏Ïö∞Í≥†, Í∑∏Í≤ÉÏùÑ Îã¨ÏÑ±ÌïòÎ©¥ÏÑú ÏÑ±Ï∑®Í∞êÏùÑ ÎäêÎÅºÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî. Ïù¥Î†áÍ≤å ÌïòÎ©¥ ÏûêÏó∞Ïä§ÎüΩÍ≤å ÌïôÏäµ ÎèôÍ∏∞Í∞Ä ÏÉùÍ∏∞Í≥†, ${mainKeyword}Ïóê ÎåÄÌïú Ìù•ÎØ∏ÎèÑ ÎÜíÏïÑÏßëÎãàÎã§.

ÌäπÌûà ÌïôÎ∂ÄÎ™®ÎãòÏùò Í¥ÄÏã¨Í≥º ÏùëÏõêÏù¥ Ï†ïÎßê Ï§ëÏöîÌï©ÎãàÎã§. ÏûëÏùÄ Î∞úÏ†ÑÏù¥ÎùºÎèÑ Ïπ≠Ï∞¨Ìï¥Ï£ºÏãúÎ©¥, ÏïÑÏù¥Îì§ÏùÄ Îçî Ïó¥Ïã¨Ìûà ÌïòÍ≤å Îê©ÎãàÎã§! üéâ


üí° ÎßàÎ¨¥Î¶¨ÌïòÎ©∞

Ïò§ÎäòÏùÄ ${topic}Ïóê ÎåÄÌï¥ ÏûêÏÑ∏Ìûà ÏïåÏïÑÎ≥¥ÏïòÏäµÎãàÎã§.

ÌïµÏã¨ÏùÄ Í∏∞Ï¥àÎ•º ÌÉÑÌÉÑÌûà ÌïòÍ≥†, Íæ∏Ï§ÄÌûà ÌïôÏäµÌïòÎ©∞, ÌïÑÏöîÌïòÎã§Î©¥ Ï†ÑÎ¨∏Í∞ÄÏùò ÎèÑÏõÄÏùÑ Î∞õÎäî Í≤ÉÏûÖÎãàÎã§.

Ïö∞Î¶¨ ÏïÑÏù¥ÏóêÍ≤å ÎßûÎäî Î∞©Î≤ïÏùÑ Ï∞æÏïÑÏÑú Ï∞®Í∑ºÏ∞®Í∑º ÏßÑÌñâÌïòÏãúÎ©¥, Î∂ÑÎ™Ö Ï¢ãÏùÄ Í≤∞Í≥ºÍ∞Ä ÏûàÏùÑ Í±∞ÏòàÏöî! üòä

Í∂ÅÍ∏àÌïòÏã† Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† ÎåìÍ∏ÄÎ°ú ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî. ÏÑ±Ïã¨ÏÑ±ÏùòÍªè ÎãµÎ≥ÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§!

#${mainKeyword} ${keywords ? keywords.split(',').map(k => '#' + k.trim()).join(' ') : ''} #ÌïôÏõê #ÌïôÏäµÎ≤ï #Í≥µÎ∂ÄÎ≤ï #ÍµêÏú°Ï†ïÎ≥¥`
}

// ========================================
// Page Routes
// ========================================

// Main page
// Favicon route - prevent 404
app.get('/favicon.ico', (c) => {
  return c.body(null, 204)
})

app.get('/', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§ - ÌïôÏõê Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ | ÏäàÌçº ÌîåÎ†àÏù¥Ïä§</title>
        <meta name="description" content="100% ÌòÑÏßÅ ÌïôÏõêÏû•Ïù¥ ÏïåÎ†§Ï£ºÎäî Ïã§Ï†Ñ ÎßàÏºÄÌåÖ! ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú, Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ, ÌçºÎÑê ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏ ÍµêÏú°. ÎåÄÌëúÏù¥ÏÇ¨ Í≥†Ìù¨Ï§Ä, Ï†ú1ÌåÄÏû• Í≥†ÏÑ†Ïö∞ÏôÄ Ìï®ÍªòÌïòÎäî ÌïôÏõê ÏÑ±Ïû• Ïª®ÏÑ§ÌåÖ.">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://superplace-academy.pages.dev/">
        <meta property="og:title" content="Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§ - ÌïôÏõê Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ">
        <meta property="og:description" content="100% ÌòÑÏßÅ ÌïôÏõêÏû•Ïù¥ ÏïåÎ†§Ï£ºÎäî Ïã§Ï†Ñ ÎßàÏºÄÌåÖ! ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú, Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏ ÍµêÏú°">
        <meta property="og:image" content="https://superplace-academy.pages.dev/thumbnail-share.jpg">
        
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://superplace-academy.pages.dev/">
        <meta property="twitter:title" content="Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§ - ÌïôÏõê Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ">
        <meta property="twitter:description" content="100% ÌòÑÏßÅ ÌïôÏõêÏû•Ïù¥ ÏïåÎ†§Ï£ºÎäî Ïã§Ï†Ñ ÎßàÏºÄÌåÖ!">
        <meta property="twitter:image" content="https://superplace-academy.pages.dev/thumbnail-share.jpg">
        
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          
          :root {
            --primary: #7c3aed;
            --primary-dark: #5b21b6;
            --accent: #fb923c;
            --accent-dark: #f97316;
          }
          
          body {
            background: #ffffff;
            color: #1f2937;
          }
          
          .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          }
          
          .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px -8px rgba(124, 58, 237, 0.15);
          }
          
          .animate-fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
          }
          
          .animate-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
          }
          
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          
          .gradient-orange {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
          }
          
          .section-light {
            background: #fafafa;
          }
          
          .text-balance {
            text-wrap: balance;
          }
          
          /* Ï†ÑÏ≤¥ Î©îÍ∞Ä Î©îÎâ¥ Ïä§ÌÉÄÏùº */
          .nav-menu-wrapper {
            display: flex;
            align-items: center;
            gap: 40px;
            position: relative;
          }
          
          .mega-menu {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            display: none;
            background: white;
            border-top: 2px solid #e5e7eb;
            box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.15);
            z-index: 100;
            transition: opacity 0.3s ease-out;
          }
          
          .mega-menu-inner {
            max-width: 1280px;
            margin: 0 auto;
            padding: 40px 48px;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 32px;
          }
          
          .menu-column {
            display: flex;
            flex-direction: column;
            min-width: 0;
          }
          
          .menu-column-title {
            font-size: 15px;
            font-weight: 700;
            color: #7c3aed;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
            cursor: pointer;
          }
          
          .menu-column-title a {
            color: #7c3aed;
            text-decoration: none;
          }
          
          .menu-column-title a:hover {
            color: #6d28d9;
          }
          
          .menu-column a {
            display: block;
            padding: 8px 0;
            color: #374151;
            text-decoration: none;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
          }
          
          .menu-column a:hover {
            color: #7c3aed;
            padding-left: 8px;
          }
          
          @keyframes fadeInDown {
            from {
              opacity: 0;
              transform: translateY(-10px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
        </style>
    </head>
    <body>
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center space-x-3">
                        <img src="/static/images/logo.png" alt="SUPER PLACE" class="h-10" onerror="this.style.display='none'">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </div>
                    <div class="hidden md:flex items-center space-x-10">
                        <!-- Î©îÎâ¥ Ìï≠Î™©Îì§ -->
                        <div class="nav-menu-wrapper">
                            <a href="/" class="text-gray-700 hover:text-purple-600 font-medium transition">Ìôà</a>
                            <a href="/programs" class="text-gray-700 hover:text-purple-600 font-medium transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                            <a href="/pricing" class="text-gray-700 hover:text-purple-600 font-medium transition">ÏöîÍ∏àÏ†ú</a>
                            <a href="/success" class="text-gray-700 hover:text-purple-600 font-medium transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                            <a href="/contact" class="text-gray-700 hover:text-purple-600 font-medium transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                            <a href="https://kohsunwoo12345-cmyk.github.io/SUPERPLACE.Home.store/" target="_blank" class="text-gray-700 hover:text-purple-600 font-medium transition">AI Î¥á ÏáºÌïëÎ™∞</a>
                            
                            <!-- Ï†ÑÏ≤¥ Î©îÍ∞Ä Î©îÎâ¥ -->
                            <div class="mega-menu">
                                <div class="mega-menu-inner">
                                    <!-- Ìôà -->
                                    <div class="menu-column">
                                        <div class="menu-column-title"><a href="#home" onclick="scrollToSection('home'); return false;" style="cursor: pointer; text-decoration: none;">Ìôà</a></div>
                                        <a href="/">Î©îÏù∏ Ìôà</a>
                                        <a href="/about">ÌöåÏÇ¨ ÏÜåÍ∞ú</a>
                                        <a href="/dashboard">ÎåÄÏãúÎ≥¥Îìú</a>
                                    </div>
                                    
                                    <!-- ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® -->
                                    <div class="menu-column">
                                        <div class="menu-column-title"><a href="#programs" onclick="scrollToSection('programs'); return false;" style="cursor: pointer; text-decoration: none;">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a></div>
                                        <a href="/tools/landing-page-builder">ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</a>
                                        <a href="/tools/sms-sender">Î¨∏Ïûê Î∞úÏÜ°</a>
                                        <a href="/tools/student-management">ÌïôÏÉù Í¥ÄÎ¶¨</a>
                                        <a href="/tools/ai-learning-report">ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</a>
                                    </div>
                                    
                                    <!-- ÏöîÍ∏àÏ†ú -->
                                    <div class="menu-column">
                                        <div class="menu-column-title"><a href="#pricing" onclick="scrollToSection('pricing'); return false;" style="cursor: pointer; text-decoration: none;">ÏöîÍ∏àÏ†ú</a></div>
                                        <a href="/pricing/starter">Ïä§ÌÉÄÌÑ∞ ÌîåÎûú</a>
                                        <a href="/pricing/basic">Î≤†Ïù¥ÏßÅ ÌîåÎûú</a>
                                        <a href="/pricing/pro">ÌîÑÎ°ú ÌîåÎûú</a>
                                        <a href="/pricing/business">ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú</a>
                                        <a href="/pricing/premium">ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú</a>
                                        <a href="/pricing/enterprise">ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú</a>
                                    </div>
                                    
                                    <!-- ÏÑ±Í≥µ ÏÇ¨Î°Ä -->
                                    <div class="menu-column">
                                        <div class="menu-column-title"><a href="#success" onclick="scrollToSection('success'); return false;" style="cursor: pointer; text-decoration: none;">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a></div>
                                        <a href="/success">Ï†ÑÏ≤¥ ÏÇ¨Î°Ä</a>
                                        <a href="/success/academy">ÌïôÏõê ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                                        <a href="/success/teacher">ÍµêÏÇ¨ ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                                    </div>
                                    
                                    <!-- Î¨∏ÏùòÌïòÍ∏∞ -->
                                    <div class="menu-column">
                                        <div class="menu-column-title"><a href="#contact" onclick="scrollToSection('contact'); return false;" style="cursor: pointer; text-decoration: none;">Î¨∏ÏùòÌïòÍ∏∞</a></div>
                                        <a href="/contact">ÏùºÎ∞ò Î¨∏Ïùò</a>
                                        <a href="/contact/support">Í∏∞Ïà† ÏßÄÏõê</a>
                                        <a href="/contact/sales">ÏòÅÏóÖ Î¨∏Ïùò</a>
                                    </div>
                                    
                                    <!-- AI Î¥á ÏáºÌïëÎ™∞ -->
                                    <div class="menu-column">
                                        <div class="menu-column-title">AI Î¥á ÏáºÌïëÎ™∞</div>
                                        <a href="https://kohsunwoo12345-cmyk.github.io/SUPERPLACE.Home.store/" target="_blank">ÏáºÌïëÎ™∞ Ìôà</a>
                                        <a href="https://kohsunwoo12345-cmyk.github.io/SUPERPLACE.Home.store/products" target="_blank">ÏÉÅÌíà Î™©Î°ù</a>
                                        <a href="https://kohsunwoo12345-cmyk.github.io/SUPERPLACE.Home.store/cart" target="_blank">Ïû•Î∞îÍµ¨Îãà</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Î°úÍ∑∏Ïù∏ Ï†Ñ -->
                        <a href="/signup?teacher=true" id="teacherRegisterBtn" class="text-purple-600 hover:text-purple-700 font-semibold border border-purple-600 px-5 py-2.5 rounded-full hover:bg-purple-50 transition-all">
                            ÏÑ†ÏÉùÎãò Îì±Î°ù
                        </a>
                        <a href="/login" id="loginBtn" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium hover:shadow-lg transition-all">
                            Î°úÍ∑∏Ïù∏
                        </a>
                        
                        <!-- ÏÑ†ÏÉùÎãò Ï†ÑÏö© (Î°úÍ∑∏Ïù∏ ÌõÑ) -->
                        <a href="/academy-management" id="academyManageLink" class="hidden text-gray-700 hover:text-purple-600 font-medium transition">ÌïôÏõê Í¥ÄÎ¶¨</a>
                        
                        <!-- Î°úÍ∑∏Ïù∏ ÌõÑ -->
                        <div id="userMenu" class="hidden flex items-center space-x-4">
                            <a href="/dashboard" class="text-gray-700 hover:text-purple-600 font-medium">ÎåÄÏãúÎ≥¥Îìú</a>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold" id="userAvatar"></div>
                                <span id="userName" class="text-gray-900 font-medium"></span>
                            </div>
                            <button onclick="logout()" class="text-gray-600 hover:text-red-600">Î°úÍ∑∏ÏïÑÏõÉ</button>
                        </div>
                    </div>
                    <div class="md:hidden">
                        <button id="mobile-menu-btn" class="text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
                <div class="px-6 py-4 space-y-2">
                    <a href="/" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">Ìôà</a>
                    <a href="/programs" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                    <a href="/pricing" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">ÏöîÍ∏àÏ†ú</a>
                    <a href="/success" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                    <a href="/contact" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                    <a href="https://kohsunwoo12345-cmyk.github.io/SUPERPLACE.Home.store/" target="_blank" class="block px-4 py-3 text-gray-700 hover:bg-purple-50 rounded-xl transition">AI Î¥á ÏáºÌïëÎ™∞</a>
                    <a href="/teachers/register" class="block px-4 py-3 text-purple-600 border border-purple-600 bg-white hover:bg-purple-50 rounded-xl text-center font-semibold">ÏÑ†ÏÉùÎãò Îì±Î°ù</a>
                    <a href="/login" class="block px-4 py-3 gradient-purple text-white rounded-xl text-center font-medium">Î°úÍ∑∏Ïù∏</a>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section id="home" class="pt-32 pb-32 px-6 bg-white relative overflow-hidden">
            <div class="absolute inset-0 z-0">
                <div class="absolute top-0 right-0 w-1/2 h-1/2 bg-gradient-to-br from-purple-100 to-transparent rounded-full blur-3xl opacity-30"></div>
                <div class="absolute bottom-0 left-0 w-1/2 h-1/2 bg-gradient-to-tr from-orange-100 to-transparent rounded-full blur-3xl opacity-30"></div>
            </div>
            <div class="max-w-7xl mx-auto relative z-10">
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <!-- Left: Text Content -->
                    <div class="animate-fade-in">
                        <div class="inline-block mb-6 px-5 py-2.5 bg-purple-50 rounded-full text-purple-700 text-sm font-medium border border-purple-100">
                            ÌïôÏõê ÎßàÏºÄÌåÖÏùò ÏÉàÎ°úÏö¥ Í∏∞Ï§Ä
                        </div>
                        <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6 leading-tight">
                            ÌïôÏõêÏû•ÎãòÏùò ÏÑ±Í≥µ,<br>
                            <span class="text-purple-600">Ïö∞Î¶¨Í∞Ä Ìï®ÍªòÌï©ÎãàÎã§</span>
                        </h1>
                        <p class="text-xl text-gray-600 mb-10 leading-relaxed">
                            ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ 1ÏúÑ, Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú, ÌçºÎÑê ÎßàÏºÄÌåÖÍπåÏßÄ<br>
                            <span class="text-gray-900 font-medium">500Í∞ú ÌïôÏõêÏù¥ Í≤ÄÏ¶ù</span>Ìïú Ïã§Ï†Ñ ÎßàÏºÄÌåÖ ÎÖ∏ÌïòÏö∞
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 mb-12">
                            <a href="/contact" class="gradient-purple text-white px-10 py-4 rounded-full text-lg font-medium shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 text-center">
                                Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÍ∏∞
                            </a>
                            <a href="/programs" class="bg-white text-purple-600 border-2 border-purple-200 px-10 py-4 rounded-full text-lg font-medium hover:border-purple-400 hover:bg-purple-50 transition-all text-center">
                                ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Î≥¥Í∏∞
                            </a>
                        </div>
                        
                        <!-- ÏÑ†ÏÉùÎãò Îì±Î°ù ÏïàÎÇ¥ -->
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-2xl p-6">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-900 mb-2">ÏÑ†ÏÉùÎãòÏù¥Ïã†Í∞ÄÏöî?</h3>
                                    <p class="text-gray-600 mb-4">
                                        ÌïôÏõê ÏõêÏû•ÎãòÍ≥º Ìï®Íªò ÌïôÏÉù Í¥ÄÎ¶¨Î•º ÏãúÏûëÌïòÏÑ∏Ïöî. Í∞ÑÌé∏Ìïú Îì±Î°ù Ï†àÏ∞®Î°ú Î∞îÎ°ú ÏãúÏûëÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                    </p>
                                    <a href="/teachers/register" class="inline-flex items-center px-6 py-3 bg-white border-2 border-purple-600 text-purple-600 rounded-full font-semibold hover:bg-purple-600 hover:text-white transition-all">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                                        </svg>
                                        ÏÑ†ÏÉùÎãò Îì±Î°ùÌïòÍ∏∞
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right: Hero Image -->
                    <div class="animate-fade-in" style="transition-delay: 0.2s">
                        <div class="relative rounded-3xl overflow-hidden shadow-2xl">
                            <img src="/static/images/hero-main.png" 
                                 alt="ÌïôÏõê Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§" 
                                 class="w-full h-auto object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-purple-900/10 to-transparent"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-20">
                    
                    <!-- Stats -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-8 pt-12 border-t border-gray-100">
                        <div class="text-center">
                            <div class="text-4xl lg:text-5xl font-bold text-purple-600 mb-2">500+</div>
                            <div class="text-sm lg:text-base text-gray-600 font-medium">ÍµêÏú° ÏàòÎ£å ÌïôÏõê</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl lg:text-5xl font-bold text-orange-500 mb-2">95%</div>
                            <div class="text-sm lg:text-base text-gray-600 font-medium">ÎßåÏ°±ÎèÑ</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl lg:text-5xl font-bold text-purple-600 mb-2">24/7</div>
                            <div class="text-sm lg:text-base text-gray-600 font-medium">Ïª§ÎÆ§ÎãàÌã∞ Ïö¥ÏòÅ</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl lg:text-5xl font-bold text-orange-500 mb-2">1:1</div>
                            <div class="text-sm lg:text-base text-gray-600 font-medium">ÎßûÏ∂§ Ïª®ÏÑ§ÌåÖ</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="programs" class="py-32 px-6 section-light">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-20 animate-fade-in">
                    <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                        ÌïµÏã¨ ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®
                    </h2>
                    <p class="text-xl text-gray-600">
                        Ïã§Ï†ÑÏóêÏÑú Î∞îÎ°ú Ï†ÅÏö© Í∞ÄÎä•Ìïú ÌïôÏõê ÎßàÏºÄÌåÖ Ï†ÑÎûµ
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 lg:gap-8">
                    <!-- Service 1 -->
                    <div class="bg-white rounded-3xl overflow-hidden border border-gray-100 card-hover animate-fade-in" style="transition-delay: 0.1s">
                        <div class="h-48 overflow-hidden">
                            <img src="/static/images/naver-place.png" 
                                 alt="ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ" 
                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
                        </div>
                        <div class="p-8">
                            <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§<br>ÏÉÅÏúÑÎÖ∏Ï∂ú</h3>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑ Îã¨ÏÑ±ÏùÑ ÏúÑÌïú Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞. ÌÇ§ÏõåÎìú Î∂ÑÏÑùÎ∂ÄÌÑ∞ Î¶¨Î∑∞ Í¥ÄÎ¶¨ÍπåÏßÄ ÏôÑÎ≤ΩÌïòÍ≤å ÎßàÏä§ÌÑ∞Ìï©ÎãàÎã§.
                            </p>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÌÇ§ÏõåÎìú ÏµúÏ†ÅÌôî Ï†ÑÎûµ</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Î¶¨Î∑∞ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÏßÄÏó≠ SEO ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú</span>
                                </li>
                            </ul>
                            <a href="/programs/naver-place" class="mt-6 block w-full py-3 text-center gradient-purple text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </a>
                        </div>
                    </div>

                    <!-- Service 2 -->
                    <div class="bg-white rounded-3xl overflow-hidden border border-gray-100 card-hover animate-fade-in" style="transition-delay: 0.2s">
                        <div class="h-48 overflow-hidden">
                            <img src="/static/images/blog-marketing.jpg" 
                                 alt="Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ" 
                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
                        </div>
                        <div class="p-8">
                            <div class="w-12 h-12 gradient-orange rounded-xl flex items-center justify-center mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">Î∏îÎ°úÍ∑∏<br>ÏÉÅÏúÑÎÖ∏Ï∂ú</h3>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≤ÄÏÉâ ÏµúÏÉÅÏúÑ ÏßÑÏûÖ Ï†ÑÎûµ. SEO ÏµúÏ†ÅÌôîÏôÄ ÏΩòÌÖêÏ∏† Í∏∞ÌöçÏùò Î™®Îì† Í≤ÉÏùÑ Î∞∞ÏõÅÎãàÎã§.
                            </p>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-orange-500 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Í≤ÄÏÉâ ÏïåÍ≥†Î¶¨Ï¶ò ÏôÑÎ≤Ω Ïù¥Ìï¥</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-orange-500 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Ìö®Í≥ºÏ†ÅÏù∏ Í∏ÄÏì∞Í∏∞ Í∏∞Î≤ï</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-orange-500 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÏΩòÌÖêÏ∏† Ï†ÑÎûµ ÏàòÎ¶Ω</span>
                                </li>
                            </ul>
                            <a href="/programs/blog" class="mt-6 block w-full py-3 text-center gradient-orange text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </a>
                        </div>
                    </div>

                    <!-- Service 3 -->
                    <div class="bg-white rounded-3xl overflow-hidden border border-gray-100 card-hover animate-fade-in" style="transition-delay: 0.3s">
                        <div class="h-48 overflow-hidden">
                            <img src="/static/images/funnel-marketing.png" 
                                 alt="ÌçºÎÑê ÎßàÏºÄÌåÖ" 
                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
                        </div>
                        <div class="p-8">
                            <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center mb-4">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">ÌçºÎÑê<br>ÎßàÏºÄÌåÖ</h3>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                ÏÉÅÎã¥Î∂ÄÌÑ∞ Îì±Î°ùÍπåÏßÄ ÏûêÎèôÌôî ÏãúÏä§ÌÖú Íµ¨Ï∂ï. Ìö®Ïú®Ï†ÅÏù∏ ÌïôÏÉù Î™®Ïßë ÌîÑÎ°úÏÑ∏Ïä§Î•º ÏôÑÏÑ±Ìï©ÎãàÎã§.
                            </p>
                            <ul class="space-y-3 text-gray-700">
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Í≥†Í∞ù Ïó¨Ï†ï ÏôÑÎ≤Ω ÏÑ§Í≥Ñ</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>ÎßàÏºÄÌåÖ ÏûêÎèôÌôî ÎèÑÍµ¨</span>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-5 h-5 text-purple-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Ï†ÑÌôòÏú® Í∑πÎåÄÌôî Ï†ÑÎûµ</span>
                                </li>
                            </ul>
                            <a href="/programs/funnel" class="mt-6 block w-full py-3 text-center gradient-purple text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Program CTA Section -->
        <section id="pricing" class="py-20 px-6 bg-gradient-to-br from-purple-50 to-white">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
                        Í¥ÄÏã¨ÏûàÎäî ÌîÑÎ°úÍ∑∏Îû®ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
                    </h2>
                    <p class="text-lg text-gray-600">
                        Í∞Å ÌîÑÎ°úÍ∑∏Îû®Ïùò ÏÉÅÏÑ∏ ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÍ≥† Î∞îÎ°ú Ïã†Ï≤≠ÌïòÏÑ∏Ïöî
                    </p>
                </div>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <!-- ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ Î≤ÑÌäº -->
                    <a href="/programs/naver-place" class="group bg-white rounded-2xl p-8 border-2 border-purple-200 hover:border-purple-600 hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                        <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:scale-110 transition-transform">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">
                            ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§<br>ÏÉÅÏúÑÎÖ∏Ï∂ú
                        </h3>
                        <p class="text-gray-600 text-center mb-4">
                            ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑ Îã¨ÏÑ± Ï†ÑÎûµ
                        </p>
                        <div class="text-center">
                            <span class="text-purple-600 font-bold group-hover:text-purple-700">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </span>
                        </div>
                    </a>

                    <!-- Î∏îÎ°úÍ∑∏ Î≤ÑÌäº -->
                    <a href="/programs/blog" class="group bg-white rounded-2xl p-8 border-2 border-orange-200 hover:border-orange-500 hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                        <div class="w-16 h-16 gradient-orange rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:scale-110 transition-transform">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">
                            Î∏îÎ°úÍ∑∏<br>ÏÉÅÏúÑÎÖ∏Ï∂ú
                        </h3>
                        <p class="text-gray-600 text-center mb-4">
                            Í≤ÄÏÉâ ÏµúÏÉÅÏúÑ ÏßÑÏûÖ Ï†ÑÎûµ
                        </p>
                        <div class="text-center">
                            <span class="text-orange-500 font-bold group-hover:text-orange-600">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </span>
                        </div>
                    </a>

                    <!-- ÌçºÎÑê ÎßàÏºÄÌåÖ Î≤ÑÌäº -->
                    <a href="/programs/funnel" class="group bg-white rounded-2xl p-8 border-2 border-purple-200 hover:border-purple-600 hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                        <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:scale-110 transition-transform">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">
                            ÌçºÎÑê<br>ÎßàÏºÄÌåÖ
                        </h3>
                        <p class="text-gray-600 text-center mb-4">
                            24ÏãúÍ∞Ñ ÏûêÎèô ÌïôÏÉù Î™®Ïßë
                        </p>
                        <div class="text-center">
                            <span class="text-purple-600 font-bold group-hover:text-purple-700">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí
                            </span>
                        </div>
                    </a>
                    
                    <!-- ÌïôÏÉù Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                    <a href="/students" class="group bg-white rounded-2xl p-8 border-2 border-blue-200 hover:border-blue-600 hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:scale-110 transition-transform">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">
                            ÌïôÏÉù<br>Í¥ÄÎ¶¨
                        </h3>
                        <p class="text-gray-600 text-center mb-4">
                            ÌïôÏÉù/Î∞ò/ÏÑ±Í≥º ÌÜµÌï© Í¥ÄÎ¶¨
                        </p>
                        <div class="text-center">
                            <span class="text-blue-600 font-bold group-hover:text-blue-700">
                                Î∞îÎ°úÍ∞ÄÍ∏∞ ‚Üí
                            </span>
                        </div>
                    </a>
                </div>

                <!-- ÎåÄÌñâ Î¨∏Ïùò ÌÅ∞ Î≤ÑÌäº -->
                <div class="text-center">
                    <a href="/contact" class="inline-block gradient-purple text-white px-16 py-6 rounded-full text-xl font-bold shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all duration-300">
                        <span class="flex items-center gap-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <span>ÎåÄÌñâ Î¨∏ÏùòÌïòÍ∏∞</span>
                        </span>
                    </a>
                    <p class="text-gray-500 mt-4">
                        24ÏãúÍ∞Ñ ÎÇ¥Ïóê ÎãµÎ≥ÄÎìúÎ¶ΩÎãàÎã§
                    </p>
                </div>
            </div>
        </section>

        <!-- Why Us Section -->
        <section id="success" class="py-32 px-6 bg-white">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-20 animate-fade-in">
                    <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                        Ïôú Ïö∞Î¶¨Î•º ÏÑ†ÌÉùÌï¥Ïïº Ìï†ÍπåÏöî?
                    </h2>
                    <p class="text-xl text-gray-600">
                        ÌòÑÏóÖ ÌïôÏõêÏû•Ïù¥ ÏßÅÏ†ë Í∞ÄÎ•¥ÏπòÎäî Ïã§Ï†Ñ ÎßàÏºÄÌåÖ ÍµêÏú°
                    </p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8 mb-20">
                    <!-- Left: Image Grid -->\n                    <div class="grid grid-cols-2 gap-4 animate-fade-in">
                        <div class="col-span-2 rounded-2xl overflow-hidden">
                            <img src="/static/images/seminar-education.jpg" 
                                 alt="Ìú¥ÏßÄÌÜµ(‰ºëÁü•ÈÄö) ÍµêÏú° ÏÑ∏ÎØ∏ÎÇò - ÌïôÏõêÏû• ÍµêÏú° ÌòÑÏû•" 
                                 class="w-full h-72 object-cover">
                        </div>
                        <div class="rounded-2xl overflow-hidden">
                            <img src="/static/images/kumetang-classroom-2.jpg" 
                                 alt="Íæ∏Î©îÎïÖÌïôÏõê ÌïôÏäµ Í≥µÍ∞Ñ" 
                                 class="w-full h-48 object-cover">
                        </div>
                        <div class="rounded-2xl overflow-hidden bg-white flex items-center justify-center p-4">
                            <img src="/static/images/kumetang-logo.png" 
                                 alt="Íæ∏Î©îÎïÖÌïôÏõê Î°úÍ≥†" 
                                 class="w-full h-auto object-contain">
                        </div>
                    </div>
                    
                    <!-- Right: Features -->
                    <div class="space-y-6 animate-fade-in" style="transition-delay: 0.1s">
                        <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-purple-100">
                            <div class="flex items-start gap-4">
                                <div class="w-14 h-14 gradient-purple rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold">
                                    01
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                                        ÌòÑÏóÖ ÌïôÏõêÏû•Ïùò ÏÇ¥ÏïÑÏûàÎäî ÎÖ∏ÌïòÏö∞
                                    </h3>
                                    <p class="text-gray-600 leading-relaxed">
                                        Íæ∏Î©îÎïÖÌïôÏõêÏùÑ Ïö¥ÏòÅÌïòÎ©∞ ÏßÅÏ†ë Í≤ÄÏ¶ùÌïú Ïã§Ï†Ñ Ï†ÑÎûµ. Ïù¥Î°†Ïù¥ ÏïÑÎãå Í≤ΩÌóòÏóêÏÑú Ïö∞Îü¨ÎÇòÏò® ÏßÑÏßú ÎÖ∏ÌïòÏö∞Î•º Î∞∞ÏõÅÎãàÎã§.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-8 border border-orange-100">
                            <div class="flex items-start gap-4">
                                <div class="w-14 h-14 gradient-orange rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold">
                                    02
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                                        24/7 Ïª§ÎÆ§ÎãàÌã∞ & Ïò§ÌîÑÎùºÏù∏ Î™®ÏûÑ
                                    </h3>
                                    <p class="text-gray-600 leading-relaxed">
                                        Ïò§ÌîàÏ±ÑÌåÖÎ∞©ÏóêÏÑú Ïã§ÏãúÍ∞Ñ ÏÜåÌÜµÌïòÍ≥†, Ï†ïÍ∏∞ Ïò§ÌîÑÎùºÏù∏ Î™®ÏûÑÏóêÏÑú Ï†ÑÍµ≠ ÌïôÏõêÏû•ÎãòÎì§Í≥º ÎÑ§Ìä∏ÏõåÌÇπÌïòÏÑ∏Ïöî.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-purple-100">
                            <div class="flex items-start gap-4">
                                <div class="w-14 h-14 gradient-purple rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold">
                                    03
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                                        500Í∞ú ÌïôÏõêÏù¥ Í≤ÄÏ¶ùÌïú ÏÑ±Í≥º
                                    </h3>
                                    <p class="text-gray-600 leading-relaxed">
                                        500Í∞ú Ïù¥ÏÉÅ ÌïôÏõêÏùò Ïã§Ï†ú ÏÑ±Í≥µ ÏÇ¨Î°ÄÏôÄ 95% ÎßåÏ°±ÎèÑÍ∞Ä Ï¶ùÎ™ÖÌïòÎäî ÌôïÏã§Ìïú Ìö®Í≥ºÎ•º Í≤ΩÌóòÌïòÏÑ∏Ïöî.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testimonial -->
                <div class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-3xl p-12 lg:p-16 max-w-5xl mx-auto animate-fade-in shadow-2xl">
                    <div class="flex items-start gap-6 mb-8">
                        <svg class="w-12 h-12 text-white/80 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                    </div>
                    <p class="text-2xl lg:text-3xl text-white leading-relaxed mb-10 font-medium">
                        ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ ÍµêÏú°ÏùÑ Î∞õÏùÄ ÌõÑ 3Í∞úÏõî ÎßåÏóê Ïã†Í∑ú Î¨∏ÏùòÍ∞Ä <span class="text-orange-300 font-bold">2Î∞∞ Ïù¥ÏÉÅ</span> ÎäòÏóàÏäµÎãàÎã§. Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞Í∞Ä Ï†ïÎßê ÎåÄÎã®Ìï©ÎãàÎã§!
                    </p>
                    <div class="flex items-center gap-5">
                        <div class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center text-white font-bold text-2xl border-2 border-white/30">
                            ÍπÄ
                        </div>
                        <div>
                            <div class="font-bold text-white text-xl">ÍπÄOO ÏõêÏû•Îãò</div>
                            <div class="text-white/80">ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÏòÅÏñ¥ÌïôÏõê</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section id="contact" class="py-32 px-6 gradient-purple">
            <div class="max-w-4xl mx-auto text-center animate-fade-in">
                <h2 class="text-4xl lg:text-6xl font-bold text-white mb-8 text-balance">
                    ÌïôÏõê ÏÑ±Ïû•Ïùò ÏãúÏûë,<br>
                    ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                </h2>
                <p class="text-xl text-white/90 mb-12 leading-relaxed">
                    Î¨¥Î£å ÏÉÅÎã¥ÏúºÎ°ú Ïö∞Î¶¨ ÌïôÏõêÏóê Îî± ÎßûÎäî ÎßàÏºÄÌåÖ Ï†ÑÎûµÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/contact" class="bg-white text-purple-600 px-12 py-5 rounded-full text-lg font-medium shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all duration-300">
                        Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÍ∏∞
                    </a>
                    <a href="/programs" class="bg-white/10 backdrop-blur-sm border-2 border-white/40 text-white px-12 py-5 rounded-full text-lg font-medium hover:bg-white hover:text-purple-600 transition-all">
                        ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Î≥¥Í∏∞
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-50 text-gray-600 py-20 px-6 border-t border-gray-100">
            <div class="max-w-7xl mx-auto">
                <div class="grid md:grid-cols-4 gap-12 mb-16">
                    <div>
                        <div class="flex items-center space-x-2 mb-4">
                            <img src="/static/images/logo.png" alt="SUPER PLACE" class="h-8" onerror="this.style.display='none'">
                            <span class="text-xl font-bold text-gray-900">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</span>
                        </div>
                        <p class="text-gray-500 text-sm leading-relaxed">
                            ÌïôÏõê ÎßàÏºÄÌåÖÏùò ÏÉàÎ°úÏö¥ Í∏∞Ï§Ä
                        </p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">ÏÑúÎπÑÏä§</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/programs" class="hover:text-purple-600 transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a></li>
                            <li><a href="/success" class="hover:text-purple-600 transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a></li>
                            <li><a href="/contact" class="hover:text-purple-600 transition">Î¨∏ÏùòÌïòÍ∏∞</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">ÌöåÏÇ¨</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/about" class="hover:text-purple-600 transition">ÌöåÏÇ¨ ÏÜåÍ∞ú</a></li>
                            <li><a href="#" class="hover:text-purple-600 transition">Ïù¥Ïö©ÏïΩÍ¥Ä</a></li>
                            <li><a href="#" class="hover:text-purple-600 transition">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">Ïó∞ÎùΩÏ≤ò</h4>
                        <ul class="space-y-3 text-sm">
                            <li>Ïù∏Ï≤úÍ¥ëÏó≠Ïãú ÏÑúÍµ¨ Ï≤≠ÎùºÏª§ÎÇºÎ°ú 270, 2Ï∏µ</li>
                            <li>wangholy1@naver.com</li>
                            <li>010-8739-9697</li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-200 pt-8 mt-8">
                    <div class="text-center text-gray-600 text-sm space-y-2">
                        <p class="font-medium text-gray-900">Ï£ºÏãùÌöåÏÇ¨ Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</p>
                        <p>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏: 142-88-02445</p>
                        <p>Ï£ºÏÜå: Ïù∏Ï≤úÍ¥ëÏó≠Ïãú ÏÑúÍµ¨ Ï≤≠ÎùºÏª§ÎÇºÎ°ú 270, 2Ï∏µ</p>
                        <p>Ïù¥Î©îÏùº: wangholy1@naver.com | Ï†ÑÌôî: 010-8739-9697</p>
                        <p class="text-gray-500 mt-4">&copy; 2024 Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>

        <script>
            // Mega menu delay control
            let menuTimeout;
            const menuWrapper = document.querySelector('.nav-menu-wrapper');
            const megaMenu = document.querySelector('.mega-menu');
            
            function showMegaMenu() {
                clearTimeout(menuTimeout);
                if (megaMenu) {
                    megaMenu.style.display = 'block';
                }
            }
            
            function hideMegaMenu() {
                menuTimeout = setTimeout(() => {
                    if (megaMenu) {
                        megaMenu.style.display = 'none';
                    }
                }, 500); // 500ms delay before hiding
            }
            
            if (menuWrapper) {
                menuWrapper.addEventListener('mouseenter', showMegaMenu);
                menuWrapper.addEventListener('mouseleave', hideMegaMenu);
            }
            
            if (megaMenu) {
                megaMenu.addEventListener('mouseenter', showMegaMenu);
                megaMenu.addEventListener('mouseleave', hideMegaMenu);
            }
            
            // Smooth scroll to section
            function scrollToSection(sectionId) {
                const element = document.getElementById(sectionId);
                if (element) {
                    const navHeight = 80; // Navigation bar height
                    const elementPosition = element.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - navHeight;
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            }
            
            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ï≤¥ÌÅ¨
            function checkLoginStatus() {
                const user = JSON.parse(localStorage.getItem('user') || 'null');
                if (user) {
                    // Î°úÍ∑∏Ïù∏Îêú ÏÉÅÌÉú
                    document.getElementById('loginBtn').classList.add('hidden');
                    document.getElementById('teacherRegisterBtn').classList.add('hidden');
                    document.getElementById('userMenu').classList.remove('hidden');
                    document.getElementById('userMenu').classList.add('flex');
                    document.getElementById('userName').textContent = user.name;
                    document.getElementById('userAvatar').textContent = user.name.charAt(0);
                    
                    // ÏÑ†ÏÉùÎãòÏù∏ Í≤ΩÏö∞ 'ÌïôÏõê Í¥ÄÎ¶¨' Î≤ÑÌäº Î≥¥Ïù¥Í∏∞
                    if (user.user_type === 'teacher') {
                        document.getElementById('academyManageLink').classList.remove('hidden');
                    }
                } else {
                    // Î°úÍ∑∏ÏïÑÏõÉ ÏÉÅÌÉú
                    document.getElementById('loginBtn').classList.remove('hidden');
                    document.getElementById('teacherRegisterBtn').classList.remove('hidden');
                    document.getElementById('userMenu').classList.add('hidden');
                    document.getElementById('academyManageLink').classList.add('hidden');
                }
            }

            function logout() {
                if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    location.reload();
                }
            }

            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('hidden');
            });

            // Smooth scroll animations
            const observeElements = () => {
                const elements = document.querySelectorAll('.animate-fade-in');
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, {
                    threshold: 0.15,
                    rootMargin: '0px 0px -60px 0px'
                });
                
                elements.forEach(element => observer.observe(element));
            };

            // Initialize
            document.addEventListener('DOMContentLoaded', () => {
                checkLoginStatus(); // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
                observeElements();
                
                // Add visible class to hero immediately
                document.querySelector('section .animate-fade-in')?.classList.add('visible');
            });
        </script>
    </body>
    </html>
  `)
})

// ==================== Í≤∞Ï†ú ÏãúÏä§ÌÖú API ====================

// ÌîåÎûú Ï†ïÎ≥¥ Îß§Ìïë
const PLAN_INFO = {
  'starter': { name: 'Ïä§ÌÉÄÌÑ∞ ÌîåÎûú', price: 55000, studentLimit: 30, aiReportLimit: 30, landingPageLimit: 40, teacherLimit: 2 },
  'basic': { name: 'Î≤†Ïù¥ÏßÅ ÌîåÎûú', price: 77000, studentLimit: 50, aiReportLimit: 50, landingPageLimit: 70, teacherLimit: 4 },
  'pro': { name: 'ÌîÑÎ°ú ÌîåÎûú', price: 147000, studentLimit: 100, aiReportLimit: 100, landingPageLimit: 140, teacherLimit: 6 },
  'business': { name: 'ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú', price: 297000, studentLimit: 300, aiReportLimit: 600, landingPageLimit: 550, teacherLimit: 10 },
  'premium': { name: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú', price: 440000, studentLimit: 500, aiReportLimit: 1000, landingPageLimit: 900, teacherLimit: 15 },
  'enterprise': { name: 'ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú', price: 750000, studentLimit: 1000, aiReportLimit: 3000, landingPageLimit: 2000, teacherLimit: 20 }
}

// Í≤∞Ï†ú ÏôÑÎ£å ÏõπÌõÖ (ÏïÑÏûÑÌè¨Ìä∏ÏóêÏÑú Ìò∏Ï∂ú)
app.post('/api/payments/webhook', async (c) => {
  try {
    const { imp_uid, merchant_uid, status } = await c.req.json()
    
    console.log('[Payment Webhook] Received:', { imp_uid, merchant_uid, status })

    if (status === 'paid') {
      // merchant_uidÏóêÏÑú academy_idÏôÄ plan Ï∂îÏ∂ú
      // ÌòïÏãù: academy_{academyId}_{planId}_{timestamp}
      const parts = merchant_uid.split('_')
      const academyId = parseInt(parts[1])
      const planId = parts[2]
      
      const planInfo = PLAN_INFO[planId]
      if (!planInfo) {
        console.error('[Payment Webhook] Invalid plan ID:', planId)
        return c.json({ success: false, error: 'Invalid plan' }, 400)
      }

      // Íµ¨ÎèÖ ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞ (1Í∞úÏõî)
      const now = new Date()
      const startDate = now.toISOString().split('T')[0]
      const endDate = new Date(now.setMonth(now.getMonth() + 1)).toISOString().split('T')[0]

      // Í∏∞Ï°¥ Íµ¨ÎèÖ ÎπÑÌôúÏÑ±Ìôî
      await c.env.DB.prepare(`
        UPDATE subscriptions 
        SET status = 'expired', updated_at = CURRENT_TIMESTAMP
        WHERE academy_id = ? AND status = 'active'
      `).bind(academyId).run()

      // ÏÉà Íµ¨ÎèÖ ÏÉùÏÑ±
      const result = await c.env.DB.prepare(`
        INSERT INTO subscriptions (
          academy_id, plan_name, plan_price, student_limit, ai_report_limit,
          landing_page_limit, teacher_limit, subscription_start_date, 
          subscription_end_date, status, payment_method, merchant_uid, imp_uid
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'active', 'card', ?, ?)
      `).bind(
        academyId,
        planInfo.name,
        planInfo.price,
        planInfo.studentLimit,
        planInfo.aiReportLimit,
        planInfo.landingPageLimit,
        planInfo.teacherLimit,
        startDate,
        endDate,
        merchant_uid,
        imp_uid
      ).run()

      console.log('[Payment Webhook] Subscription created:', {
        subscriptionId: result.meta.last_row_id,
        academyId,
        plan: planInfo.name,
        startDate,
        endDate
      })

      return c.json({ success: true, subscriptionId: result.meta.last_row_id })
    }

    return c.json({ success: true, message: 'Status not paid' })
  } catch (error) {
    console.error('[Payment Webhook] Error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Í≤∞Ï†ú ÏôÑÎ£å ÌõÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏° ÌôïÏù∏
app.post('/api/payments/complete', async (c) => {
  try {
    const { imp_uid, merchant_uid } = await c.req.json()
    
    console.log('[Payment Complete] Client callback:', { imp_uid, merchant_uid })

    // merchant_uidÏóêÏÑú Ï†ïÎ≥¥ Ï∂îÏ∂ú
    const parts = merchant_uid.split('_')
    const academyId = parseInt(parts[1])
    const planId = parts[2]
    
    const planInfo = PLAN_INFO[planId]
    if (!planInfo) {
      return c.json({ success: false, error: 'Invalid plan' }, 400)
    }

    // Íµ¨ÎèÖ ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞
    const now = new Date()
    const startDate = now.toISOString().split('T')[0]
    const endDate = new Date(now.setMonth(now.getMonth() + 1)).toISOString().split('T')[0]

    // Í∏∞Ï°¥ Íµ¨ÎèÖ ÎπÑÌôúÏÑ±Ìôî
    await c.env.DB.prepare(`
      UPDATE subscriptions 
      SET status = 'expired', updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND status = 'active'
    `).bind(academyId).run()

    // ÏÉà Íµ¨ÎèÖ ÏÉùÏÑ±
    const result = await c.env.DB.prepare(`
      INSERT INTO subscriptions (
        academy_id, plan_name, plan_price, student_limit, ai_report_limit,
        landing_page_limit, teacher_limit, subscription_start_date, 
        subscription_end_date, status, payment_method, merchant_uid, imp_uid
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'active', 'card', ?, ?)
    `).bind(
      academyId,
      planInfo.name,
      planInfo.price,
      planInfo.studentLimit,
      planInfo.aiReportLimit,
      planInfo.landingPageLimit,
      planInfo.teacherLimit,
      startDate,
      endDate,
      merchant_uid,
      imp_uid
    ).run()

    console.log('[Payment Complete] Subscription created:', {
      subscriptionId: result.meta.last_row_id,
      academyId,
      plan: planInfo.name,
      startDate,
      endDate
    })

    // usage_tracking ÌÖåÏù¥Î∏î ÏÉùÏÑ± (ÏóÜÏùÑ Í≤ΩÏö∞)
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS usage_tracking (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER NOT NULL,
        subscription_id INTEGER NOT NULL,
        current_students INTEGER DEFAULT 0,
        ai_reports_used_this_month INTEGER DEFAULT 0,
        last_ai_report_reset_date TEXT,
        landing_pages_created INTEGER DEFAULT 0,
        current_teachers INTEGER DEFAULT 0,
        sms_sent_this_month INTEGER DEFAULT 0,
        last_sms_reset_date TEXT,
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        updated_at TEXT DEFAULT CURRENT_TIMESTAMP
      )
    `).run()

    // usage_tracking Î†àÏΩîÎìú ÏÉùÏÑ± (Íµ¨ÎèÖÍ≥º Ìï®Íªò)
    const usageResult = await c.env.DB.prepare(`
      INSERT INTO usage_tracking (
        academy_id, subscription_id, current_students, 
        ai_reports_used_this_month, landing_pages_created, 
        current_teachers, sms_sent_this_month,
        last_ai_report_reset_date, last_sms_reset_date
      ) VALUES (?, ?, 0, 0, 0, 0, 0, ?, ?)
    `).bind(
      academyId,
      result.meta.last_row_id,
      startDate,
      startDate
    ).run()

    console.log('[Payment Complete] Usage tracking initialized:', {
      usageId: usageResult.meta.last_row_id
    })

    return c.json({ 
      success: true, 
      subscription: {
        id: result.meta.last_row_id,
        planName: planInfo.name,
        startDate,
        endDate
      }
    })
  } catch (error) {
    console.error('[Payment Complete] Error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Íµ¨ÎèÖ ÏÉÅÌÉú ÌôïÏù∏ API
app.get('/api/subscriptions/status', async (c) => {
  try {
    // ÏÑ∏ÏÖòÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
    const sessionId = getCookie(c, 'session_id')
    if (!sessionId) {
      console.log('[Subscription Status] No session_id cookie found')
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }
    
    // ÏÑ∏ÏÖòÏóêÏÑú ÏÇ¨Ïö©Ïûê ID Ï°∞Ìöå
    const session = await c.env.DB.prepare(`
      SELECT user_id FROM sessions WHERE session_id = ? AND expires_at > datetime('now')
    `).bind(sessionId).first()
    
    if (!session) {
      console.log('[Subscription Status] Session not found or expired')
      return c.json({ success: false, error: 'Session expired' }, 401)
    }

    const userId = session.user_id
    
    console.log('[Subscription Status] userId:', userId)
    
    // ÏÇ¨Ïö©ÏûêÏùò academy_id Ï°∞Ìöå
    const user = await c.env.DB.prepare(`SELECT id, academy_id FROM users WHERE id = ?`).bind(userId).first()
    
    console.log('[Subscription Status] user:', user)
    
    // üî• ÌïµÏã¨ Î≥ÄÍ≤Ω: academy_idÎ•º Ìï≠ÏÉÅ user.idÎ°ú Í∞ïÏ†ú ÏÑ§Ï†ï
    let academyId = user.id
    
    if (user?.academy_id !== user.id) {
      console.log(`[Subscription Status] Fixing academy_id from ${user?.academy_id} to ${user.id}`)
      try {
        await c.env.DB.prepare(`UPDATE users SET academy_id = ? WHERE id = ?`).bind(academyId, userId).run()
      } catch (e) {
        console.error('[Subscription Status] Failed to update academy_id:', e)
      }
    }

    console.log('[Subscription Status] Using academy_id:', academyId)

    // ÌôúÏÑ± Íµ¨ÎèÖ Ï°∞Ìöå
    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC
      LIMIT 1
    `).bind(academyId).first()

    console.log('[Subscription Status] Active subscription:', subscription)

    if (!subscription) {
      // Íµ¨ÎèÖÏù¥ ÏóÜÏñ¥ÎèÑ Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏÑ§Ï†ïÌïú ÌïúÎèÑÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
      console.log('[Subscription Status] No active subscription, checking for admin plan')
      
      const adminSubscription = await c.env.DB.prepare(`
        SELECT * FROM subscriptions 
        WHERE academy_id = ? AND plan_name = 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú'
        ORDER BY created_at DESC
        LIMIT 1
      `).bind(academyId).first()
      
      console.log('[Subscription Status] Admin subscription:', adminSubscription)
      
      if (adminSubscription) {
        // Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûúÏù¥ ÏûàÏúºÎ©¥ ÌëúÏãú
        console.log('[Subscription Status] Returning admin subscription')
        return c.json({ 
          success: true, 
          hasSubscription: true,
          subscription: {
            id: adminSubscription.id,
            planName: adminSubscription.plan_name,
            startDate: adminSubscription.subscription_start_date,
            endDate: adminSubscription.subscription_end_date,
            studentLimit: adminSubscription.student_limit || 0,
            aiReportLimit: adminSubscription.ai_report_limit || 0,
            landingPageLimit: adminSubscription.landing_page_limit || 0,
            teacherLimit: adminSubscription.teacher_limit || 0
          }
        })
      }
      
      console.log('[Subscription Status] No subscription found at all')
      return c.json({ 
        success: true, 
        hasSubscription: false,
        message: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§'
      })
    }

    console.log('[Subscription Status] Found active subscription, checking expiration')

    // Íµ¨ÎèÖ ÎßåÎ£å ÌôïÏù∏ (ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§Ä, Ï¢ÖÎ£åÏùº 23:59:59ÍπåÏßÄ ÏÇ¨Ïö© Í∞ÄÎä•)
    const now = new Date()
    const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)) // UTC+9
    const koreaDateStr = koreaTime.toISOString().split('T')[0]
    const endDateTime = new Date(subscription.subscription_end_date + 'T23:59:59+09:00')
    const isExpired = koreaTime > endDateTime

    if (isExpired) {
      // Íµ¨ÎèÖ ÎßåÎ£å Ï≤òÎ¶¨
      await c.env.DB.prepare(`
        UPDATE subscriptions 
        SET status = 'expired', updated_at = CURRENT_TIMESTAMP
        WHERE id = ?
      `).bind(subscription.id).run()

      // üî• ÏûêÎèô Í∂åÌïú ÌôòÏàò: Íµ¨ÎèÖ ÎßåÎ£å Ïãú Î™®Îì† Í∂åÌïú ÎπÑÌôúÏÑ±Ìôî
      const user = await c.env.DB.prepare(`
        SELECT id FROM users WHERE academy_id = ?
      `).bind(academyId).first()

      if (user) {
        console.log('[Subscription Expired] Revoking all permissions for user:', user.id)
        
        await c.env.DB.prepare(`
          UPDATE user_permissions 
          SET is_active = 0
          WHERE user_id = ?
        `).bind(user.id).run()
        
        console.log('[Subscription Expired] All permissions revoked for user:', user.id)
      }

      return c.json({ 
        success: true, 
        hasSubscription: false,
        message: 'Íµ¨ÎèÖÏù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§'
      })
    }

    return c.json({ 
      success: true, 
      hasSubscription: true,
      subscription: {
        id: subscription.id,
        planName: subscription.plan_name,
        startDate: subscription.subscription_start_date,
        endDate: subscription.subscription_end_date,
        studentLimit: subscription.student_limit,
        aiReportLimit: subscription.ai_report_limit,
        landingPageLimit: subscription.landing_page_limit,
        teacherLimit: subscription.teacher_limit
      }
    })
  } catch (error) {
    console.error('[Subscription Status] Error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ==================== ÏÇ¨Ïö©Îüâ ÌïúÎèÑ Ï≤¥ÌÅ¨ API ====================

// ÏÇ¨Ïö©Îüâ Ï°∞Ìöå API
app.get('/api/usage/check', async (c) => {
  try {
    const sessionId = getCookie(c, 'session_id')
    if (!sessionId) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    // ÏÑ∏ÏÖòÏóêÏÑú user_id Ï°∞Ìöå
    const session = await c.env.DB.prepare(`
      SELECT user_id FROM sessions WHERE session_id = ? AND expires_at > datetime('now')
    `).bind(sessionId).first()
    
    if (!session) {
      return c.json({ success: false, error: 'Session expired or invalid' }, 401)
    }
    
    const userId = session.user_id
    
    // ÏÇ¨Ïö©ÏûêÏùò academy_id Ï°∞Ìöå
    const user = await c.env.DB.prepare(`SELECT id, academy_id FROM users WHERE id = ?`).bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'User not found' }, 404)
    }
    
    // üî• ÌïµÏã¨ Î≥ÄÍ≤Ω: academy_idÎ•º Ìï≠ÏÉÅ user.idÎ°ú Í∞ïÏ†ú ÏÑ§Ï†ï
    let academyId = user.id
    
    if (user?.academy_id !== user.id) {
      try {
        await c.env.DB.prepare(`UPDATE users SET academy_id = ? WHERE id = ?`).bind(academyId, userId).run()
        console.log('[Usage Check] Fixed academy_id to:', userId)
      } catch (e) {
        console.error('[Usage Check] Failed to update academy_id:', e)
      }
    }

    // ÌôúÏÑ± Íµ¨ÎèÖ Ï°∞Ìöå
    let subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    // ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏúºÎ©¥ Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú ÌôïÏù∏
    if (!subscription) {
      subscription = await c.env.DB.prepare(`
        SELECT * FROM subscriptions 
        WHERE academy_id = ? AND plan_name = 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú'
        ORDER BY created_at DESC LIMIT 1
      `).bind(academyId).first()
    }

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' 
      }, 403)
    }

    // üî• Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå: students ÌÖåÏù¥Î∏îÏóêÏÑú Ïã§Ï†ú ÌïôÏÉù Ïàò Í≥ÑÏÇ∞
    let actualStudentsCount = 0
    try {
      const result = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM students WHERE academy_id = ?
      `).bind(academyId).first()
      actualStudentsCount = result?.count || 0
    } catch (err) {
      console.error('[Usage] students table error:', err.message)
    }
    
    // üî• Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå: landing_pages ÌÖåÏù¥Î∏îÏóêÏÑú Ïã§Ï†ú ÎûúÎî©ÌéòÏù¥ÏßÄ Ïàò Í≥ÑÏÇ∞
    let actualLandingPagesCount = 0
    try {
      const result = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM landing_pages WHERE user_id = ?
      `).bind(userId).first()
      actualLandingPagesCount = result?.count || 0
    } catch (err) {
      console.error('[Usage] landing_pages table error:', err.message)
    }
    
    // üî• Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå: teacher_applications ÌÖåÏù¥Î∏îÏóêÏÑú Ïã§Ï†ú ÏÑ†ÏÉùÎãò Ïàò Í≥ÑÏÇ∞
    let actualTeachersCount = 0
    try {
      const result = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM teacher_applications WHERE academy_id = ?
      `).bind(academyId).first()
      actualTeachersCount = result?.count || 0
    } catch (err) {
      console.error('[Usage] teacher_applications table error:', err.message)
    }

    // ÏÇ¨Ïö©Îüâ Ï°∞Ìöå (AI Î¶¨Ìè¨Ìä∏Îäî usage_trackingÏóêÏÑú Ï°∞Ìöå)
    let usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).first()

    // AI Î¶¨Ìè¨Ìä∏ ÏÇ¨Ïö©Îüâ (usage_trackingÏóêÏÑúÎßå Ï°∞Ìöå)
    let aiReportsCount = 0
    if (usage) {
      aiReportsCount = usage.ai_reports_used_this_month || 0
    }

    // üìä ÏµúÏ¢Ö ÏùëÎãµ: Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ Î∞òÌôò
    return c.json({
      success: true,
      limits: {
        students: subscription.student_limit,
        aiReports: subscription.ai_report_limit,
        landingPages: subscription.landing_page_limit,
        teachers: subscription.teacher_limit
      },
      usage: {
        students: actualStudentsCount,
        aiReports: aiReportsCount,
        landingPages: actualLandingPagesCount,
        teachers: actualTeachersCount,
        sms: usage?.sms_sent_this_month || 0
      }
    })
  } catch (error) {
    console.error('[Usage Check] Error:', error)
    return c.json({ 
      success: false, 
      error: error.message,
      stack: error.stack 
    }, 500)
  }
})

// ÌïôÏÉù Ï∂îÍ∞Ä Ï†Ñ ÌïúÎèÑ Ï≤¥ÌÅ¨
app.post('/api/usage/check-student-limit', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).first()

    const currentStudents = usage?.current_students || 0
    const canAdd = currentStudents < subscription.student_limit

    return c.json({
      success: true,
      canAdd,
      current: currentStudents,
      limit: subscription.student_limit,
      message: canAdd ? 'ÌïôÏÉùÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§' : 'ÌïôÏÉù Ïàò ÌïúÎèÑÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§'
    })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ï†Ñ ÌïúÎèÑ Ï≤¥ÌÅ¨
app.post('/api/usage/check-ai-report-limit', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).first()

    const currentReports = usage?.ai_reports_used_this_month || 0
    const canCreate = currentReports < subscription.ai_report_limit

    return c.json({
      success: true,
      canCreate,
      current: currentReports,
      limit: subscription.ai_report_limit,
      message: canCreate ? 'AI Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§' : 'AI Î¶¨Ìè¨Ìä∏ ÏõîÍ∞Ñ ÌïúÎèÑÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§'
    })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± Ï†Ñ ÌïúÎèÑ Ï≤¥ÌÅ¨
app.post('/api/usage/check-landing-page-limit', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).first()

    const currentPages = usage?.landing_pages_created || 0
    const canCreate = currentPages < subscription.landing_page_limit

    return c.json({
      success: true,
      canCreate,
      current: currentPages,
      limit: subscription.landing_page_limit,
      message: canCreate ? 'ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§' : 'ÎûúÎî©ÌéòÏù¥ÏßÄ ÌïúÎèÑÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§'
    })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ï†Ñ ÌïúÎèÑ Ï≤¥ÌÅ¨
app.post('/api/usage/check-teacher-limit', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).first()

    const currentTeachers = usage?.current_teachers || 0
    const canAdd = currentTeachers < subscription.teacher_limit

    return c.json({
      success: true,
      canAdd,
      current: currentTeachers,
      limit: subscription.teacher_limit,
      message: canAdd ? 'ÏÑ†ÏÉùÎãòÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§' : 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÌïúÎèÑÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§'
    })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä API (ÌïôÏÉù Ï∂îÍ∞Ä Ïãú)
app.post('/api/usage/increment-students', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ success: false, error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' }, 403)
    }

    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET current_students = current_students + 1, updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).run()

    return c.json({ success: true, message: 'ÌïôÏÉù ÏàòÍ∞Ä Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§' })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä API (AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ïãú)
app.post('/api/usage/increment-ai-reports', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ success: false, error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' }, 403)
    }

    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET ai_reports_used_this_month = ai_reports_used_this_month + 1, updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).run()

    return c.json({ success: true, message: 'AI Î¶¨Ìè¨Ìä∏ ÏÇ¨Ïö©ÎüâÏù¥ Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§' })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä API (ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± Ïãú)
app.post('/api/usage/increment-landing-pages', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ success: false, error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' }, 403)
    }

    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET landing_pages_created = landing_pages_created + 1, updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).run()

    return c.json({ success: true, message: 'ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÇ¨Ïö©ÎüâÏù¥ Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§' })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä API (ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ïãú)
app.post('/api/usage/increment-teachers', async (c) => {
  try {
    const session = getCookie(c, 'session_id')
    if (!session) {
      return c.json({ success: false, error: 'Not authenticated' }, 401)
    }

    const sessionData = JSON.parse(session)
    const academyId = sessionData.id

    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()

    if (!subscription) {
      return c.json({ success: false, error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' }, 403)
    }

    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET current_teachers = current_teachers + 1, updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(academyId, subscription.id).run()

    return c.json({ success: true, message: 'ÏÑ†ÏÉùÎãò ÏàòÍ∞Ä Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§' })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// üî• Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê ÏÇ¨Ïö© ÌïúÎèÑ ÏàòÏ†ï API (Íµ¨ÎèÖ ÏÉùÏÑ± Ìè¨Ìï®)
app.post('/api/admin/usage/:userId/update-limits', async (c) => {
  try {
    const userId = c.req.param('userId')
    const { studentLimit, aiReportLimit, landingPageLimit, teacherLimit, subscriptionMonths } = await c.req.json()
    
    // Í∏∞Î≥∏Í∞í: Íµ¨ÎèÖ Í∞úÏõî ÏàòÍ∞Ä ÏóÜÏúºÎ©¥ 1Í∞úÏõî
    const months = subscriptionMonths || 1
    
    console.log('[Admin] Updating usage limits for user:', userId, 'months:', months)
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
    const user = await c.env.DB.prepare('SELECT id, email, name, academy_id, academy_name FROM users WHERE id = ?').bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§' }, 404)
    }
    
    // üî• ÌïµÏã¨ Î≥ÄÍ≤Ω: Í∞Å ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í≥†Ïú†Ìïú academy_id Ìï†Îãπ (user.id Í∏∞Î∞ò)
    // academy_idÍ∞Ä ÏóÜÍ±∞ÎÇò user.idÏôÄ Îã§Î•¥Î©¥ user.idÎ°ú Í∞ïÏ†ú ÏÑ§Ï†ï
    let academyId = user.id
    
    if (user.academy_id !== user.id) {
      console.log(`[Admin] Updating academy_id from ${user.academy_id} to ${user.id} for user ${userId}`)
      await c.env.DB.prepare(`
        UPDATE users SET academy_id = ? WHERE id = ?
      `).bind(academyId, user.id).run()
    }
    
    // Ìï¥Îãπ ÏÇ¨Ïö©Ïûê(academy)Ïùò Í∏∞Ï°¥ Íµ¨ÎèÖ Ï°∞Ìöå
    const existingSubscription = await c.env.DB.prepare(`
      SELECT id FROM subscriptions 
      WHERE academy_id = ? AND plan_name = 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú'
      ORDER BY created_at DESC LIMIT 1
    `).bind(academyId).first()
    
    // ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú ÎÇ†Ïßú Í≥ÑÏÇ∞
    const now = new Date()
    const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)) // UTC+9
    const today = koreaTime.toISOString().split('T')[0]
    
    // NÍ∞úÏõî ÌõÑ Í≥ÑÏÇ∞ (Ï¢ÖÎ£åÏùºÏùÄ NÍ∞úÏõî ÌõÑ Ï†ÑÎÇ† 23:59:59)
    const endDate = new Date(koreaTime)
    endDate.setMonth(endDate.getMonth() + months)
    endDate.setDate(endDate.getDate() - 1) // Ï†ÑÎÇ†ÍπåÏßÄ
    const subscriptionEndDate = endDate.toISOString().split('T')[0]
    
    console.log(`[Admin] Subscription period: ${today} to ${subscriptionEndDate} (${months} months)`)
    
    if (existingSubscription) {
      // Í∏∞Ï°¥ Í¥ÄÎ¶¨Ïûê ÌîåÎûú ÏóÖÎç∞Ïù¥Ìä∏
      console.log('[Admin] Updating existing admin subscription:', existingSubscription.id)
      
      await c.env.DB.prepare(`
        UPDATE subscriptions 
        SET student_limit = ?, 
            ai_report_limit = ?, 
            landing_page_limit = ?, 
            teacher_limit = ?,
            subscription_start_date = ?,
            subscription_end_date = ?,
            status = 'active',
            updated_at = CURRENT_TIMESTAMP
        WHERE id = ?
      `).bind(studentLimit, aiReportLimit, landingPageLimit, teacherLimit, today, subscriptionEndDate, existingSubscription.id).run()
      
      // usage_trackingÎèÑ ÌôïÏù∏ÌïòÍ≥† ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
      try {
        const existingUsage = await c.env.DB.prepare(`
          SELECT id FROM usage_tracking WHERE academy_id = ? AND subscription_id = ?
        `).bind(academyId, existingSubscription.id).first()
        
        if (!existingUsage) {
          console.log('[Admin] Creating missing usage_tracking for existing subscription')
          await c.env.DB.prepare(`
            INSERT INTO usage_tracking (
              academy_id, subscription_id,
              current_students, ai_reports_used_this_month, 
              landing_pages_created, current_teachers,
              created_at, updated_at
            )
            VALUES (?, ?, 0, 0, 0, 0, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
          `).bind(academyId, existingSubscription.id).run()
        }
      } catch (usageError) {
        console.warn('[Admin] Failed to create usage_tracking (may already exist):', usageError.message)
        // Continue anyway - usage_tracking is not critical for subscription limits
      }
      
      console.log('‚úÖ [Admin] Existing admin subscription updated')
      
      // üî• Íµ¨ÎèÖ ÏÑ§Ï†ï Ïãú ÏûêÎèôÏúºÎ°ú Í∂åÌïú Î∂ÄÏó¨
      const permissionResult = await grantDefaultPermissions(c.env.DB, userId)
      console.log('[Admin] Permission grant result:', permissionResult)
    } else {
      // ÏÉà Í¥ÄÎ¶¨Ïûê ÌîåÎûú ÏÉùÏÑ±
      console.log('[Admin] Creating new admin subscription for academy_id:', academyId)
      
      const newSubResult = await c.env.DB.prepare(`
        INSERT INTO subscriptions (
          academy_id, plan_name, plan_price, 
          student_limit, ai_report_limit, landing_page_limit, teacher_limit,
          subscription_start_date, subscription_end_date, status, payment_method,
          merchant_uid, created_at
        )
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))
      `).bind(
        academyId, 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú', 0,
        studentLimit, aiReportLimit, landingPageLimit, teacherLimit,
        today, subscriptionEndDate, 'active', 'admin',
        'admin_' + userId + '_' + Date.now()
      ).run()
      
      const newSubId = newSubResult.meta.last_row_id
      
      // usage_tracking ÏÉùÏÑ±
      try {
        await c.env.DB.prepare(`
          INSERT INTO usage_tracking (
            academy_id, subscription_id,
            current_students, ai_reports_used_this_month, 
            landing_pages_created, current_teachers,
            created_at, updated_at
          )
          VALUES (?, ?, 0, 0, 0, 0, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
        `).bind(academyId, newSubId).run()
        console.log('‚úÖ [Admin] New admin subscription created with usage_tracking')
        
        // üî• Íµ¨ÎèÖ ÏÑ§Ï†ï Ïãú ÏûêÎèôÏúºÎ°ú Í∂åÌïú Î∂ÄÏó¨
        const permissionResult = await grantDefaultPermissions(c.env.DB, userId)
        console.log('[Admin] Permission grant result:', permissionResult)
      } catch (usageError) {
        console.warn('[Admin] Failed to create usage_tracking:', usageError.message)
        console.log('‚úÖ [Admin] New admin subscription created (usage_tracking will be auto-created on first use)')
        
        // üî• Íµ¨ÎèÖ ÏÑ§Ï†ï Ïãú ÏûêÎèôÏúºÎ°ú Í∂åÌïú Î∂ÄÏó¨
        const permissionResult = await grantDefaultPermissions(c.env.DB, userId)
        console.log('[Admin] Permission grant result:', permissionResult)
      }
    }
    
    return c.json({ 
      success: true, 
      message: 'ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§',
      limits: {
        studentLimit,
        aiReportLimit,
        landingPageLimit,
        teacherLimit
      }
    })
  } catch (error) {
    console.error('[Admin] Update limits error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// üî• Í¥ÄÎ¶¨Ïûê: ÌîåÎûú ÌöåÏàò API
app.post('/api/admin/revoke-plan/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    
    console.log('[Admin] Revoking plan for user:', userId)
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
    const user = await c.env.DB.prepare('SELECT id, email, name, academy_id FROM users WHERE id = ?').bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§' }, 404)
    }
    
    const academyId = user.academy_id || user.id
    
    // 1. Íµ¨ÎèÖ ÎßåÎ£å Ï≤òÎ¶¨
    const updateResult = await c.env.DB.prepare(`
      UPDATE subscriptions 
      SET status = 'expired', updated_at = CURRENT_TIMESTAMP
      WHERE academy_id = ? AND status = 'active'
    `).bind(academyId).run()
    
    console.log('[Admin] Subscriptions expired:', updateResult.meta.changes)
    
    // 2. Î™®Îì† Í∂åÌïú ÎπÑÌôúÏÑ±Ìôî (user_permissions ÌÖåÏù¥Î∏îÏóêÎäî updated_at ÏóÜÏùå)
    const revokeResult = await c.env.DB.prepare(`
      UPDATE user_permissions 
      SET is_active = 0
      WHERE user_id = ?
    `).bind(userId).run()
    
    console.log('[Admin] Permissions revoked:', revokeResult.meta.changes)
    
    return c.json({ 
      success: true, 
      message: 'ÌîåÎûúÏù¥ ÌöåÏàòÎêòÏóàÏäµÎãàÎã§',
      details: {
        subscriptionsExpired: updateResult.meta.changes,
        permissionsRevoked: revokeResult.meta.changes
      }
    })
  } catch (error) {
    console.error('[Admin] Revoke plan error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// üî• Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê Íµ¨ÎèÖ Ï†ïÎ≥¥ Ï°∞Ìöå API
app.get('/api/admin/usage/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    
    // ÏÇ¨Ïö©ÏûêÏùò academy_id Ï°∞Ìöå
    const user = await c.env.DB.prepare('SELECT id, academy_id, name, academy_name FROM users WHERE id = ?').bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, hasSubscription: false, message: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§' })
    }
    
    // academy_idÍ∞Ä ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
    let academyId = user.academy_id
    if (!academyId) {
      // user.idÎ•º academy_idÎ°ú ÏÇ¨Ïö©
      academyId = user.id
      try {
        await c.env.DB.prepare(`
          UPDATE users SET academy_id = ? WHERE id = ?
        `).bind(academyId, user.id).run()
        console.log('[Admin] Auto-created academy_id:', academyId)
      } catch (err) {
        console.error('[Admin] Failed to set academy_id:', err)
      }
    }
    
    // ÌôúÏÑ± Íµ¨ÎèÖ Ï°∞Ìöå (Îëê Í∞ÄÏßÄ Ïä§ÌÇ§Îßà Î™®Îëê ÏãúÎèÑ)
    let subscription = null
    try {
      // Î®ºÏ†Ä ÏÉà Ïä§ÌÇ§Îßà ÏãúÎèÑ (academy_id)
      subscription = await c.env.DB.prepare(`
        SELECT * FROM subscriptions 
        WHERE academy_id = ? AND status = 'active'
        ORDER BY created_at DESC LIMIT 1
      `).bind(academyId).first()
    } catch (e) {
      console.log('[Admin] academy_id column not found in GET, trying user_id (old schema):', e.message)
      // Íµ¨ Ïä§ÌÇ§Îßà ÏãúÎèÑ (user_id)
      try {
        subscription = await c.env.DB.prepare(`
          SELECT * FROM subscriptions 
          WHERE user_id = ? AND status = 'active'
          ORDER BY created_at DESC LIMIT 1
        `).bind(user.id).first()
        
        if (subscription) {
          console.log('[Admin] Found subscription using old schema (user_id) in GET')
        }
      } catch (e2) {
        console.log('[Admin] Both schema attempts failed in GET:', e2.message)
        return c.json({ 
          success: false, 
          error: 'DB Ïä§ÌÇ§Îßà Ïò§Î•ò: /api/db/migrateÎ•º Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî. Error: ' + e2.message 
        }, 500)
      }
    }
    
    if (!subscription) {
      return c.json({ success: true, hasSubscription: false, message: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§' })
    }
    
    // ÏÇ¨Ïö©Îüâ Ï°∞Ìöå
    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE subscription_id = ?
    `).bind(subscription.id).first()
    
    return c.json({
      success: true,
      hasSubscription: true,
      subscription: {
        id: subscription.id,
        planName: subscription.plan_name,
        startDate: subscription.subscription_start_date,
        endDate: subscription.subscription_end_date,
        studentLimit: subscription.student_limit,
        aiReportLimit: subscription.ai_report_limit,
        landingPageLimit: subscription.landing_page_limit,
        teacherLimit: subscription.teacher_limit
      },
      usage: {
        currentStudents: usage?.current_students || 0,
        aiReportsUsed: usage?.ai_reports_used_this_month || 0,
        landingPagesCreated: usage?.landing_pages_created || 0,
        currentTeachers: usage?.current_teachers || 0
      }
    })
  } catch (error) {
    console.error('[Admin] Get usage error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ==================== ÌîåÎûúÎ≥Ñ Íµ¨Îß§ ÌéòÏù¥ÏßÄ ====================

// Ïä§ÌÉÄÌÑ∞ ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/starter', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ïä§ÌÉÄÌÑ∞ ÌîåÎûú Íµ¨Îß§ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-gradient-to-br from-gray-50 via-white to-purple-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="flex items-center space-x-6">
                        <a href="/pricing" class="text-gray-600 hover:text-purple-600 transition">‚Üê ÏöîÍ∏àÏ†úÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</a>
                        <a href="/dashboard" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium hover:shadow-lg transition">ÎåÄÏãúÎ≥¥Îìú</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-32 pb-24 px-6">
            <div class="max-w-6xl mx-auto">
                <div class="grid lg:grid-cols-2 gap-12">
                    <!-- ÏôºÏ™Ω: ÌîåÎûú Ï†ïÎ≥¥ -->
                    <div>
                        <div class="inline-block px-4 py-2 bg-gray-100 rounded-full text-gray-700 text-sm font-semibold mb-4">
                            Ïä§ÌÉÄÌÑ∞ ÌîåÎûú
                        </div>
                        <h1 class="text-5xl font-bold text-gray-900 mb-4">
                            ÏÜåÍ∑úÎ™® ÌïôÏõêÏùÑ ÏúÑÌïú<br>
                            <span class="text-purple-600">ÏãúÏûë ÌîåÎûú</span>
                        </h1>
                        <div class="flex items-end gap-3 mb-8">
                            <span class="text-6xl font-bold text-gray-900">‚Ç©55,000</span>
                            <span class="text-2xl text-gray-600 mb-2">/Ïõî</span>
                        </div>

                        <div class="bg-white rounded-2xl p-8 border-2 border-gray-200 mb-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3>
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">ÌïôÏÉù ÏµúÎåÄ 30Î™Ö</div>
                                        <div class="text-sm text-gray-600">ÏÜåÍ∑úÎ™® ÌïôÏõêÏóê ÏµúÏ†ÅÌôî</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">AI ÌïôÏäµ Î¶¨Ìè¨Ìä∏ Ïõî 30Í∞ú</div>
                                        <div class="text-sm text-gray-600">ÌïôÏÉùÎ≥Ñ ÎßûÏ∂§ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">ÎûúÎî©ÌéòÏù¥ÏßÄ 40Í∞ú</div>
                                        <div class="text-sm text-gray-600">Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ ÌéòÏù¥ÏßÄ Ï†úÏûë</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 2Î™Ö</div>
                                        <div class="text-sm text-gray-600">Îã§Ï§ë ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù</div>
                                        <div class="text-sm text-gray-600">ÌïôÏÉù ÏùºÏùº ÌïôÏäµ ÌòÑÌô© Í¥ÄÎ¶¨</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">Í∏∞Î≥∏ ÎßàÏºÄÌåÖ ÏûêÎ£å</div>
                                        <div class="text-sm text-gray-600">ÌÖúÌîåÎ¶ø Ï†úÍ≥µ</div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">Ïù¥Î©îÏùº ÏßÄÏõê</div>
                                        <div class="text-sm text-gray-600">ÏóÖÎ¨¥ÏãúÍ∞Ñ ÎÇ¥ ÏßÄÏõê</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                            <div class="flex items-start gap-3">
                                <svg class="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="text-sm text-gray-700">
                                    <strong>Ïù¥Ïö© Í∏∞Í∞Ñ:</strong> Í≤∞Ï†úÏùºÎ°úÎ∂ÄÌÑ∞ 1Í∞úÏõî<br>
                                    <strong>ÏûêÎèô Í∞±Ïã†:</strong> ÏóÜÏùå (Ïû¨Íµ¨Îß§ ÌïÑÏöî)<br>
                                    <strong>ÌôòÎ∂à Ï†ïÏ±Ö:</strong> 7Ïùº Ïù¥ÎÇ¥ 100% ÌôòÎ∂à
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ïò§Î•∏Ï™Ω: Í≤∞Ï†ú Ìèº -->
                    <div>
                        <div class="bg-white rounded-2xl p-8 border-2 border-gray-200 shadow-xl sticky top-32">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6">Í≤∞Ï†ú Ï†ïÎ≥¥</h2>
                            
                            <div class="mb-6">
                                <div class="flex justify-between items-center py-6">
                                    <div>
                                        <div class="text-lg font-bold text-gray-900">Ïä§ÌÉÄÌÑ∞ ÌîåÎûú (ÏõîÍ∞Ñ)</div>
                                        <div class="text-sm text-gray-600 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div>
                                    </div>
                                    <span class="text-3xl font-bold text-purple-600">‚Ç©55,000</span>
                                </div>
                            </div>

                            <div class="space-y-4 mb-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ïù¥Î¶Ñ</label>
                                    <input type="text" id="buyerName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="ÌôçÍ∏∏Îèô">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ïù¥Î©îÏùº</label>
                                    <input type="email" id="buyerEmail" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="example@email.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ïó∞ÎùΩÏ≤ò</label>
                                    <input type="tel" id="buyerPhone" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="010-1234-5678">
                                </div>
                            </div>

                            <div class="mb-6">
                                <label class="flex items-start gap-3">
                                    <input type="checkbox" id="agreeTerms" class="mt-1 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                    <span class="text-sm text-gray-700">
                                        <a href="/terms" class="text-purple-600 hover:underline">Ïù¥Ïö©ÏïΩÍ¥Ä</a> Î∞è 
                                        <a href="/privacy" class="text-purple-600 hover:underline">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>Ïóê ÎèôÏùòÌï©ÎãàÎã§.
                                    </span>
                                </label>
                            </div>

                            <button onclick="processPayment()" class="w-full py-4 gradient-purple text-white rounded-xl font-bold text-lg hover:shadow-2xl transition-all">
                                ‚Ç©60,500 Í≤∞Ï†úÌïòÍ∏∞
                            </button>

                            <div class="mt-6 text-center text-sm text-gray-500">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                ÏïàÏ†ÑÌïú Í≤∞Ï†ú ÏãúÏä§ÌÖúÏúºÎ°ú Î≥¥Ìò∏Îê©ÎãàÎã§
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ÏïÑÏûÑÌè¨Ìä∏ Ï¥àÍ∏∞Ìôî (ÎÇòÏ§ëÏóê Ïã§Ï†ú Í∞ÄÎßπÏ†ê ÏΩîÎìúÎ°ú Î≥ÄÍ≤Ω)
            IMP.init('imp00000000');

            // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨ Î∞è ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏûêÎèô ÏûÖÎ†•
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (user) {
                document.getElementById('buyerName').value = user.name || '';
                document.getElementById('buyerEmail').value = user.email || '';
                document.getElementById('buyerPhone').value = user.phone || '';
            }

            function processPayment() {
                const name = document.getElementById('buyerName').value;
                const email = document.getElementById('buyerEmail').value;
                const phone = document.getElementById('buyerPhone').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;

                if (!name || !email || !phone) {
                    alert('Î™®Îì† Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (!agreeTerms) {
                    alert('Ïù¥Ïö©ÏïΩÍ¥Ä Î∞è Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®Ïóê ÎèôÏùòÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (!user) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.');
                    window.location.href = '/login';
                    return;
                }

                // merchant_uid ÏÉùÏÑ±
                const merchantUid = \`academy_\${user.id}_starter_\${new Date().getTime()}\`;

                console.log('[Payment] Starting payment:', { plan: 'starter', amount: 60500, merchantUid });

                IMP.request_pay({
                    pg: 'html5_inicis',
                    pay_method: 'card',
                    merchant_uid: merchantUid,
                    name: 'Ïä§ÌÉÄÌÑ∞ ÌîåÎûú (ÏõîÍ∞Ñ)',
                    amount: 60500,
                    buyer_email: email,
                    buyer_name: name,
                    buyer_tel: phone,
                    buyer_addr: '',
                    buyer_postcode: ''
                }, async function(rsp) {
                    if (rsp.success) {
                        console.log('[Payment] Payment success:', { imp_uid: rsp.imp_uid, merchant_uid: rsp.merchant_uid });
                        
                        try {
                            const response = await fetch('/api/payments/complete', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    imp_uid: rsp.imp_uid,
                                    merchant_uid: rsp.merchant_uid
                                })
                            });

                            const result = await response.json();
                            
                            if (result.success) {
                                const sub = result.subscription;
                                alert(\`Í≤∞Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÌîåÎûú: \${sub.planName}\\nÏù¥Ïö© Í∏∞Í∞Ñ: \${sub.startDate} ~ \${sub.endDate}\\n\\nÎåÄÏãúÎ≥¥ÎìúÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.\`);
                                window.location.href = '/dashboard';
                            } else {
                                alert('Í≤∞Ï†ú Ï≤òÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + result.error);
                            }
                        } catch (error) {
                            console.error('[Payment] Error:', error);
                            alert('Í≤∞Ï†ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    } else {
                        console.error('[Payment] Payment failed:', rsp.error_msg);
                        alert('Í≤∞Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + rsp.error_msg);
                    }
                });
            }
        </script>
    </body>
    </html>
  `)
})

// Î≤†Ïù¥ÏßÅ ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/basic', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î≤†Ïù¥ÏßÅ ÌîåÎûú Íµ¨Îß§ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
          .gradient-purple { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }
          .gradient-blue { background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); }
        </style>
    </head>
    <body class="bg-gradient-to-br from-blue-50 via-white to-purple-50">
        <nav class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="flex items-center space-x-6">
                        <a href="/pricing" class="text-gray-600 hover:text-purple-600 transition">‚Üê ÏöîÍ∏àÏ†úÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</a>
                        <a href="/dashboard" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium hover:shadow-lg transition">ÎåÄÏãúÎ≥¥Îìú</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-32 pb-24 px-6">
            <div class="max-w-6xl mx-auto">
                <div class="grid lg:grid-cols-2 gap-12">
                    <div>
                        <div class="inline-block px-4 py-2 bg-blue-100 rounded-full text-blue-700 text-sm font-semibold mb-4">Î≤†Ïù¥ÏßÅ ÌîåÎûú</div>
                        <h1 class="text-5xl font-bold text-gray-900 mb-4">ÏÑ±Ïû•ÌïòÎäî ÌïôÏõêÏùÑ ÏúÑÌïú<br><span class="text-blue-600">Î≤†Ïù¥ÏßÅ ÌîåÎûú</span></h1>
                        <div class="flex items-end gap-3 mb-8">
                            <span class="text-6xl font-bold text-gray-900">‚Ç©77,000</span>
                            <span class="text-2xl text-gray-600 mb-2">/Ïõî</span>
                        </div>

                        <div class="bg-white rounded-2xl p-8 border-2 border-blue-200 mb-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3>
                            <div class="space-y-4">
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">ÌïôÏÉù ÏµúÎåÄ 50Î™Ö</div><div class="text-sm text-gray-600">Ï§ëÏÜåÍ∑úÎ™® ÌïôÏõêÏóê Ï†ÅÌï©</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">AI ÌïôÏäµ Î¶¨Ìè¨Ìä∏ Ïõî 50Í∞ú</div><div class="text-sm text-gray-600">ÌïôÏÉùÎ≥Ñ ÎßûÏ∂§ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">ÎûúÎî©ÌéòÏù¥ÏßÄ 70Í∞ú</div><div class="text-sm text-gray-600">Ï†ÑÎ¨∏ ÎßàÏºÄÌåÖ ÌéòÏù¥ÏßÄ Ï†úÏûë</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 4Î™Ö</div><div class="text-sm text-gray-600">ÌåÄ ÌòëÏóÖ Í∞ïÌôî</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏûêÎèôÌôî</div><div class="text-sm text-gray-600">ÏûêÎèô Î©îÏãúÏßÄ Î∞úÏÜ°</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú</div><div class="text-sm text-gray-600">ÏßÄÏó≠ ÎßàÏºÄÌåÖ Í∞ïÌôî</div></div></div>
                                <div class="flex items-start gap-3"><div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><div><div class="font-semibold text-gray-900">Ïù¥Î©îÏùº ÏßÄÏõê</div><div class="text-sm text-gray-600">ÏóÖÎ¨¥ÏãúÍ∞Ñ ÎÇ¥ ÏßÄÏõê</div></div></div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white rounded-2xl p-8 border-2 border-blue-200 shadow-xl sticky top-32">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6">Í≤∞Ï†ú Ï†ïÎ≥¥</h2>
                            <div class="mb-6">
                                <div class="flex justify-between items-center py-6"><div><div class="text-lg font-bold text-gray-900">Î≤†Ïù¥ÏßÅ ÌîåÎûú (ÏõîÍ∞Ñ)</div><div class="text-sm text-gray-600 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div></div><span class="text-3xl font-bold text-blue-600">‚Ç©77,000</span></div>
                            </div>
                            <div class="space-y-4 mb-6">
                                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Ïù¥Î¶Ñ</label><input type="text" id="buyerName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="ÌôçÍ∏∏Îèô"></div>
                                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Ïù¥Î©îÏùº</label><input type="email" id="buyerEmail" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="example@email.com"></div>
                                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Ïó∞ÎùΩÏ≤ò</label><input type="tel" id="buyerPhone" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="010-1234-5678"></div>
                            </div>
                            <div class="mb-6"><label class="flex items-start gap-3"><input type="checkbox" id="agreeTerms" class="mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"><span class="text-sm text-gray-700"><a href="/terms" class="text-blue-600 hover:underline">Ïù¥Ïö©ÏïΩÍ¥Ä</a> Î∞è <a href="/privacy" class="text-blue-600 hover:underline">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>Ïóê ÎèôÏùòÌï©ÎãàÎã§.</span></label></div>
                            <button onclick="processPayment()" class="w-full py-4 gradient-blue text-white rounded-xl font-bold text-lg hover:shadow-2xl transition-all">‚Ç©84,700 Í≤∞Ï†úÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            IMP.init('imp00000000');
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (user) {
                document.getElementById('buyerName').value = user.name || '';
                document.getElementById('buyerEmail').value = user.email || '';
                document.getElementById('buyerPhone').value = user.phone || '';
            }
            function processPayment() {
                const name = document.getElementById('buyerName').value;
                const email = document.getElementById('buyerEmail').value;
                const phone = document.getElementById('buyerPhone').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                if (!name || !email || !phone) { alert('Î™®Îì† Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
                if (!agreeTerms) { alert('Ïù¥Ïö©ÏïΩÍ¥Ä Î∞è Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®Ïóê ÎèôÏùòÌï¥Ï£ºÏÑ∏Ïöî.'); return; }
                if (!user) { alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.'); window.location.href = '/login'; return; }
                const merchantUid = \`academy_\${user.id}_basic_\${new Date().getTime()}\`;
                IMP.request_pay({
                    pg: 'html5_inicis', pay_method: 'card', merchant_uid: merchantUid,
                    name: 'Î≤†Ïù¥ÏßÅ ÌîåÎûú (ÏõîÍ∞Ñ)', amount: 84700,
                    buyer_email: email, buyer_name: name, buyer_tel: phone
                }, async function(rsp) {
                    if (rsp.success) {
                        try {
                            const response = await fetch('/api/payments/complete', {
                                method: 'POST', headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ imp_uid: rsp.imp_uid, merchant_uid: rsp.merchant_uid })
                            });
                            const result = await response.json();
                            if (result.success) {
                                alert(\`Í≤∞Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÌîåÎûú: \${result.subscription.planName}\\nÏù¥Ïö© Í∏∞Í∞Ñ: \${result.subscription.startDate} ~ \${result.subscription.endDate}\`);
                                window.location.href = '/dashboard';
                            } else { alert('Í≤∞Ï†ú Ï≤òÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + result.error); }
                        } catch (error) { alert('Í≤∞Ï†ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'); }
                    } else { alert('Í≤∞Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + rsp.error_msg); }
                });
            }
        </script>
    </body>
    </html>
  `)
})

// ÌîÑÎ°ú ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/pro', (c) => {
  return c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>ÌîÑÎ°ú ÌîåÎûú Íµ¨Îß§</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.iamport.kr/v1/iamport.js"></script><style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');*{font-family:'Pretendard Variable',Pretendard,sans-serif;}.gradient-purple{background:linear-gradient(135deg,#7c3aed 0%,#a855f7 100%);}</style></head><body class="bg-gradient-to-br from-purple-50 via-white to-pink-50"><nav class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-md border-b"><div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center"><a href="/" class="text-xl font-bold">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</a><div class="flex gap-6"><a href="/pricing" class="text-gray-600">‚Üê ÏöîÍ∏àÏ†ú</a><a href="/dashboard" class="gradient-purple text-white px-6 py-2.5 rounded-full">ÎåÄÏãúÎ≥¥Îìú</a></div></div></nav><div class="pt-32 pb-24 px-6"><div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-12"><div><div class="inline-block px-4 py-2 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full text-purple-700 font-semibold mb-4">ÌîÑÎ°ú ÌîåÎûú ‚≠ê Í∞ÄÏû• Ïù∏Í∏∞</div><h1 class="text-5xl font-bold mb-4">Ï§ëÌòï ÌïôÏõêÏùÑ ÏúÑÌïú<br><span class="bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú</span></h1><div class="flex items-end gap-3 mb-8"><span class="text-6xl font-bold">‚Ç©147,000</span><span class="text-2xl text-gray-600">/Ïõî</span></div><div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl p-8 text-white"><h3 class="text-xl font-bold mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3><div class="space-y-3"><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÌïôÏÉù 100Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>AI Î¶¨Ìè¨Ìä∏ 100Í∞ú/Ïõî</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎûúÎî©ÌéòÏù¥ÏßÄ 140Í∞ú</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÏÑ†ÏÉùÎãò 6Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>AI ÎßàÏºÄÌåÖ Ïª®ÏÑ§ÌåÖ</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎîîÏûêÏù∏ ÌÖúÌîåÎ¶ø Î¨¥Ï†úÌïú</span></div><div class="flex gap-3"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Ïö∞ÏÑ† ÏßÄÏõê (24ÏãúÍ∞Ñ)</span></div></div></div></div><div><div class="bg-white rounded-2xl p-8 border-2 border-purple-300 shadow-2xl sticky top-32"><div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-2 rounded-full text-sm font-bold">‚≠ê Í∞ÄÏû• Ïù∏Í∏∞</div><h2 class="text-2xl font-bold mb-6 mt-4">Í≤∞Ï†ú Ï†ïÎ≥¥</h2><div class="mb-6"><div class="flex justify-between py-6"><div><div class="text-lg font-bold">ÌîÑÎ°ú ÌîåÎûú (ÏõîÍ∞Ñ)</div><div class="text-sm text-gray-600 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div></div><span class="text-3xl font-bold text-purple-600">‚Ç©147,000</span></div></div><div class="space-y-4 mb-6"><input type="text" id="buyerName" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î¶Ñ"><input type="email" id="buyerEmail" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î©îÏùº"><input type="tel" id="buyerPhone" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïó∞ÎùΩÏ≤ò"></div><label class="flex gap-3 mb-6"><input type="checkbox" id="agreeTerms" class="w-5 h-5"><span class="text-sm">ÏïΩÍ¥Ä ÎèôÏùò</span></label><button onclick="processPayment()" class="w-full py-4 gradient-purple text-white rounded-xl font-bold hover:shadow-2xl">‚Ç©147,000 Í≤∞Ï†ú</button></div></div></div></div><script>IMP.init('imp00000000');const user=JSON.parse(localStorage.getItem('user')||'null');if(user){document.getElementById('buyerName').value=user.name||'';document.getElementById('buyerEmail').value=user.email||'';document.getElementById('buyerPhone').value=user.phone||'';}function processPayment(){const name=document.getElementById('buyerName').value,email=document.getElementById('buyerEmail').value,phone=document.getElementById('buyerPhone').value;if(!name||!email||!phone||!document.getElementById('agreeTerms').checked){alert('Ï†ïÎ≥¥ ÏûÖÎ†• Î∞è ÏïΩÍ¥Ä ÎèôÏùò ÌïÑÏöî');return;}if(!user){window.location.href='/login';return;}const merchantUid='academy_'+user.id+'_pro_'+Date.now();IMP.request_pay({pg:'html5_inicis',pay_method:'card',merchant_uid:merchantUid,name:'ÌîÑÎ°ú ÌîåÎûú',amount:161700,buyer_email:email,buyer_name:name,buyer_tel:phone},async(rsp)=>{if(rsp.success){const res=await fetch('/api/payments/complete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imp_uid:rsp.imp_uid,merchant_uid:rsp.merchant_uid})});const result=await res.json();if(result.success){alert('Í≤∞Ï†ú ÏôÑÎ£å!');window.location.href='/dashboard';}}else{alert('Í≤∞Ï†ú Ïã§Ìå®: '+rsp.error_msg);}});}</script></body></html>`)
})

// ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/business', (c) => {
  return c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú Íµ¨Îß§</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.iamport.kr/v1/iamport.js"></script><style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');*{font-family:'Pretendard Variable',Pretendard,sans-serif;}</style></head><body class="bg-gradient-to-br from-green-50 to-blue-50"><nav class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-md border-b"><div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center"><a href="/" class="text-xl font-bold">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</a><div class="flex gap-6"><a href="/pricing" class="text-gray-600">‚Üê ÏöîÍ∏àÏ†ú</a><a href="/dashboard" class="bg-green-600 text-white px-6 py-2.5 rounded-full">ÎåÄÏãúÎ≥¥Îìú</a></div></div></nav><div class="pt-32 pb-24 px-6"><div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-12"><div><div class="inline-block px-4 py-2 bg-green-100 rounded-full text-green-700 font-semibold mb-4">ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú</div><h1 class="text-5xl font-bold mb-4">ÎåÄÌòï ÌïôÏõêÏùÑ ÏúÑÌïú<br><span class="text-green-600">ÎπÑÏ¶àÎãàÏä§ ÏÜîÎ£®ÏÖò</span></h1><div class="flex items-end gap-3 mb-8"><span class="text-6xl font-bold">‚Ç©297,000</span><span class="text-2xl text-gray-600">/Ïõî</span></div><div class="bg-white rounded-2xl p-8 border-2 border-green-200"><h3 class="text-xl font-bold mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3><div class="space-y-3 text-gray-700"><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÌïôÏÉù 300Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>AI Î¶¨Ìè¨Ìä∏ 600Í∞ú/Ïõî</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎûúÎî©ÌéòÏù¥ÏßÄ 550Í∞ú</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÏÑ†ÏÉùÎãò 10Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Î©ÄÌã∞ Ï∫†ÌçºÏä§ Í¥ÄÎ¶¨</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Ï†ÑÏö© Í≥ÑÏ†ï Îß§ÎãàÏ†Ä</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎßûÏ∂§Ìòï ÎåÄÏãúÎ≥¥Îìú</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>24/7 Ï†ÑÌôî ÏßÄÏõê</span></div></div></div></div><div><div class="bg-white rounded-2xl p-8 border-2 border-green-300 shadow-2xl sticky top-32"><h2 class="text-2xl font-bold mb-6">Í≤∞Ï†ú Ï†ïÎ≥¥</h2><div class="mb-6"><div class="flex justify-between py-6"><div><div class="text-lg font-bold">ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú (ÏõîÍ∞Ñ)</div><div class="text-sm text-gray-600 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div></div><span class="text-3xl font-bold text-green-600">‚Ç©297,000</span></div></div><div class="space-y-4 mb-6"><input type="text" id="buyerName" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î¶Ñ"><input type="email" id="buyerEmail" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î©îÏùº"><input type="tel" id="buyerPhone" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïó∞ÎùΩÏ≤ò"></div><label class="flex gap-3 mb-6"><input type="checkbox" id="agreeTerms" class="w-5 h-5"><span class="text-sm">ÏïΩÍ¥Ä ÎèôÏùò</span></label><button onclick="processPayment()" class="w-full py-4 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700">‚Ç©297,000 Í≤∞Ï†ú</button></div></div></div></div><script>IMP.init('imp00000000');const user=JSON.parse(localStorage.getItem('user')||'null');if(user){document.getElementById('buyerName').value=user.name||'';document.getElementById('buyerEmail').value=user.email||'';document.getElementById('buyerPhone').value=user.phone||'';}function processPayment(){const name=document.getElementById('buyerName').value,email=document.getElementById('buyerEmail').value,phone=document.getElementById('buyerPhone').value;if(!name||!email||!phone||!document.getElementById('agreeTerms').checked){alert('Ï†ïÎ≥¥ ÏûÖÎ†• Î∞è ÏïΩÍ¥Ä ÎèôÏùò ÌïÑÏöî');return;}if(!user){window.location.href='/login';return;}const merchantUid='academy_'+user.id+'_business_'+Date.now();IMP.request_pay({pg:'html5_inicis',pay_method:'card',merchant_uid:merchantUid,name:'ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú',amount:326700,buyer_email:email,buyer_name:name,buyer_tel:phone},async(rsp)=>{if(rsp.success){const res=await fetch('/api/payments/complete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imp_uid:rsp.imp_uid,merchant_uid:rsp.merchant_uid})});const result=await res.json();if(result.success){alert('Í≤∞Ï†ú ÏôÑÎ£å!');window.location.href='/dashboard';}}else{alert('Í≤∞Ï†ú Ïã§Ìå®: '+rsp.error_msg);}});}</script></body></html>`)
})

// ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/premium', (c) => {
  return c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú Íµ¨Îß§</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.iamport.kr/v1/iamport.js"></script><style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');*{font-family:'Pretendard Variable',Pretendard,sans-serif;}</style></head><body class="bg-gradient-to-br from-amber-50 to-orange-50"><nav class="fixed w-full top-0 z-50 bg-white/90 backdrop-blur-md border-b"><div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center"><a href="/" class="text-xl font-bold">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</a><div class="flex gap-6"><a href="/pricing" class="text-gray-600">‚Üê ÏöîÍ∏àÏ†ú</a><a href="/dashboard" class="bg-amber-600 text-white px-6 py-2.5 rounded-full">ÎåÄÏãúÎ≥¥Îìú</a></div></div></nav><div class="pt-32 pb-24 px-6"><div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-12"><div><div class="inline-block px-4 py-2 bg-gradient-to-r from-amber-100 to-orange-100 rounded-full text-amber-700 font-semibold mb-4">ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú</div><h1 class="text-5xl font-bold mb-4">ÏµúÏÉÅÏúÑ ÌïôÏõêÏùÑ ÏúÑÌïú<br><span class="bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏÑúÎπÑÏä§</span></h1><div class="flex items-end gap-3 mb-8"><span class="text-6xl font-bold">‚Ç©440,000</span><span class="text-2xl text-gray-600">/Ïõî</span></div><div class="bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-2xl p-8"><h3 class="text-xl font-bold mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3><div class="space-y-3"><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÌïôÏÉù 500Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>AI Î¶¨Ìè¨Ìä∏ 1,000Í∞ú/Ïõî</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎûúÎî©ÌéòÏù¥ÏßÄ 900Í∞ú</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÏÑ†ÏÉùÎãò 15Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Í≥†Í∏â Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>API Ïó∞Îèô ÏßÄÏõê</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Ï†ÑÏö© ÎßàÏºÄÌåÖ Îß§ÎãàÏ†Ä</span></div><div class="flex gap-3"><svg class="w-5 h-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>VIP ÏßÄÏõê</span></div></div></div></div><div><div class="bg-white rounded-2xl p-8 border-2 border-amber-300 shadow-2xl sticky top-32"><h2 class="text-2xl font-bold mb-6">Í≤∞Ï†ú Ï†ïÎ≥¥</h2><div class="mb-6"><div class="flex justify-between py-6"><div><div class="text-lg font-bold">ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú (ÏõîÍ∞Ñ)</div><div class="text-sm text-gray-600 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div></div><span class="text-3xl font-bold text-amber-600">‚Ç©440,000</span></div></div><div class="space-y-4 mb-6"><input type="text" id="buyerName" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î¶Ñ"><input type="email" id="buyerEmail" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïù¥Î©îÏùº"><input type="tel" id="buyerPhone" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Ïó∞ÎùΩÏ≤ò"></div><label class="flex gap-3 mb-6"><input type="checkbox" id="agreeTerms" class="w-5 h-5"><span class="text-sm">ÏïΩÍ¥Ä ÎèôÏùò</span></label><button onclick="processPayment()" class="w-full py-4 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-xl font-bold hover:shadow-2xl">‚Ç©440,000 Í≤∞Ï†ú</button></div></div></div></div><script>IMP.init('imp00000000');const user=JSON.parse(localStorage.getItem('user')||'null');if(user){document.getElementById('buyerName').value=user.name||'';document.getElementById('buyerEmail').value=user.email||'';document.getElementById('buyerPhone').value=user.phone||'';}function processPayment(){const name=document.getElementById('buyerName').value,email=document.getElementById('buyerEmail').value,phone=document.getElementById('buyerPhone').value;if(!name||!email||!phone||!document.getElementById('agreeTerms').checked){alert('Ï†ïÎ≥¥ ÏûÖÎ†• Î∞è ÏïΩÍ¥Ä ÎèôÏùò ÌïÑÏöî');return;}if(!user){window.location.href='/login';return;}const merchantUid='academy_'+user.id+'_premium_'+Date.now();IMP.request_pay({pg:'html5_inicis',pay_method:'card',merchant_uid:merchantUid,name:'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú',amount:484000,buyer_email:email,buyer_name:name,buyer_tel:phone},async(rsp)=>{if(rsp.success){const res=await fetch('/api/payments/complete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imp_uid:rsp.imp_uid,merchant_uid:rsp.merchant_uid})});const result=await res.json();if(result.success){alert('Í≤∞Ï†ú ÏôÑÎ£å!');window.location.href='/dashboard';}}else{alert('Í≤∞Ï†ú Ïã§Ìå®: '+rsp.error_msg);}});}</script></body></html>`)
})

// ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú Íµ¨Îß§ ÌéòÏù¥ÏßÄ
app.get('/pricing/enterprise', (c) => {
  return c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú Íµ¨Îß§</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.iamport.kr/v1/iamport.js"></script><style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');*{font-family:'Pretendard Variable',Pretendard,sans-serif;}</style></head><body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white"><nav class="fixed w-full top-0 z-50 bg-black/50 backdrop-blur-md border-b border-white/10"><div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center"><a href="/" class="text-xl font-bold text-white">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</a><div class="flex gap-6"><a href="/pricing" class="text-gray-300 hover:text-white">‚Üê ÏöîÍ∏àÏ†ú</a><a href="/dashboard" class="bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-2.5 rounded-full">ÎåÄÏãúÎ≥¥Îìú</a></div></div></nav><div class="pt-32 pb-24 px-6"><div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-12"><div><div class="inline-block px-4 py-2 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/50 rounded-full text-purple-300 font-semibold mb-4">ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à</div><h1 class="text-5xl font-bold mb-4">ÎåÄÍ∑úÎ™® ÌïôÏõê Î∞è<br><span class="bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">ÌîÑÎûúÏ∞®Ïù¥Ï¶àÎ•º ÏúÑÌïú</span></h1><div class="flex items-end gap-3 mb-8"><span class="text-6xl font-bold">‚Ç©750,000</span><span class="text-2xl text-gray-400">/Ïõî</span></div><div class="bg-gradient-to-br from-purple-600/20 to-pink-600/20 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-8"><h3 class="text-xl font-bold mb-6">Ìè¨Ìï®Îêú Í∏∞Îä•</h3><div class="space-y-3"><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÌïôÏÉù 1,000Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>AI Î¶¨Ìè¨Ìä∏ 3,000Í∞ú/Ïõî</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎûúÎî©ÌéòÏù¥ÏßÄ 2,000Í∞ú</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÏÑ†ÏÉùÎãò 20Î™Ö</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÌîÑÎûúÏ∞®Ïù¥Ï¶à Î©ÄÌã∞ ÏßÄÏ†ê</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>ÎßûÏ∂§Ìòï Í∏∞Îä• Í∞úÎ∞ú</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>Ï†ÑÎã¥ Í∞úÎ∞ú ÏßÄÏõêÌåÄ</span></div><div class="flex gap-3"><svg class="w-5 h-5 text-purple-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg><span>24/7 Ï†ÑÏö© Ìï´ÎùºÏù∏</span></div></div></div></div><div><div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl p-8 shadow-2xl sticky top-32"><h2 class="text-2xl font-bold mb-6">Í≤∞Ï†ú Ï†ïÎ≥¥</h2><div class="mb-6"><div class="flex justify-between py-6"><div><div class="text-lg font-bold">ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú (ÏõîÍ∞Ñ)</div><div class="text-sm text-gray-400 mt-1">1Í∞úÏõî Ïù¥Ïö©Í∂å</div></div><span class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">‚Ç©750,000</span></div></div><div class="space-y-4 mb-6"><input type="text" id="buyerName" class="w-full px-4 py-3 bg-white/10 border-2 border-white/20 rounded-lg text-white placeholder-gray-400" placeholder="Ïù¥Î¶Ñ"><input type="email" id="buyerEmail" class="w-full px-4 py-3 bg-white/10 border-2 border-white/20 rounded-lg text-white placeholder-gray-400" placeholder="Ïù¥Î©îÏùº"><input type="tel" id="buyerPhone" class="w-full px-4 py-3 bg-white/10 border-2 border-white/20 rounded-lg text-white placeholder-gray-400" placeholder="Ïó∞ÎùΩÏ≤ò"></div><label class="flex gap-3 mb-6"><input type="checkbox" id="agreeTerms" class="w-5 h-5"><span class="text-sm">ÏïΩÍ¥Ä ÎèôÏùò</span></label><button onclick="processPayment()" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold hover:shadow-2xl hover:shadow-purple-500/50">‚Ç©750,000 Í≤∞Ï†ú</button></div></div></div></div><script>IMP.init('imp00000000');const user=JSON.parse(localStorage.getItem('user')||'null');if(user){document.getElementById('buyerName').value=user.name||'';document.getElementById('buyerEmail').value=user.email||'';document.getElementById('buyerPhone').value=user.phone||'';}function processPayment(){const name=document.getElementById('buyerName').value,email=document.getElementById('buyerEmail').value,phone=document.getElementById('buyerPhone').value;if(!name||!email||!phone||!document.getElementById('agreeTerms').checked){alert('Ï†ïÎ≥¥ ÏûÖÎ†• Î∞è ÏïΩÍ¥Ä ÎèôÏùò ÌïÑÏöî');return;}if(!user){window.location.href='/login';return;}const merchantUid='academy_'+user.id+'_enterprise_'+Date.now();IMP.request_pay({pg:'html5_inicis',pay_method:'card',merchant_uid:merchantUid,name:'ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú',amount:825000,buyer_email:email,buyer_name:name,buyer_tel:phone},async(rsp)=>{if(rsp.success){const res=await fetch('/api/payments/complete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imp_uid:rsp.imp_uid,merchant_uid:rsp.merchant_uid})});const result=await res.json();if(result.success){alert('Í≤∞Ï†ú ÏôÑÎ£å!');window.location.href='/dashboard';}}else{alert('Í≤∞Ï†ú Ïã§Ìå®: '+rsp.error_msg);}});}</script></body></html>`)
})

// ÏöîÍ∏àÏ†ú ÌéòÏù¥ÏßÄ
app.get('/pricing', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏöîÍ∏àÏ†ú - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          .gradient-orange {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
          }
          .gradient-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
          }
          .pricing-card {
            transition: all 0.3s ease;
          }
          .pricing-card:hover {
            transform: translateY(-8px);
          }
          .check-icon {
            flex-shrink: 0;
          }
        </style>
    </head>
    <body class="bg-gradient-to-br from-purple-50 via-white to-orange-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-10">
                        <a href="/" class="text-gray-700 hover:text-purple-600 font-medium transition">Ìôà</a>
                        <a href="/programs" class="text-gray-700 hover:text-purple-600 font-medium transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/pricing" class="text-purple-600 font-bold">ÏöîÍ∏àÏ†ú</a>
                        <a href="/success" class="text-gray-700 hover:text-purple-600 font-medium transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                        <a href="/contact" class="text-gray-700 hover:text-purple-600 font-medium transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium hover:shadow-lg transition-all">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="pt-32 pb-16 px-6">
            <div class="max-w-7xl mx-auto text-center">
                <div class="inline-block mb-6 px-5 py-2.5 bg-purple-100 rounded-full text-purple-700 text-sm font-semibold">
                    üíé Ìï©Î¶¨Ï†ÅÏù∏ Í∞ÄÍ≤©ÏúºÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                </div>
                <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
                    ÌïôÏõê ÏÑ±Ïû•ÏùÑ ÏúÑÌïú<br>
                    <span class="text-purple-600">ÎßûÏ∂§Ìòï ÏöîÍ∏àÏ†ú</span>
                </h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
                    Í∑úÎ™®ÏôÄ ÌïÑÏöîÏóê ÎßûÎäî ÌîåÎûúÏùÑ ÏÑ†ÌÉùÌïòÍ≥†,<br>
                    ÏßÄÍ∏à Î∞îÎ°ú ÌïôÏõê ÎßàÏºÄÌåÖ ÌòÅÏã†ÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî
                </p>
            </div>
        </section>

        <!-- Pricing Cards -->
        <section class="pb-24 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    
                    <!-- Ïä§ÌÉÄÌÑ∞ ÌîåÎûú -->
                    <div class="pricing-card bg-white rounded-3xl p-8 border-2 border-gray-200 hover:border-purple-300 hover:shadow-2xl">
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-gray-100 rounded-full text-gray-700 text-sm font-semibold mb-4">
                                Ïä§ÌÉÄÌÑ∞
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-gray-900">‚Ç©55,000</span>
                                <span class="text-gray-600 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-gray-600">ÏÜåÍ∑úÎ™® ÌïôÏõêÏùÑ ÏúÑÌïú Í∏∞Î≥∏ ÌîåÎûú</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÌïôÏÉù ÏµúÎåÄ 30Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">AI Î¶¨Ìè¨Ìä∏ Ïõî 30Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÎûúÎî©ÌéòÏù¥ÏßÄ 40Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 2Î™Ö</span>
                            </div>
                        </div>
                        
                        <a href="/pricing/starter"
                            class="block text-center w-full py-4 bg-gray-900 text-white rounded-xl font-bold hover:bg-gray-800 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </a>
                    </div>

                    <!-- Î≤†Ïù¥ÏßÅ ÌîåÎûú -->
                    <div class="pricing-card bg-white rounded-3xl p-8 border-2 border-blue-200 hover:border-blue-400 hover:shadow-2xl">
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-blue-100 rounded-full text-blue-700 text-sm font-semibold mb-4">
                                Î≤†Ïù¥ÏßÅ
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-gray-900">‚Ç©77,000</span>
                                <span class="text-gray-600 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-gray-600">ÏÑ±Ïû•ÌïòÎäî ÌïôÏõêÏùÑ ÏúÑÌïú ÌîåÎûú</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÌïôÏÉù ÏµúÎåÄ 50Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">AI Î¶¨Ìè¨Ìä∏ Ïõî 50Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÎûúÎî©ÌéòÏù¥ÏßÄ 70Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 4Î™Ö</span>
                            </div>
                        </div>
                        
                        <button 
                            onclick="location.href='/pricing/basic'"
                            class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </button>
                    </div>

                    <!-- ÌîÑÎ°ú ÌîåÎûú (Ï∂îÏ≤ú) -->
                    <div class="pricing-card bg-gradient-to-br from-purple-600 to-purple-700 rounded-3xl p-8 border-2 border-purple-500 hover:shadow-2xl relative">
                        <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
                            <div class="bg-orange-500 text-white px-6 py-2 rounded-full text-sm font-bold shadow-lg">
                                ‚≠ê Í∞ÄÏû• Ïù∏Í∏∞
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-white/20 rounded-full text-white text-sm font-semibold mb-4">
                                ÌîÑÎ°ú
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-white">‚Ç©147,000</span>
                                <span class="text-purple-100 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-purple-100">Ï§ëÌòï ÌïôÏõêÏùÑ ÏúÑÌïú ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-300 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÌïôÏÉù ÏµúÎåÄ 100Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-300 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">AI Î¶¨Ìè¨Ìä∏ Ïõî 100Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-300 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÎûúÎî©ÌéòÏù¥ÏßÄ 140Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-300 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 6Î™Ö</span>
                            </div>
                        </div>
                        
                        <button 
                            onclick="location.href='/pricing/pro'"
                            class="w-full py-4 bg-white text-purple-600 rounded-xl font-bold hover:bg-purple-50 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </button>
                    </div>

                    <!-- ÎπÑÏ¶àÎãàÏä§ ÌîåÎûú -->
                    <div class="pricing-card bg-white rounded-3xl p-8 border-2 border-indigo-200 hover:border-indigo-400 hover:shadow-2xl">
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-indigo-100 rounded-full text-indigo-700 text-sm font-semibold mb-4">
                                ÎπÑÏ¶àÎãàÏä§
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-gray-900">‚Ç©297,000</span>
                                <span class="text-gray-600 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-gray-600">ÎåÄÌòï ÌïôÏõêÏùÑ ÏúÑÌïú ÏôÑÏ†ÑÌïú ÏÜîÎ£®ÏÖò</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÌïôÏÉù ÏµúÎåÄ 300Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">AI Î¶¨Ìè¨Ìä∏ Ïõî 600Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÎûúÎî©ÌéòÏù¥ÏßÄ 550Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 10Î™Ö</span>
                            </div>
                        </div>
                        
                        <button 
                            onclick="location.href='/pricing/business'"
                            class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </button>
                    </div>

                    <!-- ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌîåÎûú -->
                    <div class="pricing-card bg-white rounded-3xl p-8 border-2 border-orange-200 hover:border-orange-400 hover:shadow-2xl">
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-orange-100 rounded-full text-orange-700 text-sm font-semibold mb-4">
                                ÌîÑÎ¶¨ÎØ∏ÏóÑ
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-gray-900">‚Ç©440,000</span>
                                <span class="text-gray-600 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-gray-600">ÎåÄÍ∑úÎ™® ÌïôÏõê ÏµúÏ†ÅÌôî ÏÜîÎ£®ÏÖò</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÌïôÏÉù ÏµúÎåÄ 500Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">AI Î¶¨Ìè¨Ìä∏ Ïõî 1,000Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÎûúÎî©ÌéòÏù¥ÏßÄ 900Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-gray-700 font-medium">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 15Î™Ö</span>
                            </div>
                        </div>
                        
                        <button 
                            onclick="location.href='/pricing/premium'"
                            class="w-full py-4 bg-orange-600 text-white rounded-xl font-bold hover:bg-orange-700 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </button>
                    </div>

                    <!-- ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÌîåÎûú -->
                    <div class="pricing-card bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 border-2 border-gray-700 hover:shadow-2xl">
                        <div class="mb-6">
                            <div class="inline-block px-4 py-2 bg-white/10 rounded-full text-white text-sm font-semibold mb-4">
                                ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à
                            </div>
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-5xl font-bold text-white">‚Ç©750,000</span>
                                <span class="text-gray-300 mb-2">/Ïõî</span>
                            </div>
                            <p class="text-gray-300">ÌîÑÎûúÏ∞®Ïù¥Ï¶à & ÎåÄÌòï ÌïôÏõê Í∑∏Î£π</p>
                        </div>
                        
                        <div class="space-y-3 mb-8">
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÌïôÏÉù ÏµúÎåÄ 1,000Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">AI Î¶¨Ìè¨Ìä∏ Ïõî 3,000Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÎûúÎî©ÌéòÏù¥ÏßÄ 2,000Í∞ú</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï 20Î™Ö</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <svg class="check-icon w-5 h-5 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-white font-medium">Ï†ÑÎã¥ Îß§ÎãàÏ†Ä Î∞∞Ï†ï</span>
                            </div>
                        </div>
                        
                        <button 
                            onclick="location.href='/pricing/enterprise'"
                            class="w-full py-4 bg-white text-gray-900 rounded-xl font-bold hover:bg-gray-100 transition-all hover:shadow-lg">
                            Íµ¨Îß§ÌïòÍ∏∞
                        </button>
                    </div>

                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="py-24 px-6 bg-white">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏</h2>
                    <p class="text-xl text-gray-600">Í∂ÅÍ∏àÌïòÏã† Ï†êÏùÑ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî</p>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-gray-50 rounded-2xl p-6 hover:bg-gray-100 transition-all">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üí≥ Í≤∞Ï†ú Î∞©Î≤ïÏùÄ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?</h3>
                        <p class="text-gray-600">Ïã†Ïö©Ïπ¥Îìú, Ï≤¥ÌÅ¨Ïπ¥Îìú, Í≥ÑÏ¢åÏù¥Ï≤¥, Í∞ÄÏÉÅÍ≥ÑÏ¢å Îì± Îã§ÏñëÌïú Í≤∞Ï†ú ÏàòÎã®ÏùÑ ÏßÄÏõêÌï©ÎãàÎã§.</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-2xl p-6 hover:bg-gray-100 transition-all">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üîÑ ÌîåÎûú Î≥ÄÍ≤ΩÏù¥ Í∞ÄÎä•ÌïúÍ∞ÄÏöî?</h3>
                        <p class="text-gray-600">ÎÑ§, Ïñ∏Ï†úÎì†ÏßÄ ÌîåÎûúÏùÑ ÏóÖÍ∑∏Î†àÏù¥ÎìúÌïòÍ±∞ÎÇò Îã§Ïö¥Í∑∏Î†àÏù¥ÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§. Ï∞®Ïï°ÏùÄ ÏùºÌï† Í≥ÑÏÇ∞Îê©ÎãàÎã§.</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-2xl p-6 hover:bg-gray-100 transition-all">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üì± Î¨¥Î£å Ï≤¥ÌóòÏù¥ Í∞ÄÎä•ÌïúÍ∞ÄÏöî?</h3>
                        <p class="text-gray-600">Î≤†Ïù¥ÏßÅ ÌîåÎûúÏùÑ 14Ïùº ÎèôÏïà Î¨¥Î£åÎ°ú Ï≤¥ÌóòÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§. Ï≤¥Ìóò Í∏∞Í∞Ñ Ï§ë Ïñ∏Ï†úÎì† Ìï¥ÏßÄ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-2xl p-6 hover:bg-gray-100 transition-all">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üéì ÍµêÏú° ÏûêÎ£åÎäî Ïñ¥ÎñªÍ≤å Î∞õÎÇòÏöî?</h3>
                        <p class="text-gray-600">Íµ¨Îß§ ÌõÑ ÎåÄÏãúÎ≥¥ÎìúÏóêÏÑú Ï¶âÏãú Î™®Îì† ÍµêÏú° ÏûêÎ£åÏôÄ ÎßàÏºÄÌåÖ Í∞ÄÏù¥ÎìúÏóê Ï†ëÍ∑ºÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="py-24 px-6 bg-gradient-to-br from-purple-600 to-purple-800">
            <div class="max-w-4xl mx-auto text-center text-white">
                <h2 class="text-4xl lg:text-5xl font-bold mb-6">
                    ÏïÑÏßÅ Í≥†ÎØºÏ§ëÏù¥Ïã†Í∞ÄÏöî?
                </h2>
                <p class="text-xl text-purple-100 mb-10">
                    ÏßÄÍ∏à Î∞îÎ°ú ÏÉÅÎã¥ÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî. ÌïôÏõêÏóê ÎßûÎäî ÏµúÏ†ÅÏùò ÌîåÎûúÏùÑ Ï∂îÏ≤úÌï¥ÎìúÎ¶ΩÎãàÎã§.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/contact" class="inline-block bg-white text-purple-600 px-8 py-4 rounded-xl font-bold hover:bg-purple-50 transition-all">
                        Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠
                    </a>
                    <a href="tel:010-8739-9697" class="inline-block bg-purple-500 text-white px-8 py-4 rounded-xl font-bold hover:bg-purple-400 transition-all">
                        üìû 010-8739-9697
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-900 text-gray-300 py-16 px-6">
            <div class="max-w-7xl mx-auto text-center">
                <div class="text-2xl font-bold text-white mb-4">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</div>
                <p class="text-gray-400 mb-6">ÌïôÏõê ÎßàÏºÄÌåÖÏùò ÏÉàÎ°úÏö¥ Í∏∞Ï§Ä</p>
                <div class="space-y-2">
                    <p>Ïù¥Î©îÏùº: wangholy1@naver.com</p>
                    <p>Ï†ÑÌôî: 010-8739-9697</p>
                </div>
            </div>
        </footer>

        <script>
            // ÏïÑÏûÑÌè¨Ìä∏ Ï¥àÍ∏∞Ìôî
            const IMP = window.IMP;
            IMP.init('imp00000000'); // Ïã§Ï†ú Í∞ÄÎßπÏ†ê ÏãùÎ≥ÑÏΩîÎìúÎ°ú ÍµêÏ≤¥ ÌïÑÏöî

            function startPayment(plan, amount, planName) {
                // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
                const currentUser = localStorage.getItem('currentUser');
                if (!currentUser) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.');
                    window.location.href = '/login';
                    return;
                }

                const user = JSON.parse(currentUser);
                // merchant_uid ÌòïÏãù: academy_{academyId}_{planId}_{timestamp}
                const merchantUid = \`academy_\${user.id}_\${plan}_\${new Date().getTime()}\`;

                console.log('[Payment] Starting payment:', { plan, amount, planName, merchantUid });

                IMP.request_pay({
                    pg: 'html5_inicis',  // PGÏÇ¨ (inicis: KGÏù¥ÎãàÏãúÏä§)
                    pay_method: 'card',
                    merchant_uid: merchantUid,
                    name: planName,
                    amount: amount,
                    buyer_email: user.email || '',
                    buyer_name: user.name || '',
                    buyer_tel: user.phone || '',
                    buyer_addr: '',
                    buyer_postcode: ''
                }, async function(rsp) {
                    if (rsp.success) {
                        console.log('[Payment] Payment success:', { imp_uid: rsp.imp_uid, merchant_uid: rsp.merchant_uid });
                        
                        // Í≤∞Ï†ú ÏÑ±Í≥µ Ïãú ÏÑúÎ≤ÑÏóê Íµ¨ÎèÖ ÏÉùÏÑ± ÏöîÏ≤≠
                        try {
                            const response = await fetch('/api/payments/complete', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    imp_uid: rsp.imp_uid,
                                    merchant_uid: rsp.merchant_uid
                                })
                            });

                            const result = await response.json();
                            
                            if (result.success) {
                                const sub = result.subscription;
                                alert(\`Í≤∞Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÌîåÎûú: \${sub.planName}\\nÏù¥Ïö© Í∏∞Í∞Ñ: \${sub.startDate} ~ \${sub.endDate}\\n\\nÎåÄÏãúÎ≥¥ÎìúÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.\`);
                                window.location.href = '/dashboard';
                            } else {
                                alert('Í≤∞Ï†ú Ï≤òÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + result.error);
                            }
                        } catch (error) {
                            console.error('[Payment] Error:', error);
                            alert('Í≤∞Ï†ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    } else {
                        console.error('[Payment] Payment failed:', rsp.error_msg);
                        alert('Í≤∞Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + rsp.error_msg);
                    }
                });
            }
        </script>
    </body>
    </html>
  `)
})

// Î¨∏ÏùòÌïòÍ∏∞ ÌéòÏù¥ÏßÄ
app.get('/contact', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¨∏ÏùòÌïòÍ∏∞ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-white">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <img src="/static/images/logo.png" alt="SUPER PLACE" class="h-10" onerror="this.style.display='none'">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-10">
                        <a href="/" class="text-gray-700 hover:text-purple-600 font-medium transition">Ìôà</a>
                        <a href="/programs" class="text-gray-700 hover:text-purple-600 font-medium transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/success" class="text-gray-700 hover:text-purple-600 font-medium transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                        <a href="/contact" class="text-purple-600 font-medium transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium hover:shadow-lg transition-all">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contact Form Section -->
        <section class="pt-32 pb-24 px-6">
            <div class="max-w-3xl mx-auto">
                <div class="text-center mb-12">
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠</h1>
                    <p class="text-xl text-gray-600">ÌïôÏõêÏóê ÎßûÎäî ÎßûÏ∂§ ÎßàÏºÄÌåÖ Ï†ÑÎûµÏùÑ ÏÉÅÎã¥Ìï¥ÎìúÎ¶ΩÎãàÎã§</p>
                </div>

                <!-- Ïπ¥Ïπ¥Ïò§Ï±ÑÎÑê Î¨∏Ïùò Î≤ÑÌäº -->
                <div class="mb-8">
                    <a href="https://pf.kakao.com/_tnZzn/chat" target="_blank" rel="noopener noreferrer"
                        class="block bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all transform hover:-translate-y-1">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-yellow-300 rounded-2xl flex items-center justify-center">
                                    <svg class="w-10 h-10" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 3C6.5 3 2 6.58 2 11c0 2.95 2.03 5.53 5 6.74V22l4.5-3.5c.67.09 1.36.14 2.5.14 5.5 0 10-3.58 10-8s-4.5-8-10-8z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-1">üí¨ Ïπ¥Ïπ¥Ïò§Ï±ÑÎÑêÎ°ú Îπ†Î•∏ Î¨∏Ïùò</h3>
                                    <p class="text-sm text-gray-700">Ïã§ÏãúÍ∞Ñ ÏÉÅÎã¥ Í∞ÄÎä• (ÌèâÏùº 9:00-18:00)</p>
                                </div>
                            </div>
                            <div class="text-2xl">‚Üí</div>
                        </div>
                    </a>
                </div>

                <div class="text-center mb-8">
                    <span class="inline-block px-4 py-2 bg-gray-100 rounded-full text-sm text-gray-600">
                        ÎòêÎäî ÏïÑÎûò ÏñëÏãùÏúºÎ°ú Î¨∏ÏùòÌïòÏÑ∏Ïöî
                    </span>
                </div>

                <div class="bg-white rounded-2xl border border-gray-200 p-8 lg:p-12">
                    <form id="contactForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î¶Ñ <span class="text-red-500">*</span></label>
                            <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î©îÏùº <span class="text-red-500">*</span></label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span></label>
                            <input type="tel" name="phone" required placeholder="010-0000-0000" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö</label>
                            <input type="text" name="academy_name" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Î¨∏Ïùò ÎÇ¥Ïö© <span class="text-red-500">*</span></label>
                            <textarea name="message" required rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition resize-none"></textarea>
                        </div>

                        <button type="submit" class="w-full gradient-purple text-white py-4 rounded-xl text-lg font-medium hover:shadow-xl transition-all">
                            Î¨∏Ïùò Ï†ëÏàòÌïòÍ∏∞
                        </button>

                        <div id="message" class="hidden mt-4 p-4 rounded-xl"></div>
                    </form>
                </div>

                <div class="mt-12 grid md:grid-cols-3 gap-6">
                    <div class="text-center p-6 bg-gray-50 rounded-xl">
                        <svg class="w-10 h-10 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <div class="font-medium text-gray-900">Ïù¥Î©îÏùº</div>
                        <div class="text-sm text-gray-600 mt-1">wangholy1@naver.com</div>
                    </div>
                    <div class="text-center p-6 bg-gray-50 rounded-xl">
                        <svg class="w-10 h-10 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <div class="font-medium text-gray-900">ÏúÑÏπò</div>
                        <div class="text-sm text-gray-600 mt-1">Ïù∏Ï≤úÍ¥ëÏó≠Ïãú ÏÑúÍµ¨</div>
                    </div>
                    <div class="text-center p-6 bg-gray-50 rounded-xl">
                        <svg class="w-10 h-10 mx-auto mb-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="font-medium text-gray-900">ÏÉÅÎã¥ ÏãúÍ∞Ñ</div>
                        <div class="text-sm text-gray-600 mt-1">ÌèâÏùº 10:00 - 18:00</div>
                    </div>
                </div>
            </div>
        </section>

        <script>
            document.getElementById('contactForm').addEventListener('submit', async (e) => {
                e.preventDefault()
                
                const formData = new FormData(e.target)
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    academy_name: formData.get('academy_name'),
                    message: formData.get('message')
                }

                try {
                    const response = await fetch('/api/contact', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    })

                    const result = await response.json()
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')

                    if (result.success) {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                        messageEl.textContent = result.message
                        e.target.reset()
                    } else {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                        messageEl.textContent = result.error
                    }
                } catch (err) {
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                    messageEl.textContent = 'Î¨∏Ïùò Ï†ëÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
                }
            })
        </script>
    </body>
    </html>
  `)
})

// ÌöåÏõêÍ∞ÄÏûÖ ÌéòÏù¥ÏßÄ
app.get('/register', (c) => {
  return c.redirect('/signup')
})

// Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ
app.get('/login', (c) => {
  const googleClientId = c.env.GOOGLE_CLIENT_ID || 'YOUR_GOOGLE_CLIENT_ID'
  const kakaoJsKey = c.env.KAKAO_JS_KEY || 'YOUR_KAKAO_JS_KEY'
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î°úÍ∑∏Ïù∏ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="min-h-screen flex items-center justify-center px-6 py-12">
            <div class="max-w-md w-full">
                <div class="text-center mb-10">
                    <a href="/" class="inline-block mb-6">
                        <span class="text-2xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Î°úÍ∑∏Ïù∏</h1>
                    <p class="text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖ ÍµêÏú°Ïóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§</p>
                </div>

                <div class="bg-white rounded-2xl border border-gray-200 p-8">
                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î©îÏùº</label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                            <input type="password" name="password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <button type="submit" class="w-full gradient-purple text-white py-3 rounded-xl font-medium hover:shadow-xl transition-all">
                            Î°úÍ∑∏Ïù∏
                        </button>

                        <div id="message" class="hidden mt-4 p-4 rounded-xl"></div>
                    </form>

                    <!-- ÏÜåÏÖú Î°úÍ∑∏Ïù∏ -->
                    <div class="mt-6">
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-200"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-4 bg-white text-gray-500">ÎòêÎäî Í∞ÑÌé∏ Î°úÍ∑∏Ïù∏</span>
                            </div>
                        </div>

                        <div class="mt-6 space-y-3">
                            <button onclick="loginWithGoogle()" class="w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-xl hover:bg-gray-50 transition-all">
                                <svg class="w-5 h-5" viewBox="0 0 24 24">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                <span class="font-medium text-gray-700">Íµ¨Í∏ÄÎ°ú Í≥ÑÏÜçÌïòÍ∏∞</span>
                            </button>

                            <button onclick="loginWithKakao()" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-xl transition-all" style="background-color: #FEE500;">
                                <svg class="w-5 h-5" viewBox="0 0 24 24">
                                    <path fill="#000000" d="M12 3c5.799 0 10.5 3.664 10.5 8.185 0 4.52-4.701 8.184-10.5 8.184a13.5 13.5 0 0 1-1.727-.11l-4.408 2.883c-.501.265-.678.236-.472-.413l.892-3.678c-2.88-1.46-4.785-3.99-4.785-6.866C1.5 6.665 6.201 3 12 3zm5.907 8.06l1.47-1.424a.472.472 0 0 0-.656-.678l-1.928 1.866V9.282a.472.472 0 0 0-.944 0v2.557a.471.471 0 0 0 0 .222V13.5a.472.472 0 0 0 .944 0v-1.363l.427-.413 1.428 2.033a.472.472 0 1 0 .773-.543l-1.514-2.155zm-2.958 1.924h-1.46V9.297a.472.472 0 0 0-.943 0v4.159c0 .26.21.472.471.472h1.932a.472.472 0 1 0 0-.944zm-5.857-1.092l.696-1.707.638 1.707H9.092zm2.523.488l.002-.016a.469.469 0 0 0-.127-.32l-1.046-2.8a.69.69 0 0 0-.627-.474.696.696 0 0 0-.653.447l-1.661 4.075a.472.472 0 0 0 .874.357l.33-.813h2.07l.299.8a.472.472 0 1 0 .884-.33l-.345-.926zM8.294 9.302a.472.472 0 0 0-.471-.472H5.185a.472.472 0 1 0 0 .944h1.039v3.736a.472.472 0 0 0 .943 0V9.774h1.127a.472.472 0 0 0 .47-.472z"/>
                                </svg>
                                <span class="font-medium text-gray-900">Ïπ¥Ïπ¥Ïò§Î°ú Í≥ÑÏÜçÌïòÍ∏∞</span>
                            </button>
                        </div>
                    </div>

                    <div class="mt-6 text-center text-sm text-gray-600">
                        Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <a href="/signup" class="text-purple-600 hover:text-purple-700 font-medium">ÌöåÏõêÍ∞ÄÏûÖ</a>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-2">ÏÑ†ÏÉùÎãòÏù¥Ïã†Í∞ÄÏöî?</p>
                            <a href="/teachers/register" class="inline-flex items-center text-sm text-purple-600 hover:text-purple-700 font-medium">
                                <i class="fas fa-chalkboard-teacher mr-2"></i>
                                ÏÑ†ÏÉùÎãò Îì±Î°ùÌïòÍ∏∞
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Google Sign-In SDK -->
        <script src="https://accounts.google.com/gsi/client" async defer></script>
        <!-- Kakao SDK -->
        <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js" integrity="sha384-l+xbElFSnPZ2rOaPrU//2FF5B4LB8FiX5q4fXYTlfcG4PGpMkE1vcL7kNXI6Cci0" crossorigin="anonymous"></script>

        <script>
            // API ÌÇ§ ÏÑ§Ï†ï (ÏÑúÎ≤ÑÏóêÏÑú Ï£ºÏûÖ)
            const GOOGLE_CLIENT_ID = '${googleClientId}';
            const KAKAO_JS_KEY = '${kakaoJsKey}';
            
            // Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ï¥àÍ∏∞Ìôî
            function initGoogleSignIn() {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleCallback
                })
            }

            // Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ ÏΩúÎ∞±
            async function handleGoogleCallback(response) {
                try {
                    // JWT ÌÜ†ÌÅ∞ ÎîîÏΩîÎî©
                    const payload = JSON.parse(atob(response.credential.split('.')[1]))
                    
                    const result = await fetch('/api/auth/google', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            idToken: response.credential,
                            email: payload.email,
                            name: payload.name,
                            picture: payload.picture
                        })
                    })

                    const data = await result.json()
                    
                    if (data.success) {
                        localStorage.setItem('user', JSON.stringify(data.user))
                        showMessage('success', data.message)
                        setTimeout(() => {
                            window.location.href = data.user.role === 'admin' ? '/admin/dashboard' : '/dashboard'
                        }, 1000)
                    } else if (data.needsRegistration) {
                        // ÌöåÏõêÍ∞ÄÏûÖ ÌïÑÏöî
                        sessionStorage.setItem('socialData', JSON.stringify(data.socialData))
                        window.location.href = '/signup?from=google'
                    } else {
                        showMessage('error', data.error || 'Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')
                    }
                } catch (err) {
                    console.error('Google login error:', err)
                    showMessage('error', 'Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.')
                }
            }

            // Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Î≤ÑÌäº ÌÅ¥Î¶≠
            function loginWithGoogle() {
                google.accounts.id.prompt()
            }

            // Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ Ï¥àÍ∏∞Ìôî
            function initKakaoLogin() {
                if (!Kakao.isInitialized()) {
                    Kakao.init(KAKAO_JS_KEY)
                }
            }

            // Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏
            function loginWithKakao() {
                Kakao.Auth.login({
                    success: async function(authObj) {
                        try {
                            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                            Kakao.API.request({
                                url: '/v2/user/me',
                                success: async function(response) {
                                    const result = await fetch('/api/auth/kakao', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({
                                            accessToken: authObj.access_token,
                                            id: response.id,
                                            email: response.kakao_account?.email || '',
                                            nickname: response.properties?.nickname || '',
                                            profile_image: response.properties?.profile_image || ''
                                        })
                                    })

                                    const data = await result.json()
                                    
                                    if (data.success) {
                                        localStorage.setItem('user', JSON.stringify(data.user))
                                        showMessage('success', data.message)
                                        setTimeout(() => {
                                            window.location.href = data.user.role === 'admin' ? '/admin/dashboard' : '/dashboard'
                                        }, 1000)
                                    } else if (data.needsRegistration) {
                                        // ÌöåÏõêÍ∞ÄÏûÖ ÌïÑÏöî
                                        sessionStorage.setItem('socialData', JSON.stringify(data.socialData))
                                        window.location.href = '/signup?from=kakao'
                                    } else {
                                        showMessage('error', data.error || 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')
                                    }
                                },
                                fail: function(error) {
                                    console.error('Kakao API error:', err)
                                    showMessage('error', 'Ïπ¥Ïπ¥Ïò§ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.')
                                }
                            })
                        } catch (err) {
                            console.error('Kakao login error:', err)
                            showMessage('error', 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.')
                        }
                    },
                    fail: function(err) {
                        console.error('Kakao login failed:', err)
                        showMessage('error', 'Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')
                    }
                })
            }

            // Î©îÏãúÏßÄ ÌëúÏãú Ìï®Ïàò
            function showMessage(type, text) {
                const messageEl = document.getElementById('message')
                messageEl.classList.remove('hidden')
                if (type === 'success') {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                } else {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                }
                messageEl.textContent = text
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
            window.addEventListener('load', () => {
                initGoogleSignIn()
                initKakaoLogin()
            })

            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault()
                
                const formData = new FormData(e.target)
                const data = {
                    email: formData.get('email'),
                    password: formData.get('password')
                }

                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    })

                    const result = await response.json()
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')

                    if (result.success) {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                        messageEl.textContent = result.message
                        localStorage.setItem('user', JSON.stringify(result.user))
                        
                        // Ïó≠Ìï†Ïóê Îî∞Îùº ÏûêÎèô Î¶¨Îã§Ïù¥Î†âÌä∏
                        setTimeout(() => {
                            if (result.user.role === 'admin') {
                                window.location.href = '/admin/dashboard'
                            } else {
                                window.location.href = '/dashboard'
                            }
                        }, 1000)
                    } else {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                        messageEl.textContent = result.error
                    }
                } catch (err) {
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                    messageEl.textContent = 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
                }
            })
        </script>
    </body>
    </html>
  `)
})

// ÌÖåÏä§Ìä∏ ÎùºÏö∞Ìä∏
app.get('/test-route', (c) => {
  return c.html('<h1>Test Route Works!</h1>')
})

// ÏÑ†ÏÉùÎãò Îì±Î°ù ÌéòÏù¥ÏßÄ
app.get('/teachers/register', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÑ†ÏÉùÎãò Îì±Î°ù - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <!-- Î°úÍ≥† -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 gradient-purple rounded-2xl mb-4">
                    <i class="fas fa-chalkboard-teacher text-3xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">ÏÑ†ÏÉùÎãò Îì±Î°ù</h1>
                <p class="text-gray-600">ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìúÎ°ú ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏùÑ Îì±Î°ùÌïòÏÑ∏Ïöî</p>
            </div>

            <!-- Îì±Î°ù Ìèº -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="space-y-4">
                        <!-- ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìú -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-key text-purple-600 mr-2"></i>ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìú *
                            </label>
                            <input 
                                type="text" 
                                name="verificationCode" 
                                required 
                                maxlength="6"
                                placeholder="6ÏûêÎ¶¨ ÏΩîÎìú"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent uppercase"
                            >
                            <p class="text-xs text-gray-500 mt-1">
                                ÏõêÏû•ÎãòÏúºÎ°úÎ∂ÄÌÑ∞ Î∞õÏùÄ 6ÏûêÎ¶¨ Ïù∏Ï¶ù ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                            </p>
                        </div>

                        <!-- ÌïôÏõêÎ™Ö -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-school text-purple-600 mr-2"></i>ÌïôÏõêÎ™Ö *
                            </label>
                            <input 
                                type="text" 
                                name="academyName" 
                                required 
                                placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê Î∂ÑÎãπÏ†ê"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                            <p class="text-xs text-gray-500 mt-1">
                                Ïù∏Ï¶ù ÏΩîÎìúÏôÄ ÏùºÏπòÌïòÎäî ÌïôÏõêÎ™ÖÏùÑ Ï†ïÌôïÌûà ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                            </p>
                        </div>

                        <!-- Ïù¥Î¶Ñ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user text-purple-600 mr-2"></i>Ïù¥Î¶Ñ *
                            </label>
                            <input 
                                type="text" 
                                name="name" 
                                required 
                                placeholder="ÌôçÍ∏∏Îèô"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                        </div>

                        <!-- Ïù¥Î©îÏùº -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-envelope text-purple-600 mr-2"></i>Ïù¥Î©îÏùº *
                            </label>
                            <input 
                                type="email" 
                                name="email" 
                                required 
                                placeholder="teacher@example.com"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                        </div>

                        <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-lock text-purple-600 mr-2"></i>ÎπÑÎ∞ÄÎ≤àÌò∏ *
                            </label>
                            <input 
                                type="password" 
                                name="password" 
                                required 
                                minlength="6"
                                placeholder="ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅ"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                        </div>

                        <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-lock text-purple-600 mr-2"></i>ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ *
                            </label>
                            <input 
                                type="password" 
                                name="confirmPassword" 
                                required 
                                minlength="6"
                                placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Îã§Ïãú ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                        </div>

                        <!-- Ï†ÑÌôîÎ≤àÌò∏ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-phone text-purple-600 mr-2"></i>Ï†ÑÌôîÎ≤àÌò∏
                            </label>
                            <input 
                                type="tel" 
                                name="phone" 
                                placeholder="010-1234-5678"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                        </div>
                    </div>

                    <!-- ÏïàÎÇ¥ Î©îÏãúÏßÄ -->
                    <div class="mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                        <p class="text-sm text-purple-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Îì±Î°ù Ï†àÏ∞®:</strong> Ïã†Ï≤≠ ÌõÑ ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Î∞õÏúºÎ©¥ Í≥ÑÏ†ïÏù¥ ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
                        </p>
                    </div>

                    <!-- Î≤ÑÌäº -->
                    <button 
                        type="submit" 
                        class="w-full mt-6 gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90 transition"
                    >
                        <i class="fas fa-user-plus mr-2"></i>Îì±Î°ù Ïã†Ï≤≠
                    </button>
                </form>

                <!-- Î°úÍ∑∏Ïù∏ ÎßÅÌÅ¨ -->
                <div class="mt-6 text-center">
                    <p class="text-gray-600">
                        Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? 
                        <a href="/login" class="text-purple-600 hover:text-purple-700 font-medium">Î°úÍ∑∏Ïù∏</a>
                    </p>
                    <p class="text-gray-600 mt-2">
                        <a href="/" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-home mr-1"></i>ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </a>
                    </p>
                </div>
            </div>

            <!-- ÎèÑÏõÄÎßê -->
            <div class="mt-8 text-center">
                <p class="text-sm text-gray-600">
                    <i class="fas fa-question-circle mr-2"></i>
                    Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä ÏóÜÏúºÏã†Í∞ÄÏöî? ÏÜåÏÜç ÌïôÏõê ÏõêÏû•ÎãòÍªò Î¨∏ÏùòÌïòÏÑ∏Ïöî.
                </p>
            </div>
        </div>

        <script>
            async function handleRegister(event) {
                event.preventDefault();
                
                const form = event.target;
                const formData = {
                    verificationCode: form.verificationCode.value.toUpperCase().trim(),
                    academyName: form.academyName.value.trim(),
                    name: form.name.value.trim(),
                    email: form.email.value.trim(),
                    password: form.password.value,
                    phone: form.phone.value.trim()
                };
                
                // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
                if (formData.password !== form.confirmPassword.value) {
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                    return;
                }
                
                try {
                    const response = await fetch('/api/teachers/apply', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert(data.message);
                        // Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        window.location.href = '/login';
                    } else {
                        alert('Ïò§Î•ò: ' + data.error);
                    }
                } catch (error) {
                    console.error('Register error:', error);
                    alert('Îì±Î°ù Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
        </script>
    </body>
    </html>
  `)
})

// ÌöåÏõêÍ∞ÄÏûÖ ÌéòÏù¥ÏßÄ
app.get('/signup', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌöåÏõêÍ∞ÄÏûÖ v2.0 - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="min-h-screen flex items-center justify-center px-6 py-12">
            <div class="max-w-md w-full">
                <div class="text-center mb-10">
                    <a href="/" class="inline-block mb-6">
                        <span class="text-2xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="flex items-center justify-center gap-3 mb-2">
                        <h1 class="text-3xl font-bold text-gray-900">ÌöåÏõêÍ∞ÄÏûÖ</h1>
                        <span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded-full">v2.0</span>
                    </div>
                    <p class="text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖ ÍµêÏú°ÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî</p>
                </div>

                <div class="bg-white rounded-2xl border border-gray-200 p-8">
                    <!-- Í≥ÑÏ†ï Ïú†Ìòï ÏÑ†ÌÉù (ÎùºÎîîÏò§ Î≤ÑÌäº) -->
                    <div class="mb-6">
                        <label class="block text-lg font-bold text-gray-900 mb-4 text-center">
                            Ïñ¥Îñ§ Í≥ÑÏ†ïÏúºÎ°ú Í∞ÄÏûÖÌïòÏãúÍ≤†ÏäµÎãàÍπå?
                        </label>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <label class="relative cursor-pointer">
                                <input type="radio" name="userType" value="director" checked class="peer sr-only" onchange="toggleUserType()">
                                <div class="p-6 border-2 border-gray-300 rounded-xl peer-checked:border-purple-600 peer-checked:bg-purple-50 hover:border-purple-400 transition text-center">
                                    <i class="fas fa-school text-4xl text-purple-600 mb-3 block"></i>
                                    <p class="font-bold text-gray-900 text-lg mb-1">ÌïôÏõêÏû•</p>
                                    <p class="text-xs text-gray-600">ÌïôÏõêÏùÑ Ïö¥ÏòÅÌï©ÎãàÎã§</p>
                                </div>
                            </label>
                            <label class="relative cursor-pointer">
                                <input type="radio" name="userType" value="teacher" class="peer sr-only" onchange="toggleUserType()">
                                <div class="p-6 border-2 border-gray-300 rounded-xl peer-checked:border-purple-600 peer-checked:bg-purple-50 hover:border-purple-400 transition text-center">
                                    <i class="fas fa-chalkboard-teacher text-4xl text-purple-600 mb-3 block"></i>
                                    <p class="font-bold text-gray-900 text-lg mb-1">ÏÑ†ÏÉùÎãò</p>
                                    <p class="text-xs text-gray-600">ÌïôÏõêÏóêÏÑú Í∞ÄÎ•¥Ïπ©ÎãàÎã§</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <form id="signupForm" class="space-y-5">
                        <!-- ÏÑ†ÏÉùÎãò Ï†ÑÏö© ÌïÑÎìú -->
                        <div id="teacherFields" class="hidden space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">
                                    <i class="fas fa-key text-purple-600 mr-2"></i>ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìú <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="verificationCode" id="verificationCode" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition uppercase" placeholder="ABC123" maxlength="6">
                                <p class="text-xs text-gray-500 mt-1">ÏõêÏû•ÎãòÏóêÍ≤å Î∞õÏùÄ 6ÏûêÎ¶¨ ÏΩîÎìú</p>
                            </div>
                        </div>

                        <!-- Í≥µÌÜµ ÌïÑÎìú -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                <span id="nameLabel">ÏõêÏû•Îãò ÏÑ±Ìï®</span> <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="ÌôçÍ∏∏Îèô">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î©îÏùº <span class="text-red-500">*</span></label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="example@email.com">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÎπÑÎ∞ÄÎ≤àÌò∏ <span class="text-red-500">*</span></label>
                            <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅ">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span></label>
                            <input type="tel" name="phone" required placeholder="010-0000-0000" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê Ïù¥Î¶Ñ <span class="text-red-500">*</span></label>
                            <input type="text" name="academy_name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="Íæ∏Î©îÎïÖÌïôÏõê">
                            <p id="academyHint" class="text-xs text-gray-500 mt-1 hidden">Ïù∏Ï¶ù ÏΩîÎìúÏôÄ ÏùºÏπòÌïòÎäî ÌïôÏõêÎ™ÖÏùÑ Ï†ïÌôïÌûà ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
                        </div>

                        <!-- ÏõêÏû•Îãò Ï†ÑÏö© ÌïÑÎìú -->
                        <div id="directorFields">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê ÏúÑÏπò</label>
                                <input type="text" name="academy_location" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="Ïù∏Ï≤ú ÏÑúÍµ¨ Í≤ÄÎã®Îèô (ÏÑ†ÌÉùÏÇ¨Ìï≠)">
                            </div>
                        </div>

                        <!-- ÏÑ†ÏÉùÎãò ÏïàÎÇ¥ Î©îÏãúÏßÄ -->
                        <div id="teacherNotice" class="hidden bg-purple-50 border border-purple-200 rounded-xl p-4">
                            <p class="text-sm text-purple-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                <strong>Îì±Î°ù Ï†àÏ∞®:</strong> Ïã†Ï≤≠ ÌõÑ ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Î∞õÏúºÎ©¥ Í≥ÑÏ†ïÏù¥ ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
                            </p>
                        </div>

                        <button type="submit" class="w-full gradient-purple text-white py-3 rounded-xl font-medium hover:shadow-xl transition-all">
                            <span id="submitText">ÌöåÏõêÍ∞ÄÏûÖ</span>
                        </button>

                        <div id="message" class="hidden mt-4 p-4 rounded-xl"></div>
                    </form>

                    <div class="mt-6 text-center text-sm text-gray-600">
                        Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? <a href="/login" class="text-purple-600 hover:text-purple-700 font-medium">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ÎùºÎîîÏò§ Î≤ÑÌäº ÌÜ†Í∏Ä Ìï®Ïàò
            function toggleUserType() {
                const userTypeRadio = document.querySelector('input[name="userType"]:checked').value;
                const isTeacher = userTypeRadio === 'teacher';
                
                const teacherFields = document.getElementById('teacherFields');
                const directorFields = document.getElementById('directorFields');
                const teacherNotice = document.getElementById('teacherNotice');
                const academyHint = document.getElementById('academyHint');
                const nameLabel = document.getElementById('nameLabel');
                const submitText = document.getElementById('submitText');
                const verificationCodeInput = document.getElementById('verificationCode');

                if (isTeacher) {
                    // ÏÑ†ÏÉùÎãò Î™®Îìú
                    teacherFields.classList.remove('hidden');
                    directorFields.classList.add('hidden');
                    teacherNotice.classList.remove('hidden');
                    academyHint.classList.remove('hidden');
                    nameLabel.textContent = 'Ïù¥Î¶Ñ';
                    submitText.innerHTML = '<i class="fas fa-user-plus mr-2"></i>ÏÑ†ÏÉùÎãò Îì±Î°ù Ïã†Ï≤≠';
                    verificationCodeInput.required = true;
                } else {
                    // ÏõêÏû•Îãò Î™®Îìú
                    teacherFields.classList.add('hidden');
                    directorFields.classList.remove('hidden');
                    teacherNotice.classList.add('hidden');
                    academyHint.classList.add('hidden');
                    nameLabel.textContent = 'ÏõêÏû•Îãò ÏÑ±Ìï®';
                    submitText.textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
                    verificationCodeInput.required = false;
                }
            }

            // Ìèº Ï†úÏ∂ú
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault()
                
                const formData = new FormData(e.target)
                const userTypeRadio = document.querySelector('input[name="userType"]:checked').value;
                const isTeacher = userTypeRadio === 'teacher';
                
                // ÏÑ†ÏÉùÎãò Îì±Î°ùÏù∏ Í≤ΩÏö∞
                if (isTeacher) {
                    const data = {
                        verificationCode: formData.get('verificationCode'),
                        academy_name: formData.get('academy_name'),
                        name: formData.get('name'),
                        email: formData.get('email'),
                        password: formData.get('password'),
                        phone: formData.get('phone')
                    }
                    
                    try {
                        const response = await fetch('/api/teachers/apply', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        })

                        const result = await response.json()
                        const messageEl = document.getElementById('message')
                        messageEl.classList.remove('hidden')

                        if (result.success) {
                            messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                            messageEl.textContent = result.message || 'Îì±Î°ù Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.'
                            e.target.reset()
                            setTimeout(() => {
                                window.location.href = '/login'
                            }, 2000)
                        } else {
                            messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                            let errorMsg = result.error || 'Îì±Î°ù Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
                            if (result.details) {
                                errorMsg += '\\n\\nÏÉÅÏÑ∏: ' + result.details
                            }
                            messageEl.textContent = errorMsg
                            console.error('Error details:', result)
                        }
                    } catch (error) {
                        console.error('Teacher registration error:', error)
                        const messageEl = document.getElementById('message')
                        messageEl.classList.remove('hidden')
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                        messageEl.textContent = 'Îì±Î°ù Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\\n\\n' + error.message
                    }
                    return
                }
                
                // ÏõêÏû•Îãò ÌöåÏõêÍ∞ÄÏûÖÏù∏ Í≤ΩÏö∞
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    password: formData.get('password'),
                    phone: formData.get('phone'),
                    academy_name: formData.get('academy_name'),
                    academy_location: formData.get('academy_location')
                }

                try {
                    const response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    })

                    const result = await response.json()
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')

                    if (result.success) {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                        messageEl.textContent = result.message
                        setTimeout(() => {
                            window.location.href = '/login'
                        }, 1500)
                    } else {
                        messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                        messageEl.textContent = result.error
                    }
                } catch (err) {
                    const messageEl = document.getElementById('message')
                    messageEl.classList.remove('hidden')
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                    messageEl.textContent = 'ÌöåÏõêÍ∞ÄÏûÖ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
                }
            })
        </script>
    </body>
    </html>
  `)
})

// ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® ÌéòÏù¥ÏßÄ
app.get('/programs', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          .gradient-orange {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
          }
        </style>
    </head>
    <body class="bg-white">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-10">
                        <a href="/" class="text-gray-700 hover:text-purple-600 font-medium transition">Ìôà</a>
                        <a href="/programs" class="text-purple-600 font-medium">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/success" class="text-gray-700 hover:text-purple-600 font-medium transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                        <a href="/contact" class="text-gray-700 hover:text-purple-600 font-medium transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero -->
        <section class="pt-32 pb-20 px-6">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Ïã§Ï†Ñ Í≤ΩÌóòÏùÑ Î∞îÌÉïÏúºÎ°ú Ìïú Ï≤¥Í≥ÑÏ†ÅÏù∏ ÌïôÏõê ÎßàÏºÄÌåÖ ÍµêÏú°
                </p>
            </div>
        </section>

        <!-- Programs -->
        <section class="pb-24 px-6">
            <div class="max-w-7xl mx-auto space-y-20">
                <!-- Program 1 -->
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div>
                        <div class="inline-block px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-4">ÌîÑÎ°úÍ∑∏Îû® 01</div>
                        <h2 class="text-4xl font-bold text-gray-900 mb-6">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú</h2>
                        <p class="text-xl text-gray-600 mb-8">
                            ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑÎ•º Ï∞®ÏßÄÌïòÎäî Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞. ÌïôÏõê ÏúÑÏπò Í∏∞Î∞ò ÏµúÏ†ÅÌôî Ï†ÑÎûµÏúºÎ°ú Ïã†Í∑ú ÌïôÏÉù Ïú†ÏûÖÏùÑ Í∑πÎåÄÌôîÌï©ÎãàÎã§.
                        </p>
                        <div class="space-y-4 mb-8">
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">ÌÇ§ÏõåÎìú Î∂ÑÏÑù Î∞è ÏµúÏ†ÅÌôî</div>
                                    <div class="text-gray-600 text-sm">ÌïôÏõêÏóê ÎßûÎäî ÏµúÏ†ÅÏùò ÌÇ§ÏõåÎìú Î∞úÍµ¥</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">Î¶¨Î∑∞ Í¥ÄÎ¶¨ Ï†ÑÎûµ</div>
                                    <div class="text-gray-600 text-sm">Í∏çÏ†ïÏ†ÅÏù∏ Î¶¨Î∑∞ ÌôïÎ≥¥ Î∞è Í¥ÄÎ¶¨</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">ÏßÄÏó≠ SEO ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú</div>
                                    <div class="text-gray-600 text-sm">ÏßÄÏó≠ Í∏∞Î∞ò Í≤ÄÏÉâ ÏµúÏ†ÅÌôî</div>
                                </div>
                            </div>
                        </div>
                        <a href="/contact" class="inline-block gradient-purple text-white px-8 py-4 rounded-xl font-medium hover:shadow-xl transition">
                            Î¨∏ÏùòÌïòÍ∏∞
                        </a>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-12 border border-purple-100">
                        <div class="text-6xl mb-6">üìç</div>
                        <div class="space-y-3 text-gray-700">
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÍµêÏú° Í∏∞Í∞Ñ</span>
                                <span class="font-semibold">4Ï£º</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÏàòÍ∞ï Î∞©Ïãù</span>
                                <span class="font-semibold">Ïò®ÎùºÏù∏ + Ïò§ÌîÑÎùºÏù∏</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÎÇúÏù¥ÎèÑ</span>
                                <span class="font-semibold">Ï¥àÍ∏â-Ï§ëÍ∏â</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program 2 -->
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div class="order-2 lg:order-1">
                        <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-12 border border-orange-100">
                            <div class="text-6xl mb-6">üìù</div>
                            <div class="space-y-3 text-gray-700">
                                <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                    <span>ÍµêÏú° Í∏∞Í∞Ñ</span>
                                    <span class="font-semibold">4Ï£º</span>
                                </div>
                                <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                    <span>ÏàòÍ∞ï Î∞©Ïãù</span>
                                    <span class="font-semibold">Ïò®ÎùºÏù∏</span>
                                </div>
                                <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                    <span>ÎÇúÏù¥ÎèÑ</span>
                                    <span class="font-semibold">Ï¥àÍ∏â-Ï§ëÍ∏â</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="order-1 lg:order-2">
                        <div class="inline-block px-4 py-2 bg-orange-100 text-orange-700 rounded-full text-sm font-medium mb-4">ÌîÑÎ°úÍ∑∏Îû® 02</div>
                        <h2 class="text-4xl font-bold text-gray-900 mb-6">Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú</h2>
                        <p class="text-xl text-gray-600 mb-8">
                            ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≤ÄÏÉâ ÏÉÅÏúÑÍ∂å ÏßÑÏûÖ Ï†ÑÎûµ. SEO ÏµúÏ†ÅÌôîÎ∂ÄÌÑ∞ ÏΩòÌÖêÏ∏† Í∏∞ÌöçÍπåÏßÄ Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú ÌïôÏäµÌï©ÎãàÎã§.
                        </p>
                        <div class="space-y-4 mb-8">
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-orange-500 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">Í≤ÄÏÉâ ÏïåÍ≥†Î¶¨Ï¶ò Ïù¥Ìï¥</div>
                                    <div class="text-gray-600 text-sm">ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ ÏõêÎ¶¨ ÏôÑÎ≤Ω ÎßàÏä§ÌÑ∞</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-orange-500 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">ÏΩòÌÖêÏ∏† ÏûëÏÑ± Í∏∞Î≤ï</div>
                                    <div class="text-gray-600 text-sm">Ìö®Í≥ºÏ†ÅÏù∏ Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-orange-500 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">Ìö®Í≥ºÏ†ÅÏù∏ Ìè¨Ïä§ÌåÖ Ï†ÑÎûµ</div>
                                    <div class="text-gray-600 text-sm">Ï£ºÍ∏∞Ï†ÅÏù∏ ÏΩòÌÖêÏ∏† Î∞úÌñâ Ï†ÑÎûµ</div>
                                </div>
                            </div>
                        </div>
                        <a href="/contact" class="inline-block gradient-orange text-white px-8 py-4 rounded-xl font-medium hover:shadow-xl transition">
                            Î¨∏ÏùòÌïòÍ∏∞
                        </a>
                    </div>
                </div>

                <!-- Program 3 -->
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div>
                        <div class="inline-block px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-4">ÌîÑÎ°úÍ∑∏Îû® 03</div>
                        <h2 class="text-4xl font-bold text-gray-900 mb-6">ÌçºÎÑê ÎßàÏºÄÌåÖ</h2>
                        <p class="text-xl text-gray-600 mb-8">
                            ÏÉÅÎã¥Î∂ÄÌÑ∞ Îì±Î°ùÍπåÏßÄ ÏûêÎèôÌôî ÏãúÏä§ÌÖú Íµ¨Ï∂ï. Ìö®Ïú®Ï†ÅÏù∏ ÌïôÏÉù Î™®Ïßë ÌîÑÎ°úÏÑ∏Ïä§Î•º ÏôÑÏÑ±Ìï©ÎãàÎã§.
                        </p>
                        <div class="space-y-4 mb-8">
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">Í≥†Í∞ù Ïó¨Ï†ï ÏÑ§Í≥Ñ</div>
                                    <div class="text-gray-600 text-sm">ÏÉÅÎã¥-Îì±Î°ùÍπåÏßÄ ÌîÑÎ°úÏÑ∏Ïä§ ÏµúÏ†ÅÌôî</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">ÏûêÎèôÌôî ÎèÑÍµ¨ ÌôúÏö©</div>
                                    <div class="text-gray-600 text-sm">Ìö®Ïú®Ï†ÅÏù∏ ÎßàÏºÄÌåÖ ÏûêÎèôÌôî</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-purple-600 mt-1 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="font-semibold text-gray-900">Ï†ÑÌôòÏú® ÏµúÏ†ÅÌôî</div>
                                    <div class="text-gray-600 text-sm">ÏÉÅÎã¥-Îì±Î°ù Ï†ÑÌôòÏú® Í∑πÎåÄÌôî</div>
                                </div>
                            </div>
                        </div>
                        <a href="/contact" class="inline-block gradient-purple text-white px-8 py-4 rounded-xl font-medium hover:shadow-xl transition">
                            Î¨∏ÏùòÌïòÍ∏∞
                        </a>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-12 border border-purple-100">
                        <div class="text-6xl mb-6">‚ö°</div>
                        <div class="space-y-3 text-gray-700">
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÍµêÏú° Í∏∞Í∞Ñ</span>
                                <span class="font-semibold">6Ï£º</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÏàòÍ∞ï Î∞©Ïãù</span>
                                <span class="font-semibold">Ïò®ÎùºÏù∏ + 1:1 Ïª®ÏÑ§ÌåÖ</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-white rounded-xl">
                                <span>ÎÇúÏù¥ÎèÑ</span>
                                <span class="font-semibold">Ï§ëÍ∏â-Í≥†Í∏â</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA -->
        <section class="py-24 px-6 gradient-purple">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl lg:text-5xl font-bold text-white mb-6">
                    Î¨¥Î£å ÏÉÅÎã¥ÏúºÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                </h2>
                <p class="text-xl text-white/90 mb-10">
                    Ïö∞Î¶¨ ÌïôÏõêÏóê ÎßûÎäî ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®ÏùÑ Ï∂îÏ≤úÌï¥ÎìúÎ¶ΩÎãàÎã§
                </p>
                <a href="/contact" class="inline-block bg-white text-purple-600 px-12 py-5 rounded-full text-lg font-medium shadow-xl hover:-translate-y-1 transition">
                    Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠
                </a>
            </div>
        </section>
    </body>
    </html>
  `)
})

// ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù ÌéòÏù¥ÏßÄ
app.get('/programs', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .gradient-orange { background: linear-gradient(135deg, #fb923c 0%, #f97316 100%); }
            .card-hover { transition: all 0.3s; }
            .card-hover:hover { transform: translateY(-4px); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <div class="flex items-center gap-6">
                        <a href="/" class="text-gray-600 hover:text-purple-600">Ìôà</a>
                        <a href="/programs" class="text-purple-600 font-medium">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/tools" class="text-gray-600 hover:text-purple-600">ÎßàÏºÄÌåÖ Ìà¥</a>
                        <a href="/contact" class="text-gray-600 hover:text-purple-600">Î¨∏ÏùòÌïòÍ∏∞</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-gray-900 mb-4">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</h1>
                <p class="text-xl text-gray-600">Ïã§Ï†ÑÏóêÏÑú Î∞îÎ°ú Ï†ÅÏö© Í∞ÄÎä•Ìïú ÌïôÏõê ÎßàÏºÄÌåÖ Ï†ÑÎûµ</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <!-- ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden card-hover">
                    <div class="h-48 bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center">
                        <i class="fas fa-map-marker-alt text-white text-6xl"></i>
                    </div>
                    <div class="p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§<br>ÏÉÅÏúÑÎÖ∏Ï∂ú</h2>
                        <p class="text-gray-600 mb-6">ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑ Îã¨ÏÑ±ÏùÑ ÏúÑÌïú Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞</p>
                        
                        <div class="space-y-2 mb-6">
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                ÌÇ§ÏõåÎìú ÏµúÏ†ÅÌôî Ï†ÑÎûµ
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                Î¶¨Î∑∞ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                ÏßÄÏó≠ SEO ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú
                            </div>
                        </div>

                        <div class="flex items-center justify-between mb-6">
                            <span class="text-2xl font-bold text-purple-600">‚Ç©300,000</span>
                            <span class="text-sm text-gray-500">4Ï£º Í≥ºÏ†ï</span>
                        </div>

                        <a href="/programs/naver-place" class="block w-full py-3 text-center gradient-purple text-white rounded-xl font-bold hover:shadow-lg transition">
                            ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                        </a>
                    </div>
                </div>

                <!-- Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden card-hover">
                    <div class="h-48 bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center">
                        <i class="fas fa-blog text-white text-6xl"></i>
                    </div>
                    <div class="p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">Î∏îÎ°úÍ∑∏<br>ÏÉÅÏúÑÎÖ∏Ï∂ú</h2>
                        <p class="text-gray-600 mb-6">Í≤ÄÏÉâ ÏµúÏÉÅÏúÑ ÏßÑÏûÖÏùÑ ÏúÑÌïú SEO Ï†ÑÎûµ</p>
                        
                        <div class="space-y-2 mb-6">
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-orange-600 mr-2"></i>
                                Í≤ÄÏÉâ ÏïåÍ≥†Î¶¨Ï¶ò ÏôÑÎ≤Ω Ïù¥Ìï¥
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-orange-600 mr-2"></i>
                                Ìö®Í≥ºÏ†ÅÏù∏ Í∏ÄÏì∞Í∏∞ Í∏∞Î≤ï
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-orange-600 mr-2"></i>
                                ÏΩòÌÖêÏ∏† Ï†ÑÎûµ ÏàòÎ¶Ω
                            </div>
                        </div>

                        <div class="flex items-center justify-between mb-6">
                            <span class="text-2xl font-bold text-orange-600">‚Ç©250,000</span>
                            <span class="text-sm text-gray-500">3Ï£º Í≥ºÏ†ï</span>
                        </div>

                        <a href="/programs/blog" class="block w-full py-3 text-center gradient-orange text-white rounded-xl font-bold hover:shadow-lg transition">
                            ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                        </a>
                    </div>
                </div>

                <!-- ÌçºÎÑê ÎßàÏºÄÌåÖ -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden card-hover">
                    <div class="h-48 bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
                        <i class="fas fa-funnel-dollar text-white text-6xl"></i>
                    </div>
                    <div class="p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">ÌçºÎÑê<br>ÎßàÏºÄÌåÖ</h2>
                        <p class="text-gray-600 mb-6">24ÏãúÍ∞Ñ ÏûêÎèô ÌïôÏÉù Î™®Ïßë ÏãúÏä§ÌÖú</p>
                        
                        <div class="space-y-2 mb-6">
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                Í≥†Í∞ù Ïó¨Ï†ï ÏôÑÎ≤Ω ÏÑ§Í≥Ñ
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                ÎßàÏºÄÌåÖ ÏûêÎèôÌôî ÎèÑÍµ¨
                            </div>
                            <div class="flex items-center text-sm text-gray-700">
                                <i class="fas fa-check text-purple-600 mr-2"></i>
                                Ï†ÑÌôòÏú® Í∑πÎåÄÌôî Ï†ÑÎûµ
                            </div>
                        </div>

                        <div class="flex items-center justify-between mb-6">
                            <span class="text-2xl font-bold text-purple-600">‚Ç©400,000</span>
                            <span class="text-sm text-gray-500">6Ï£º Í≥ºÏ†ï</span>
                        </div>

                        <a href="/programs/funnel" class="block w-full py-3 text-center gradient-purple text-white rounded-xl font-bold hover:shadow-lg transition">
                            ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                        </a>
                    </div>
                </div>
            </div>

            <!-- CTA ÏÑπÏÖò -->
            <div class="mt-16 bg-gradient-to-r from-purple-600 to-pink-600 rounded-3xl p-12 text-center text-white">
                <h2 class="text-4xl font-bold mb-4">Ï†ÑÏ≤¥ Ìå®ÌÇ§ÏßÄÎ°ú Îçî Ï†ÄÎ†¥ÌïòÍ≤å!</h2>
                <p class="text-xl mb-8 opacity-90">3Í∞ú ÌîÑÎ°úÍ∑∏Îû® Ï†ÑÏ≤¥ ÏàòÍ∞ï Ïãú 30% Ìï†Ïù∏</p>
                <div class="flex items-center justify-center gap-4 mb-8">
                    <span class="text-3xl line-through opacity-75">‚Ç©950,000</span>
                    <span class="text-5xl font-bold">‚Ç©665,000</span>
                </div>
                <a href="/contact" class="inline-block bg-white text-purple-600 px-12 py-4 rounded-full text-lg font-bold hover:shadow-2xl transition">
                    Ìå®ÌÇ§ÏßÄ Î¨∏ÏùòÌïòÍ∏∞
                </a>
            </div>
        </div>
    </body>
    </html>
  `)
})

// ÏÑ±Í≥µ ÏÇ¨Î°Ä ÌéòÏù¥ÏßÄ
// ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù ÌéòÏù¥ÏßÄ
app.get('/programs', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="preconnect" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
        <style>
          body { font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Ìó§Îçî -->
        <header class="bg-white shadow-sm border-b">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-blue-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <div class="flex gap-8 items-center">
                        <a href="/" class="text-gray-600 hover:text-blue-600">Ìôà</a>
                        <a href="/programs" class="text-blue-600 font-semibold">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/tools" class="text-gray-600 hover:text-blue-600">ÎßàÏºÄÌåÖ Ìà¥</a>
                        <a href="/contact" class="text-gray-600 hover:text-blue-600">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </nav>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <!-- ÌéòÏù¥ÏßÄ Ìó§Îçî -->
            <div class="text-center mb-16">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</h1>
                <p class="text-xl text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏Í∞ÄÍ∞Ä ÎêòÍ∏∞ ÏúÑÌïú Ïã§Ï†Ñ ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</p>
            </div>

            <!-- ÌîÑÎ°úÍ∑∏Îû® Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
            <div id="programsGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
                <!-- ÌîÑÎ°úÍ∑∏Îû® Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê©ÎãàÎã§ -->
            </div>

            <!-- CTA ÏÑπÏÖò -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-12 text-center text-white">
                <h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® Ïã†Ï≤≠ÌïòÍ∏∞</h2>
                <p class="text-xl mb-8 text-blue-100">ÏõêÌïòÏãúÎäî ÌîÑÎ°úÍ∑∏Îû®ÏùÑ ÏÑ†ÌÉùÌïòÍ≥† ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî</p>
                <a href="/contact" class="inline-block px-8 py-4 bg-white text-blue-600 rounded-lg font-semibold hover:bg-blue-50 transition">
                    Î¨∏ÏùòÌïòÍ∏∞ ‚Üí
                </a>
            </div>
        </main>

        <script>
          const user = JSON.parse(localStorage.getItem('user') || '{}');
          
          // ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù Îç∞Ïù¥ÌÑ∞
          const programs = [
            {
              id: 'naver-place',
              name: 'ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú',
              description: 'ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑÎ•º ÏúÑÌïú Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞',
              details: 'ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî, Î¶¨Î∑∞ Í¥ÄÎ¶¨, ÌÇ§ÏõåÎìú Ï†ÑÎûµ',
              image: '/static/images/naver-place.png',
              icon: 'üó∫Ô∏è',
              features: ['ÏßÄÏó≠ Í≤ÄÏÉâ ÏµúÏ†ÅÌôî', 'Î¶¨Î∑∞ Í¥ÄÎ¶¨ Ï†ÑÎûµ', 'ÌÇ§ÏõåÎìú Î∂ÑÏÑù', 'Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù']
            },
            {
              id: 'blog',
              name: 'Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú',
              description: 'Í≤ÄÏÉâ 1ÌéòÏù¥ÏßÄ ÏßÑÏûÖÏùÑ ÏúÑÌïú Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ',
              details: 'SEO ÏµúÏ†ÅÌôî, ÏΩòÌÖêÏ∏† Ï†ÑÎûµ, Ïú†ÏûÖ Ï¶ùÎåÄ Î∞©Î≤ï',
              image: '/static/images/blog-marketing.png',
              icon: 'üìù',
              features: ['SEO ÏµúÏ†ÅÌôî', 'ÏΩòÌÖêÏ∏† Í∏∞Ìöç', 'ÌÇ§ÏõåÎìú Ï†ÑÎûµ', 'Ïú†ÏûÖ Î∂ÑÏÑù']
            },
            {
              id: 'funnel',
              name: 'ÌçºÎÑê ÎßàÏºÄÌåÖ',
              description: 'ÏûêÎèôÌôîÎêú ÌïôÏÉù Î™®Ïßë ÏãúÏä§ÌÖú Íµ¨Ï∂ï',
              details: 'ÎûúÎî©ÌéòÏù¥ÏßÄ, ÏûêÎèôÌôî ÏãúÏä§ÌÖú, Ï†ÑÌôòÏú® ÏµúÏ†ÅÌôî',
              image: '/static/images/funnel-marketing.png',
              icon: 'üéØ',
              features: ['ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†úÏûë', 'ÎßàÏºÄÌåÖ ÏûêÎèôÌôî', 'Ï†ÑÌôòÏú® ÏµúÏ†ÅÌôî', 'CRM ÏãúÏä§ÌÖú']
            },
            {
              id: 'sns',
              name: 'SNS ÎßàÏºÄÌåÖ',
              description: 'Ïù∏Ïä§ÌÉÄÍ∑∏Îû®, ÌéòÏù¥Ïä§Î∂Å ÌôúÏö© Ï†ÑÎûµ',
              details: 'ÏΩòÌÖêÏ∏† Ï†úÏûë, Í¥ëÍ≥† Ïö¥ÏòÅ, ÌåîÎ°úÏõå ÌôïÎ≥¥',
              icon: 'üì±',
              features: ['ÏΩòÌÖêÏ∏† Ï†úÏûë', 'Í¥ëÍ≥† Ïö¥ÏòÅ', 'ÌåîÎ°úÏõå ÌôïÎ≥¥', 'Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÌòëÏóÖ']
            },
            {
              id: 'video',
              name: 'ÏòÅÏÉÅ ÎßàÏºÄÌåÖ',
              description: 'Ïú†ÌäúÎ∏å, ÏàèÌèº ÏΩòÌÖêÏ∏† Ï†úÏûë',
              details: 'ÏòÅÏÉÅ Í∏∞Ìöç, Ï¥¨ÏòÅ/Ìé∏Ïßë, Ï±ÑÎÑê Ïö¥ÏòÅ',
              icon: 'üé•',
              features: ['ÏòÅÏÉÅ Í∏∞Ìöç', 'Ï¥¨ÏòÅ/Ìé∏Ïßë', 'Ï±ÑÎÑê Ïö¥ÏòÅ', 'Ïú†ÌäúÎ∏å SEO']
            },
            {
              id: 'ad',
              name: 'Ïò®ÎùºÏù∏ Í¥ëÍ≥†',
              description: 'ÎÑ§Ïù¥Î≤Ñ, Íµ¨Í∏Ä Í¥ëÍ≥† Ïö¥ÏòÅ Ï†ÑÎûµ',
              details: 'Í¥ëÍ≥† ÏßëÌñâ, ÏòàÏÇ∞ Í¥ÄÎ¶¨, ROI ÏµúÏ†ÅÌôî',
              icon: 'üí∞',
              features: ['Í¥ëÍ≥† ÏßëÌñâ', 'ÏòàÏÇ∞ Í¥ÄÎ¶¨', 'ROI Î∂ÑÏÑù', 'A/B ÌÖåÏä§Ìä∏']
            },
            {
              id: 'community',
              name: 'Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖ',
              description: 'ÌïôÎ∂ÄÎ™® Ïª§ÎÆ§ÎãàÌã∞ ÌôúÏÑ±Ìôî Ï†ÑÎûµ',
              details: 'Ïª§ÎÆ§ÎãàÌã∞ Ïö¥ÏòÅ, Ïù¥Î≤§Ìä∏ Í∏∞Ìöç, Íµ¨Ï†Ñ ÎßàÏºÄÌåÖ',
              icon: 'üë•',
              features: ['Ïª§ÎÆ§ÎãàÌã∞ Ïö¥ÏòÅ', 'Ïù¥Î≤§Ìä∏ Í∏∞Ìöç', 'Íµ¨Ï†Ñ ÎßàÏºÄÌåÖ', 'ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ']
            },
            {
              id: 'branding',
              name: 'Î∏åÎûúÎî©',
              description: 'ÌïôÏõê Î∏åÎûúÎìú ÏïÑÏù¥Îç¥Ìã∞Ìã∞ Íµ¨Ï∂ï',
              details: 'Î∏åÎûúÎìú Ï†ÑÎûµ, Î°úÍ≥†/ÎîîÏûêÏù∏, Ïä§ÌÜ†Î¶¨ÌÖîÎßÅ',
              icon: 'üé®',
              features: ['Î∏åÎûúÎìú Ï†ÑÎûµ', 'Î°úÍ≥†/ÎîîÏûêÏù∏', 'Ïä§ÌÜ†Î¶¨ÌÖîÎßÅ', 'BI/CI Íµ¨Ï∂ï']
            },
            {
              id: 'data',
              name: 'Í≤ÄÏÉâÎüâ Ï°∞Ìöå',
              description: 'ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâÎüâ Î∞è ÏàúÏúÑ Î∂ÑÏÑù',
              details: 'ÌÇ§ÏõåÎìú Í≤ÄÏÉâÎüâ, ÌîåÎ†àÏù¥Ïä§ ÏàúÏúÑ Ï°∞Ìöå, Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù',
              icon: 'üîç',
              features: ['Í≤ÄÏÉâÎüâ Ï°∞Ìöå', 'ÏàúÏúÑ ÌôïÏù∏', 'Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù', 'ÌÇ§ÏõåÎìú Ï∂îÏ∂ú']
            },
            {
              id: 'carrot',
              name: 'ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖ',
              description: 'ÏßÄÏó≠ Í∏∞Î∞ò ÎãπÍ∑ºÎßàÏºì ÌôúÏö© Ï†ÑÎûµ',
              details: 'ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÌîÑÎ°úÌïÑ, ÏßÄÏó≠ Í¥ëÍ≥†, ÎèôÎÑ§ ÌôçÎ≥¥',
              icon: 'ü•ï',
              features: ['ÎπÑÏ¶àÎãàÏä§ ÌîÑÎ°úÌïÑ', 'ÏßÄÏó≠ ÌÉÄÍ≤üÌåÖ', 'ÎèôÎÑ§ Í¥ëÍ≥†', 'ÏßÅÍ±∞Îûò Ïú†ÎèÑ']
            },
            {
              id: 'meta',
              name: 'Î©îÌÉÄ Í¥ëÍ≥†',
              description: 'Facebook/Instagram Í¥ëÍ≥† Ïö¥ÏòÅ',
              details: 'Î©îÌÉÄ Í¥ëÍ≥† Í¥ÄÎ¶¨Ïûê, ÌÉÄÍ≤üÌåÖ, ÏÑ±Í≥º Î∂ÑÏÑù',
              icon: 'üìò',
              features: ['Í¥ëÍ≥† Í≥ÑÏ†ï ÏÑ§Ï†ï', 'ÌÉÄÍ≤ü Ïò§ÎîîÏñ∏Ïä§', 'ÌÅ¨Î¶¨ÏóêÏù¥Ìã∞Î∏å', 'ROI ÏµúÏ†ÅÌôî']
            },
            {
              id: 'youtube-ad',
              name: 'Ïú†ÌäúÎ∏å Í¥ëÍ≥†',
              description: 'Ïú†ÌäúÎ∏å Í¥ëÍ≥† Ï∫†ÌéòÏù∏ Ïö¥ÏòÅ',
              details: 'Ïú†ÌäúÎ∏å Í¥ëÍ≥† Ïú†Ìòï, ÌÉÄÍ≤üÌåÖ, ÏòÅÏÉÅ Ï†úÏûë',
              icon: 'üì∫',
              features: ['Í¥ëÍ≥† Ïú†Ìòï ÏÑ†ÌÉù', 'ÌÉÄÍ≤ü ÏÑ§Ï†ï', 'ÏòÅÏÉÅ Ï†úÏûë', 'ÏÑ±Í≥º Ï∏°Ï†ï']
            },
            {
              id: 'threads',
              name: 'Ïì∞Î†àÎìú ÎßàÏºÄÌåÖ',
              description: 'Meta Threads ÌôúÏö© Ï†ÑÎûµ',
              details: 'Ïì∞Î†àÎìú ÏΩòÌÖêÏ∏†, Ïª§ÎÆ§ÎãàÌã∞ Íµ¨Ï∂ï, Î∞îÏù¥Îü¥ ÎßàÏºÄÌåÖ',
              icon: 'üßµ',
              features: ['ÏΩòÌÖêÏ∏† Ï†ÑÎûµ', 'ÌåîÎ°úÏõå ÌôïÎ≥¥', 'Ìä∏Î†åÎìú ÌôúÏö©', 'Ïù∏Í≤åÏù¥ÏßÄÎ®ºÌä∏']
            }
          ];

          // ÏÇ¨Ïö©Ïûê Í∂åÌïú ÌôïÏù∏
          async function loadPrograms() {
            const grid = document.getElementById('programsGrid');
            
            let userPermissions = [];
            if (user.id) {
              try {
                const response = await fetch(\`/api/user/\${user.id}/permissions\`);
                const data = await response.json();
                userPermissions = data.permissions || [];
              } catch (err) {
                console.error('Í∂åÌïú Ï°∞Ìöå Ïã§Ìå®:', err);
              }
            }

            // ÌîÑÎ°úÍ∑∏Îû® Í∂åÌïú ÌïÑÌÑ∞ÎßÅ
            const programPermissions = userPermissions
              .filter(p => p.permission_type === 'program')
              .map(p => p.permission_name);

            // ÌîÑÎ°úÍ∑∏Îû® Ïπ¥Îìú Î†åÎçîÎßÅ
            programs.forEach(program => {
              const hasPermission = user.role === 'admin' || programPermissions.includes(program.id);
              
              const card = \`
                <div class="bg-white rounded-xl shadow-sm hover:shadow-lg transition p-6 border border-gray-200">
                  <div class="text-5xl mb-4">\${program.icon}</div>
                  <h3 class="text-2xl font-bold text-gray-900 mb-3">\${program.name}</h3>
                  <p class="text-gray-600 mb-4">\${program.description}</p>
                  <p class="text-sm text-gray-500 mb-6">\${program.details}</p>
                  
                  <div class="mb-6">
                    <p class="text-sm font-semibold text-gray-700 mb-2">Ï£ºÏöî ÎÇ¥Ïö©:</p>
                    <ul class="space-y-1">
                      \${program.features.map(f => \`
                        <li class="text-sm text-gray-600 flex items-center">
                          <span class="text-blue-600 mr-2">‚úì</span> \${f}
                        </li>
                      \`).join('')}
                    </ul>
                  </div>
                  
                  \${hasPermission ? \`
                    <a href="/programs/\${program.id}" 
                       class="block w-full py-3 bg-blue-600 text-white text-center rounded-lg hover:bg-blue-700 transition font-semibold">
                      ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞ ‚Üí
                    </a>
                  \` : \`
                    <button onclick="requestAccess('\${program.id}', '\${program.name}')" 
                            class="w-full py-3 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition font-semibold">
                      üîí Í∂åÌïú ÏöîÏ≤≠ÌïòÍ∏∞
                    </button>
                  \`}
                </div>
              \`;
              
              grid.innerHTML += card;
            });
          }

          // Í∂åÌïú ÏöîÏ≤≠
          function requestAccess(programId, programName) {
            if (!user.id) {
              alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
              window.location.href = '/login';
              return;
            }
            
            // ÌäπÏ†ï ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÏßÅÏ†ë ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
            const programUrls = {
              'data': '/tools/search-volume',
              'sms': '/tools/sms-sender',
              'blog': '/tools/blog-writer',
              'landing': '/tools/landing-builder',
              'student': '/students'
            };
            
            if (programUrls[programId]) {
              window.location.href = programUrls[programId];
              return;
            }
            
            alert(\`"\${programName}" ÌîÑÎ°úÍ∑∏Îû®Ïóê ÎåÄÌïú Í∂åÌïú ÏöîÏ≤≠Ïù¥ Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.\\nÍ¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Ïù¥Ïö©ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.\`);
            
            // Ïã§Ï†úÎ°úÎäî Í∂åÌïú ÏöîÏ≤≠ API Ìò∏Ï∂ú
            // Ïòà: POST /api/access-requests { userId, programId, programName }
          }

          // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù Î°úÎìú
          loadPrograms();
        </script>
    </body>
    </html>
  `)
})

app.get('/success', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÑ±Í≥µ ÏÇ¨Î°Ä - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-white">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-10">
                        <a href="/" class="text-gray-700 hover:text-purple-600 font-medium transition">Ìôà</a>
                        <a href="/programs" class="text-gray-700 hover:text-purple-600 font-medium transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/success" class="text-purple-600 font-medium">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                        <a href="/contact" class="text-gray-700 hover:text-purple-600 font-medium transition">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero -->
        <section class="pt-32 pb-20 px-6">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6">ÏÑ±Í≥µ ÏÇ¨Î°Ä</h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    500Í∞ú Ïù¥ÏÉÅÏùò ÌïôÏõêÏù¥ Ïö∞Î¶¨ÏôÄ Ìï®Íªò ÏÑ±Ïû•ÌñàÏäµÎãàÎã§
                </p>
            </div>
        </section>

        <!-- Success Stories -->
        <section class="pb-24 px-6">
            <div class="max-w-7xl mx-auto grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Story 1 -->
                <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-purple-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-purple-600 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-purple-600 mb-2">2Î∞∞</div>
                            <div class="text-sm text-gray-600">Ïã†Í∑ú Î¨∏Ïùò Ï¶ùÍ∞Ä</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ ÍµêÏú°ÏùÑ Î∞õÏùÄ ÌõÑ 3Í∞úÏõî ÎßåÏóê Ïã†Í∑ú Î¨∏ÏùòÍ∞Ä 2Î∞∞ Ïù¥ÏÉÅ ÎäòÏóàÏäµÎãàÎã§. Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞Í∞Ä Ï†ïÎßê ÎåÄÎã®Ìï©ÎãàÎã§!
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-purple-100">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center text-white font-bold">ÍπÄ</div>
                        <div>
                            <div class="font-bold text-gray-900">ÍπÄOO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÏòÅÏñ¥ÌïôÏõê</div>
                        </div>
                    </div>
                </div>

                <!-- Story 2 -->
                <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-8 border border-orange-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-orange-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-orange-500 mb-2">1ÏúÑ</div>
                            <div class="text-sm text-gray-600">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ≥º Î¶¨Î∑∞ Í¥ÄÎ¶¨ Ï†ÑÎûµÏùÑ Î∞∞Ïö¥ ÌõÑ Ïö∞Î¶¨ ÌïôÏõêÏù¥ ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑÏóê Ïò¨ÎûêÏñ¥Ïöî. Îì±Î°ù Î¨∏ÏùòÍ∞Ä ÎÅäÏù¥ÏßÄ ÏïäÏäµÎãàÎã§.
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-orange-100">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center text-white font-bold">Î∞ï</div>
                        <div>
                            <div class="font-bold text-gray-900">Î∞ïOO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄÍµ¨ ÏàòÌïôÌïôÏõê</div>
                        </div>
                    </div>
                </div>

                <!-- Story 3 -->
                <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-purple-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-purple-600 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-purple-600 mb-2">3Î∞∞</div>
                            <div class="text-sm text-gray-600">Î∏îÎ°úÍ∑∏ Ïú†ÏûÖ</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ Í∞ïÏùòÎ•º Îì£Í≥† ÏΩòÌÖêÏ∏† Ï†ÑÎûµÏùÑ Î∞îÍø®ÎçîÎãà Î∏îÎ°úÍ∑∏ Ïú†ÏûÖÏù¥ 3Î∞∞Î°ú ÎäòÏóàÏäµÎãàÎã§. ÌïôÎ∂ÄÎ™®ÎãòÎì§Ïùò Ïã†Î¢∞ÎèÑ ÎÜíÏïÑÏ°åÏñ¥Ïöî.
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-purple-100">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center text-white font-bold">Ïù¥</div>
                        <div>
                            <div class="font-bold text-gray-900">Ïù¥OO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">ÎåÄÏ†Ñ Ïú†ÏÑ±Íµ¨ ÏòÅÏñ¥ÌïôÏõê</div>
                        </div>
                    </div>
                </div>

                <!-- Story 4 -->
                <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-8 border border-orange-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-orange-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-orange-500 mb-2">40%</div>
                            <div class="text-sm text-gray-600">Ï†ÑÌôòÏú® ÏÉÅÏäπ</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        ÌçºÎÑê ÎßàÏºÄÌåÖ ÏãúÏä§ÌÖúÏùÑ Íµ¨Ï∂ïÌïú ÌõÑ ÏÉÅÎã¥-Îì±Î°ù Ï†ÑÌôòÏú®Ïù¥ 40% ÏÉÅÏäπÌñàÏäµÎãàÎã§. ÏûêÎèôÌôîÎ°ú ÏóÖÎ¨¥ Ìö®Ïú®ÎèÑ ÌÅ¨Í≤å Í∞úÏÑ†ÎêêÏñ¥Ïöî.
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-orange-100">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center text-white font-bold">Ïµú</div>
                        <div>
                            <div class="font-bold text-gray-900">ÏµúOO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">Ïù∏Ï≤ú ÏÑúÍµ¨ Ï¢ÖÌï©ÌïôÏõê</div>
                        </div>
                    </div>
                </div>

                <!-- Story 5 -->
                <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-purple-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-purple-600 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-purple-600 mb-2">50Î™Ö</div>
                            <div class="text-sm text-gray-600">Ïã†Í∑ú Îì±Î°ù</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        ÍµêÏú° Ïù¥Ïàò ÌõÑ 6Í∞úÏõî ÎßåÏóê Ïã†Í∑ú Îì±Î°ù ÌïôÏÉùÏù¥ 50Î™Ö ÎäòÏóàÏäµÎãàÎã§. ÌïôÏõê Ïö¥ÏòÅÏù¥ ÏïàÏ†ïÌôîÎêòÍ≥† Îß§Ï∂úÎèÑ ÌÅ¨Í≤å Ï¶ùÍ∞ÄÌñàÏñ¥Ïöî.
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-purple-100">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center text-white font-bold">Ï†ï</div>
                        <div>
                            <div class="font-bold text-gray-900">Ï†ïOO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">Í¥ëÏ£º Î∂ÅÍµ¨ ÏòÅÏñ¥ÌïôÏõê</div>
                        </div>
                    </div>
                </div>

                <!-- Story 6 -->
                <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-8 border border-orange-100">
                    <div class="flex items-start gap-4 mb-6">
                        <svg class="w-10 h-10 text-orange-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <div>
                            <div class="text-3xl font-bold text-orange-500 mb-2">95%</div>
                            <div class="text-sm text-gray-600">Ïû¨Îì±Î°ùÎ•†</div>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-6 leading-relaxed">
                        ÎßàÏºÄÌåÖ ÏûêÎèôÌôîÏôÄ ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ Ï†ÑÎûµÏùÑ Î∞∞Ïö¥ ÌõÑ Ïû¨Îì±Î°ùÎ•†Ïù¥ 95%Î°ú Ïò¨ÎûêÏäµÎãàÎã§. ÌïôÏÉù Í¥ÄÎ¶¨ÎèÑ Ìõ®Ïî¨ Ï≤¥Í≥ÑÏ†ÅÏù¥ÏóêÏöî.
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-orange-100">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center text-white font-bold">Í∞ï</div>
                        <div>
                            <div class="font-bold text-gray-900">Í∞ïOO ÏõêÏû•Îãò</div>
                            <div class="text-sm text-gray-600">ÏàòÏõê ÏòÅÌÜµÍµ¨ ÏàòÌïôÌïôÏõê</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section class="py-24 px-6 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Ïà´ÏûêÎ°ú Î≥¥Îäî ÏÑ±Í≥º</h2>
                    <p class="text-xl text-gray-600">Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¶ùÎ™ÖÌïòÎäî ÌôïÏã§Ìïú Ìö®Í≥º</p>
                </div>
                <div class="grid md:grid-cols-4 gap-8">
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-2">500+</div>
                        <div class="text-gray-600">ÍµêÏú° ÏàòÎ£å ÌïôÏõê</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-2">95%</div>
                        <div class="text-gray-600">ÎßåÏ°±ÎèÑ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-2">2.5Î∞∞</div>
                        <div class="text-gray-600">ÌèâÍ∑† Î¨∏Ïùò Ï¶ùÍ∞Ä</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-2">85%</div>
                        <div class="text-gray-600">Ïû¨ÏàòÍ∞ïÎ•†</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="py-24 px-6 bg-gray-50">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏</h2>
                    <p class="text-xl text-gray-600">ÌïôÏõêÏû•ÎãòÎì§Ïù¥ Í∞ÄÏû• Í∂ÅÍ∏àÌï¥ÌïòÏãúÎäî ÏßàÎ¨∏Îì§ÏûÖÎãàÎã§</p>
                </div>
                
                <div class="space-y-4">
                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>üí∞ ÍµêÏú° ÎπÑÏö©ÏùÄ ÏñºÎßàÏù∏Í∞ÄÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-4">ÌîÑÎ°úÍ∑∏Îû®Î≥ÑÎ°ú ÏÉÅÏù¥ÌïòÎ©∞, Î¨¥Î£å ÏÉÅÎã¥ÏùÑ ÌÜµÌï¥ ÌïôÏõê Í∑úÎ™®ÏôÄ Î™©ÌëúÏóê ÎßûÎäî ÎßûÏ∂§ Í≤¨Ï†ÅÏùÑ Ï†úÍ≥µÌï¥ÎìúÎ¶ΩÎãàÎã§.</p>
                            <p class="text-sm text-purple-600">ÌèâÍ∑† ROI: 340% (Ìà¨Ïûê ÎåÄÎπÑ 3.4Î∞∞ ÏàòÏùµ)</p>
                        </div>
                    </details>

                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>‚è±Ô∏è Ìö®Í≥ºÎ•º Î≥¥Í∏∞ÍπåÏßÄ ÏñºÎßàÎÇò Í±∏Î¶¨ÎÇòÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-2">‚Ä¢ <strong>Ï¶âÏãú Ìö®Í≥º</strong>: ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ Í∞úÏÑ† (1Ï£ºÏùº ÎÇ¥)</p>
                            <p class="mb-2">‚Ä¢ <strong>Îã®Í∏∞ Ìö®Í≥º</strong>: ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ Î¨∏Ïùò Ï¶ùÍ∞Ä (2~4Ï£º)</p>
                            <p>‚Ä¢ <strong>Ïû•Í∏∞ Ìö®Í≥º</strong>: Î∏îÎ°úÍ∑∏ Ïú†ÏûÖ Ï¶ùÍ∞Ä, Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑ ÏÉÅÏäπ (3Í∞úÏõî~)</p>
                        </div>
                    </details>

                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>üéØ Ïª¥Ìì®ÌÑ∞Î•º Ïûò Î™ª Îã§Î§ÑÎèÑ Í¥úÏ∞ÆÎÇòÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-4">ÎÑ§! Ï†ÑÌòÄ Í±±Ï†ïÌïòÏßÄ ÏïäÏúºÏÖîÎèÑ Îê©ÎãàÎã§. Ï†ÄÌù¨ ÍµêÏú°ÏùÄ Ï¥àÎ≥¥ÏûêÎèÑ ÏâΩÍ≤å Îî∞ÎùºÌï† Ïàò ÏûàÎèÑÎ°ù ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.</p>
                            <ul class="space-y-2 text-sm">
                                <li>‚úì 1:1 ÎßûÏ∂§ ÏßÄÎèÑ</li>
                                <li>‚úì Îã®Í≥ÑÎ≥Ñ ÏòÅÏÉÅ Í∞ïÏùò</li>
                                <li>‚úì 24ÏãúÍ∞Ñ Ïπ¥Ïπ¥Ïò§ÌÜ° ÏßÄÏõê</li>
                            </ul>
                        </div>
                    </details>

                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>üè´ Ïñ¥Îñ§ ÌïôÏõêÏóê Ï†ÅÌï©ÌïúÍ∞ÄÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-4">Î™®Îì† Í∑úÎ™®Ïùò ÌïôÏõêÏóê Ï†ÅÌï©Ìï©ÎãàÎã§:</p>
                            <ul class="space-y-2">
                                <li>‚Ä¢ ÏòÅÏñ¥ÌïôÏõê, ÏàòÌïôÌïôÏõê, Ï¢ÖÌï©ÌïôÏõê</li>
                                <li>‚Ä¢ ÏÜåÍ∑úÎ™® Í∞úÏù∏ÌïôÏõê ~ ÎåÄÌòï ÌîÑÎûúÏ∞®Ïù¥Ï¶à</li>
                                <li>‚Ä¢ Ïò®ÎùºÏù∏/Ïò§ÌîÑÎùºÏù∏ ÌïôÏõê Î™®Îëê Í∞ÄÎä•</li>
                            </ul>
                        </div>
                    </details>

                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>üì± Ïò§ÌîÑÎùºÏù∏ Î™®ÏûÑÎèÑ ÏûàÎÇòÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-4">ÎÑ§! Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú Ïò§ÌîÑÎùºÏù∏ ÏõåÌÅ¨ÏÉµÍ≥º ÎÑ§Ìä∏ÏõåÌÇπ Î™®ÏûÑÏùÑ ÏßÑÌñâÌï©ÎãàÎã§.</p>
                            <p class="text-sm text-purple-600">‚Ä¢ Ïõî 1Ìöå Ïò§ÌîÑÎùºÏù∏ ÌäπÍ∞ï (Ïù∏Ï≤ú/ÏÑúÏö∏)</p>
                            <p class="text-sm text-purple-600">‚Ä¢ Ïó∞ 2Ìöå Ï†ÑÍµ≠ ÌïôÏõêÏû• Ïª®ÌçºÎü∞Ïä§</p>
                        </div>
                    </details>

                    <details class="bg-white rounded-2xl border border-gray-200 overflow-hidden group">
                        <summary class="px-8 py-6 cursor-pointer font-bold text-lg text-gray-900 hover:text-purple-600 transition flex items-center justify-between">
                            <span>üîÑ ÌôòÎ∂à Ï†ïÏ±ÖÏùÄ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?</span>
                            <svg class="w-6 h-6 transform group-open:rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </summary>
                        <div class="px-8 pb-6 text-gray-600">
                            <p class="mb-4">ÍµêÏú° ÏãúÏûë ÌõÑ 7Ïùº Ïù¥ÎÇ¥ 100% ÌôòÎ∂àÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
                            <p class="text-sm text-gray-500">ÎßåÏ°±ÎèÑ 95% Ïù¥ÏÉÅ! ÎåÄÎ∂ÄÎ∂ÑÏùò ÌïôÏõêÏû•ÎãòÎì§Ïù¥ ÎßåÏ°±ÌïòÏãúÍ≥† Ïû¨Íµ¨Îß§ÌïòÏã≠ÎãàÎã§.</p>
                        </div>
                    </details>
                </div>

                <div class="mt-12 text-center">
                    <p class="text-gray-600 mb-6">Îçî Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî?</p>
                    <a href="/contact" class="inline-block bg-purple-600 text-white px-8 py-4 rounded-full font-medium hover:bg-purple-700 transition">
                        1:1 Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÍ∏∞
                    </a>
                </div>
            </div>
        </section>

        <!-- Customer Reviews Slider -->
        <section class="py-24 px-6 bg-white">
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">Ïã§Ï†ú ÌõÑÍ∏∞</h2>
                    <p class="text-xl text-gray-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ÏôÄ Ìï®ÍªòÌïú ÌïôÏõêÏû•ÎãòÎì§Ïùò ÏÉùÏÉùÌïú ÌõÑÍ∏∞ÏûÖÎãàÎã§</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Review 1 -->
                    <div class="bg-gradient-to-br from-purple-50 to-white p-8 rounded-2xl border border-purple-100 hover:shadow-xl transition">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl">ÍπÄ</div>
                            <div class="ml-4">
                                <div class="font-bold text-gray-900">ÍπÄÏßÄÏàò ÏõêÏû•Îãò</div>
                                <div class="text-sm text-gray-600">Ïù∏Ï≤ú Î∂ÄÌèâÍµ¨ ÏòÅÏñ¥ÌïôÏõê</div>
                            </div>
                        </div>
                        <div class="text-yellow-500 mb-4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p class="text-gray-700 mb-4">"ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÍµêÏú° Î∞õÍ≥† Ìïú Îã¨ ÎßåÏóê Î¨∏ÏùòÍ∞Ä 3Î∞∞ ÎäòÏóàÏñ¥Ïöî! Ïã§Ï†úÎ°ú Ìö®Í≥ºÍ∞Ä ÏûàÎäî ÎßàÏºÄÌåÖÏùÑ Î∞∞Ïö∏ Ïàò ÏûàÏóàÏäµÎãàÎã§."</p>
                        <div class="text-sm text-purple-600 font-medium">Î¨∏Ïùò Ïàò 3Î∞∞ Ï¶ùÍ∞Ä ‚Üë</div>
                    </div>

                    <!-- Review 2 -->
                    <div class="bg-gradient-to-br from-orange-50 to-white p-8 rounded-2xl border border-orange-100 hover:shadow-xl transition">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-xl">Î∞ï</div>
                            <div class="ml-4">
                                <div class="font-bold text-gray-900">Î∞ïÎØºÏ§Ä ÏõêÏû•Îãò</div>
                                <div class="text-sm text-gray-600">ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÏàòÌïôÌïôÏõê</div>
                            </div>
                        </div>
                        <div class="text-yellow-500 mb-4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p class="text-gray-700 mb-4">"Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú Ï†ÑÎûµÏùÑ Î∞∞Ïö∞Í≥† Í≤ÄÏÉâ Ïú†ÏûÖÏù¥ Ìè≠Î∞úÏ†ÅÏúºÎ°ú ÎäòÏóàÏäµÎãàÎã§. Ìà¨Ïûê ÎåÄÎπÑ ÏµúÍ≥†Ïùò ÏÑ†ÌÉùÏù¥ÏóàÏñ¥Ïöî!"</p>
                        <div class="text-sm text-orange-600 font-medium">Î∏îÎ°úÍ∑∏ Ïú†ÏûÖ 500% Ï¶ùÍ∞Ä ‚Üë</div>
                    </div>

                    <!-- Review 3 -->
                    <div class="bg-gradient-to-br from-purple-50 to-white p-8 rounded-2xl border border-purple-100 hover:shadow-xl transition">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl">Ïù¥</div>
                            <div class="ml-4">
                                <div class="font-bold text-gray-900">Ïù¥ÏÑúÏó∞ ÏõêÏû•Îãò</div>
                                <div class="text-sm text-gray-600">Ïù∏Ï≤ú ÏÑúÍµ¨ Ï¢ÖÌï©ÌïôÏõê</div>
                            </div>
                        </div>
                        <div class="text-yellow-500 mb-4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p class="text-gray-700 mb-4">"ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏãúÏä§ÌÖú ÎçïÎ∂ÑÏóê Ïû¨ÏàòÍ∞ïÎ•†Ïù¥ ÌÅ¨Í≤å Ïò¨ÎûêÏñ¥Ïöî. Ïã§Ï†ÑÏóêÏÑú Î∞îÎ°ú Ïç®Î®πÏùÑ Ïàò ÏûàÎäî ÎÖ∏ÌïòÏö∞Í∞Ä ÏµúÍ≥†ÏûÖÎãàÎã§!"</p>
                        <div class="text-sm text-purple-600 font-medium">Ïû¨ÏàòÍ∞ïÎ•† 20% Ï¶ùÍ∞Ä ‚Üë</div>
                    </div>
                </div>

                <div class="mt-12 text-center">
                    <a href="/success" class="inline-block text-purple-600 font-medium hover:underline">
                        Îçî ÎßéÏùÄ ÏÑ±Í≥µ ÏÇ¨Î°Ä Î≥¥Í∏∞ ‚Üí
                    </a>
                </div>
            </div>
        </section>

        <!-- CTA -->
        <section class="py-24 px-6 gradient-purple">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl lg:text-5xl font-bold text-white mb-6">
                    Îã§Ïùå ÏÑ±Í≥µ ÏÇ¨Î°ÄÏùò Ï£ºÏù∏Í≥µÏùÄ ÏõêÏû•ÎãòÏûÖÎãàÎã§
                </h2>
                <p class="text-xl text-white/90 mb-10">
                    ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                </p>
                <a href="/contact" class="inline-block bg-white text-purple-600 px-12 py-5 rounded-full text-lg font-medium shadow-xl hover:-translate-y-1 transition">
                    Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠
                </a>
            </div>
        </section>
    </body>
    </html>
  `)
})

// ÌïôÏõêÏû• Ï†ÑÏö© Î¶¨ÏÜåÏä§ ÌéòÏù¥ÏßÄ
app.get('/resources', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎßàÏºÄÌåÖ Î¶¨ÏÜåÏä§ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          .resource-card:hover {
            transform: translateY(-4px);
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100 shadow-sm">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</span>
                    </a>
                    <div class="flex items-center space-x-6">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/resources" class="text-purple-600 font-medium">Î¶¨ÏÜåÏä§</a>
                        <a href="/success" class="text-gray-600 hover:text-purple-600">ÏÑ±Í≥µÏÇ¨Î°Ä</a>
                        <a href="/about" class="text-gray-600 hover:text-purple-600">ÌöåÏÇ¨ÏÜåÍ∞ú</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero -->
        <div class="pt-24 pb-12 px-6 gradient-purple">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-4xl lg:text-5xl font-bold text-white mb-4">ÌïôÏõê ÎßàÏºÄÌåÖ Î¶¨ÏÜåÏä§</h1>
                <p class="text-xl text-white/90">Ïã§Ï†ÑÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ÏôÄ Í∞ÄÏù¥Îìú</p>
            </div>
        </div>

        <!-- Resources Content -->
        <div class="py-12 px-6">
            <div class="max-w-7xl mx-auto">
                
                <!-- ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ -->
                <section class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8">üìç ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h2>
                    <div class="bg-white rounded-2xl p-8 border border-gray-200 resource-card transition">
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-xl font-bold text-purple-600 mb-4">Í∏∞Î≥∏ Ï†ïÎ≥¥ ÏôÑÏÑ±ÎèÑ</h3>
                                <ul class="space-y-3 text-gray-700">
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>ÌïôÏõêÎ™Ö:</strong> ÏßÄÏó≠Î™Ö + Í≥ºÎ™© Ìè¨Ìï® (Ïòà: Ïù∏Ï≤úÏÑúÍµ¨ÏòÅÏñ¥ÌïôÏõê)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Ïπ¥ÌÖåÍ≥†Î¶¨:</strong> Ï†ïÌôïÌïú ÏóÖÏ¢Ö Î∂ÑÎ•ò (ÌïôÏõê > ÏòÅÏñ¥ÌïôÏõê)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>ÏòÅÏóÖÏãúÍ∞Ñ:</strong> Ï†ïÌôïÌïú ÏãúÍ∞ÑÎåÄ ÏûÖÎ†• (Î≥ÄÎèô Ïãú Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Ï†ÑÌôîÎ≤àÌò∏:</strong> ÌÅ¥Î¶≠ ÌÜµÌôî Í∞ÄÎä•Ìïú Î≤àÌò∏</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Ï£ºÏÜå:</strong> Ï†ïÌôïÌïú Ï£ºÏÜå + ÏÉÅÏÑ∏ ÏúÑÏπò (Í±¥Î¨ºÎ™Ö, Ï∏µÏàò)</span>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-purple-600 mb-4">ÏΩòÌÖêÏ∏† & Ïù¥ÎØ∏ÏßÄ</h3>
                                <ul class="space-y-3 text-gray-700">
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>ÎåÄÌëú ÏÇ¨ÏßÑ:</strong> Î∞ùÍ≥† Íπ®ÎÅóÌïú ÌïôÏõê Ï†ÑÍ≤Ω (ÏµúÏÜå 10Ïû•)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Í∞ïÏùòÏã§ ÏÇ¨ÏßÑ:</strong> ÌïôÏäµ ÌôòÍ≤ΩÏù¥ Ïûò Î≥¥Ïù¥Îäî ÏÇ¨ÏßÑ</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Î©îÎâ¥/Í∞ÄÍ≤©:</strong> Í∞ïÏ¢åÎ≥Ñ ÏÉÅÏÑ∏ Í∞ÄÍ≤©Ìëú Îì±Î°ù</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>ÏÜåÍ∞úÍ∏Ä:</strong> 500Ïûê Ïù¥ÏÉÅ, ÌÇ§ÏõåÎìú 3Ìöå Ïù¥ÏÉÅ Ìè¨Ìï®</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úì</span>
                                        <span><strong>Ìè¨Ïä§ÌåÖ:</strong> Ï£º 2Ìöå Ïù¥ÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-8 p-6 bg-purple-50 rounded-xl">
                            <h4 class="font-bold text-purple-900 mb-3">üéØ Î¶¨Î∑∞ Í¥ÄÎ¶¨ Ï†ÑÎûµ</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li>‚Ä¢ <strong>Î¶¨Î∑∞ ÏöîÏ≤≠:</strong> ÏàòÏóÖ Ï¢ÖÎ£å ÌõÑ ÎßåÏ°±ÎèÑ ÎÜíÏùÑ Îïå ÏöîÏ≤≠</li>
                                <li>‚Ä¢ <strong>Îπ†Î•∏ ÎãµÎ≥Ä:</strong> Î™®Îì† Î¶¨Î∑∞Ïóê 24ÏãúÍ∞Ñ ÎÇ¥ ÎãµÎ≥Ä</li>
                                <li>‚Ä¢ <strong>Î∂ÄÏ†ï Î¶¨Î∑∞:</strong> Í∞êÏ†ïÏ†Å ÎåÄÏùë Í∏àÏßÄ, Í∞úÏÑ† ÏùòÏßÄ ÌëúÌòÑ</li>
                                <li>‚Ä¢ <strong>Î™©Ìëú:</strong> Ïõî 5Í∞ú Ïù¥ÏÉÅ Ïã†Í∑ú Î¶¨Î∑∞ ÌôïÎ≥¥</li>
                            </ul>
                        </div>

                        <div class="mt-6 text-center">
                            <button onclick="downloadChecklist('naver')" class="bg-purple-600 text-white px-8 py-3 rounded-full font-medium hover:bg-purple-700 transition">
                                Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îã§Ïö¥Î°úÎìú (PDF)
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Î∏îÎ°úÍ∑∏ ÌÇ§ÏõåÎìú -->
                <section class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8">üìù Î∏îÎ°úÍ∑∏ Ìè¨Ïä§ÌåÖ ÌÇ§ÏõåÎìú Ï∂îÏ≤ú</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- ÏòÅÏñ¥ÌïôÏõê ÌÇ§ÏõåÎìú -->
                        <div class="bg-white rounded-2xl p-8 border border-gray-200 resource-card transition">
                            <h3 class="text-xl font-bold text-orange-600 mb-4">ÏòÅÏñ¥ÌïôÏõê ÌÇ§ÏõåÎìú</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">üî• Ìï´ ÌÇ§ÏõåÎìú (Í≤ÄÏÉâÎüâ ÎÜíÏùå)</div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">Ï¥àÎì±ÏòÅÏñ¥ÌïôÏõê</span>
                                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">Ï§ëÎì±ÏòÅÏñ¥ÎÇ¥Ïã†</span>
                                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">ÏòÅÏñ¥ÌöåÌôîÌïôÏõê</span>
                                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">ÌååÎãâÏä§</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">üíé Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú (Í≤ΩÏüÅ ÎÇÆÏùå)</div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Ïù∏Ï≤úÏÑúÍµ¨ÏòÅÏñ¥ÌïôÏõêÏ∂îÏ≤ú</span>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Ï¥àÎì±ÏòÅÏñ¥Í≥µÎ∂ÄÎ≤ï</span>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">ÏòÅÏñ¥ÌïôÏõêÏÑ†ÌÉùÍ∏∞Ï§Ä</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÏàòÌïôÌïôÏõê ÌÇ§ÏõåÎìú -->
                        <div class="bg-white rounded-2xl p-8 border border-gray-200 resource-card transition">
                            <h3 class="text-xl font-bold text-purple-600 mb-4">ÏàòÌïôÌïôÏõê ÌÇ§ÏõåÎìú</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">üî• Ìï´ ÌÇ§ÏõåÎìú (Í≤ÄÏÉâÎüâ ÎÜíÏùå)</div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">Ï¥àÎì±ÏàòÌïôÌïôÏõê</span>
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">Ï§ëÎì±ÏàòÌïôÎÇ¥Ïã†</span>
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">Í≥†Îì±ÏàòÌïô</span>
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">ÏàòÌïôÌïôÏõêÎπÑÍµê</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">üíé Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú (Í≤ΩÏüÅ ÎÇÆÏùå)</div>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">ÏàòÌïôÍ∞úÎÖêÌïôÏõê</span>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Ï¥àÎì±ÏàòÌïôÎ¨∏Ï†úÏßëÏ∂îÏ≤ú</span>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">ÏàòÌïôÏÑ†ÌñâÌïôÏäµ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏòàÏãú -->
                <section class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8">üí¨ ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏòàÏãú Î¨∏Íµ¨</h2>
                    <div class="bg-white rounded-2xl p-8 border border-gray-200 resource-card transition">
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="p-6 bg-green-50 rounded-xl">
                                <h4 class="font-bold text-green-900 mb-3">üìà ÏÑ±Ï†Å Ìñ•ÏÉÅ Ïãú</h4>
                                <p class="text-sm text-gray-700">"ÌïôÎ∂ÄÎ™®Îãò, Ïù¥Î≤à Î™®ÏùòÍ≥†ÏÇ¨ÏóêÏÑú ÏàòÌïô Îì±Í∏âÏù¥ 3Îì±Í∏âÏóêÏÑú 1Îì±Í∏âÏúºÎ°ú Ìñ•ÏÉÅÎêòÏóàÏäµÎãàÎã§! Íæ∏Ï§ÄÌûà ÎÖ∏Î†•Ìïú Í≤∞Í≥ºÍ∞Ä ÎìúÎü¨ÎÇòÍ≥† ÏûàÏäµÎãàÎã§."</p>
                            </div>
                            <div class="p-6 bg-blue-50 rounded-xl">
                                <h4 class="font-bold text-blue-900 mb-3">üéØ ÌïôÏäµ ÌÉúÎèÑ Í∞úÏÑ†</h4>
                                <p class="text-sm text-gray-700">"ÏµúÍ∑º ÏàòÏóÖ Ï∞∏Ïó¨ÎèÑÍ∞Ä ÎààÏóê ÎùÑÍ≤å Ï¢ãÏïÑÏ°åÏäµÎãàÎã§. ÏßàÎ¨∏ÎèÑ Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÌïòÍ≥†, Í≥ºÏ†ú ÏôÑÏÑ±ÎèÑÎèÑ ÎÜíÏïÑÏ°åÏñ¥Ïöî. Ïù¥ÎåÄÎ°úÎßå Í∞ÄÎ©¥ Îã§Ïùå ÏãúÌóòÏóêÏÑú Ï¢ãÏùÄ Í≤∞Í≥º Í∏∞ÎåÄÎê©ÎãàÎã§!"</p>
                            </div>
                            <div class="p-6 bg-purple-50 rounded-xl">
                                <h4 class="font-bold text-purple-900 mb-3">üìö Ï∂îÍ∞Ä ÌïôÏäµ Ï†úÏïà</h4>
                                <p class="text-sm text-gray-700">"Í∏∞Ï¥àÍ∞Ä ÌÉÑÌÉÑÌï¥Ï†∏ÏÑú Îã§Ïùå Îã®Í≥ÑÎ°ú ÎÑòÏñ¥Í∞ÄÎèÑ Ï¢ãÏùÑ Í≤É Í∞ôÏäµÎãàÎã§. Ïã¨Ìôî Í≥ºÏ†ïÏùÑ Ï∂îÏ≤úÎìúÎ¶¨Î©∞, ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÏÉÅÎã¥ Ïãú ÎßêÏîÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§."</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ÏõîÎ≥Ñ ÎßàÏºÄÌåÖ Ï∫òÎ¶∞Îçî -->
                <section class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8">üìÖ ÏõîÎ≥Ñ ÌïôÏõê ÎßàÏºÄÌåÖ Ï∫òÎ¶∞Îçî</h2>
                    <div class="bg-white rounded-2xl p-8 border border-gray-200 resource-card transition">
                        <div class="space-y-6">
                            <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-xl">
                                <div class="w-20 text-center">
                                    <div class="text-2xl font-bold text-purple-600">1~2Ïõî</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 mb-2">Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï & Ïã†ÌïôÍ∏∞ Ï§ÄÎπÑ</h4>
                                    <p class="text-sm text-gray-700">‚Ä¢ Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï ÌôçÎ≥¥<br>‚Ä¢ Ïã†ÌïôÍ∏∞ Îì±Î°ù Ï°∞Í∏∞ Ìï†Ïù∏<br>‚Ä¢ ÌïôÎ∂ÄÎ™® ÏÑ§Î™ÖÌöå Í∞úÏµú</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-xl">
                                <div class="w-20 text-center">
                                    <div class="text-2xl font-bold text-orange-600">3~4Ïõî</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 mb-2">Ïã†ÌïôÍ∏∞ ÏßëÏ§ë ÎßàÏºÄÌåÖ</h4>
                                    <p class="text-sm text-gray-700">‚Ä¢ Ï≤´ Ï§ëÍ∞ÑÍ≥†ÏÇ¨ ÎåÄÎπÑÎ∞ò ÌôçÎ≥¥<br>‚Ä¢ ÌïôÎ∂ÄÎ™® Í∞ÑÎã¥Ìöå<br>‚Ä¢ ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ Î¶¨Î∑∞ Ïù¥Î≤§Ìä∏</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-xl">
                                <div class="w-20 text-center">
                                    <div class="text-2xl font-bold text-green-600">5~6Ïõî</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 mb-2">Ï§ëÍ∞ÑÍ≥†ÏÇ¨ ÌõÑ Ïû¨Îì±Î°ù ÏßëÏ§ë</h4>
                                    <p class="text-sm text-gray-700">‚Ä¢ ÏÑ±Ï†Å Ìñ•ÏÉÅ ÏÇ¨Î°Ä Î∏îÎ°úÍ∑∏ Ìè¨Ïä§ÌåÖ<br>‚Ä¢ Í∏∞ÎßêÍ≥†ÏÇ¨ ÎåÄÎπÑÎ∞ò ÏòàÏïΩ<br>‚Ä¢ ÌòïÏ†ú/ÏûêÎß§ Ìï†Ïù∏ ÌîÑÎ°úÎ™®ÏÖò</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-xl">
                                <div class="w-20 text-center">
                                    <div class="text-2xl font-bold text-blue-600">7~8Ïõî</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 mb-2">Ïó¨Î¶ÑÎ∞©Ìïô ÌäπÍ∞ï ÏãúÏ¶å</h4>
                                    <p class="text-sm text-gray-700">‚Ä¢ Ïó¨Î¶ÑÎ∞©Ìïô ÏßëÏ§ë Ï∫†ÌîÑ<br>‚Ä¢ 2ÌïôÍ∏∞ ÏÑ†Ìñâ ÌïôÏäµÎ∞ò<br>‚Ä¢ Ï∂îÏ≤ú Ïù¥Î≤§Ìä∏ (ÏπúÍµ¨ Îç∞Î†§Ïò§Í∏∞)</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-xl">
                                <div class="w-20 text-center">
                                    <div class="text-2xl font-bold text-purple-600">11~12Ïõî</div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 mb-2">ÏàòÎä• & Í∏∞ÎßêÍ≥†ÏÇ¨ ÎßàÏºÄÌåÖ</h4>
                                    <p class="text-sm text-gray-700">‚Ä¢ ÏàòÎä• ÎåÄÎ∞ï Ïù¥Î≤§Ìä∏<br>‚Ä¢ Ïó∞Îßê Ïû¨Îì±Î°ù Ï°∞Í∏∞ Ìï†Ïù∏<br>‚Ä¢ ÌïôÎ∂ÄÎ™® Í∞êÏÇ¨ Ïù¥Î≤§Ìä∏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>

        <script>
        function downloadChecklist(type) {
            if (type === 'naver') {
                alert('ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º Îã§Ïö¥Î°úÎìúÌï©ÎãàÎã§.\\n\\nÏã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî PDF ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎê©ÎãàÎã§.');
                // Ïã§Ï†úÎ°úÎäî PDF ÌååÏùº Îã§Ïö¥Î°úÎìú Î°úÏßÅ Ï∂îÍ∞Ä
            }
        }
        </script>
    </body>
    </html>
  `)
})

// ÎåÄÏãúÎ≥¥Îìú ÌéòÏù¥ÏßÄ
app.get('/dashboard', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎåÄÏãúÎ≥¥Îìú - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">ÌïôÏõêÏû• ÎåÄÏãúÎ≥¥Îìú</span>
                    </div>
                    <div class="flex items-center space-x-6">
                        <a href="/" class="flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white px-5 py-2.5 rounded-lg hover:from-purple-700 hover:to-purple-800 transition-all shadow-md hover:shadow-lg font-medium">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            <span>üè† ÌôàÏúºÎ°ú</span>
                        </a>
                        <div id="smsNavDropdown" class="relative group hidden">
                            <button class="flex items-center space-x-1 text-gray-700 hover:text-purple-600 transition font-medium">
                                <span>üì± SMS</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="hidden group-hover:block absolute top-full right-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-100 py-2 z-50">
                                <a href="/sms/compose" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition">
                                    ‚úçÔ∏è Î¨∏Ïûê ÏûëÏÑ±
                                </a>
                                <a href="/sms/senders" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition">
                                    üìû Î∞úÏã†Î≤àÌò∏ Í¥ÄÎ¶¨
                                </a>
                                <a href="/sms/logs" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition">
                                    üìã Î∞úÏÜ° ÎÇ¥Ïó≠
                                </a>
                                <a href="/sms/points" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition">
                                    üí∞ Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨
                                </a>
                            </div>
                        </div>
                        <span id="userName" class="text-gray-700 font-medium"></span>
                        <a href="/profile" class="text-gray-600 hover:text-purple-600 transition">ÌîÑÎ°úÌïÑ</a>
                        <a id="adminDashboardBtn" href="/admin/dashboard" class="hidden bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition font-medium">
                            üîê Í¥ÄÎ¶¨Ïûê Ï†ÑÏö© ÎåÄÏãúÎ≥¥Îìú
                        </a>
                        <button onclick="logout()" class="text-gray-600 hover:text-purple-600 transition">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Íµ¨ÎèÖ Í≤ΩÍ≥† Î∞∞ÎÑà (ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Ï†ÑÏö©) -->
        <div id="subscriptionWarningBanner" class="hidden fixed top-20 left-0 right-0 z-40 bg-gradient-to-r from-red-500 to-orange-500 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-bold text-lg mb-1">‚ö†Ô∏è Íµ¨ÎèÖ ÌîåÎûúÏù¥ ÏóÜÏäµÎãàÎã§</div>
                            <div class="text-sm text-white text-opacity-90">
                                Î™®Îì† Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ ÌîåÎûúÏùÑ Íµ¨ÎèÖÌï¥Ï£ºÏÑ∏Ïöî. ÏßÄÍ∏à Íµ¨ÎèÖÌïòÍ≥† ÌïôÏõê ÎßàÏºÄÌåÖÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!
                            </div>
                        </div>
                    </div>
                    <a href="/pricing" class="bg-white text-red-600 px-6 py-3 rounded-lg hover:bg-gray-100 transition font-bold shadow-lg whitespace-nowrap">
                        ÌîåÎûú ÏÑ†ÌÉùÌïòÍ∏∞ ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <div class="pt-32 pb-24 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">ÏïàÎÖïÌïòÏÑ∏Ïöî, <span id="userNameDisplay"></span>Îãò!</h1>
                    <p class="text-xl text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖ ÌòÑÌô©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                </div>

                <!-- Stats Grid -->
                <div class="grid md:grid-cols-3 gap-6 mb-12">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-blue-100">Î≥¥Ïú† Ìè¨Ïù∏Ìä∏</div>
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="text-4xl font-bold mb-4"><span id="userPoints">0</span>P</div>
                        <div class="space-y-2">
                            <button onclick="openDepositModal()" class="w-full bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50 transition font-medium text-sm">
                                üí∞ ÏûÖÍ∏à Ïã†Ï≤≠
                            </button>
                            <a href="/my-deposits" class="block w-full bg-blue-50 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100 transition font-medium text-sm text-center">
                                üìã ÏûÖÍ∏à ÎÇ¥Ïó≠
                            </a>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-gray-600">Îì±Î°ù ÌïôÏÉù ÌòÑÌô©</div>
                            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </div>
                        <div class="text-4xl font-bold text-gray-900 mb-2"><span id="studentCount">0</span>Î™Ö</div>
                        <a href="/students/list" class="text-sm text-purple-600 hover:text-purple-700 font-medium">
                            ÌïôÏÉù Í¥ÄÎ¶¨ ‚Üí
                        </a>
                    </div>

                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-gray-600">ÏÑ†ÏÉùÎãò ÌòÑÌô©</div>
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div class="text-4xl font-bold text-gray-900 mb-2"><span id="teacherCount">0</span>Î™Ö</div>
                        <a href="/teachers" class="text-sm text-green-600 hover:text-green-700 font-medium">
                            ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ‚Üí
                        </a>
                    </div>
                </div>

                <!-- SMS Quick Access -->
                <div id="smsSection" class="mb-12">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">üì± SMS Î¨∏Ïûê Î∞úÏÜ°</h2>
                        <a href="/sms/compose" class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-green-800 transition-all shadow-md hover:shadow-lg font-medium flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span>Î¨∏Ïûê ÏûëÏÑ±ÌïòÍ∏∞</span>
                        </a>
                    </div>
                    <div class="grid md:grid-cols-4 gap-6">
                        <a href="/sms/compose" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-green-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Î¨∏Ïûê ÏûëÏÑ±</h3>
                                    <p class="text-sm text-gray-500">SMS/LMS Î∞úÏÜ°</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                ÌïôÎ∂ÄÎ™®ÎãòÍªò Í≥µÏßÄÏÇ¨Ìï≠, ÏÉÅÎã¥ ÏïàÎÇ¥, ÏàòÏóÖ ÏïåÎ¶ºÏùÑ Í∞ÑÌé∏ÌïòÍ≤å Î∞úÏÜ°ÌïòÏÑ∏Ïöî
                            </p>
                        </a>

                        <a href="/sms/senders" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-blue-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Î∞úÏã†Î≤àÌò∏</h3>
                                    <p class="text-sm text-gray-500">Î≤àÌò∏ Í¥ÄÎ¶¨</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Î∞úÏã†Î≤àÌò∏Î•º Îì±Î°ùÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî. Ïù∏Ï¶ùÎêú Î≤àÌò∏Îßå ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§
                            </p>
                        </a>

                        <a href="/sms/logs" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-purple-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Î∞úÏÜ° ÎÇ¥Ïó≠</h3>
                                    <p class="text-sm text-gray-500">Ï†ÑÏÜ° Í∏∞Î°ù</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Î¨∏Ïûê Î∞úÏÜ° ÎÇ¥Ïó≠Í≥º ÌÜµÍ≥ÑÎ•º ÌôïÏù∏ÌïòÍ≥† ÏÑ±Í≥µ/Ïã§Ìå® ÎÇ¥Ïó≠ÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî
                            </p>
                        </a>

                        <a href="/sms/points" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-orange-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Ìè¨Ïù∏Ìä∏</h3>
                                    <p class="text-sm text-gray-500"><span id="dashboardPoints">0</span>P</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Ìè¨Ïù∏Ìä∏ ÏûîÏï° ÌôïÏù∏, Ï∂©Ï†Ñ, ÏÇ¨Ïö© ÎÇ¥Ïó≠ÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî
                            </p>
                        </a>
                    </div>
                </div>

                <!-- Landing Page Builder Section -->
                <div id="landingSection" class="mb-12" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">üé® ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</h2>
                        <a href="/tools/landing-builder" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-lg hover:from-purple-700 hover:to-purple-800 transition-all shadow-md hover:shadow-lg font-medium flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span>ÏÉàÎ°ú ÎßåÎì§Í∏∞</span>
                        </a>
                    </div>
                    <div class="grid md:grid-cols-4 gap-6">
                        <a href="/tools/landing-builder" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-purple-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">ÌéòÏù¥ÏßÄ ÏÉùÏÑ±</h3>
                                    <p class="text-sm text-gray-500">AI ÏûêÎèô ÏÉùÏÑ±</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                AIÍ∞Ä ÏûêÎèôÏúºÎ°ú Ï†ÑÎ¨∏Ï†ÅÏù∏ ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§
                            </p>
                        </a>

                        <a href="/tools/landing-manager" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-blue-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">ÎÇ¥ ÌéòÏù¥ÏßÄ</h3>
                                    <p class="text-sm text-gray-500"><span id="landingPagesCount">0</span>Í∞ú</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                ÏÉùÏÑ±Ìïú ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º Î≥¥Í≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî
                            </p>
                        </a>

                        <a href="/tools/landing-folders" class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-green-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Ìè¥Îçî Í¥ÄÎ¶¨</h3>
                                    <p class="text-sm text-gray-500"><span id="landingFoldersCount">0</span>Í∞ú</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                ÌéòÏù¥ÏßÄÎ•º Ìè¥ÎçîÎ°ú Ï†ïÎ¶¨ÌïòÍ≥† Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî
                            </p>
                        </a>

                        <div class="block bg-white rounded-xl p-6 border-2 border-gray-200 hover:border-orange-500 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">Ï¥ù Ï°∞ÌöåÏàò</h3>
                                    <p class="text-sm text-gray-500"><span id="landingViewsCount">0</span>Ìöå</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Î™®Îì† ÎûúÎî©ÌéòÏù¥ÏßÄÏùò ÎàÑÏ†Å Î∞©Î¨∏Ïûê ÏàòÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî
                            </p>
                        </div>
                    </div>
                </div>

                <!-- My Landing Pages Section -->
                <div id="landingPagesSection" class="mb-12" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">üöÄ ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ</h2>
                        <a href="/tools/landing-builder" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all shadow-md hover:shadow-lg font-medium flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span>+ ÏÉà ÎûúÎî©ÌéòÏù¥ÏßÄ</span>
                        </a>
                    </div>
                    <div id="landingPagesList" class="grid md:grid-cols-2 gap-6">
                        <div class="text-center text-gray-500 py-12 md:col-span-2">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            Î∂àÎü¨Ïò§Îäî Ï§ë...
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <a href="/tools/landing-manager" class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium">
                            <span>Ï†ÑÏ≤¥ Í¥ÄÎ¶¨</span>
                            <svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>

                <!-- Marketing Tools -->
                <div class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">üéØ ÎßàÏºÄÌåÖ ÎèÑÍµ¨</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <a href="/tools/search-volume" class="block bg-gradient-to-br from-cyan-500 to-cyan-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâÎüâ Ï°∞Ìöå</h3>
                                    <p class="text-cyan-100 text-sm">Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâÎüâ Î∂ÑÏÑù</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                ÌÇ§ÏõåÎìú Í≤ÄÏÉâÎüâÍ≥º ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏàúÏúÑÎ•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏ÌïòÏÑ∏Ïöî. Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑùÍ≥º ÏµúÏ†Å ÌÇ§ÏõåÎìú Î∞úÍµ¥Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/parent-message" class="block bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏãúÏä§ÌÖú</h3>
                                    <p class="text-purple-100 text-sm">AI Î©îÏãúÏßÄ ÏûêÎèô ÏÉùÏÑ±</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                Í∞ÑÎã®Ìïú Î©îÎ™®Îßå ÏûëÏÑ±ÌïòÎ©¥ AIÍ∞Ä Îî∞ÎúªÌïú Î©îÏãúÏßÄÎ°ú Î≥ÄÌôòÌï¥ÎìúÎ¶ΩÎãàÎã§. ÌïôÎ∂ÄÎ™®ÎãòÍ≥ºÏùò ÏÜåÌÜµÏù¥ ÎçîÏö± Ìé∏Î¶¨Ìï¥ÏßëÎãàÎã§.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/blog-writer" class="block bg-gradient-to-br from-orange-500 to-orange-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÎèÑÍµ¨</h3>
                                    <p class="text-orange-100 text-sm">SEO ÏµúÏ†ÅÌôî Í∏Ä ÏÉùÏÑ±</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                Ï£ºÏ†úÎßå ÏûÖÎ†•ÌïòÎ©¥ ÎÑ§Ïù¥Î≤Ñ SEOÏóê ÏµúÏ†ÅÌôîÎêú Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§. ÏÉÅÏúÑÎÖ∏Ï∂úÏùÑ ÏúÑÌïú ÌïÑÏàò ÎèÑÍµ¨ÏûÖÎãàÎã§.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/landing-builder" class="block bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</h3>
                                    <p class="text-blue-100 text-sm">AI ÏûêÎèô ÌéòÏù¥ÏßÄ Ï†úÏûë</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                ÌïôÏõê ÏÜåÍ∞ú, ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥, ÌïôÏÉù Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄÎ•º Í∞ÑÎã®Ìïú ÏûÖÎ†•ÎßåÏúºÎ°ú ÏûêÎèô ÏÉùÏÑ±Ìï©ÎãàÎã§. Ïπ¥Ïπ¥Ïò§ÌÜ°ÏúºÎ°ú Î∞îÎ°ú Í≥µÏú†ÌïòÏÑ∏Ïöî.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/sms-sender" class="block bg-gradient-to-br from-green-500 to-green-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÏûêÎèô Î¨∏Ïûê Î∞úÏÜ°</h3>
                                    <p class="text-green-100 text-sm">ÌïôÎ∂ÄÎ™® ÏùºÍ¥Ñ Î¨∏Ïûê Î∞úÏÜ°</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                ÏàòÏóÖ Í≥µÏßÄ, Í≤∞ÏÑù ÏïàÎÇ¥, ÏÉÅÎã¥ ÏöîÏ≤≠ÏùÑ ÌÖúÌîåÎ¶øÏúºÎ°ú Í∞ÑÌé∏ÌïòÍ≤å Î∞úÏÜ°ÌïòÏÑ∏Ïöî. ÏòàÏïΩ Î∞úÏÜ°ÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/students" class="block bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÌïôÏÉù Í¥ÄÎ¶¨</h3>
                                    <p class="text-indigo-100 text-sm">Ï∂úÍ≤∞¬∑ÏÑ±Ï†Å¬∑ÏÉÅÎã¥ Í∏∞Î°ù</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                ÌïôÏÉù Ï†ïÎ≥¥, Ï∂úÍ≤∞ Í¥ÄÎ¶¨, ÏÑ±Ï†Å Í∏∞Î°ù, ÏÉÅÎã¥ ÎÇ¥Ïó≠ÏùÑ Ìïú Í≥≥ÏóêÏÑú Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/dashboard-analytics" class="block bg-gradient-to-br from-teal-500 to-teal-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">ÌÜµÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</h3>
                                    <p class="text-teal-100 text-sm">Îß§Ï∂ú¬∑ÌïôÏÉù¬∑ÎßàÏºÄÌåÖ ÌÜµÍ≥Ñ</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                ÌïôÏõê Ïö¥ÏòÅ ÌòÑÌô©ÏùÑ ÌïúÎààÏóê ÌååÏïÖÌïòÍ≥†, Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò ÏùòÏÇ¨Í≤∞Ï†ïÏùÑ ÌïòÏÑ∏Ïöî.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>

                        <a href="/tools/ai-learning-report" class="block bg-gradient-to-br from-violet-500 to-fuchsia-700 rounded-2xl p-8 hover:shadow-2xl transition-all hover:-translate-y-1">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h3>
                                    <p class="text-violet-100 text-sm">Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÌïôÏäµ Î∂ÑÏÑù</p>
                                </div>
                            </div>
                            <p class="text-white/90 leading-relaxed mb-4">
                                AIÍ∞Ä ÌïôÏÉùÏùò ÏÑ±Ï†Å, Ï∂úÏÑù, ÌïôÏäµ ÌÉúÎèÑÎ•º Ï¢ÖÌï© Î∂ÑÏÑùÌïòÏó¨ ÎßûÏ∂§Ìòï Î¶¨Ìè¨Ìä∏Î•º ÏûêÎèô ÏÉùÏÑ±Ìï©ÎãàÎã§.
                            </p>
                            <div class="flex items-center text-white font-medium">
                                <span>Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞</span>
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="space-y-8">
                    <!-- Subscription Status & Usage -->
                    <div id="subscriptionStatusMain" class="bg-white rounded-2xl p-8 border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä Íµ¨ÎèÖ Î∞è ÏÇ¨Ïö© ÌòÑÌô©</h2>
                        <div class="text-center py-12">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                            <p class="text-gray-500">Íµ¨ÎèÖ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>

                    <!-- Main Tools Section -->
                    <div class="bg-white rounded-2xl p-8 border border-gray-200 mb-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">üöÄ Ï£ºÏöî Í∏∞Îä•</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <!-- Landing Page Builder -->
                            <a href="/tools/landing-builder" class="dashboard-card-landing-builder flex items-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl hover:shadow-lg transition-all border-2 border-purple-200">
                                <div class="w-14 h-14 bg-purple-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-lg text-gray-900">ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</div>
                                    <div class="text-sm text-gray-600 mt-1">ÌïôÏõê ÌôçÎ≥¥ ÌéòÏù¥ÏßÄÎ•º ÏâΩÍ≤å ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî</div>
                                </div>
                                <svg class="w-6 h-6 text-purple-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <!-- AI Learning Report -->
                            <a href="/tools/ai-learning-report" class="dashboard-card-ai-report flex items-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl hover:shadow-lg transition-all border-2 border-blue-200">
                                <div class="w-14 h-14 bg-blue-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-lg text-gray-900">AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
                                    <div class="text-sm text-gray-600 mt-1">ÌïôÏÉù ÏÑ±Ï†ÅÏùÑ AIÎ°ú Î∂ÑÏÑùÌïòÏÑ∏Ïöî</div>
                                </div>
                                <svg class="w-6 h-6 text-blue-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <!-- Student Management -->
                            <a href="/students/list" class="dashboard-card-student-mgmt flex items-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl hover:shadow-lg transition-all border-2 border-green-200">
                                <div class="w-14 h-14 bg-green-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-lg text-gray-900">ÌïôÏÉù Í¥ÄÎ¶¨</div>
                                    <div class="text-sm text-gray-600 mt-1">ÌïôÏÉù Ï†ïÎ≥¥Î•º Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</div>
                                </div>
                                <svg class="w-6 h-6 text-green-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <!-- SMS Message -->
                            <a href="/tools/sms-sender" class="dashboard-card-sms flex items-center p-6 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl hover:shadow-lg transition-all border-2 border-orange-200">
                                <div class="w-14 h-14 bg-orange-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-lg text-gray-900">Î¨∏Ïûê Î©îÏãúÏßÄ</div>
                                    <div class="text-sm text-gray-600 mt-1">ÌïôÎ∂ÄÎ™®ÏóêÍ≤å Î¨∏ÏûêÎ•º Î∞úÏÜ°ÌïòÏÑ∏Ïöî</div>
                                </div>
                                <svg class="w-6 h-6 text-orange-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="bg-white rounded-2xl p-8 border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Î∞îÎ°úÍ∞ÄÍ∏∞</h2>
                        <div class="space-y-3">
                            <a href="/programs" class="flex items-center justify-between p-5 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                    <span class="font-medium text-gray-900">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</span>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <a href="/success" class="flex items-center justify-between p-5 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                    </svg>
                                    <span class="font-medium text-gray-900">ÏÑ±Í≥µ ÏÇ¨Î°Ä</span>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <a href="/resources" class="flex items-center justify-between p-5 bg-gradient-to-r from-purple-50 to-orange-50 rounded-xl hover:shadow-md transition border-2 border-purple-200">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                    <div>
                                        <div class="font-bold text-gray-900">ÎßàÏºÄÌåÖ Î¶¨ÏÜåÏä§</div>
                                        <div class="text-xs text-gray-600">Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ & Í∞ÄÏù¥Îìú</div>
                                    </div>
                                </div>
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <a href="/contact" class="flex items-center justify-between p-5 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                    </svg>
                                    <span class="font-medium text-gray-900">1:1 ÏÉÅÎã¥ Ïã†Ï≤≠</span>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>

                            <a href="/" class="flex items-center justify-between p-5 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                    </svg>
                                    <span class="font-medium text-gray-900">Î©îÏù∏ ÌéòÏù¥ÏßÄ</span>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Check authentication
            const user = JSON.parse(localStorage.getItem('user') || 'null')
            const isImpersonating = localStorage.getItem('is_impersonating') === 'true'
            
            console.log('[Dashboard Init] User from localStorage:', user)
            
            if (!user) {
                console.error('[Dashboard Init] No user in localStorage, redirecting to login')
                window.location.href = '/login'
            } else {
                console.log('[Dashboard Init] User ID:', user.id, 'Email:', user.email, 'Name:', user.name)
                
                document.getElementById('userName').textContent = user.name
                document.getElementById('userNameDisplay').textContent = user.name
                
                // Í¥ÄÎ¶¨ÏûêÏùº Í≤ΩÏö∞ Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú Î≤ÑÌäº ÌëúÏãú
                if (user.role === 'admin') {
                    document.getElementById('adminDashboardBtn').classList.remove('hidden')
                }
                
                // Impersonating Ï§ëÏù¥Î©¥ Î≥µÍ∑Ä Î≤ÑÌäº ÌëúÏãú
                if (isImpersonating) {
                    const nav = document.querySelector('nav .flex.items-center.space-x-4')
                    if (nav) {
                        const returnBtn = document.createElement('button')
                        returnBtn.onclick = returnToAdmin
                        returnBtn.className = 'px-4 py-2 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-all'
                        returnBtn.innerHTML = 'üîô Í¥ÄÎ¶¨ÏûêÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞'
                        nav.insertBefore(returnBtn, nav.firstChild)
                    }
                }
                
                // Íµ¨ÎèÖ ÏÉÅÌÉú Î°úÎìú
                console.log('[Dashboard Init] Loading subscription status...')
                loadSubscriptionStatus()
                
                // Í∂åÌïú Ï≤¥ÌÅ¨ Î∞è UI ÌëúÏãú/Ïà®ÍπÄ
                checkPermissions()
            }
            
            // Íµ¨ÎèÖ ÏÉÅÌÉú Î°úÎìú Ìï®Ïàò
            async function loadSubscriptionStatus() {
                try {
                    console.log('[Dashboard] üîç Starting subscription status check...')
                    console.log('[Dashboard] Current user from localStorage:', user)
                    
                    // üî• Try session-based API first
                    let response = await fetch('/api/subscriptions/status')
                    console.log('[Dashboard] API Response Status:', response.status, response.statusText)
                    
                    let data = await response.json()
                    
                    // üî• If session failed, try direct user ID lookup
                    if (!data.success || !data.hasSubscription) {
                        console.log('[Dashboard] ‚ö†Ô∏è Session-based API failed, trying direct lookup with user.id:', user.id)
                        const directResponse = await fetch('/api/debug/user/' + user.id + '/subscription')
                        const directData = await directResponse.json()
                        
                        console.log('[Dashboard] Direct lookup response:', directData)
                        
                        if (directData.subscriptions && directData.subscriptions.active) {
                            const sub = directData.subscriptions.active
                            data = {
                                success: true,
                                hasSubscription: true,
                                subscription: {
                                    id: sub.id,
                                    planName: sub.plan_name,
                                    startDate: sub.subscription_start_date,
                                    endDate: sub.subscription_end_date,
                                    studentLimit: sub.student_limit,
                                    aiReportLimit: sub.ai_report_limit,
                                    landingPageLimit: sub.landing_page_limit,
                                    teacherLimit: sub.teacher_limit
                                }
                            }
                            console.log('[Dashboard] ‚úÖ Converted to subscription format:', data)
                        }
                    }
                    
                    console.log('[Dashboard] ========== SUBSCRIPTION STATUS API RESPONSE ==========')
                    console.log('[Dashboard] Full Response:', JSON.stringify(data, null, 2))
                    console.log('[Dashboard] success:', data.success)
                    console.log('[Dashboard] hasSubscription:', data.hasSubscription)
                    console.log('[Dashboard] error:', data.error)
                    console.log('[Dashboard] ==========================================================')
                    console.log('[Dashboard] Subscription Status Response:', data)
                    
                    const statusDiv = document.getElementById('subscriptionStatusMain')
                    const warningBanner = document.getElementById('subscriptionWarningBanner')
                    
                    if (!statusDiv) {
                        console.error('subscriptionStatusMain element not found')
                        return
                    }
                    
                    // Íµ¨ÎèÖ Ïó¨Î∂Ä ÌôïÏù∏
                    const hasSubscription = data.success && data.hasSubscription
                    const isAdminPlan = hasSubscription && data.subscription && data.subscription.planName === 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú'
                    
                    console.log('[Dashboard] hasSubscription:', hasSubscription, 'isAdminPlan:', isAdminPlan)
                    
                    // Íµ¨ÎèÖÏù¥ ÏóÜÏúºÎ©¥ Í≤ΩÍ≥† Î∞∞ÎÑà ÌëúÏãú (Í¥ÄÎ¶¨Ïûê ÌîåÎûú Ìè¨Ìï® Î™®Îì† Íµ¨ÎèÖÏù¥ ÏûàÏúºÎ©¥ Î∞∞ÎÑà Ïà®ÍπÄ)
                    if (!hasSubscription) {
                        console.log('[Dashboard] Showing warning banner - no subscription')
                        console.log('[Dashboard] üî¥ No subscription found! Data:', {
                            userId: user.id,
                            userName: user.name,
                            apiResponse: data,
                            message: 'This user needs to log in with their account to see subscription data'
                        })
                        warningBanner.classList.remove('hidden')
                        // Î∞∞ÎÑà ÎÜíÏù¥ÎßåÌÅº Ïª®ÌÖêÏ∏† ÏòÅÏó≠ÏùÑ ÏïÑÎûòÎ°ú Î∞ÄÍ∏∞
                        const mainContent = document.querySelector('.pt-32')
                        if (mainContent) {
                            mainContent.classList.remove('pt-32')
                            mainContent.classList.add('pt-48')
                        }
                    } else if (warningBanner) {
                        console.log('[Dashboard] Hiding warning banner - has subscription')
                        warningBanner.classList.add('hidden')
                    }
                    
                    if (hasSubscription) {
                        const sub = data.subscription
                        
                        // ÎÇ†Ïßú Í≥ÑÏÇ∞
                        const startDate = new Date(sub.startDate)
                        const endDate = new Date(sub.endDate + 'T23:59:59+09:00')
                        const today = new Date()
                        const daysLeft = Math.max(0, Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)))
                        const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24))
                        const daysUsed = totalDays - daysLeft
                        
                        // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
                        const formatDate = (date) => {
                            const year = date.getFullYear()
                            const month = String(date.getMonth() + 1).padStart(2, '0')
                            const day = String(date.getDate()).padStart(2, '0')
                            return year + 'ÎÖÑ ' + month + 'Ïõî ' + day + 'Ïùº'
                        }
                        
                        // ÏÇ¨Ïö©Îüâ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                        let usageHtml = ''
                        try {
                            console.log('[Dashboard] Fetching usage data...')
                            let usageRes = await fetch('/api/usage/check', {
                                method: 'GET',
                                credentials: 'include',
                                cache: 'no-cache'
                            })
                            console.log('[Dashboard] Usage API status:', usageRes.status)
                            
                            let usageData = await usageRes.json()
                            console.log('[Dashboard] ========== USAGE API RESPONSE ==========')
                            console.log('[Dashboard] Full Response:', JSON.stringify(usageData, null, 2))
                            console.log('[Dashboard] success:', usageData.success)
                            console.log('[Dashboard] error:', usageData.error)
                            console.log('[Dashboard] ==========================================')
                            
                            // üî• If usage check failed, use debug API
                            if (!usageData.success) {
                                console.log('[Dashboard] ‚ö†Ô∏è Usage API failed, using debug data for user.id:', user.id)
                                const debugResponse = await fetch('/api/debug/user/' + user.id + '/subscription')
                                const debugData = await debugResponse.json()
                                
                                if (debugData.subscriptions && debugData.subscriptions.active) {
                                    const activeSub = debugData.subscriptions.active
                                    const actualData = debugData.actualData || {}
                                    
                                    usageData = {
                                        success: true,
                                        limits: {
                                            students: activeSub.student_limit || 0,
                                            aiReports: activeSub.ai_report_limit || 0,
                                            landingPages: activeSub.landing_page_limit || 0,
                                            teachers: activeSub.teacher_limit || 0
                                        },
                                        usage: {
                                            students: actualData.students || 0,
                                            aiReports: 0,
                                            landingPages: actualData.landingPages || 0,
                                            teachers: actualData.teachers === 'table_not_found' ? 0 : (actualData.teachers || 0),
                                            sms: 0
                                        }
                                    }
                                    console.log('[Dashboard] ‚úÖ Converted debug data to usage format:', usageData)
                                }
                            }
                            
                            if (usageData.success) {
                                const { limits, usage } = usageData
                                
                                console.log('[Dashboard] ========== LIMITS ==========')
                                console.log('[Dashboard] Students Limit:', limits.students)
                                console.log('[Dashboard] AI Reports Limit:', limits.aiReports)
                                console.log('[Dashboard] Landing Pages Limit:', limits.landingPages)
                                console.log('[Dashboard] Teachers Limit:', limits.teachers)
                                console.log('[Dashboard] ========== USAGE ==========')
                                console.log('[Dashboard] Students Used:', usage.students)
                                console.log('[Dashboard] AI Reports Used:', usage.aiReports)
                                console.log('[Dashboard] Landing Pages Used:', usage.landingPages)
                                console.log('[Dashboard] Teachers Used:', usage.teachers)
                                console.log('[Dashboard] =======================================')
                                
                                // ÌçºÏÑºÌä∏ Í≥ÑÏÇ∞ Î∞è ÏÉâÏÉÅ Í≤∞Ï†ï
                                const calcUsage = (current, limit) => {
                                    const percent = limit > 0 ? Math.min((current / limit) * 100, 100) : 0
                                    const remaining = Math.max(limit - current, 0)
                                    let color = 'blue'
                                    if (percent >= 100) color = 'red'
                                    else if (percent >= 80) color = 'orange'
                                    else if (percent >= 60) color = 'yellow'
                                    return { percent, remaining, color, current, limit }
                                }
                                
                                const studentUsage = calcUsage(usage.students || 0, limits.students || 0)
                                const reportUsage = calcUsage(usage.aiReports || 0, limits.aiReports || 0)
                                const landingUsage = calcUsage(usage.landingPages || 0, limits.landingPages || 0)
                                const teacherUsage = calcUsage(usage.teachers || 0, limits.teachers || 0)
                                
                                const renderUsageCard = (icon, title, usage) => {
                                    return '<div class="bg-white rounded-2xl p-6 shadow-lg border-2 ' + 
                                        (usage.color === 'red' ? 'border-red-300 bg-red-50' : 
                                         usage.color === 'orange' ? 'border-orange-300 bg-orange-50' :
                                         usage.color === 'yellow' ? 'border-yellow-300 bg-yellow-50' : 'border-blue-200 bg-blue-50') + '">' +
                                        '<div class="flex items-center gap-3 mb-4">' +
                                        '<span class="text-4xl">' + icon + '</span>' +
                                        '<div class="flex-1">' +
                                        '<h4 class="text-base font-bold text-gray-900">' + title + '</h4>' +
                                        '<p class="text-2xl font-bold mt-1 ' + 
                                        (usage.color === 'red' ? 'text-red-600' : 
                                         usage.color === 'orange' ? 'text-orange-600' :
                                         usage.color === 'yellow' ? 'text-yellow-600' : 'text-blue-600') + '">' +
                                        usage.current.toLocaleString() + ' / ' + usage.limit.toLocaleString() +
                                        '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '<div class="w-full bg-gray-300 rounded-full h-4 mb-3 overflow-hidden">' +
                                        '<div class="h-4 rounded-full transition-all duration-500 ' + 
                                        (usage.color === 'red' ? 'bg-gradient-to-r from-red-500 to-red-700' : 
                                         usage.color === 'orange' ? 'bg-gradient-to-r from-orange-500 to-orange-700' :
                                         usage.color === 'yellow' ? 'bg-gradient-to-r from-yellow-500 to-yellow-700' : 'bg-gradient-to-r from-blue-500 to-blue-700') + 
                                        '" style="width: ' + Math.min(usage.percent, 100) + '%"></div>' +
                                        '</div>' +
                                        '<div class="flex justify-between items-center">' +
                                        '<span class="text-sm font-semibold text-gray-700">' + usage.percent.toFixed(1) + '% ÏÇ¨Ïö© Ï§ë</span>' +
                                        '<span class="text-sm font-bold px-3 py-1 rounded-full ' + 
                                        (usage.remaining === 0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700') + '">' +
                                        'ÎÇ®Ïùå: ' + usage.remaining.toLocaleString() + 'Í∞ú' +
                                        '</span>' +
                                        '</div>' +
                                        '</div>'
                                }
                                
                                usageHtml = '<div class="mt-6 pt-6 border-t-2 border-purple-200">' +
                                    '<div class="flex items-center justify-between mb-6">' +
                                    '<h3 class="text-xl font-bold text-gray-900">üìä Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Îüâ</h3>' +
                                    '<span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏Îê®</span>' +
                                    '</div>' +
                                    '<div class="space-y-4">' +
                                    renderUsageCard('üë•', 'ÌïôÏÉù', studentUsage) +
                                    renderUsageCard('üìä', 'AI Î¶¨Ìè¨Ìä∏', reportUsage) +
                                    renderUsageCard('üé®', 'ÎûúÎî©ÌéòÏù¥ÏßÄ', landingUsage) +
                                    renderUsageCard('üë®‚Äçüè´', 'ÏÑ†ÏÉùÎãò', teacherUsage) +
                                    '</div>' +
                                    '</div>'
                            } else {
                                console.error('[Dashboard] Usage API returned success=false:', usageData)
                                usageHtml = '<div class="mt-6 pt-6 border-t-2 border-red-200">' +
                                    '<div class="text-sm text-red-600">ÏÇ¨Ïö©Îüâ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§: ' + (usageData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò') + '</div>' +
                                    '</div>'
                            }
                        } catch (usageErr) {
                            console.error('[Usage] Error fetching usage:', usageErr)
                            usageHtml = '<div class="mt-6 pt-6 border-t-2 border-red-200">' +
                                '<div class="text-sm text-red-600">ÏÇ¨Ïö©Îüâ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ' + usageErr.message + '</div>' +
                                '</div>'
                        }
                        
                        statusDiv.innerHTML = 
                            '<div class="bg-gradient-to-r from-purple-100 to-blue-100 border-2 border-purple-300 rounded-xl p-6">' +
                                '<div class="flex items-center justify-between flex-wrap gap-4">' +
                                    '<div class="flex-1">' +
                                        '<div class="flex items-center gap-4 mb-4">' +
                                            '<div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center">' +
                                                '<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>' +
                                                '</svg>' +
                                            '</div>' +
                                            '<div>' +
                                                '<div class="flex items-center gap-2 mb-1">' +
                                                    '<span class="text-lg font-bold text-gray-900">' + sub.planName + '</span>' +
                                                    '<span class="px-3 py-1 bg-green-500 text-white text-xs font-bold rounded-full">ÌôúÏÑ±</span>' +
                                                '</div>' +
                                                '<div class="text-sm text-gray-700 font-medium mb-1">' +
                                                    'üìÖ ' + formatDate(startDate) + ' ~ ' + formatDate(endDate) +
                                                '</div>' +
                                                '<div class="flex items-center gap-4 text-xs">' +
                                                    '<span class="text-blue-600 font-bold">‚è≥ ' + daysLeft + 'Ïùº ÎÇ®Ïùå</span>' +
                                                    '<span class="text-gray-500">Ï¥ù ' + totalDays + 'Ïùº Ï§ë ' + daysUsed + 'Ïùº ÏÇ¨Ïö©</span>' +
                                                '</div>' +
                                            '</div>' +
                                        '</div>' +
                                        usageHtml +
                                    '</div>' +
                                    '<a href="/pricing" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-medium whitespace-nowrap">' +
                                        'ÌîåÎûú Î≥ÄÍ≤Ω' +
                                    '</a>' +
                                '</div>' +
                            '</div>'
                    } else {
                        statusDiv.innerHTML = 
                            '<div class="bg-gradient-to-r from-orange-100 to-red-100 border-2 border-orange-300 rounded-xl p-6">' +
                                '<div class="flex items-center justify-between flex-wrap gap-4">' +
                                    '<div class="flex items-center gap-4">' +
                                        '<div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center">' +
                                            '<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>' +
                                            '</svg>' +
                                        '</div>' +
                                        '<div>' +
                                            '<div class="text-lg font-bold text-gray-900 mb-1">Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§</div>' +
                                            '<div class="text-sm text-gray-600">' +
                                                'ÌîåÎûúÏùÑ Íµ¨ÎèÖÌïòÍ≥† Î™®Îì† Í∏∞Îä•ÏùÑ Ïù¥Ïö©ÌïòÏÑ∏Ïöî' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                    '<a href="/pricing" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-medium whitespace-nowrap">' +
                                        'ÌîåÎûú ÏÑ†ÌÉùÌïòÍ∏∞' +
                                    '</a>' +
                                '</div>' +
                            '</div>'
                    }
                } catch (error) {
                    console.error('[Subscription Status] Error:', error)
                }
            }
            
            // Í∂åÌïú Ï≤¥ÌÅ¨ Ìï®Ïàò
            async function checkPermissions() {
                try {
                    const response = await fetch('/api/user/permissions?userId=' + user.id)
                    const data = await response.json()
                    
                    console.log('üîç checkPermissions - Í∂åÌïú Ï°∞Ìöå Í≤∞Í≥º:', data)
                    
                    if (data.success) {
                        const permissions = data.permissions
                        console.log('‚úÖ checkPermissions - ÌòÑÏû¨ Í∂åÌïú:', permissions)
                        
                        // Í¥ÄÎ¶¨ÏûêÎäî Î™®Îì† ÎèÑÍµ¨ ÌëúÏãú
                        if (user.role === 'admin') {
                            console.log('‚úÖ Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï - Î™®Îì† ÎèÑÍµ¨ ÌëúÏãú')
                            // Í¥ÄÎ¶¨ÏûêÎäî SMS ÏÑπÏÖòÍ≥º ÎÑ§ÎπÑÍ≤åÏù¥ÏÖòÎèÑ Î™®Îëê ÌëúÏãú
                            const smsSection = document.getElementById('smsSection')
                            if (smsSection) smsSection.style.display = 'block'
                            const smsNavDropdown = document.getElementById('smsNavDropdown')
                            if (smsNavDropdown) smsNavDropdown.classList.remove('hidden')
                            return
                        }
                        
                        // Í∞Å ÎèÑÍµ¨Î≥Ñ Í∂åÌïú Ï≤¥ÌÅ¨ Î∞è Ïà®ÍπÄ Ï≤òÎ¶¨
                        const toolMapping = {
                            'search_volume': 'a[href="/tools/search-volume"]',
                            'parent_message': 'a[href="/tools/parent-message"]',
                            'blog_writer': 'a[href="/tools/blog-writer"]',
                            'landing_builder': 'a[href="/tools/landing-builder"]',
                            'sms_sender': 'a[href="/tools/sms-sender"]',
                            'student_management': 'a[href="/students/list"], a[href="/students"]',
                            'dashboard_analytics': 'a[href="/tools/dashboard-analytics"]',
                            'ai_learning_report': 'a[href="/tools/ai-learning-report"]',
                            'keyword_analyzer': 'a[href="/tools/keyword-analyzer"]',
                            'review_template': 'a[href="/tools/review-template"]',
                            'ad_copy_generator': 'a[href="/tools/ad-copy-generator"]',
                            'photo_optimizer': 'a[href="/tools/photo-optimizer"]',
                            'competitor_analysis': 'a[href="/tools/competitor-analysis"]',
                            'blog_checklist': 'a[href="/tools/blog-checklist"]',
                            'content_calendar': 'a[href="/tools/content-calendar"]',
                            'consultation_script': 'a[href="/tools/consultation-script"]',
                            'place_optimization': 'a[href="/tools/place-optimization"]',
                            'roi_calculator': 'a[href="/tools/roi-calculator"]'
                        }
                        
                        // üî• ÎåÄÏãúÎ≥¥Îìú Ï£ºÏöî Í∏∞Îä• Ïπ¥Îìú Îß§Ìïë Ï∂îÍ∞Ä
                        const dashboardCardMapping = {
                            'landing_builder': '.dashboard-card-landing-builder',
                            'ai_learning_report': '.dashboard-card-ai-report',
                            'student_management': '.dashboard-card-student-mgmt',
                            'sms_sender': '.dashboard-card-sms'
                        }
                        
                        // Î™®Îì† ÎèÑÍµ¨ Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Ïà®ÍπÄ
                        Object.values(toolMapping).forEach(selector => {
                            const elements = document.querySelectorAll(selector)
                            elements.forEach(el => {
                                el.style.display = 'none'
                            })
                        })
                        
                        // üî• Î™®Îì† ÎåÄÏãúÎ≥¥Îìú Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Ïà®ÍπÄ
                        Object.values(dashboardCardMapping).forEach(selector => {
                            const elements = document.querySelectorAll(selector)
                            elements.forEach(el => {
                                el.style.display = 'none'
                                console.log('üîí ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú Ïà®ÍπÄ:', selector)
                            })
                        })
                        
                        // Í∂åÌïúÏù¥ ÏûàÎäî ÎèÑÍµ¨Îßå ÌëúÏãú
                        Object.keys(permissions).forEach(permKey => {
                            if (permissions[permKey]) {
                                // ÏùºÎ∞ò ÎèÑÍµ¨ ÌëúÏãú
                                if (toolMapping[permKey]) {
                                    const elements = document.querySelectorAll(toolMapping[permKey])
                                    elements.forEach(el => {
                                        el.style.display = ''
                                    })
                                    console.log('‚úÖ Í∂åÌïú ÏûàÏùå:', permKey)
                                }
                                
                                // üî• ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú ÌëúÏãú
                                if (dashboardCardMapping[permKey]) {
                                    const elements = document.querySelectorAll(dashboardCardMapping[permKey])
                                    elements.forEach(el => {
                                        el.style.display = ''
                                        console.log('‚úÖ ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú ÌëúÏãú:', permKey)
                                    })
                                }
                            }
                        })
                        
                        // SMS ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÎìúÎ°≠Îã§Ïö¥ Î∞è ÏÑπÏÖò (sms ÎòêÎäî sms_sender Í∂åÌïúÏúºÎ°ú Ï≤¥ÌÅ¨ - Ìò∏ÌôòÏÑ±)
                        if (permissions.sms || permissions.sms_sender) {
                            document.getElementById('smsNavDropdown')?.classList.remove('hidden')
                            document.getElementById('smsQuickAccess')?.classList.remove('hidden')
                            const smsSection = document.getElementById('smsSection')
                            if (smsSection) {
                                smsSection.style.display = 'block'
                            }
                            console.log('‚úÖ SMS Í∂åÌïú ÏûàÏùå (sms ÎòêÎäî sms_sender)')
                        } else {
                            // SMS Í∂åÌïúÏù¥ ÏóÜÏúºÎ©¥ Ïà®ÍπÄ
                            const smsSection = document.getElementById('smsSection')
                            if (smsSection) {
                                smsSection.style.display = 'none'
                            }
                            console.log('‚ùå SMS Í∂åÌïú ÏóÜÏùå')
                        }
                    }
                } catch (err) {
                    console.error('Í∂åÌïú Ï°∞Ìöå Ïã§Ìå®:', err)
                    // ÏóêÎü¨ Ïãú Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Î™®Îëê Ïà®ÍπÄ (Í¥ÄÎ¶¨ÏûêÎäî Ï†úÏô∏)
                    if (user.role !== 'admin') {
                        // Î™®Îì† ÎèÑÍµ¨ Ïπ¥Îìú Ïà®Í∏∞Í∏∞
                        const allTools = document.querySelectorAll('a[href^="/tools/"], a[href="/students"]')
                        allTools.forEach(tool => {
                            tool.style.display = 'none'
                        })
                    }
                }
            }
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
            checkUserPermissions()
            loadUserPoints()
            loadMyLandingPages()
            loadLandingFolders()
            loadStudentCount()
            loadTeacherCount()
            
            // ÌïôÏÉù/ÏÑ†ÏÉùÎãò Ïàò ÏûêÎèô Í∞±Ïã† (30Ï¥àÎßàÎã§)
            setInterval(() => {
                loadStudentCount()
                loadTeacherCount()
                loadMyLandingPages()
                loadLandingFolders()
            }, 30000) // 30Ï¥à
            
            // ÌéòÏù¥ÏßÄÍ∞Ä Îã§Ïãú Ìè¨Ïª§Ïä§Î•º Î∞õÏùÑ Îïå Í∞±Ïã†
            window.addEventListener('focus', () => {
                loadStudentCount()
                loadTeacherCount()
                loadMyLandingPages()
                loadLandingFolders()
            })
            
            // Îã§Î•∏ ÌÉ≠ÏóêÏÑú Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ ÏûàÏùÑ Îïå Í∞±Ïã† (storage Ïù¥Î≤§Ìä∏)
            window.addEventListener('storage', (e) => {
                if (e.key === 'students_updated' || e.key === 'teachers_updated') {
                    loadStudentCount()
                    loadTeacherCount()
                }
            })

            function returnToAdmin() {
                const originalAdmin = JSON.parse(localStorage.getItem('original_admin'))
                if (originalAdmin) {
                    localStorage.setItem('user', JSON.stringify(originalAdmin))
                    localStorage.removeItem('original_admin')
                    localStorage.removeItem('is_impersonating')
                    alert('Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏúºÎ°ú Î≥µÍ∑ÄÌï©ÎãàÎã§.')
                    window.location.href = '/admin/users.html'
                }
            }

            function logout() {
                localStorage.removeItem('user')
                localStorage.removeItem('original_admin')
                localStorage.removeItem('is_impersonating')
                window.location.href = '/'
            }

            // Ìè¨Ïù∏Ìä∏ Ïã§ÏãúÍ∞Ñ Î°úÎìú
            async function loadUserPoints() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (user && user.id) {
                    try {
                        const response = await fetch('/api/users/' + user.id + '/points')
                        const data = await response.json()
                        if (data.success) {
                            const points = data.points || 0
                            document.getElementById('userPoints').textContent = points.toLocaleString()
                            // SMS ÏÑπÏÖòÏùò Ìè¨Ïù∏Ìä∏ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                            const dashboardPointsEl = document.getElementById('dashboardPoints')
                            if (dashboardPointsEl) {
                                dashboardPointsEl.textContent = points.toLocaleString()
                            }
                            
                            // localStorageÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                            user.points = points
                            localStorage.setItem('user', JSON.stringify(user))
                        }
                    } catch (err) {
                        console.error('Ìè¨Ïù∏Ìä∏ Î°úÎìú Ïã§Ìå®:', err)
                    }
                }
            }

            async function loadStudentCount() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (user && user.id) {
                    try {
                        // Ìó§Îçî Î∞©ÏãùÏúºÎ°ú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†ÑÎã¨
                        const userDataHeader = btoa(unescape(encodeURIComponent(JSON.stringify(user))));
                        const response = await fetch('/api/students', {
                            headers: {
                                'X-User-Data-Base64': userDataHeader
                            }
                        })
                        const data = await response.json()
                        console.log('ÌïôÏÉù Ïàò Î°úÎìú:', data)
                        if (data.success && data.students) {
                            const count = data.students.length
                            document.getElementById('studentCount').textContent = count
                            console.log('ÌïôÏÉù Ïàò ÏóÖÎç∞Ïù¥Ìä∏:', count)
                        }
                    } catch (err) {
                        console.error('ÌïôÏÉù Ïàò Î°úÎìú Ïã§Ìå®:', err)
                    }
                }
            }

            async function loadTeacherCount() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (user && user.id) {
                    try {
                        const response = await fetch('/api/teachers?userId=' + user.id)
                        const data = await response.json()
                        if (data.success && data.teachers) {
                            const count = data.teachers.length
                            document.getElementById('teacherCount').textContent = count
                        }
                    } catch (err) {
                        console.error('ÏÑ†ÏÉùÎãò Ïàò Î°úÎìú Ïã§Ìå®:', err)
                    }
                }
            }

            // ÏÇ¨Ïö©Ïûê Í∂åÌïú ÌôïÏù∏ Î∞è Î©îÎâ¥ ÌëúÏãú/Ïà®ÍπÄ
            async function checkUserPermissions() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (!user || !user.id) return
                
                try {
                    const response = await fetch('/api/user/permissions?userId=' + user.id)
                    const data = await response.json()
                    
                    console.log('üîç ÏÇ¨Ïö©Ïûê Í∂åÌïú Ï°∞Ìöå Í≤∞Í≥º:', data)
                    
                    if (data.success && data.permissions) {
                        const permissions = data.permissions
                        console.log('‚úÖ ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Í∂åÌïú:', permissions)
                        
                        // search_volume Í∂åÌïú Ï≤¥ÌÅ¨ - ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâÎüâ Ï°∞Ìöå
                        const searchVolumeCard = document.querySelector('a[href="/tools/search-volume"]')
                        if (searchVolumeCard) {
                            if (!permissions.search_volume) {
                                searchVolumeCard.style.display = 'none'
                                console.log('‚ùå search_volume Í∂åÌïú ÏóÜÏùå - Ïπ¥Îìú Ïà®ÍπÄ')
                            } else {
                                console.log('‚úÖ search_volume Í∂åÌïú ÏûàÏùå - Ïπ¥Îìú ÌëúÏãú')
                            }
                        }
                        
                        // sms Í∂åÌïú Ï≤¥ÌÅ¨ - SMS Î¨∏Ïûê Î∞úÏÜ° (sms ÎòêÎäî sms_sender Ìò∏ÌôòÏÑ±)
                        const smsSection = document.getElementById('smsSection')
                        if (smsSection) {
                            if (!permissions.sms && !permissions.sms_sender) {
                                smsSection.style.display = 'none'
                                console.log('‚ùå sms Í∂åÌïú ÏóÜÏùå - SMS ÏÑπÏÖò Ïà®ÍπÄ')
                            } else {
                                smsSection.style.display = 'block'
                                console.log('‚úÖ sms Í∂åÌïú ÏûàÏùå - SMS ÏÑπÏÖò ÌëúÏãú')
                            }
                        }
                        
                        // SMS ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÎìúÎ°≠Îã§Ïö¥ÎèÑ sms ÎòêÎäî sms_sender Í∂åÌïúÏúºÎ°ú Ï≤¥ÌÅ¨
                        const smsNavDropdown = document.getElementById('smsNavDropdown')
                        if (smsNavDropdown) {
                            if (!permissions.sms && !permissions.sms_sender) {
                                smsNavDropdown.style.display = 'none'
                                console.log('‚ùå sms Í∂åÌïú ÏóÜÏùå - SMS ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÎìúÎ°≠Îã§Ïö¥ Ïà®ÍπÄ')
                            } else {
                                smsNavDropdown.classList.remove('hidden')
                                console.log('‚úÖ sms Í∂åÌïú ÏûàÏùå - SMS ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÎìúÎ°≠Îã§Ïö¥ ÌëúÏãú')
                            }
                        }
                        
                        // landing_builder Í∂åÌïú Ï≤¥ÌÅ¨ - ÎûúÎî©ÌéòÏù¥ÏßÄ
                        const landingSection = document.getElementById('landingSection')
                        if (landingSection) {
                            if (!permissions.landing_builder) {
                                landingSection.style.display = 'none'
                                console.log('‚ùå landing_builder Í∂åÌïú ÏóÜÏùå - ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÑπÏÖò Ïà®ÍπÄ')
                            } else {
                                landingSection.style.display = 'block'
                                console.log('‚úÖ landing_builder Í∂åÌïú ÏûàÏùå - ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÑπÏÖò ÌëúÏãú')
                            }
                        }
                        
                        // landing_builder ÎèÑÍµ¨ Ïπ¥ÎìúÎèÑ Ïà®ÍπÄ
                        const landingBuilderCard = document.querySelector('a[href="/tools/landing-builder"]')
                        if (landingBuilderCard && landingBuilderCard.closest('.grid')) {
                            // ÎåÄÏãúÎ≥¥Îìú Ïô∏Î∂ÄÏùò landing-builder ÎßÅÌÅ¨Îßå Ï≤¥ÌÅ¨
                            const isInDashboardSection = landingBuilderCard.closest('#landingSection')
                            if (!isInDashboardSection && !permissions.landing_builder) {
                                landingBuilderCard.style.display = 'none'
                                console.log('‚ùå landing_builder Í∂åÌïú ÏóÜÏùå - Ïô∏Î∂Ä Ïπ¥Îìú Ïà®ÍπÄ')
                            }
                        }
                    }
                } catch (err) {
                    console.error('Í∂åÌïú ÌôïÏù∏ Ïã§Ìå®:', err)
                }
            }

            // ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ Î∂àÎü¨Ïò§Í∏∞
            async function loadMyLandingPages() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (user && user.id) {
                    try {
                        const response = await fetch('/api/landing/my-pages?userId=' + user.id)
                        const data = await response.json()
                        
                        const container = document.getElementById('landingPagesList')
                        
                        if (data.success && data.pages && data.pages.length > 0) {
                            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                            const totalPages = data.pages.length
                            const totalViews = data.pages.reduce((sum, page) => sum + (page.view_count || 0), 0)
                            
                            // ÌéòÏù¥ÏßÄ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
                            const pagesCountEl = document.getElementById('landingPagesCount')
                            if (pagesCountEl) pagesCountEl.textContent = totalPages
                            
                            // Ï°∞ÌöåÏàò ÏóÖÎç∞Ïù¥Ìä∏
                            const viewsCountEl = document.getElementById('landingViewsCount')
                            if (viewsCountEl) viewsCountEl.textContent = totalViews.toLocaleString()
                            
                            // ÏµúÍ∑º 4Í∞úÎßå ÌëúÏãú (2x2 Í∑∏Î¶¨Îìú)
                            const recentPages = data.pages.slice(0, 4)
                            container.innerHTML = recentPages.map(page => {
                                const pageUrl = window.location.origin + '/landing/' + page.slug
                                const statusBadge = page.status === 'active' 
                                    ? '<span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">ÌôúÏÑ±</span>'
                                    : '<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">ÎπÑÌôúÏÑ±</span>'
                                
                                return '<div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-lg transition">' +
                                    '<div class="flex justify-between items-start mb-3">' +
                                        '<h3 class="font-bold text-gray-900 text-lg">' + page.title + '</h3>' +
                                        statusBadge +
                                    '</div>' +
                                    '<div class="text-sm text-gray-600 mb-4">' +
                                        '<div class="flex items-center gap-2 mb-2">' +
                                            '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>' +
                                            '<span>Ï°∞ÌöåÏàò: ' + (page.view_count || 0) + 'Ìöå</span>' +
                                        '</div>' +
                                        '<div class="text-xs text-gray-500">' +
                                            'ÏÉùÏÑ±Ïùº: ' + new Date(page.created_at).toLocaleDateString('ko-KR') +
                                        '</div>' +
                                    '</div>' +
                                    '<div class="flex gap-2">' +
                                        '<a href="' + pageUrl + '" target="_blank" class="flex-1 px-3 py-2 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700 transition text-center">' +
                                            'ÎØ∏Î¶¨Î≥¥Í∏∞' +
                                        '</a>' +
                                        '<button onclick="copyUrl(' + "'" + pageUrl + "'" + ')" class="px-3 py-2 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 transition">' +
                                            'üîó' +
                                        '</button>' +
                                    '</div>' +
                                '</div>'
                            }).join('')
                        } else {
                            // ÎûúÎî©ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏùÑ Îïå ÏïàÎÇ¥ Î©îÏãúÏßÄ ÌëúÏãú Î∞è ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
                            const pagesCountEl = document.getElementById('landingPagesCount')
                            if (pagesCountEl) pagesCountEl.textContent = '0'
                            
                            const viewsCountEl = document.getElementById('landingViewsCount')
                            if (viewsCountEl) viewsCountEl.textContent = '0'
                            
                            container.innerHTML = '<div class="col-span-2 text-center py-12 text-gray-500">' +
                                '<p class="mb-4">ÏïÑÏßÅ ÏÉùÏÑ±Ìïú ÎûúÎî©ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§</p>' +
                                '<a href="/tools/landing-builder" class="inline-block px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">' +
                                'Ï≤´ ÎûúÎî©ÌéòÏù¥ÏßÄ ÎßåÎì§Í∏∞' +
                                '</a>' +
                                '</div>'
                        }
                    } catch (err) {
                        console.error('ÎûúÎî©ÌéòÏù¥ÏßÄ Î°úÎìú Ïã§Ìå®:', err)
                        const container = document.getElementById('landingPagesList')
                        if (container) {
                            container.innerHTML = '<div class="col-span-2 text-center py-12 text-red-500">Î°úÎî© Ïã§Ìå®</div>'
                        }
                    }
                }
            }

            // ÎûúÎî©ÌéòÏù¥ÏßÄ Ìè¥Îçî Ïàò Î°úÎìú
            async function loadLandingFolders() {
                const user = JSON.parse(localStorage.getItem('user'))
                if (user && user.id) {
                    try {
                        const response = await fetch('/api/landing/folders?userId=' + user.id)
                        const data = await response.json()
                        
                        if (data.success && data.folders) {
                            const foldersCountEl = document.getElementById('landingFoldersCount')
                            if (foldersCountEl) {
                                foldersCountEl.textContent = data.folders.length
                            }
                        }
                    } catch (err) {
                        console.error('Ìè¥Îçî Ïàò Î°úÎìú Ïã§Ìå®:', err)
                    }
                }
            }

            // URL Î≥µÏÇ¨
            function copyUrl(url) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('URLÏù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! ' + url)
                }).catch(err => {
                    alert('Î≥µÏÇ¨ Ïã§Ìå®: ' + err)
                })
            }

            // 5Ï¥àÎßàÎã§ Ìè¨Ïù∏Ìä∏ ÏûêÎèô Í∞±Ïã†
            setInterval(loadUserPoints, 5000)

            // ÏûÖÍ∏à Ïã†Ï≤≠ Î™®Îã¨ Ïó¥Í∏∞
            function openDepositModal() {
                document.getElementById('depositModal').classList.remove('hidden')
            }

            // ÏûÖÍ∏à Ïã†Ï≤≠ Î™®Îã¨ Îã´Í∏∞
            function closeDepositModal() {
                document.getElementById('depositModal').classList.add('hidden')
            }

            // Í≥ÑÏ¢åÎ≤àÌò∏ Î≥µÏÇ¨
            function copyAccountNumber() {
                const accountNumber = '746-910023-17004'
                navigator.clipboard.writeText(accountNumber).then(() => {
                    alert('Í≥ÑÏ¢åÎ≤àÌò∏Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! ' + accountNumber)
                }).catch(err => {
                    alert('Î≥µÏÇ¨ Ïã§Ìå®: ' + err)
                })
            }

            // ÏûÖÍ∏à Ïã†Ï≤≠
            function calculateTotal() {
                const amountInput = document.getElementById('depositAmount');
                const amount = parseInt(amountInput.value) || 0;
                const vat = Math.round(amount * 0.1);
                const total = amount + vat;
                
                document.getElementById('displayPoints').textContent = amount.toLocaleString() + 'P';
                document.getElementById('displayVAT').textContent = '+' + vat.toLocaleString() + 'Ïõê';
                document.getElementById('displayTotal').textContent = total.toLocaleString() + 'Ïõê';
            }

            async function submitDeposit() {
                const user = JSON.parse(localStorage.getItem('user'))
                const amount = parseInt(document.getElementById('depositAmount').value) || 0
                const vat = Math.round(amount * 0.1)
                const totalAmount = amount + vat
                const bankName = document.getElementById('bankName').value
                const accountNumber = document.getElementById('accountNumber').value
                const depositorName = document.getElementById('depositorName').value
                const message = document.getElementById('depositMessage').value

                if (!amount || amount <= 0) {
                    alert('Ï∂©Ï†ÑÌï† Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.')
                    return
                }

                try {
                    const response = await fetch('/api/deposit/request', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: user.id,
                            userName: user.name,
                            userEmail: user.email,
                            amount: amount, // Ìè¨Ïù∏Ìä∏ Í∏àÏï° (Î∂ÄÍ∞ÄÏÑ∏ Ï†úÏô∏)
                            totalAmount: totalAmount, // Ïã§Ï†ú ÏûÖÍ∏àÏï° (Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®)
                            bankName,
                            accountNumber,
                            depositorName,
                            message: message + ' [Ìè¨Ïù∏Ìä∏: ' + amount.toLocaleString() + 'P + Î∂ÄÍ∞ÄÏÑ∏: ' + vat.toLocaleString() + 'Ïõê = Ï¥ù ' + totalAmount.toLocaleString() + 'Ïõê]'
                        })
                    })

                    const data = await response.json()
                    if (data.success) {
                        alert('ÏûÖÍ∏à Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÏ∂©Ï†Ñ Ìè¨Ïù∏Ìä∏: ' + amount.toLocaleString() + 'P\\nÎ∂ÄÍ∞ÄÏÑ∏ (10%): ' + vat.toLocaleString() + 'Ïõê\\nÏûÖÍ∏àÌïòÏã§ Í∏àÏï°: ' + totalAmount.toLocaleString() + 'Ïõê\\n\\nÍ¥ÄÎ¶¨Ïûê ÌôïÏù∏ ÌõÑ ' + amount.toLocaleString() + 'PÍ∞Ä ÏßÄÍ∏âÎê©ÎãàÎã§.')
                        closeDepositModal()
                        // Ìèº Ï¥àÍ∏∞Ìôî
                        document.getElementById('depositAmount').value = ''
                        document.getElementById('bankName').value = ''
                        document.getElementById('accountNumber').value = ''
                        document.getElementById('depositorName').value = ''
                        document.getElementById('depositMessage').value = ''
                        calculateTotal() // Í∏àÏï° ÌëúÏãú Ï¥àÍ∏∞Ìôî
                    } else {
                        alert('Ïò§Î•ò: ' + data.error)
                    }
                } catch (err) {
                    alert('ÏûÖÍ∏à Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.')
                }
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¶âÏãú Ìè¨Ïù∏Ìä∏ Î°úÎìú
            loadUserPoints()
            
            document.addEventListener('DOMContentLoaded', () => {
                loadUserPoints()
            })
        </script>

        <!-- ÏûÖÍ∏à Ïã†Ï≤≠ Î™®Îã¨ -->
        <div id="depositModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 my-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">üí∞ ÏûÖÍ∏à Ïã†Ï≤≠</h3>
                    <button onclick="closeDepositModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Í≥ÑÏ¢å Ï†ïÎ≥¥ -->
                <div class="bg-gradient-to-r from-blue-500 to-blue-700 rounded-xl p-5 mb-6 text-white">
                    <h4 class="font-bold mb-3 flex items-center gap-2">
                        <i class="fas fa-university"></i>
                        ÏûÖÍ∏à Í≥ÑÏ¢å Ï†ïÎ≥¥
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between items-center">
                            <span class="text-blue-100">ÏùÄÌñâ</span>
                            <span class="font-bold">ÌïòÎÇòÏùÄÌñâ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-100">Í≥ÑÏ¢åÎ≤àÌò∏</span>
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-lg">746-910023-17004</span>
                                <button onclick="copyAccountNumber()" class="bg-white text-blue-600 px-3 py-1 rounded text-xs font-bold hover:bg-blue-50 transition">
                                    Î≥µÏÇ¨
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-100">ÏòàÍ∏àÏ£º</span>
                            <span class="font-bold">Ï£ºÏãùÌöåÏÇ¨ Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ï∂©Ï†ÑÌï† Ìè¨Ïù∏Ìä∏ *</label>
                        <input type="number" id="depositAmount" placeholder="10000" 
                               onkeyup="calculateTotal()" onchange="calculateTotal()"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">ÏûÖÎ†•Ìïú Í∏àÏï°ÎßåÌÅº Ìè¨Ïù∏Ìä∏Í∞Ä Ï∂©Ï†ÑÎê©ÎãàÎã§</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Ï∂©Ï†Ñ Ìè¨Ïù∏Ìä∏</span>
                            <span class="text-lg font-semibold text-gray-900" id="displayPoints">0P</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Î∂ÄÍ∞ÄÏÑ∏ (10%)</span>
                            <span class="text-lg font-semibold text-gray-900" id="displayVAT">+0Ïõê</span>
                        </div>
                        <div class="border-t border-blue-300 pt-2 mt-2">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-900">ÏµúÏ¢Ö ÏûÖÍ∏àÏï°</span>
                                <span class="text-xl font-bold text-blue-600" id="displayTotal">0Ïõê</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÏùÄÌñâÎ™Ö</label>
                        <input type="text" id="bankName" placeholder="Íµ≠ÎØºÏùÄÌñâ" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Í≥ÑÏ¢åÎ≤àÌò∏</label>
                        <input type="text" id="accountNumber" placeholder="123-45-678901" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÏûÖÍ∏àÏûêÎ™Ö</label>
                        <input type="text" id="depositorName" placeholder="ÌôçÍ∏∏Îèô" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î©îÎ™®</label>
                        <textarea id="depositMessage" rows="3" placeholder="Ï∂îÍ∞Ä Î©îÏãúÏßÄ (ÏÑ†ÌÉùÏÇ¨Ìï≠)" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button onclick="closeDepositModal()" 
                                class="flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium">
                            Ï∑®ÏÜå
                        </button>
                        <button onclick="submitDeposit()" 
                                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            Ïã†Ï≤≠ÌïòÍ∏∞
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// SMS Î∞úÏÜ° ÌéòÏù¥ÏßÄ
app.get('/tools/sms-sender', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏûêÎèô Î¨∏Ïûê Î∞úÏÜ° - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <span class="text-xl font-bold text-gray-900">ÏûêÎèô Î¨∏Ïûê Î∞úÏÜ°</span>
                    <div class="flex gap-4">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <button onclick="logout()" class="text-gray-600 hover:text-red-600">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-4xl font-bold text-gray-900 mb-3">üì± ÏûêÎèô Î¨∏Ïûê Î∞úÏÜ° ÏãúÏä§ÌÖú</h1>
                    <p class="text-lg text-gray-600">ÌÖúÌîåÎ¶øÏùÑ ÏÑ†ÌÉùÌïòÍ≥† ÌïôÎ∂ÄÎ™®ÎãòÍªò Î¨∏ÏûêÎ•º Î∞úÏÜ°ÌïòÏÑ∏Ïöî</p>
                </div>

                <!-- ÌÜµÍ≥Ñ -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="text-sm text-gray-600 mb-2">Ïò§Îäò Î∞úÏÜ°</div>
                        <div class="text-3xl font-bold text-gray-900" id="statToday">0</div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="text-sm text-gray-600 mb-2">Ïù¥Î≤à Îã¨ Î∞úÏÜ°</div>
                        <div class="text-3xl font-bold text-gray-900" id="statMonth">0</div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="text-sm text-gray-600 mb-2">ÎåÄÍ∏∞Ï§ë</div>
                        <div class="text-3xl font-bold text-orange-600" id="statPending">0</div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Î¨∏Ïûê Î∞úÏÜ° Ìèº -->
                    <div class="bg-white rounded-xl p-8 border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Î¨∏Ïûê Î∞úÏÜ°</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù</label>
                                <select id="templateSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl" onchange="loadTemplate()">
                                    <option value="">ÌÖúÌîåÎ¶øÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏàòÏã†Ïûê Ïù¥Î¶Ñ</label>
                                <input type="text" id="recipientName" placeholder="ÌôçÍ∏∏Îèô" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏàòÏã†Ïûê Ï†ÑÌôîÎ≤àÌò∏</label>
                                <input type="tel" id="recipientPhone" placeholder="01012345678" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Î©îÏãúÏßÄ ÎÇ¥Ïö©</label>
                                <textarea id="messageContent" rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                                <div class="text-sm text-gray-500 mt-2">
                                    <span id="charCount">0</span>/90Ïûê (ÌïúÍ∏Ä Í∏∞Ï§Ä)
                                </div>
                            </div>

                            <div class="flex gap-3">
                                <button onclick="sendSMS()" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition">
                                    Ï¶âÏãú Î∞úÏÜ°
                                </button>
                                <button onclick="scheduleSMS()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">
                                    ÏòàÏïΩ Î∞úÏÜ°
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Î∞úÏÜ° Í∏∞Î°ù -->
                    <div class="bg-white rounded-xl p-8 border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏµúÍ∑º Î∞úÏÜ° Í∏∞Î°ù</h2>
                        <div id="historyList" class="space-y-3 max-h-[600px] overflow-y-auto">
                            <div class="text-center text-gray-500 py-8">Î∞úÏÜ° Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
        let templates = [];
        let user = null;

        // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
        const userData = localStorage.getItem('user');
        if (userData) {
            user = JSON.parse(userData);
        } else {
            user = { id: 1, name: 'Í≤åÏä§Ìä∏' };
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        async function init() {
            await loadTemplates();
            await loadStats();
            await loadHistory();
        }

        // ÌÖúÌîåÎ¶ø Î°úÎìú
        async function loadTemplates() {
            try {
                const response = await fetch('/api/sms/templates');
                const data = await response.json();
                if (data.success) {
                    templates = data.templates;
                    const select = document.getElementById('templateSelect');
                    select.innerHTML = '<option value="">ÌÖúÌîåÎ¶øÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                    data.templates.forEach(t => {
                        select.innerHTML += \`<option value="\${t.id}">\${t.name} (\${t.category})</option>\`;
                    });
                }
            } catch (err) {
                console.error('ÌÖúÌîåÎ¶ø Î°úÎìú Ïò§Î•ò:', err);
            }
        }

        // ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù Ïãú
        function loadTemplate() {
            const templateId = document.getElementById('templateSelect').value;
            if (!templateId) return;
            
            const template = templates.find(t => t.id == templateId);
            if (template) {
                document.getElementById('messageContent').value = template.content;
                updateCharCount();
            }
        }

        // Í∏ÄÏûê Ïàò Ïπ¥Ïö¥Ìä∏
        document.getElementById('messageContent').addEventListener('input', updateCharCount);
        function updateCharCount() {
            const text = document.getElementById('messageContent').value;
            document.getElementById('charCount').textContent = text.length;
        }

        // ÌÜµÍ≥Ñ Î°úÎìú
        async function loadStats() {
            try {
                const response = await fetch('/api/sms/stats');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('statToday').textContent = data.stats.today;
                    document.getElementById('statMonth').textContent = data.stats.thisMonth;
                    const pending = data.stats.byStatus.find(s => s.status === 'pending' || s.status === 'scheduled');
                    document.getElementById('statPending').textContent = pending?.count || 0;
                }
            } catch (err) {
                console.error('ÌÜµÍ≥Ñ Î°úÎìú Ïò§Î•ò:', err);
            }
        }

        // Î∞úÏÜ° Í∏∞Î°ù Î°úÎìú
        async function loadHistory() {
            try {
                const response = await fetch('/api/sms/history');
                const data = await response.json();
                if (data.success && data.history.length > 0) {
                    const list = document.getElementById('historyList');
                    list.innerHTML = data.history.slice(0, 10).map(h => \`
                        <div class="p-4 border border-gray-200 rounded-lg">
                            <div class="flex justify-between items-start mb-2">
                                <div class="font-medium text-gray-900">\${h.recipient_name || 'Ïù¥Î¶ÑÏóÜÏùå'}</div>
                                <span class="px-2 py-1 text-xs rounded \${h.status === 'sent' ? 'bg-green-100 text-green-700' : h.status === 'scheduled' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'}">\${h.status}</span>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">\${h.recipient_phone}</div>
                            <div class="text-sm text-gray-800 line-clamp-2">\${h.message_content}</div>
                            <div class="text-xs text-gray-500 mt-2">\${new Date(h.created_at).toLocaleString('ko-KR')}</div>
                        </div>
                    \`).join('');
                }
            } catch (err) {
                console.error('Í∏∞Î°ù Î°úÎìú Ïò§Î•ò:', err);
            }
        }

        // Ï¶âÏãú Î∞úÏÜ°
        async function sendSMS() {
            const name = document.getElementById('recipientName').value.trim();
            const phone = document.getElementById('recipientPhone').value.trim();
            const message = document.getElementById('messageContent').value.trim();
            const templateId = document.getElementById('templateSelect').value;

            if (!phone) {
                alert('ÏàòÏã†Ïûê Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }
            if (!message) {
                alert('Î©îÏãúÏßÄ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            try {
                const userDataStr = JSON.stringify(user);
                const userDataBase64 = btoa(unescape(encodeURIComponent(userDataStr)));

                const response = await fetch('/api/sms/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Data-Base64': userDataBase64
                    },
                    body: JSON.stringify({
                        recipient_phone: phone,
                        recipient_name: name,
                        message_content: message,
                        template_id: templateId || null
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Î¨∏ÏûêÍ∞Ä Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§!\\n' + (data.note || ''));
                    document.getElementById('recipientName').value = '';
                    document.getElementById('recipientPhone').value = '';
                    document.getElementById('messageContent').value = '';
                    document.getElementById('templateSelect').value = '';
                    await loadStats();
                    await loadHistory();
                } else {
                    alert('Î∞úÏÜ° Ïã§Ìå®: ' + data.error);
                }
            } catch (err) {
                console.error('Î∞úÏÜ° Ïò§Î•ò:', err);
                alert('Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
            }
        }

        // ÏòàÏïΩ Î∞úÏÜ°
        function scheduleSMS() {
            const scheduledTime = prompt('Î∞úÏÜ° ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (YYYY-MM-DD HH:MM ÌòïÏãù)\\nÏòà: 2024-12-20 14:00');
            if (!scheduledTime) return;

            alert('ÏòàÏïΩ Î∞úÏÜ° Í∏∞Îä•ÏùÄ Ï§ÄÎπÑÏ§ëÏûÖÎãàÎã§');
        }

        init();
        </script>
    </body>
    </html>
  `)
})

// ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏãúÏä§ÌÖú ÌéòÏù¥ÏßÄ
app.get('/tools/parent-message', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏãúÏä§ÌÖú - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
          }
          @keyframes spin {
            to { transform: rotate(360deg); }
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100 shadow-sm">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</span>
                    </a>
                    <div class="flex items-center space-x-6">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/tools/parent-message" class="text-purple-600 font-medium">ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ</a>
                        <a href="/tools/blog-writer" class="text-gray-600 hover:text-purple-600">Î∏îÎ°úÍ∑∏ ÏûëÏÑ±</a>
                        <a href="/logout" class="text-gray-600 hover:text-purple-600">Î°úÍ∑∏ÏïÑÏõÉ</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="pt-24 pb-12 px-6">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">üì± ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ ÏãúÏä§ÌÖú</h1>
                    <p class="text-xl text-gray-600">Í∞ÑÎã®Ìïú Î©îÎ™®Îßå ÏûëÏÑ±ÌïòÎ©¥ AIÍ∞Ä Îî∞ÎúªÌïú Î©îÏãúÏßÄÎ°ú Î≥ÄÌôòÌï¥ÎìúÎ¶ΩÎãàÎã§</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- ÏûÖÎ†• Ìèº -->
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">ÌïôÏÉù Ï†ïÎ≥¥ ÏûÖÎ†•</h2>
                        
                        <form id="messageForm" class="space-y-6">
                            <!-- Í∏∞Í∞Ñ ÏÑ†ÌÉù -->
                            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-4">
                                <div class="text-sm font-medium text-blue-900 mb-3">üìÖ Ï°∞Ìöå Í∏∞Í∞Ñ ÏÑ§Ï†ï</div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-blue-800 mb-1">ÏãúÏûëÏùº</label>
                                        <input type="date" id="startDate" required
                                               class="w-full px-3 py-2 border border-blue-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-blue-800 mb-1">Ï¢ÖÎ£åÏùº</label>
                                        <input type="date" id="endDate" required
                                               class="w-full px-3 py-2 border border-blue-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none">
                                    </div>
                                </div>
                                <div class="mt-3 flex gap-2">
                                    <button type="button" onclick="setDateRange(7)" class="flex-1 px-3 py-1 text-xs bg-white border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50">ÏµúÍ∑º 7Ïùº</button>
                                    <button type="button" onclick="setDateRange(30)" class="flex-1 px-3 py-1 text-xs bg-white border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50">ÏµúÍ∑º 30Ïùº</button>
                                    <button type="button" onclick="setDateRange(90)" class="flex-1 px-3 py-1 text-xs bg-white border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50">ÏµúÍ∑º 90Ïùº</button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏÉù ÏÑ†ÌÉù *</label>
                                <select id="studentSelect" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                                        onchange="loadStudentRecords()">
                                    <option value="">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                </select>
                                <p class="text-sm text-gray-500 mt-2">üí° ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏÑ§Ï†ïÌïú Í∏∞Í∞ÑÏùò ÌïôÏäµ Í∏∞Î°ùÏùÑ ÏûêÎèôÏúºÎ°ú Î∂àÎü¨ÏòµÎãàÎã§</p>
                            </div>

                            <div id="studentInfoDisplay" class="hidden bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                                <div class="text-sm font-medium text-blue-900 mb-2">üìä ÌïôÏÉù Ï†ïÎ≥¥</div>
                                <div id="studentDetails" class="text-sm text-blue-800"></div>
                            </div>

                            <div id="periodSummaryDisplay" class="hidden bg-purple-50 border-l-4 border-purple-500 rounded-lg p-4">
                                <div class="text-sm font-medium text-purple-900 mb-2">üìà ÏÑ†ÌÉù Í∏∞Í∞Ñ ÌÜµÍ≥Ñ</div>
                                <div id="periodSummary" class="text-sm text-purple-800"></div>
                            </div>

                            <div id="recentRecordsDisplay" class="hidden">
                                <label class="block text-sm font-medium text-gray-900 mb-2">
                                    ÏÑ†ÌÉù Í∏∞Í∞Ñ ÌïôÏäµ Í∏∞Î°ù (<span id="recordCount">0</span>Í±¥)
                                </label>
                                <div id="recordsList" class="space-y-2 max-h-60 overflow-y-auto bg-gray-50 rounded-lg p-4"></div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï∂îÍ∞Ä Î©îÎ™® (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                                <textarea id="shortMessage" rows="3"
                                          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none resize-none"
                                          placeholder="Ïòà: Ïù¥Î≤à Îã¨ ÌäπÎ≥ÑÌûà Ïπ≠Ï∞¨ÌïòÍ≥† Ïã∂ÏùÄ Ï†êÏù¥ÎÇò ÌïôÎ∂ÄÎ™®ÎãòÍªò Ï∂îÍ∞ÄÎ°ú Ï†ÑÎã¨Ìï† ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî"></textarea>
                                <p class="text-sm text-gray-500 mt-2">üí° ÌïôÏÉùÏùò ÏÑ†ÌÉù Í∏∞Í∞Ñ Í∏∞Î°ùÏùÑ Î∞îÌÉïÏúºÎ°ú Î©îÏãúÏßÄÍ∞Ä ÏÉùÏÑ±Îê©ÎãàÎã§. Ï∂îÍ∞ÄÎ°ú Ï†ÑÎã¨Ìï† ÎÇ¥Ïö©Ïù¥ ÏûàÏúºÎ©¥ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
                            </div>

                            <button type="submit" 
                                    class="w-full gradient-purple text-white py-4 rounded-xl text-lg font-medium hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                    id="generateBtn"
                                    disabled>
                                <span id="btnText">‚ú® AI Î©îÏãúÏßÄ ÏÉùÏÑ±ÌïòÍ∏∞</span>
                                <span id="btnLoading" class="hidden items-center justify-center">
                                    <span class="loading mr-2"></span>
                                    ÏÉùÏÑ± Ï§ë...
                                </span>
                            </button>
                        </form>
                    </div>

                    <!-- ÏÉùÏÑ±Îêú Î©îÏãúÏßÄ -->
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏÉùÏÑ±Îêú Î©îÏãúÏßÄ</h2>
                        
                        <div id="resultArea" class="hidden">
                            <div class="bg-purple-50 border-l-4 border-purple-600 rounded-lg p-6 mb-6">
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white flex-shrink-0">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold text-gray-900 mb-1" id="studentInfo"></div>
                                        <div class="text-sm text-gray-600" id="subjectInfo"></div>
                                    </div>
                                </div>
                                
                                <div id="generatedMessage" class="text-gray-800 leading-relaxed whitespace-pre-wrap"></div>
                            </div>

                            <div class="flex gap-3">
                                <button onclick="copyMessage()" 
                                        class="flex-1 bg-purple-600 text-white py-3 rounded-xl font-medium hover:bg-purple-700 transition">
                                    üìã Î≥µÏÇ¨ÌïòÍ∏∞
                                </button>
                                <button onclick="resetForm()" 
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-300 transition">
                                    üîÑ ÏÉàÎ°ú ÏûëÏÑ±
                                </button>
                            </div>
                        </div>

                        <div id="emptyState" class="text-center py-16">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                </svg>
                            </div>
                            <p class="text-gray-500">ÏôºÏ™Ω ÌèºÏùÑ ÏûëÏÑ±ÌïòÍ≥†<br>Î©îÏãúÏßÄÎ•º ÏÉùÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>

                <!-- ÏÇ¨Ïö© Í∞ÄÏù¥Îìú -->
                <div class="mt-12 bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">üí° ÏÇ¨Ïö© Í∞ÄÏù¥Îìú</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">1Ô∏è‚É£</div>
                            <h4 class="font-bold text-gray-900 mb-2">Í∏∞Í∞Ñ Î∞è ÌïôÏÉù ÏÑ†ÌÉù</h4>
                            <p class="text-sm text-gray-600">Ï°∞ÌöåÌï† Í∏∞Í∞ÑÏùÑ ÏÑ§Ï†ïÌïòÍ≥† (ÏµúÍ∑º 7Ïùº/30Ïùº/90Ïùº ÎòêÎäî ÏßÅÏ†ë ÏÑ†ÌÉù) ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                        </div>
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">2Ô∏è‚É£</div>
                            <h4 class="font-bold text-gray-900 mb-2">AIÍ∞Ä ÏûêÎèô Î∂ÑÏÑù</h4>
                            <p class="text-sm text-gray-600">ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏùò Ï∂úÏÑùÎ•†, Í≥ºÏ†ú ÏôÑÏÑ±Î•†, Ïù¥Ìï¥ÎèÑ, Ï∞∏Ïó¨ÎèÑ Îì±ÏùÑ ÏûêÎèôÏúºÎ°ú Î∂ÑÏÑùÌïòÍ≥† AIÍ∞Ä Îî∞ÎúªÌïú Î©îÏãúÏßÄÎ°ú Î≥ÄÌôòÌï©ÎãàÎã§</p>
                        </div>
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">3Ô∏è‚É£</div>
                            <h4 class="font-bold text-gray-900 mb-2">Î≥µÏÇ¨Ìï¥ÏÑú Ï†ÑÏÜ°</h4>
                            <p class="text-sm text-gray-600">ÏÉùÏÑ±Îêú Î©îÏãúÏßÄÎ•º Î≥µÏÇ¨Ìï¥ÏÑú Ïπ¥ÌÜ°Ïù¥ÎÇò Î¨∏ÏûêÎ°ú ÌïôÎ∂ÄÎ™®ÎãòÍªò Ï†ÑÏÜ°ÌïòÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let generatedMessageText = '';
            let currentStudent = null;
            let recentRecords = [];
            let currentUser = null;

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÇ¨Ïö©Ïûê ÌôïÏù∏ Î∞è Ï¥àÍ∏∞Ìôî
            function initPage() {
                const userData = localStorage.getItem('user');
                if (userData) {
                    currentUser = JSON.parse(userData);
                } else {
                    // Í≤åÏä§Ìä∏ Î™®Îìú (ÌÖåÏä§Ìä∏Ïö©)
                    currentUser = { id: 1, name: 'Í≤åÏä§Ìä∏', academy_id: 1 };
                }
                
                // Í∏∞Î≥∏ Í∏∞Í∞Ñ ÏÑ§Ï†ï (ÏµúÍ∑º 30Ïùº)
                setDateRange(30);
                
                // ÌïôÏÉù Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
                loadStudents();
            }

            // Í∏∞Í∞Ñ ÏÑ§Ï†ï Ìï®Ïàò (ÌïúÍµ≠ ÏãúÍ∞ÑÎåÄ KST Í∏∞Ï§Ä)
            function setDateRange(days) {
                // ÌïúÍµ≠ ÏãúÍ∞ÑÎåÄ(KST, UTC+9) ÌòÑÏû¨ ÎÇ†Ïßú
                const now = new Date();
                const kstOffset = 9 * 60; // 9ÏãúÍ∞ÑÏùÑ Î∂ÑÏúºÎ°ú Î≥ÄÌôò
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                const kstTime = new Date(utc + (kstOffset * 60000));
                
                // Ï¢ÖÎ£åÏùº: Ïò§Îäò (ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§Ä)
                const endDate = new Date(kstTime.getFullYear(), kstTime.getMonth(), kstTime.getDate());
                
                // ÏãúÏûëÏùº: Ïò§ÎäòÎ°úÎ∂ÄÌÑ∞ NÏùº Ï†Ñ (ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§Ä)
                const startDate = new Date(kstTime.getFullYear(), kstTime.getMonth(), kstTime.getDate());
                startDate.setDate(startDate.getDate() - (days - 1)); // NÏùºÍ∞Ñ = Ïò§Îäò Ìè¨Ìï® NÏùº
                
                // YYYY-MM-DD ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
                const formatDate = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return year + '-' + month + '-' + day;
                };
                
                document.getElementById('startDate').value = formatDate(startDate);
                document.getElementById('endDate').value = formatDate(endDate);
                
                console.log('Í∏∞Í∞Ñ ÏÑ§Ï†ï: ' + formatDate(startDate) + ' ~ ' + formatDate(endDate) + ' (ÏµúÍ∑º ' + days + 'Ïùº, ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§Ä)');
                
                // ÌïôÏÉùÏù¥ Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêòÏñ¥ ÏûàÏúºÎ©¥ Í∏∞Î°ù Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞
                if (currentStudent) {
                    loadStudentRecords();
                }
            }

            // ÏÇ¨Ïö©ÏûêÏùò ÌïôÏÉù Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
            async function loadStudents() {
                try {
                    const academyId = currentUser.academy_id || 1;
                    const response = await fetch('/api/students?academyId=' + academyId);
                    const data = await response.json();
                    
                    if (data.success) {
                        const select = document.getElementById('studentSelect');
                        select.innerHTML = '<option value="">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                        
                        data.students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.id;
                            option.textContent = student.name + ' (' + student.grade + ', ' + (student.class_name || 'ÎØ∏Î∞∞Ï†ï') + ')';
                            option.dataset.student = JSON.stringify(student);
                            select.appendChild(option);
                        });
                    }
                } catch (err) {
                    console.error('Error loading students:', err);
                    alert('ÌïôÏÉù Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            }

            // ÌïôÏÉù ÏÑ†ÌÉù Ïãú Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
            async function loadStudentRecords() {
                const select = document.getElementById('studentSelect');
                const selectedOption = select.options[select.selectedIndex];
                
                if (!selectedOption.value) {
                    document.getElementById('studentInfoDisplay').classList.add('hidden');
                    document.getElementById('periodSummaryDisplay').classList.add('hidden');
                    document.getElementById('recentRecordsDisplay').classList.add('hidden');
                    document.getElementById('generateBtn').disabled = true;
                    return;
                }

                currentStudent = JSON.parse(selectedOption.dataset.student);
                
                // Í∏∞Í∞Ñ ÌôïÏù∏
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (!startDate || !endDate) {
                    alert('Ï°∞Ìöå Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                // ÌïôÏÉù Ï†ïÎ≥¥ ÌëúÏãú
                document.getElementById('studentDetails').innerHTML = 
                    '<div><strong>Ïù¥Î¶Ñ:</strong> ' + currentStudent.name + '</div>' +
                    '<div><strong>ÌïôÎÖÑ:</strong> ' + currentStudent.grade + '</div>' +
                    '<div><strong>Í≥ºÎ™©:</strong> ' + currentStudent.subjects + '</div>' +
                    '<div><strong>ÌïôÎ∂ÄÎ™®:</strong> ' + currentStudent.parent_name + ' (' + currentStudent.parent_phone + ')</div>';
                document.getElementById('studentInfoDisplay').classList.remove('hidden');

                // ÏÑ†ÌÉù Í∏∞Í∞Ñ Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
                try {
                    const response = await fetch('/api/daily-records?studentId=' + currentStudent.id + '&startDate=' + startDate + '&endDate=' + endDate);
                    const data = await response.json();
                    
                    if (data.success) {
                        recentRecords = data.records || [];
                        displayRecords();
                        displayPeriodSummary();
                        document.getElementById('generateBtn').disabled = false;
                    }
                } catch (err) {
                    console.error('Error loading records:', err);
                    alert('ÌïôÏäµ Í∏∞Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    document.getElementById('generateBtn').disabled = false;
                }
            }

            // Í∏∞Í∞Ñ ÌÜµÍ≥Ñ ÌëúÏãú
            function displayPeriodSummary() {
                if (recentRecords.length === 0) {
                    document.getElementById('periodSummaryDisplay').classList.add('hidden');
                    return;
                }

                const totalDays = recentRecords.length;
                const attendanceCount = recentRecords.filter(r => r.attendance === 'Ï∂úÏÑù').length;
                const homeworkCompleted = recentRecords.filter(r => r.homework_status === 'ÏôÑÎ£å').length;
                
                const understandingScores = recentRecords.filter(r => r.understanding_level).map(r => r.understanding_level);
                const participationScores = recentRecords.filter(r => r.participation_level).map(r => r.participation_level);
                
                const avgUnderstanding = understandingScores.length > 0 
                    ? (understandingScores.reduce((a, b) => a + b, 0) / understandingScores.length).toFixed(1)
                    : 0;
                
                const avgParticipation = participationScores.length > 0
                    ? (participationScores.reduce((a, b) => a + b, 0) / participationScores.length).toFixed(1)
                    : 0;

                const attendanceRate = ((attendanceCount / totalDays) * 100).toFixed(0);
                const homeworkRate = totalDays > 0 ? ((homeworkCompleted / totalDays) * 100).toFixed(0) : 0;

                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const daysDiff = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;

                document.getElementById('periodSummary').innerHTML = 
                    '<div class="grid grid-cols-2 gap-2">' +
                        '<div><strong>Ï°∞Ìöå Í∏∞Í∞Ñ:</strong> ' + daysDiff + 'Ïùº</div>' +
                        '<div><strong>ÏàòÏóÖ ÏùºÏàò:</strong> ' + totalDays + 'Ïùº</div>' +
                        '<div><strong>Ï∂úÏÑùÎ•†:</strong> ' + attendanceRate + '%</div>' +
                        '<div><strong>Í≥ºÏ†ú ÏôÑÏÑ±Î•†:</strong> ' + homeworkRate + '%</div>' +
                        '<div><strong>ÌèâÍ∑† Ïù¥Ìï¥ÎèÑ:</strong> ' + avgUnderstanding + '/5Ï†ê</div>' +
                        '<div><strong>ÌèâÍ∑† Ï∞∏Ïó¨ÎèÑ:</strong> ' + avgParticipation + '/5Ï†ê</div>' +
                    '</div>';

                document.getElementById('periodSummaryDisplay').classList.remove('hidden');
            }

            // Í∏∞Î°ù ÌëúÏãú
            function displayRecords() {
                const recordsList = document.getElementById('recordsList');
                document.getElementById('recordCount').textContent = recentRecords.length;
                
                if (recentRecords.length === 0) {
                    recordsList.innerHTML = '<p class="text-gray-500 text-sm">ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
                    document.getElementById('recentRecordsDisplay').classList.remove('hidden');
                    return;
                }

                recordsList.innerHTML = recentRecords.map(record => {
                    let attendanceClass = 'bg-gray-100 text-gray-800';
                    if (record.attendance === 'Ï∂úÏÑù') attendanceClass = 'bg-green-100 text-green-800';
                    else if (record.attendance === 'ÏßÄÍ∞Å') attendanceClass = 'bg-yellow-100 text-yellow-800';
                    else if (record.attendance === 'Í≤∞ÏÑù') attendanceClass = 'bg-red-100 text-red-800';
                    
                    let html = '<div class="bg-white border border-gray-200 rounded-lg p-3 text-sm">';
                    html += '<div class="flex justify-between items-start mb-2">';
                    html += '<span class="font-medium text-gray-900">' + record.record_date + '</span>';
                    html += '<span class="text-xs px-2 py-1 rounded-full ' + attendanceClass + '">' + (record.attendance || '-') + '</span>';
                    html += '</div>';
                    html += '<div class="space-y-1 text-gray-600">';
                    if (record.homework_status) html += '<div>üìù Í≥ºÏ†ú: ' + record.homework_status + '</div>';
                    if (record.understanding_level) html += '<div>üí° Ïù¥Ìï¥ÎèÑ: ' + record.understanding_level + '/5</div>';
                    if (record.participation_level) html += '<div>üôã Ï∞∏Ïó¨ÎèÑ: ' + record.participation_level + '/5</div>';
                    if (record.achievement) html += '<div>üéØ ÏÑ±Í≥º: ' + record.achievement + '</div>';
                    if (record.memo) html += '<div class="text-gray-500">üìå ' + record.memo + '</div>';
                    html += '</div></div>';
                    return html;
                }).join('');

                document.getElementById('recentRecordsDisplay').classList.remove('hidden');
            }

            document.getElementById('messageForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!currentStudent) {
                    alert('ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const additionalMessage = document.getElementById('shortMessage').value;

                // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉú
                const btn = document.getElementById('generateBtn');
                const btnText = document.getElementById('btnText');
                const btnLoading = document.getElementById('btnLoading');
                
                btn.disabled = true;
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
                btnLoading.classList.add('flex');

                try {
                    const response = await fetch('/api/generate-parent-message-from-records', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            studentId: currentStudent.id,
                            studentName: currentStudent.name,
                            grade: currentStudent.grade,
                            subjects: currentStudent.subjects,
                            parentName: currentStudent.parent_name,
                            records: recentRecords,
                            additionalMessage,
                            startDate,
                            endDate
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        generatedMessageText = data.message;
                        
                        // Í≤∞Í≥º ÌëúÏãú
                        const daysDiff = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
                        document.getElementById('studentInfo').textContent = currentStudent.name + ' ÌïôÏÉù';
                        document.getElementById('subjectInfo').textContent = currentStudent.grade + ' ¬∑ ' + currentStudent.subjects + ' ¬∑ ' + daysDiff + 'ÏùºÍ∞Ñ (' + recentRecords.length + 'Í∞ú Í∏∞Î°ù)';
                        document.getElementById('generatedMessage').textContent = data.message;
                        
                        document.getElementById('emptyState').classList.add('hidden');
                        document.getElementById('resultArea').classList.remove('hidden');
                    } else {
                        alert('Ïò§Î•ò: ' + data.error);
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Î©îÏãúÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                } finally {
                    btn.disabled = false;
                    btnText.classList.remove('hidden');
                    btnLoading.classList.add('hidden');
                }
            });

            function copyMessage() {
                navigator.clipboard.writeText(generatedMessageText).then(() => {
                    alert('‚úÖ Î©îÏãúÏßÄÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\\n\\nÏπ¥ÌÜ°Ïù¥ÎÇò Î¨∏ÏûêÎ°ú ÌïôÎ∂ÄÎ™®ÎãòÍªò Ï†ÑÏÜ°ÌïòÏÑ∏Ïöî.');
                });
            }

            function resetForm() {
                document.getElementById('messageForm').reset();
                document.getElementById('studentInfoDisplay').classList.add('hidden');
                document.getElementById('periodSummaryDisplay').classList.add('hidden');
                document.getElementById('recentRecordsDisplay').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('resultArea').classList.add('hidden');
                document.getElementById('generateBtn').disabled = true;
                currentStudent = null;
                recentRecords = [];
                generatedMessageText = '';
                // Í∏∞Î≥∏ Í∏∞Í∞Ñ Ïû¨ÏÑ§Ï†ï
                setDateRange(30);
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
            window.addEventListener('DOMContentLoaded', function() {
                initPage();
            });
        </script>
    </body>
    </html>
  `)
})

// Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÎèÑÍµ¨ ÌéòÏù¥ÏßÄ
app.get('/tools/blog-writer', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÎèÑÍµ¨ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
          .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
          }
          @keyframes spin {
            to { transform: rotate(360deg); }
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100 shadow-sm">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</span>
                    </a>
                    <div class="flex items-center space-x-6">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/tools/parent-message" class="text-gray-600 hover:text-purple-600">ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ</a>
                        <a href="/tools/blog-writer" class="text-purple-600 font-medium">Î∏îÎ°úÍ∑∏ ÏûëÏÑ±</a>
                        <a href="/logout" class="text-gray-600 hover:text-purple-600">Î°úÍ∑∏ÏïÑÏõÉ</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="pt-24 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">‚úçÔ∏è AI Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÎèÑÍµ¨</h1>
                    <p class="text-xl text-gray-600">Ï£ºÏ†úÎßå ÏûÖÎ†•ÌïòÎ©¥ SEO ÏµúÏ†ÅÌôîÎêú Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§</p>
                </div>

                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- ÏûÖÎ†• Ìèº -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-2xl shadow-lg p-8 sticky top-24">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6">Í∏Ä Ï†ïÎ≥¥ ÏûÖÎ†•</h2>
                            
                            <form id="blogForm" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-900 mb-2">Ï£ºÏ†ú *</label>
                                    <input type="text" id="topic" required 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                                           placeholder="Ïòà: Ï¥àÎì± ÏòÅÏñ¥ ÌïôÏäµÎ≤ï">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-900 mb-2">ÌÇ§ÏõåÎìú (ÏÑ†ÌÉù)</label>
                                    <input type="text" id="keywords"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                                           placeholder="Ïòà: ÏòÅÏñ¥ÌïôÏõê, Ï¥àÎì±ÏòÅÏñ¥">
                                    <p class="text-xs text-gray-500 mt-1">ÏâºÌëúÎ°ú Íµ¨Î∂Ñ</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-900 mb-2">ÌÜ§ Ïï§ Îß§ÎÑà</label>
                                    <select id="tone"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none">
                                        <option value="ÏπúÍ∑ºÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏù∏">ÏπúÍ∑ºÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏù∏</option>
                                        <option value="Îî∞ÎúªÌïòÍ≥† Í≥µÍ∞êÌïòÎäî">Îî∞ÎúªÌïòÍ≥† Í≥µÍ∞êÌïòÎäî</option>
                                        <option value="Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† Ïã†Î¢∞Í∞ê ÏûàÎäî">Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† Ïã†Î¢∞Í∞ê ÏûàÎäî</option>
                                        <option value="Ïú†Î®∏Îü¨Ïä§ÌïòÍ≥† Ïû¨ÎØ∏ÏûàÎäî">Ïú†Î®∏Îü¨Ïä§ÌïòÍ≥† Ïû¨ÎØ∏ÏûàÎäî</option>
                                    </select>
                                </div>

                                <button type="submit" 
                                        class="w-full gradient-purple text-white py-4 rounded-xl text-lg font-medium hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                        id="generateBtn">
                                    <span id="btnText">‚ú® Î∏îÎ°úÍ∑∏ Í∏Ä ÏÉùÏÑ±ÌïòÍ∏∞</span>
                                    <span id="btnLoading" class="hidden items-center justify-center">
                                        <span class="loading mr-2"></span>
                                        ÏÉùÏÑ± Ï§ë... (30Ï¥à ÏÜåÏöî)
                                    </span>
                                </button>

                                <div class="bg-blue-50 rounded-xl p-4 text-sm text-blue-800">
                                    üí° AIÍ∞Ä Ï†úÎ™©, ÏÑúÎ°†, Î≥∏Î°†, Í≤∞Î°†ÏùÑ Ìè¨Ìï®Ìïú ÏôÑÏÑ±Îêú Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏûëÏÑ±Ìï©ÎãàÎã§
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ÏÉùÏÑ±Îêú Î∏îÎ°úÍ∑∏ Í∏Ä -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl shadow-lg p-8 min-h-[600px]">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">ÏÉùÏÑ±Îêú Î∏îÎ°úÍ∑∏ Í∏Ä</h2>
                                <div id="wordCount" class="hidden text-sm text-gray-500"></div>
                            </div>
                            
                            <div id="resultArea" class="hidden">
                                <div id="generatedBlog" class="prose max-w-none">
                                    <!-- ÏÉùÏÑ±Îêú Î∏îÎ°úÍ∑∏ ÎÇ¥Ïö© -->
                                </div>

                                <div class="mt-8 flex gap-3">
                                    <button onclick="copyBlog()" 
                                            class="flex-1 bg-purple-600 text-white py-3 rounded-xl font-medium hover:bg-purple-700 transition">
                                        üìã Ï†ÑÏ≤¥ Î≥µÏÇ¨ÌïòÍ∏∞
                                    </button>
                                    <button onclick="resetForm()" 
                                            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium hover:bg-gray-300 transition">
                                        üîÑ ÏÉàÎ°ú ÏûëÏÑ±
                                    </button>
                                </div>
                            </div>

                            <div id="emptyState" class="text-center py-24">
                                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </div>
                                <p class="text-gray-500 text-lg">Ï£ºÏ†úÎ•º ÏûÖÎ†•ÌïòÍ≥†<br>Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÌåÅ -->
                <div class="mt-12 bg-gradient-to-br from-orange-50 to-yellow-50 rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">üìù Î∏îÎ°úÍ∑∏ SEO ÌåÅ</h3>
                    <div class="grid md:grid-cols-4 gap-6">
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">üéØ</div>
                            <h4 class="font-bold text-gray-900 mb-2">ÌÇ§ÏõåÎìú ÏÑ†ÌÉù</h4>
                            <p class="text-sm text-gray-600">Í≤ÄÏÉâÎüâÏù¥ ÎßéÏùÄ ÌÇ§ÏõåÎìúÎ•º ÏûêÏó∞Ïä§ÎüΩÍ≤å 3-5Ìöå Î∞òÎ≥µ</p>
                        </div>
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">üìè</div>
                            <h4 class="font-bold text-gray-900 mb-2">Ï†ÅÏ†àÌïú Í∏∏Ïù¥</h4>
                            <p class="text-sm text-gray-600">1500-2000ÏûêÍ∞Ä SEOÏóê Í∞ÄÏû• Ìö®Í≥ºÏ†Å</p>
                        </div>
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">üñºÔ∏è</div>
                            <h4 class="font-bold text-gray-900 mb-2">Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä</h4>
                            <p class="text-sm text-gray-600">2-3Ïû•Ïùò Í¥ÄÎ†® Ïù¥ÎØ∏ÏßÄÎ°ú Í∞ÄÎèÖÏÑ± Ìñ•ÏÉÅ</p>
                        </div>
                        <div class="bg-white rounded-xl p-6">
                            <div class="text-3xl mb-3">‚è∞</div>
                            <h4 class="font-bold text-gray-900 mb-2">Íæ∏Ï§ÄÌïú Ìè¨Ïä§ÌåÖ</h4>
                            <p class="text-sm text-gray-600">Ï£º 2-3Ìöå Í∑úÏπôÏ†ÅÏù∏ ÏóÖÎ°úÎìúÍ∞Ä Ï§ëÏöî</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let generatedBlogText = '';

            document.getElementById('blogForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const topic = document.getElementById('topic').value;
                const keywords = document.getElementById('keywords').value;
                const tone = document.getElementById('tone').value;

                // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉú
                const btn = document.getElementById('generateBtn');
                const btnText = document.getElementById('btnText');
                const btnLoading = document.getElementById('btnLoading');
                
                btn.disabled = true;
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
                btnLoading.classList.add('flex');

                try {
                    const response = await fetch('/api/generate-blog-post', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            topic,
                            keywords,
                            tone
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        generatedBlogText = data.content;
                        
                        // Í≤∞Í≥º ÌëúÏãú (Ï§ÑÎ∞îÍøàÏùÑ <br>Î°ú Î≥ÄÌôò)
                        const formattedContent = data.content
                            .replace(/\\n\\n/g, '</p><p class="mb-4">')
                            .replace(/\\n/g, '<br>');
                        
                        document.getElementById('generatedBlog').innerHTML = 
                            '<div class="text-gray-800 leading-relaxed"><p class="mb-4">' + 
                            formattedContent + 
                            '</p></div>';
                        
                        document.getElementById('wordCount').textContent = 
                            'Ï¥ù ' + data.metadata.wordCount + 'Ïûê';
                        document.getElementById('wordCount').classList.remove('hidden');
                        
                        document.getElementById('emptyState').classList.add('hidden');
                        document.getElementById('resultArea').classList.remove('hidden');

                        // ÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§
                        document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        alert('Ïò§Î•ò: ' + data.error);
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Î∏îÎ°úÍ∑∏ Í∏Ä ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                } finally {
                    btn.disabled = false;
                    btnText.classList.remove('hidden');
                    btnLoading.classList.add('hidden');
                }
            });

            function copyBlog() {
                navigator.clipboard.writeText(generatedBlogText).then(() => {
                    alert('‚úÖ Î∏îÎ°úÍ∑∏ Í∏ÄÏù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\\n\\nÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏Ïóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî.');
                });
            }

            function resetForm() {
                document.getElementById('blogForm').reset();
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('resultArea').classList.add('hidden');
                document.getElementById('wordCount').classList.add('hidden');
                generatedBlogText = '';
            }
        </script>
    </body>
    </html>
  `)
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± ÎèÑÍµ¨
app.get('/tools/landing-builder', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', sans-serif; }
          .gradient-purple { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <span class="text-xl font-bold text-gray-900">ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</span>
                    <div class="flex gap-4">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/tools/landing-manager" class="text-gray-600 hover:text-purple-600">ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ</a>
                        <button onclick="logout()" class="text-gray-600 hover:text-red-600">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-4xl mx-auto">
                <div class="mb-8 flex justify-between items-start">
                    <div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-3">üé® AI ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞</h1>
                        <p class="text-lg text-gray-600">Í∞ÑÎã®Ìïú Ï†ïÎ≥¥Îßå ÏûÖÎ†•ÌïòÎ©¥ ÏôÑÏÑ±Îêú ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º ÎßåÎì§Ïñ¥ÎìúÎ¶ΩÎãàÎã§</p>
                    </div>
                    <div class="flex gap-3">
                        <a href="/tools/landing-manager" class="px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl whitespace-nowrap">
                            üìÅ ÎÇ¥ ÌéòÏù¥ÏßÄ Î≥¥Í∏∞
                        </a>
                        <a href="/tools/landing-folders" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl whitespace-nowrap">
                            üóÇÔ∏è Ìè¥Îçî Í¥ÄÎ¶¨
                        </a>
                    </div>
                </div>

                <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
                <div class="grid md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üìÑ</span>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">ÏÉùÏÑ±Ìïú ÌéòÏù¥ÏßÄ</p>
                                <p class="text-2xl font-bold text-gray-900"><span id="totalPagesCount">-</span>Í∞ú</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üìÅ</span>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Ìè¥Îçî Ïàò</p>
                                <p class="text-2xl font-bold text-gray-900"><span id="totalFoldersCount">-</span>Í∞ú</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üëÅÔ∏è</span>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Ï¥ù Ï°∞ÌöåÏàò</p>
                                <p class="text-2xl font-bold text-gray-900"><span id="totalViewsCount">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù -->
                <div class="bg-white rounded-xl p-8 border border-gray-200 mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">1Ô∏è‚É£ ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <button onclick="selectTemplate('academy-intro', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-purple-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üè´</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-purple-600 transition-colors">ÌïôÏõê ÏÜåÍ∞ú ÌéòÏù¥ÏßÄ</div>
                            <p class="text-sm text-gray-600 leading-relaxed">ÌïôÏõêÏùò Í∞ïÏ†êÍ≥º ÌäπÏßïÏùÑ Ìö®Í≥ºÏ†ÅÏúºÎ°ú ÌôçÎ≥¥</p>
                        </button>
                        <button onclick="selectTemplate('program-promo', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üìö</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-blue-600 transition-colors">ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥</div>
                            <p class="text-sm text-gray-600 leading-relaxed">ÌäπÏ†ï ÌîÑÎ°úÍ∑∏Îû® Îì±Î°ùÏùÑ Ïú†ÎèÑÌïòÎäî ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('event-promo', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-pink-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üéâ</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-pink-600 transition-colors">Ïù¥Î≤§Ìä∏ ÌîÑÎ°úÎ™®ÏÖò</div>
                            <p class="text-sm text-gray-600 leading-relaxed">Í∏¥Í∏âÍ∞ê ÏûàÎäî ÌïúÏ†ï Ïù¥Î≤§Ìä∏ ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('parent-letter', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-green-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üìß</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-green-600 transition-colors">Í∞ÄÏ†ïÌÜµÏã†Î¨∏</div>
                            <p class="text-sm text-gray-600 leading-relaxed">ÌïôÎ∂ÄÎ™®ÎãòÍªò Ï†ÑÎã¨ÌïòÎäî Í≥µÏßÄÏÇ¨Ìï≠ ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('student-report', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-indigo-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üìä</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-indigo-600 transition-colors">ÌïôÏÉù ÏÑ±Í≥º Î¶¨Ìè¨Ìä∏</div>
                            <p class="text-sm text-gray-600 leading-relaxed">ÏõîÍ∞Ñ ÌïôÏäµ Î¶¨Ìè¨Ìä∏ Í≥µÏú† ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('admission-info', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-yellow-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üéì</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-yellow-600 transition-colors">ÏûÖÌïô ÏÑ§Î™ÖÌöå</div>
                            <p class="text-sm text-gray-600 leading-relaxed">ÏÑ§Î™ÖÌöå ÏïàÎÇ¥ Î∞è Ï∞∏ÏÑù Ïú†ÎèÑ ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('academy-stats', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-red-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üìà</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-red-600 transition-colors">ÌïôÏõê ÏÑ±Í≥º ÌÜµÍ≥Ñ</div>
                            <p class="text-sm text-gray-600 leading-relaxed">Ïã§Ï†ÅÍ≥º ÏÑ±Í≥ºÎ•º ÏàòÏπòÎ°ú Î≥¥Ïó¨Ï£ºÎäî ÌéòÏù¥ÏßÄ</p>
                        </button>
                        <button onclick="selectTemplate('teacher-intro', event)" class="template-btn group p-6 border-2 border-gray-200 rounded-xl hover:border-teal-500 hover:shadow-xl transition-all duration-300 text-left bg-white">
                            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">üë®‚Äçüè´</div>
                            <div class="font-bold text-lg mb-2 text-gray-900 group-hover:text-teal-600 transition-colors">ÏÑ†ÏÉùÎãò ÏÜåÍ∞ú</div>
                            <p class="text-sm text-gray-600 leading-relaxed">Í∞ïÏÇ¨ÏßÑÏùò Í≤ΩÎ†•Í≥º Ï†ÑÎ¨∏ÏÑ±ÏùÑ ÏÜåÍ∞ú</p>
                        </button>
                    </div>
                </div>

                <!-- ÏûÖÎ†• Ìèº ÏòÅÏó≠ -->
                <div id="formArea" class="hidden">
                    <div class="bg-white rounded-xl p-8 border border-gray-200 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">2Ô∏è‚É£ Ï†ïÎ≥¥ ÏûÖÎ†•</h2>
                        <form id="landingForm" class="space-y-6"></form>
                    </div>

                    <!-- Ìè¥Îçî ÏÑ†ÌÉù -->
                    <div class="bg-white rounded-xl p-8 border border-gray-200 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">3Ô∏è‚É£ Ìè¥Îçî ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)</h2>
                        <p class="text-sm text-gray-600 mb-4">ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º Ï†ÄÏû•Ìï† Ìè¥ÎçîÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                        <div class="space-y-4">
                            <div class="flex gap-3">
                                <select id="folderSelect" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl">
                                    <option value="">Ìè¥Îçî ÏóÜÏùå (Î£®Ìä∏Ïóê Ï†ÄÏû•)</option>
                                </select>
                                <button type="button" onclick="showNewFolderInput()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:shadow-lg transition">
                                    + ÏÉà Ìè¥Îçî
                                </button>
                            </div>
                            <div id="newFolderInput" class="hidden">
                                <div class="flex gap-3">
                                    <input type="text" id="newFolderName" placeholder="ÏÉà Ìè¥Îçî Ïù¥Î¶Ñ ÏûÖÎ†•" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl">
                                    <button type="button" onclick="createFolder()" class="px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition">
                                        ÏÉùÏÑ±
                                    </button>
                                    <button type="button" onclick="hideNewFolderInput()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400 transition">
                                        Ï∑®ÏÜå
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ïç∏ÎÑ§Ïùº ÏóÖÎ°úÎìú -->
                    <div class="bg-white rounded-xl p-8 border border-gray-200 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">4Ô∏è‚É£ Ïç∏ÎÑ§Ïùº ÏÑ§Ï†ï (ÏÑ†ÌÉùÏÇ¨Ìï≠)</h2>
                        <p class="text-sm text-gray-600 mb-6">Ïπ¥Ïπ¥Ïò§ÌÜ°, ÌéòÏù¥Ïä§Î∂Å Îì±ÏóêÏÑú ÎßÅÌÅ¨ Í≥µÏú† Ïãú Î≥¥Ïó¨Ïßà Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</p>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ïç∏ÎÑ§Ïùº Ïù¥ÎØ∏ÏßÄ URL</label>
                                <input type="text" id="thumbnailUrl" placeholder="https://example.com/image.jpg (ÏÑ†ÌÉùÏÇ¨Ìï≠)" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <p class="text-xs text-gray-500 mt-2">üí° Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò, ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî (Í∂åÏû• ÌÅ¨Í∏∞: 1200x630px)</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÎòêÎäî ÌååÏùº ÏóÖÎ°úÎìú</label>
                                <input type="file" id="thumbnailFile" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-xl" onchange="handleThumbnailUpload(event)">
                            </div>
                            <div id="thumbnailPreview" class="hidden">
                                <p class="text-sm font-medium text-gray-900 mb-2">ÎØ∏Î¶¨Î≥¥Í∏∞</p>
                                <img id="thumbnailPreviewImg" src="" alt="Ïç∏ÎÑ§Ïùº ÎØ∏Î¶¨Î≥¥Í∏∞" class="w-full max-w-md rounded-lg border border-gray-300 shadow-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Í≥µÏú† Ïãú ÌëúÏãúÎê† Ï†úÎ™©/ÏÑ§Î™Ö ÏÑ§Ï†ï -->
                    <div class="bg-white rounded-xl p-8 border border-gray-200 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">5Ô∏è‚É£ Í≥µÏú† Ïãú ÌëúÏãú ÎÇ¥Ïö© (ÏÑ†ÌÉùÏÇ¨Ìï≠)</h2>
                        <p class="text-sm text-gray-600 mb-6">Ïπ¥Ïπ¥Ïò§ÌÜ°, ÌéòÏù¥Ïä§Î∂Å Îì±ÏóêÏÑú ÎßÅÌÅ¨ Í≥µÏú† Ïãú Î≥¥Ïó¨Ïßà Ï†úÎ™©Í≥º ÏÑ§Î™ÖÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</p>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌÅ∞ Í∏ÄÏûê (Ï†úÎ™©)</label>
                                <input type="text" id="ogTitle" placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï Î™®Ïßë" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <p class="text-xs text-gray-500 mt-1">üí° ÎπÑÏõåÎëêÎ©¥ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†úÎ™©Ïù¥ ÏûêÎèôÏúºÎ°ú ÏÇ¨Ïö©Îê©ÎãàÎã§</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏûëÏùÄ Í∏ÄÏûê (ÏÑ§Î™Ö)</label>
                                <textarea id="ogDescription" rows="2" placeholder="Ïòà: Ï§ëÎì± ÏòÅÏñ¥/ÏàòÌïô ÏßëÏ§ë ÏºÄÏñ¥! ÏÑ†Ï∞©Ïàú 20Î™Ö ÌïúÏ†ï Ìï†Ïù∏ Ï§ë" class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                                <p class="text-xs text-gray-500 mt-1">üí° ÎπÑÏõåÎëêÎ©¥ Í∏∞Î≥∏ ÏÑ§Î™ÖÏù¥ ÏÇ¨Ïö©Îê©ÎãàÎã§</p>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <p class="text-sm text-blue-800">
                                    <strong>üì± Ïπ¥Ïπ¥Ïò§ÌÜ° ÎØ∏Î¶¨Î≥¥Í∏∞</strong><br>
                                    <span class="text-base font-bold text-gray-900" id="previewOgTitle">Íæ∏Î©îÎïÖÌïôÏõê Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï Î™®Ïßë</span><br>
                                    <span class="text-sm text-gray-600" id="previewOgDescription">Ï§ëÎì± ÏòÅÏñ¥/ÏàòÌïô ÏßëÏ§ë ÏºÄÏñ¥! ÏÑ†Ï∞©Ïàú 20Î™Ö ÌïúÏ†ï Ìï†Ïù∏ Ï§ë</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <button onclick="generateLanding()" class="w-full gradient-purple text-white py-4 rounded-xl text-lg font-bold hover:shadow-xl transition">
                        üöÄ ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±ÌïòÍ∏∞
                    </button>
                    
                    <a href="https://developers.kakao.com/tool/debugger/sharing" target="_blank" class="block w-full text-center bg-yellow-500 hover:bg-yellow-600 text-white py-4 rounded-xl text-lg font-bold hover:shadow-xl transition mt-4">
                        üîÑ Ïπ¥Ïπ¥Ïò§ÌÜ° Ï∫êÏãú Ï¥àÍ∏∞ÌôîÌïòÍ∏∞
                    </a>
                </div>

                <!-- Í≤∞Í≥º ÏòÅÏó≠ -->
                <div id="resultArea" class="hidden">
                    <div class="bg-white rounded-xl p-8 border-2 border-green-500">
                        <h2 class="text-2xl font-bold text-green-600 mb-4">‚úÖ ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± ÏôÑÎ£å!</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Í≥µÏú† ÎßÅÌÅ¨</label>
                                <div class="flex gap-2">
                                    <input type="text" id="shareUrl" readonly class="flex-1 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50">
                                    <button onclick="copyUrl()" class="px-6 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700">
                                        üìã Î≥µÏÇ¨
                                    </button>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <a id="previewBtn" href="#" target="_blank" class="flex-1 text-center py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                                    üëÅÔ∏è ÎØ∏Î¶¨Î≥¥Í∏∞
                                </a>
                                <a href="/tools/landing-manager" class="flex-1 text-center py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700">
                                    üìÅ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
        let selectedTemplate = '';
        let user = null;
        let userFolders = [];

        // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨ (ÏÑ†ÌÉùÏ†Å)
        const userData = localStorage.getItem('user');
        if (userData) {
            user = JSON.parse(userData);
            // ÏÇ¨Ïö©Ïûê Ìè¥Îçî Î™©Î°ù Î°úÎìú
            loadUserFolders();
            // ÌÜµÍ≥Ñ Î°úÎìú
            loadStats();
        } else {
            // Î°úÍ∑∏Ïù∏ ÏóÜÏù¥ÎèÑ ÌÖåÏä§Ìä∏ Í∞ÄÎä•ÌïòÎèÑÎ°ù Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê ÏÑ§Ï†ï
            user = { id: 1, name: 'Í≤åÏä§Ìä∏' };
            console.warn('Î°úÍ∑∏Ïù∏ÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Í≤åÏä§Ìä∏ Î™®ÎìúÎ°ú ÏÇ¨Ïö©Ìï©ÎãàÎã§.');
            loadUserFolders();
            loadStats();
        }

        // ÌÜµÍ≥Ñ Î°úÎìú
        async function loadStats() {
            try {
                // ÌéòÏù¥ÏßÄ Î™©Î°ù Î°úÎìú
                const pagesResponse = await fetch('/api/landing/my-pages?userId=' + user.id);
                const pagesResult = await pagesResponse.json();
                
                if (pagesResult.success) {
                    const pages = pagesResult.pages || [];
                    document.getElementById('totalPagesCount').textContent = pages.length;
                    
                    // Ï¥ù Ï°∞ÌöåÏàò Í≥ÑÏÇ∞ (view_count Ïª¨Îüº ÏÇ¨Ïö©)
                    const totalViews = pages.reduce((sum, page) => sum + (page.view_count || 0), 0);
                    document.getElementById('totalViewsCount').textContent = totalViews.toLocaleString();
                    
                    console.log('ÌÜµÍ≥Ñ Î°úÎìú ÏôÑÎ£å - ÌéòÏù¥ÏßÄ:', pages.length, 'Ï¥ù Ï°∞ÌöåÏàò:', totalViews);
                }
                
                // Ìè¥Îçî Î™©Î°ù Î°úÎìú
                const foldersResponse = await fetch('/api/landing/folders?userId=' + user.id);
                const foldersResult = await foldersResponse.json();
                
                if (foldersResult.success) {
                    const folders = foldersResult.folders || [];
                    document.getElementById('totalFoldersCount').textContent = folders.length;
                }
            } catch (err) {
                console.error('ÌÜµÍ≥Ñ Î°úÎìú Ïã§Ìå®:', err);
                document.getElementById('totalPagesCount').textContent = '0';
                document.getElementById('totalFoldersCount').textContent = '0';
                document.getElementById('totalViewsCount').textContent = '0';
            }
        }

        // ÏÇ¨Ïö©Ïûê Ìè¥Îçî Î™©Î°ù Î°úÎìú
        async function loadUserFolders() {
            try {
                const response = await fetch('/api/landing/folders?userId=' + user.id);
                const result = await response.json();
                if (result.success) {
                    userFolders = result.folders || [];
                    updateFolderSelect();
                }
            } catch (err) {
                console.error('Ìè¥Îçî Î°úÎìú Ïã§Ìå®:', err);
            }
        }

        // Ìè¥Îçî ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateFolderSelect() {
            const select = document.getElementById('folderSelect');
            if (!select) return;
            
            // Í∏∞Ï°¥ ÏòµÏÖò Ï†úÍ±∞ (Ï≤´ Î≤àÏß∏ "Ìè¥Îçî ÏóÜÏùå" Ï†úÏô∏)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Ìè¥Îçî Î™©Î°ù Ï∂îÍ∞Ä
            userFolders.forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                select.appendChild(option);
            });
            
            // ÎßàÏßÄÎßâ ÏÑ†ÌÉùÌïú Ìè¥ÎçîÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèô ÏÑ†ÌÉù
            const lastFolderId = localStorage.getItem('lastSelectedFolder');
            if (lastFolderId) {
                select.value = lastFolderId;
            }
        }

        // ÏÉà Ìè¥Îçî ÏûÖÎ†•Ï∞Ω ÌëúÏãú
        function showNewFolderInput() {
            document.getElementById('newFolderInput').classList.remove('hidden');
            document.getElementById('newFolderName').focus();
        }

        // ÏÉà Ìè¥Îçî ÏûÖÎ†•Ï∞Ω Ïà®Í∏∞Í∏∞
        function hideNewFolderInput() {
            document.getElementById('newFolderInput').classList.add('hidden');
            document.getElementById('newFolderName').value = '';
        }

        // ÏÉà Ìè¥Îçî ÏÉùÏÑ±
        async function createFolder() {
            const folderName = document.getElementById('newFolderName').value.trim();
            if (!folderName) {
                alert('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/api/landing/folders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: user.id,
                        name: folderName
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Ìè¥Îçî "' + folderName + '"Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                    hideNewFolderInput();
                    await loadUserFolders();
                    // ÏÉàÎ°ú ÏÉùÏÑ±Ìïú Ìè¥Îçî ÏûêÎèô ÏÑ†ÌÉù
                    document.getElementById('folderSelect').value = result.folderId;
                } else {
                    alert('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                console.error('Ìè¥Îçî ÏÉùÏÑ± Ïò§Î•ò:', err);
                alert('Ìè¥Îçî ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        function selectTemplate(type, event) {
            selectedTemplate = type;
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('border-purple-600', 'bg-purple-50');
            });
            event.target.closest('.template-btn').classList.add('border-purple-600', 'bg-purple-50');
            
            showForm(type);
        }

        function showForm(type) {
            const forms = {
                'academy-intro': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö *</label>
                            <input type="text" name="academyName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏúÑÏπò *</label>
                            <input type="text" name="location" placeholder="Ïòà: Ïù∏Ï≤ú ÏÑúÍµ¨ Ï≤≠ÎùºÎèô" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ìïú Ï§Ñ ÏÜåÍ∞ú *</label>
                            <input type="text" name="features" placeholder="Ïòà: 1:1 ÎßûÏ∂§ ÍµêÏú°ÏúºÎ°ú ÏÑ±Ï†Å Ìñ•ÏÉÅÏùÑ Ï±ÖÏûÑÏßëÎãàÎã§" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌäπÎ≥ÑÌïú Í∞ïÏ†ê (1Í∞úÎãπ Ìïú Ï§Ñ, ÏµúÎåÄ 4Í∞ú) *</label>
                            <textarea name="specialties" rows="4" placeholder="10ÎÖÑ Í≤ΩÎ†•Ïùò Ï†ÑÎ¨∏ Í∞ïÏÇ¨ÏßÑ&#10;ÏÜåÍ∑úÎ™® Í∑∏Î£π ÏàòÏóÖÏúºÎ°ú ÏßëÏ§ë ÏºÄÏñ¥&#10;ÏûÖÏãú Ï†ÑÎ¨∏ Ïª®ÏÑ§ÌåÖ Î¨¥Î£å Ï†úÍ≥µ&#10;ÎÇ¥Ïã† ÌèâÍ∑† 2Îì±Í∏â Ìñ•ÏÉÅ Ïã§Ï†Å" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò *</label>
                            <input type="text" name="contact" placeholder="Ïòà: 010-1234-5678" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'program-promo': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌîÑÎ°úÍ∑∏Îû®Î™Ö *</label>
                            <input type="text" name="programName" placeholder="Ïòà: Ï§ëÎì± ÏòÅÏñ¥ ÌäπÍ∞ïÎ∞ò" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÎåÄÏÉÅ *</label>
                            <input type="text" name="target" placeholder="Ïòà: Ï§ë1~Ï§ë3" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌäπÏßï (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="features" rows="3" placeholder="ÎÇ¥Ïã† ÎåÄÎπÑ ÏôÑÎ≤Ω Ï§ÄÎπÑ&#10;Î¨∏Î≤ïÎ∂ÄÌÑ∞ ÎèÖÌï¥ÍπåÏßÄ Ï≤¥Í≥ÑÏ†Å ÌïôÏäµ&#10;Ï£º 3Ìöå ÏÜåÍ∑∏Î£π ÏàòÏóÖ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Í∞ÄÍ≤© *</label>
                                <input type="text" name="price" placeholder="Ïòà: 350,000" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Í∏∞Í∞Ñ *</label>
                                <input type="text" name="duration" placeholder="Ïòà: 3Í∞úÏõî Í≥ºÏ†ï" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïã†Ï≤≠ ÎßÅÌÅ¨ ÎòêÎäî Ï†ÑÌôîÎ≤àÌò∏</label>
                            <input type="text" name="cta" placeholder="Ïòà: 010-1234-5678 ÎòêÎäî URL" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'event-promo': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î≤§Ìä∏Î™Ö *</label>
                            <input type="text" name="eventName" placeholder="Ïòà: Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï Ï°∞Í∏∞Îì±Î°ù Ïù¥Î≤§Ìä∏" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í∏∞Í∞Ñ *</label>
                            <input type="text" name="period" placeholder="Ïòà: 12Ïõî 20Ïùº ~ 12Ïõî 31Ïùº" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í∏¥Í∏âÍ∞ê Î¨∏Íµ¨ *</label>
                            <input type="text" name="urgency" placeholder="Ïòà: ÏÑ†Ï∞©Ïàú 20Î™Ö ÌïúÏ†ï" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌòúÌÉù (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="benefits" rows="3" placeholder="Îì±Î°ùÎπÑ 50% Ìï†Ïù∏&#10;ÍµêÏû¨ÎπÑ Ï†ÑÏï° Î¨¥Î£å&#10;1:1 Î†àÎ≤® ÌÖåÏä§Ìä∏ Î¨¥Î£å Ï†úÍ≥µ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïã†Ï≤≠ ÎßÅÌÅ¨ ÎòêÎäî Ï†ÑÌôîÎ≤àÌò∏</label>
                            <input type="text" name="cta" placeholder="Ïòà: 010-1234-5678" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'parent-letter': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö *</label>
                            <input type="text" name="academyName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í≥µÏßÄÏÇ¨Ìï≠ Ï†úÎ™© *</label>
                            <input type="text" name="noticeTitle" placeholder="Ïòà: 2024ÎÖÑ Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï ÏïàÎÇ¥" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÎÇ†Ïßú *</label>
                            <input type="text" name="noticeDate" placeholder="Ïòà: 2024ÎÖÑ 12Ïõî 20Ïùº" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í≥µÏßÄ ÎÇ¥Ïö© *</label>
                            <textarea name="noticeContent" rows="8" placeholder="ÏïàÎÖïÌïòÏÑ∏Ïöî, ÌïôÎ∂ÄÎ™®Îãò.&#10;&#10;2024ÎÖÑ Í≤®Ïö∏Î∞©ÌïôÏùÑ ÎßûÏù¥ÌïòÏó¨ ÌäπÎ≥Ñ ÌîÑÎ°úÍ∑∏Îû®ÏùÑ Ï§ÄÎπÑÌñàÏäµÎãàÎã§.&#10;&#10;ÏïÑÎûò ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÏãúÍ≥† ÎßéÏùÄ Ï∞∏Ïó¨ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.&#10;&#10;Í∞êÏÇ¨Ìï©ÎãàÎã§." required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ï£ºÏöî ÏïàÎÇ¥ÏÇ¨Ìï≠ (1Í∞úÎãπ Ìïú Ï§Ñ)</label>
                            <textarea name="keyPoints" rows="4" placeholder="ÏùºÏãú: 2024ÎÖÑ 12Ïõî 26Ïùº ~ 2025ÎÖÑ 1Ïõî 31Ïùº&#10;ÎåÄÏÉÅ: Ï¥àÎì± 3ÌïôÎÖÑ ~ Ï§ëÎì± 3ÌïôÎÖÑ&#10;Í≥ºÎ™©: ÏàòÌïô, ÏòÅÏñ¥, Íµ≠Ïñ¥&#10;Ïã†Ï≤≠ ÎßàÍ∞ê: 2024ÎÖÑ 12Ïõî 24Ïùº" class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                            <p class="text-xs text-gray-500 mt-1">üí° ÎπÑÏõåÎëêÎ©¥ ÌëúÏãúÎêòÏßÄ ÏïäÏäµÎãàÎã§</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Î¨∏ÏùòÏ≤ò *</label>
                            <input type="text" name="contactInfo" placeholder="Ïòà: 032-123-4567 ÎòêÎäî 010-1234-5678" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Îã¥ÎãπÏûê</label>
                            <input type="text" name="staffName" placeholder="Ïòà: ÍµêÎ¨¥ÌåÄ ÍπÄÏÑ†ÏÉùÎãò" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'student-report': \`
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏÉù ÏÑ†ÌÉù *</label>
                                <select name="studentName" id="studentSelect" required class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-white">
                                    <option value="">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">üí° ÌïôÏÉù Î™©Î°ùÏóêÏÑú ÏûêÎèôÏúºÎ°ú Î∂àÎü¨ÏòµÎãàÎã§</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ïõî *</label>
                                <input type="text" name="month" placeholder="Ïòà: 2024ÎÖÑ 12Ïõî" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏÇ¨Ïö© ÍµêÏû¨ (1Í∞úÎãπ Ìïú Ï§Ñ)</label>
                            <textarea name="textbooks" rows="2" placeholder="Ï§ëÎì± ÏàòÌïô 2-1&#10;Î¨∏Î≤ïÏù¥ Ïì∞Í∏∞Îã§&#10;ÏòÅÎã®Ïñ¥ ÏïîÍ∏∞Ïû• LEVEL 3" class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                            <p class="text-xs text-gray-500 mt-1">üí° ÎπÑÏõåÎëêÎ©¥ ÌëúÏãúÎêòÏßÄ ÏïäÏäµÎãàÎã§</p>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï∂úÏÑùÎ•† (%)</label>
                                <input type="number" name="attendanceRate" placeholder="95" min="0" max="100" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï∂úÏÑù ÏùºÏàò</label>
                                <input type="number" name="attendanceDays" placeholder="19" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï¥ù ÏùºÏàò</label>
                                <input type="number" name="totalDays" placeholder="20" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Îã¨Ïùò ÏÑ±Í≥º (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="achievements" rows="3" placeholder="Ï§ëÍ∞ÑÍ≥†ÏÇ¨ ÏòÅÏñ¥ 90Ï†ê Îã¨ÏÑ±&#10;Îã®Ïñ¥ ÏïîÍ∏∞ 500Í∞ú ÏôÑÎ£å&#10;Î™®ÏùòÍ≥†ÏÇ¨ 3Îì±Í∏âÏóêÏÑú 2Îì±Í∏â Ìñ•ÏÉÅ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂Ñ (1Í∞úÎãπ Ìïú Ï§Ñ)</label>
                            <textarea name="improvements" rows="2" placeholder="ÎèÖÌï¥ ÏÜçÎèÑ Ìñ•ÏÉÅ ÌïÑÏöî&#10;Î¨∏Î≤ï Ïã¨Ìôî ÌïôÏäµ Í∂åÏû•" class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                            <p class="text-xs text-gray-500 mt-1">üí° ÎπÑÏõåÎëêÎ©¥ ÌëúÏãúÎêòÏßÄ ÏïäÏäµÎãàÎã§</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Îã§Ïùå Îã¨ Î™©Ìëú (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="nextGoals" rows="2" placeholder="Í∏∞ÎßêÍ≥†ÏÇ¨ 95Ï†ê Î™©Ìëú&#10;Îì£Í∏∞ ÌèâÍ∞Ä ÎßåÏ†ê ÎèÑÏ†Ñ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Îã¥Îãπ ÏÑ†ÏÉùÎãò</label>
                            <input type="text" name="teacherName" placeholder="Ïòà: ÍπÄÏòÅÌù¨ ÏÑ†ÏÉùÎãò" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'admission-info': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏÑ§Î™ÖÌöå Ï†úÎ™© *</label>
                            <input type="text" name="eventTitle" placeholder="Ïòà: 2025ÌïôÎÖÑÎèÑ Ïã†ÏûÖÏÉù Î™®Ïßë ÏÑ§Î™ÖÌöå" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÎÇ†Ïßú *</label>
                                <input type="text" name="eventDate" placeholder="Ïòà: 2024ÎÖÑ 12Ïõî 28Ïùº" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏãúÍ∞Ñ *</label>
                                <input type="text" name="eventTime" placeholder="Ïòà: Ïò§ÌõÑ 2Ïãú" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïû•ÏÜå *</label>
                            <input type="text" name="location" placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê 2Ï∏µ ÏÑ∏ÎØ∏ÎÇòÏã§" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÎåÄÏÉÅ ÌïôÎÖÑ</label>
                            <input type="text" name="targetGrade" placeholder="Ïòà: ÏòàÎπÑ Ï¥à1~Ï¥à6" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏÑ§Î™ÖÌöå ÏïàÎÇ¥ (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="agenda" rows="4" placeholder="ÌïôÏõê ÍµêÏú° Ï≤†Ìïô ÏÜåÍ∞ú&#10;Í∞ïÏÇ¨ÏßÑ ÏÜåÍ∞ú Î∞è Ïª§Î¶¨ÌÅòÎüº ÏïàÎÇ¥&#10;ÏûÖÌïô Ï†àÏ∞® Î∞è Îì±Î°ù Î∞©Î≤ï&#10;ÏßàÏùòÏùëÎãµ ÏãúÍ∞Ñ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ï∞∏ÏÑù ÌòúÌÉù (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="benefits" rows="3" placeholder="Îì±Î°ùÎπÑ 50% Ìï†Ïù∏ Ïø†Ìè∞&#10;ÍµêÏû¨ÎπÑ Ï†ÑÏï° Î¨¥Î£å&#10;Î†àÎ≤® ÌÖåÏä§Ìä∏ Î¨¥Î£å" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò *</label>
                            <input type="text" name="contact" placeholder="Ïòà: 032-123-4567" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`,
                'academy-stats': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö *</label>
                            <input type="text" name="academyName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Í∏∞Í∞Ñ *</label>
                            <input type="text" name="period" placeholder="Ïòà: 2024ÎÖÑ 2ÌïôÍ∏∞" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï¥ù Ïû¨ÌïôÏÉù Ïàò</label>
                                <input type="text" name="totalStudents" placeholder="Ïòà: 150" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌèâÍ∑† ÏÑ±Ï†Å Ìñ•ÏÉÅ</label>
                                <input type="text" name="gradeImprovement" placeholder="Ïòà: 2Îì±Í∏â" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ï£ºÏöî ÏÑ±Í≥º (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="achievements" rows="4" placeholder="Ï†ÑÍµ≠ Î™®ÏùòÍ≥†ÏÇ¨ 1Îì±Í∏â Îã¨ÏÑ± 10Î™Ö&#10;ÎÇ¥Ïã† ÌèâÍ∑† 2Îì±Í∏â Ïù¥ÏÉÅ Ìñ•ÏÉÅ&#10;Î™ÖÎ¨∏ÎåÄ Ìï©Í≤©Î•† 85%&#10;ÌïôÎ∂ÄÎ™® ÎßåÏ°±ÎèÑ 95%" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÎ∂ÄÎ™® ÌõÑÍ∏∞ (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="testimonials" rows="3" placeholder="ÏïÑÏù¥ ÏÑ±Ï†ÅÏù¥ 2Îì±Í∏âÏù¥ÎÇò Ïò¨ÎûêÏñ¥Ïöî!&#10;ÏÑ†ÏÉùÎãòÎì§Ïù¥ Ï†ïÎßê ÏπúÏ†àÌïòÍ≥† Ïó¥Ï†ïÏ†ÅÏûÖÎãàÎã§&#10;Ï≤¥Í≥ÑÏ†ÅÏù∏ Í¥ÄÎ¶¨ ÎçïÎ∂ÑÏóê ÏïàÏã¨ÌïòÍ≥† Îß°ÍπÅÎãàÎã§" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                    </div>
                \`,
                'teacher-intro': \`
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏÑ†ÏÉùÎãò Ïù¥Î¶Ñ *</label>
                            <input type="text" name="teacherName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ï†ÑÎ¨∏ Í≥ºÎ™© *</label>
                                <input type="text" name="subject" placeholder="Ïòà: ÏòÅÏñ¥" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Í≤ΩÎ†• (ÎÖÑ) *</label>
                                <input type="text" name="experience" placeholder="Ïòà: 10" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÎ†• *</label>
                            <input type="text" name="education" placeholder="Ïòà: ÏÑúÏö∏ÎåÄÌïôÍµê ÏòÅÏñ¥ÍµêÏú°Í≥º Ï°∏ÏóÖ" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ï†ÑÎ¨∏ Î∂ÑÏïº *</label>
                            <input type="text" name="specialty" placeholder="Ïòà: ÏàòÎä• ÏòÅÏñ¥, ÎÇ¥Ïã† ÎåÄÎπÑ, ÏòÅÎ¨∏Î≤ï ÌäπÌôî" required class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ï£ºÏöî Ïã§Ï†Å (1Í∞úÎãπ Ìïú Ï§Ñ) *</label>
                            <textarea name="achievements" rows="3" placeholder="ÏàòÎä• 1Îì±Í∏â ÌïôÏÉù 50Î™Ö Ïù¥ÏÉÅ Î∞∞Ï∂ú&#10;ÌïôÏÉù ÌèâÍ∑† 2Îì±Í∏â Ìñ•ÏÉÅ Îã¨ÏÑ±&#10;ÌïôÎ∂ÄÎ™® ÎßåÏ°±ÎèÑ 98%" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÏàòÏóÖ Î∞©Ïãù *</label>
                            <textarea name="teachingStyle" rows="3" placeholder="Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÏßÑÎèÑ, Ï≤¥Í≥ÑÏ†ÅÏù∏ Ïò§Îãµ Í¥ÄÎ¶¨, Ïã§Ï†Ñ Î¨∏Ï†ú ÌíÄÏù¥ Ï§ëÏã¨" required class="w-full px-4 py-3 border border-gray-300 rounded-xl"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò</label>
                            <input type="text" name="contact" placeholder="Ïòà: 032-123-4567" class="w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>
                \`
            };

            document.getElementById('landingForm').innerHTML = forms[type];
            document.getElementById('formArea').classList.remove('hidden');
            document.getElementById('formArea').scrollIntoView({ behavior: 'smooth' });
            
            // student-report ÌÖúÌîåÎ¶øÏùº Îïå ÌïôÏÉù Î™©Î°ù Î°úÎìú
            if (type === 'student-report') {
                loadStudentsForSelect();
            }
        }

        // ÌïôÏÉù Î™©Î°ùÏùÑ selectÏóê Î°úÎìúÌïòÎäî Ìï®Ïàò
        async function loadStudentsForSelect() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user || !user.id) return;
            
            try {
                const response = await fetch('/api/students?userId=' + user.id);
                const data = await response.json();
                
                if (data.success && data.students) {
                    const select = document.getElementById('studentSelect');
                    if (select) {
                        // Í∏∞Ï°¥ ÏòµÏÖò Ïú†ÏßÄÌïòÍ≥† ÌïôÏÉù Ï∂îÍ∞Ä
                        data.students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.name;
                            option.textContent = student.name + (student.grade ? ' (' + student.grade + ')' : '');
                            select.appendChild(option);
                        });
                        
                        if (data.students.length === 0) {
                            const option = document.createElement('option');
                            option.value = '';
                            option.textContent = 'Îì±Î°ùÎêú ÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§';
                            option.disabled = true;
                            select.appendChild(option);
                        }
                    }
                }
            } catch (err) {
                console.error('ÌïôÏÉù Î™©Î°ù Î°úÎìú Ïã§Ìå®:', err);
            }
        }

        // Ïç∏ÎÑ§Ïùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        async function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ÌååÏùº ÌÉÄÏûÖ Ï≤¥ÌÅ¨
            if (!file.type.startsWith('image/')) {
                alert('Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.');
                event.target.value = '';
                return;
            }

            // Î°úÎî© ÌëúÏãú
            alert('Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî...');

            try {
                // Ïù¥ÎØ∏ÏßÄÎ•º Î¶¨ÏÇ¨Ïù¥ÏßïÌïòÏó¨ Base64Î°ú Î≥ÄÌôò
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    // ÏµúÎåÄ ÌÅ¨Í∏∞: 1200x630 (OG Ïù¥ÎØ∏ÏßÄ Í∂åÏû• ÏÇ¨Ïù¥Ï¶à)
                    const maxWidth = 1200;
                    const maxHeight = 630;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = Math.floor(width * ratio);
                        height = Math.floor(height * ratio);
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // JPEGÎ°ú ÏïïÏ∂ï (ÌíàÏßà 0.85)
                    canvas.toBlob(async function(blob) {
                        // imgbb APIÎ°ú ÏóÖÎ°úÎìú
                        const formData = new FormData();
                        formData.append('image', blob);
                        
                        try {
                            // imgbb Î¨¥Î£å API ÌÇ§
                            const apiKey = 'a6acb7467153b3cf20cff3f57aa812a8';
                            
                            const response = await fetch(\`https://api.imgbb.com/1/upload?key=\${apiKey}\`, {
                                method: 'POST',
                                body: formData
                            });
                            
                            const result = await response.json();
                            
                            if (result.success && result.data && result.data.url) {
                                const imageUrl = result.data.url;
                                
                                // UI ÏóÖÎç∞Ïù¥Ìä∏
                                document.getElementById('thumbnailUrl').value = imageUrl;
                                document.getElementById('thumbnailPreviewImg').src = imageUrl;
                                document.getElementById('thumbnailPreview').classList.remove('hidden');
                                
                                alert('‚úÖ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!\\n\\nURL: ' + imageUrl);
                            } else {
                                // imgbb Ïã§Ìå® Ïãú Base64Î°ú Ìè¥Î∞±
                                const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
                                
                                document.getElementById('thumbnailUrl').value = dataUrl;
                                document.getElementById('thumbnailPreviewImg').src = dataUrl;
                                document.getElementById('thumbnailPreview').classList.remove('hidden');
                                
                                alert('‚úÖ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!');
                            }
                        } catch (err) {
                            console.error('imgbb ÏóÖÎ°úÎìú Ïò§Î•ò:', err);
                            
                            // API Ïã§Ìå® Ïãú Base64Î°ú Ìè¥Î∞±
                            const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
                            
                            document.getElementById('thumbnailUrl').value = dataUrl;
                            document.getElementById('thumbnailPreviewImg').src = dataUrl;
                            document.getElementById('thumbnailPreview').classList.remove('hidden');
                            
                            alert('‚úÖ Ïù¥ÎØ∏ÏßÄÍ∞Ä Î°úÏª¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                        }
                    }, 'image/jpeg', 0.85);
                };
                
                img.onerror = function() {
                    alert('‚ùå Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    event.target.value = '';
                };
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                
            } catch (err) {
                console.error('ÏóÖÎ°úÎìú Ïò§Î•ò:', err);
                alert('‚ùå Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\\n\\nÏù¥ÎØ∏ÏßÄ URLÏùÑ ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                event.target.value = '';
            }
        }

        // OG Ï†úÎ™©/ÏÑ§Î™Ö Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞
        document.addEventListener('DOMContentLoaded', function() {
            const ogTitleInput = document.getElementById('ogTitle');
            const ogDescInput = document.getElementById('ogDescription');
            const previewTitle = document.getElementById('previewOgTitle');
            const previewDesc = document.getElementById('previewOgDescription');

            if (ogTitleInput && previewTitle) {
                ogTitleInput.addEventListener('input', function() {
                    previewTitle.textContent = this.value || 'Íæ∏Î©îÎïÖÌïôÏõê Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï Î™®Ïßë';
                });
            }

            if (ogDescInput && previewDesc) {
                ogDescInput.addEventListener('input', function() {
                    previewDesc.textContent = this.value || 'Ï§ëÎì± ÏòÅÏñ¥/ÏàòÌïô ÏßëÏ§ë ÏºÄÏñ¥! ÏÑ†Ï∞©Ïàú 20Î™Ö ÌïúÏ†ï Ìï†Ïù∏ Ï§ë';
                });
            }
        });

        async function generateLanding() {
            if (!selectedTemplate) {
                alert('ÌÖúÌîåÎ¶øÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const formData = new FormData(document.getElementById('landingForm'));
            const data = Object.fromEntries(formData);

            // Ïç∏ÎÑ§Ïùº URL Í∞ÄÏ†∏Ïò§Í∏∞
            const thumbnailUrl = document.getElementById('thumbnailUrl').value || '';
            
            // OG Ï†úÎ™©/ÏÑ§Î™Ö Í∞ÄÏ†∏Ïò§Í∏∞
            const ogTitle = document.getElementById('ogTitle').value || '';
            const ogDescription = document.getElementById('ogDescription').value || '';
            
            // ÏÑ†ÌÉùÎêú Ìè¥Îçî Í∞ÄÏ†∏Ïò§Í∏∞
            const folderId = document.getElementById('folderSelect').value || null;
            
            // ÏÑ†ÌÉùÎêú Ìè¥ÎçîÎ•º localStorageÏóê Ï†ÄÏû• (Îã§ÏùåÎ≤àÏóê ÏûêÎèô ÏÑ†ÌÉù)
            if (folderId) {
                localStorage.setItem('lastSelectedFolder', folderId);
            } else {
                localStorage.removeItem('lastSelectedFolder');
            }

            // Î∞∞Ïó¥Î°ú Î≥ÄÌôòÏù¥ ÌïÑÏöîÌïú ÌïÑÎìúÎì§
            if (data.specialties) data.specialties = data.specialties.split('\\n').filter(s => s.trim());
            if (data.features) data.features = data.features.split('\\n').filter(s => s.trim());
            if (data.benefits) data.benefits = data.benefits.split('\\n').filter(s => s.trim());
            if (data.achievements) data.achievements = data.achievements.split('\\n').filter(s => s.trim());
            if (data.improvements) data.improvements = data.improvements.split('\\n').filter(s => s.trim());
            if (data.nextGoals) data.nextGoals = data.nextGoals.split('\\n').filter(s => s.trim());
            if (data.textbooks) data.textbooks = data.textbooks.split('\\n').filter(s => s.trim());

            // Ï†úÎ™© ÏÉùÏÑ±
            let title = '';
            if (selectedTemplate === 'academy-intro') title = data.academyName + ' ÏÜåÍ∞ú';
            else if (selectedTemplate === 'program-promo') title = data.programName;
            else if (selectedTemplate === 'event-promo') title = data.eventName;
            else if (selectedTemplate === 'student-report') title = data.studentName + ' ' + data.month + ' Î¶¨Ìè¨Ìä∏';
            else if (selectedTemplate === 'admission-info') title = data.eventTitle;
            else if (selectedTemplate === 'academy-stats') title = data.academyName + ' ' + data.period + ' ÏÑ±Í≥º';
            else if (selectedTemplate === 'teacher-intro') title = data.teacherName + ' ÏÑ†ÏÉùÎãò';

            // Î∞∞Ïó¥ ÌïÑÎìú Ï≤òÎ¶¨ - ÏÉàÎ°úÏö¥ ÌÖúÌîåÎ¶ø Ìè¨Ìï®
            if (data.agenda) data.agenda = data.agenda.split('\\n').filter(s => s.trim());
            if (data.testimonials) data.testimonials = data.testimonials.split('\\n').filter(s => s.trim());

            try {
                // ÎîîÎ≤ÑÍπÖ: Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                console.log('üîç Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞:', {
                    title,
                    template_type: selectedTemplate,
                    thumbnail_url: thumbnailUrl,
                    og_title: ogTitle,
                    og_description: ogDescription,
                    folder_id: folderId
                });
                
                // ÌïúÍ∏Ä Ìè¨Ìï®Îêú ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞Î•º Base64Î°ú Ïù∏ÏΩîÎî©
                const userDataStr = JSON.stringify(user || {id: 1});
                const userDataBase64 = btoa(unescape(encodeURIComponent(userDataStr)));
                
                const response = await fetch('/api/landing/create', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-User-Data-Base64': userDataBase64
                    },
                    body: JSON.stringify({
                        title,
                        template_type: selectedTemplate,
                        input_data: data,
                        thumbnail_url: thumbnailUrl,
                        og_title: ogTitle,
                        og_description: ogDescription,
                        folder_id: folderId
                    })
                });

                const result = await response.json();
                if (result.success) {
                    const fullUrl = window.location.origin + result.url;
                    document.getElementById('shareUrl').value = fullUrl;
                    document.getElementById('previewBtn').href = result.url;
                    document.getElementById('resultArea').classList.remove('hidden');
                    document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Ïò§Î•ò: ' + result.error);
                }
            } catch (err) {
                console.error('ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± ÏóêÎü¨:', err);
                alert('ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÏΩòÏÜîÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî: ' + error.message);
            }
        }

        function copyUrl() {
            const input = document.getElementById('shareUrl');
            input.select();
            document.execCommand('copy');
            alert('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        }
        </script>
    </body>
    </html>
  `)
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/tools/landing-manager', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <span class="text-xl font-bold text-gray-900">ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ</span>
                    <div class="flex gap-4">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/tools/landing-builder" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ ÏÉàÎ°ú ÎßåÎì§Í∏∞</a>
                        <button onclick="logout()" class="text-gray-600 hover:text-red-600">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-6xl mx-auto">
                <div class="mb-8 flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">üìÅ ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ</h1>
                        <p class="text-gray-600">ÏÉùÏÑ±Ìïú ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º Ìè¥ÎçîÎ°ú Ï†ïÎ¶¨ÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
                    </div>
                    <button onclick="openFolderModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                        + ÏÉà Ìè¥Îçî
                    </button>
                </div>

                <!-- Folders -->
                <div class="mb-8">
                    <div class="flex gap-3 overflow-x-auto pb-4" id="foldersList">
                        <button onclick="selectFolder(null)" id="folder-all" class="folder-btn px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 whitespace-nowrap">
                            üìÅ Ï†ÑÏ≤¥ (0)
                        </button>
                    </div>
                </div>

                <!-- Pages List -->
                <div id="pagesList" class="space-y-4">
                    <div class="text-center py-12 text-gray-500">Î°úÎî©Ï§ë...</div>
                </div>
            </div>
        </div>

        <!-- Folder Modal -->
        <div id="folderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞</h2>
                <input type="text" id="folderName" placeholder="Ìè¥Îçî Ïù¥Î¶Ñ (Ïòà: ÌïôÎ∂ÄÎ™® Í≥µÏú†Ïö©)" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-6">
                <div class="flex gap-3">
                    <button onclick="closeFolderModal()" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200">
                        Ï∑®ÏÜå
                    </button>
                    <button onclick="createFolder()" class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700">
                        ÏÉùÏÑ±
                    </button>
                </div>
            </div>
        </div>

        <!-- Move to Folder Modal -->
        <div id="moveFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ìè¥ÎçîÎ°ú Ïù¥Îèô</h2>
                <div id="folderSelectList" class="space-y-2 mb-6 max-h-96 overflow-y-auto">
                    <!-- Ìè¥Îçî Î™©Î°ù -->
                </div>
                <button onclick="closeMoveFolderModal()" class="w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200">
                    Ï∑®ÏÜå
                </button>
            </div>
        </div>

        <script>
        let user = null;
        let currentFolder = null;
        let allFolders = [];
        let currentPageToMove = null;

        const userData = localStorage.getItem('user');
        if (!userData) {
            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
            window.location.href = '/login';
        } else {
            user = JSON.parse(userData);
            loadFolders();
            loadPages();
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/';
        }

        // Ìè¥Îçî Î∂àÎü¨Ïò§Í∏∞
        async function loadFolders() {
            try {
                const response = await fetch('/api/landing/folders?userId=' + user.id);
                const result = await response.json();
                
                if (result.success && result.folders) {
                    allFolders = result.folders;
                    const foldersHtml = allFolders.map(f => 
                        '<button onclick="selectFolder(' + f.id + ')" id="folder-' + f.id + '" class="folder-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 whitespace-nowrap">' +
                            'üìÅ ' + f.name + ' (' + (f.page_count || 0) + ')' +
                        '</button>'
                    ).join('');
                    
                    document.getElementById('foldersList').innerHTML = 
                        '<button onclick="selectFolder(null)" id="folder-all" class="folder-btn px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 whitespace-nowrap">' +
                            'üìÅ Ï†ÑÏ≤¥ (' + (result.totalPages || 0) + ')' +
                        '</button>' + foldersHtml;
                }
            } catch (err) {
                console.error('Ìè¥Îçî Î°úÎìú Ïã§Ìå®:', err);
            }
        }

        // Ìè¥Îçî ÏÑ†ÌÉù
        function selectFolder(folderId) {
            currentFolder = folderId;
            
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.folder-btn').forEach(btn => {
                btn.className = 'folder-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 whitespace-nowrap';
            });
            
            const selectedBtn = document.getElementById('folder-' + (folderId || 'all'));
            if (selectedBtn) {
                selectedBtn.className = 'folder-btn px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 whitespace-nowrap';
            }
            
            loadPages();
        }

        // ÌéòÏù¥ÏßÄ Î∂àÎü¨Ïò§Í∏∞
        async function loadPages() {
            try {
                let url = '/api/landing/my-pages?userId=' + user.id;
                if (currentFolder) {
                    url += '&folderId=' + currentFolder;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success && result.pages.length > 0) {
                    const html = result.pages.map(p => {
                        const typeNames = {
                            'academy-intro': 'üè´ ÌïôÏõê ÏÜåÍ∞ú',
                            'program-promo': 'üìö ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥',
                            'event-promo': 'üéâ Ïù¥Î≤§Ìä∏',
                            'student-report': 'üìä ÌïôÏÉù Î¶¨Ìè¨Ìä∏'
                        };
                        const url = window.location.origin + '/landing/' + p.slug;
                        const safeUrl = url.replace(/'/g, "\\'");
                        return '<div class="bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition">' +
                                '<div class="flex items-start justify-between">' +
                                    '<div class="flex-1">' +
                                        '<div class="flex items-center gap-3 mb-2">' +
                                            '<span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs rounded-full font-medium">' +
                                                (typeNames[p.template_type] || p.template_type) +
                                            '</span>' +
                                            '<span class="text-sm text-gray-500">Ï°∞ÌöåÏàò: ' + p.view_count + '</span>' +
                                        '</div>' +
                                        '<h3 class="text-xl font-bold text-gray-900 mb-3">' + p.title + '</h3>' +
                                        '<div class="flex items-center gap-2 mb-3">' +
                                            '<input type="text" value="' + url + '" readonly class="flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm">' +
                                            '<button onclick="copyUrl(' + "'" + safeUrl + "'" + ')" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700">Î≥µÏÇ¨</button>' +
                                        '</div>' +
                                        '<p class="text-sm text-gray-500">ÏÉùÏÑ±Ïùº: ' + new Date(p.created_at).toLocaleString('ko-KR') + '</p>' +
                                    '</div>' +
                                    '<div class="flex flex-col gap-2 ml-4">' +
                                        '<a href="/landing/' + p.slug + '" target="_blank" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm text-center">ÎØ∏Î¶¨Î≥¥Í∏∞</a>' +
                                        '<button onclick="openMoveFolderModal(' + p.id + ')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">Ìè¥Îçî Ïù¥Îèô</button>' +
                                        '<button onclick="deletePage(' + p.id + ')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">ÏÇ≠Ï†ú</button>' +
                                    '</div>' +
                                '</div>' +
                            '</div>';
                    }).join('');
                    document.getElementById('pagesList').innerHTML = html;
                } else {
                    document.getElementById('pagesList').innerHTML = '<div class="text-center py-12">' +
                            '<p class="text-gray-500 mb-4">ÎûúÎî©ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>' +
                            '<a href="/tools/landing-builder" class="inline-block px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Ï≤´ ÎûúÎî©ÌéòÏù¥ÏßÄ ÎßåÎì§Í∏∞</a>' +
                        '</div>';
                }
            } catch (err) {
                document.getElementById('pagesList').innerHTML = '<div class="text-center py-12 text-red-500">Î°úÎî© Ïã§Ìå®</div>';
            }
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            });
        }

        // Ìè¥Îçî Î™®Îã¨
        function openFolderModal() {
            document.getElementById('folderModal').classList.remove('hidden');
        }

        function closeFolderModal() {
            document.getElementById('folderModal').classList.add('hidden');
            document.getElementById('folderName').value = '';
        }

        async function createFolder() {
            const name = document.getElementById('folderName').value.trim();
            if (!name) {
                alert('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/api/landing/folders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: user.id, name })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                    closeFolderModal();
                    loadFolders();
                } else {
                    alert('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Ìè¥Îçî Ïù¥Îèô Î™®Îã¨
        function openMoveFolderModal(pageId) {
            currentPageToMove = pageId;
            
            const foldersHtml = allFolders.map(f =>
                '<button onclick="moveToFolder(' + f.id + ')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left border border-gray-200">' +
                    'üìÅ ' + f.name +
                '</button>'
            ).join('');
            
            document.getElementById('folderSelectList').innerHTML = 
                '<button onclick="moveToFolder(null)" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left border border-gray-200">' +
                    'üìÅ Ìè¥Îçî ÏóÜÏùå (Ï†ÑÏ≤¥)' +
                '</button>' + foldersHtml;
            
            document.getElementById('moveFolderModal').classList.remove('hidden');
        }

        function closeMoveFolderModal() {
            document.getElementById('moveFolderModal').classList.add('hidden');
            currentPageToMove = null;
        }

        async function moveToFolder(folderId) {
            try {
                const response = await fetch('/api/landing/move-to-folder', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        pageId: currentPageToMove, 
                        folderId: folderId 
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Ìè¥ÎçîÎ°ú Ïù¥ÎèôÎêòÏóàÏäµÎãàÎã§!');
                    closeMoveFolderModal();
                    loadFolders();
                    loadPages();
                } else {
                    alert('Ïù¥Îèô Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        async function deletePage(id) {
            if (!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            try {
                const response = await fetch('/api/landing/' + id + '?userId=' + user.id, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    loadFolders();
                    loadPages();
                } else {
                    alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + (result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (err) {
                console.error('Delete error:', err);
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
            }
        }
        </script>
    </body>
    </html>
  `)
})

// Ìè¥Îçî Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/tools/landing-folders', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ìè¥Îçî Í¥ÄÎ¶¨ - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <span class="text-xl font-bold text-gray-900">üìÅ Ìè¥Îçî Í¥ÄÎ¶¨</span>
                    <div class="flex gap-4">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/tools/landing-builder" class="text-gray-600 hover:text-purple-600">ÏÉàÎ°ú ÎßåÎì§Í∏∞</a>
                        <a href="/tools/landing-manager" class="text-gray-600 hover:text-purple-600">ÎÇ¥ ÎûúÎî©ÌéòÏù¥ÏßÄ</a>
                        <button onclick="logout()" class="text-gray-600 hover:text-red-600">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-6xl mx-auto">
                <div class="mb-8 flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">üóÇÔ∏è Ìè¥Îçî Í¥ÄÎ¶¨</h1>
                        <p class="text-gray-600">ÎûúÎî©ÌéòÏù¥ÏßÄÎ•º Ìè¥ÎçîÎ≥ÑÎ°ú Ï†ïÎ¶¨ÌïòÏÑ∏Ïöî</p>
                    </div>
                    <button onclick="openNewFolderModal()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 font-medium shadow-lg hover:shadow-xl transition-all duration-200">
                        + ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞
                    </button>
                </div>

                <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ï†ÑÏ≤¥ Ìè¥Îçî</p>
                                <p class="text-3xl font-bold text-gray-900"><span id="totalFolders">-</span></p>
                            </div>
                            <div class="w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center">
                                <span class="text-3xl">üìÅ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ï†ÑÏ≤¥ ÌéòÏù¥ÏßÄ</p>
                                <p class="text-3xl font-bold text-gray-900"><span id="totalPages">-</span></p>
                            </div>
                            <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center">
                                <span class="text-3xl">üìÑ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ï¥ù Ï°∞ÌöåÏàò</p>
                                <p class="text-3xl font-bold text-gray-900"><span id="totalViews">-</span></p>
                            </div>
                            <div class="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center">
                                <span class="text-3xl">üëÅÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">ÎØ∏Î∂ÑÎ•ò ÌéòÏù¥ÏßÄ</p>
                                <p class="text-3xl font-bold text-gray-900"><span id="uncategorizedPages">-</span></p>
                            </div>
                            <div class="w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center">
                                <span class="text-3xl">üìã</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ìè¥Îçî Î™©Î°ù -->
                <div class="bg-white rounded-xl border border-gray-200 p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Ìè¥Îçî Î™©Î°ù</h2>
                    <div id="foldersList" class="space-y-4">
                        <div class="text-center py-12 text-gray-500">Î°úÎî©Ï§ë...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞ Î™®Îã¨ -->
        <div id="newFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞</h2>
                <input type="text" id="newFolderName" placeholder="Ìè¥Îçî Ïù¥Î¶Ñ ÏûÖÎ†• (Ïòà: ÌïôÎ∂ÄÎ™®Ïö©, Ïã†Í∑úÏÉùÏö©)" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <textarea id="newFolderDescription" placeholder="Ìè¥Îçî ÏÑ§Î™Ö (ÏÑ†ÌÉùÏÇ¨Ìï≠)" 
                          class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-6 resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3"></textarea>
                <div class="flex gap-3">
                    <button onclick="closeNewFolderModal()" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors">
                        Ï∑®ÏÜå
                    </button>
                    <button onclick="createNewFolder()" class="flex-1 px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                        ÏÉùÏÑ±
                    </button>
                </div>
            </div>
        </div>

        <!-- Ìè¥Îçî ÏàòÏ†ï Î™®Îã¨ -->
        <div id="editFolderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ìè¥Îçî ÏàòÏ†ï</h2>
                <input type="hidden" id="editFolderId">
                <input type="text" id="editFolderName" placeholder="Ìè¥Îçî Ïù¥Î¶Ñ" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <textarea id="editFolderDescription" placeholder="Ìè¥Îçî ÏÑ§Î™Ö" 
                          class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-6 resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3"></textarea>
                <div class="flex gap-3">
                    <button onclick="closeEditFolderModal()" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors">
                        Ï∑®ÏÜå
                    </button>
                    <button onclick="updateFolder()" class="flex-1 px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                        ÏàòÏ†ï
                    </button>
                </div>
            </div>
        </div>

        <script>
        let user = null;
        let allFolders = [];
        let allPages = [];

        // Î°úÍ∑∏Ïù∏ ÌôïÏù∏
        const userData = localStorage.getItem('user');
        if (!userData) {
            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
            window.location.href = '/login';
        } else {
            user = JSON.parse(userData);
            loadData();
        }

        async function loadData() {
            await loadFolders();
            await loadPages();
            updateStats();
            renderFolders();
        }

        async function loadFolders() {
            try {
                const response = await fetch('/api/landing/folders?userId=' + user.id);
                const result = await response.json();
                
                if (result.success) {
                    allFolders = result.folders || [];
                } else {
                    allFolders = [];
                }
            } catch (err) {
                console.error('Failed to load folders:', err);
                allFolders = [];
            }
        }

        async function loadPages() {
            try {
                const response = await fetch('/api/landing/my-pages?userId=' + user.id);
                const result = await response.json();
                
                if (result.success) {
                    allPages = result.pages || [];
                } else {
                    allPages = [];
                }
            } catch (err) {
                console.error('Failed to load pages:', err);
                allPages = [];
            }
        }

        function updateStats() {
            document.getElementById('totalFolders').textContent = allFolders.length;
            document.getElementById('totalPages').textContent = allPages.length;
            
            // Ï¥ù Ï°∞ÌöåÏàò Í≥ÑÏÇ∞
            const totalViews = allPages.reduce((sum, page) => sum + (page.view_count || 0), 0);
            document.getElementById('totalViews').textContent = totalViews.toLocaleString();
            
            // ÎØ∏Î∂ÑÎ•ò ÌéòÏù¥ÏßÄ
            const uncategorized = allPages.filter(p => !p.folder_id).length;
            document.getElementById('uncategorizedPages').textContent = uncategorized;
        }

        function renderFolders() {
            const container = document.getElementById('foldersList');
            
            if (allFolders.length === 0) {
                container.innerHTML = 
                    '<div class="text-center py-12">' +
                        '<div class="text-6xl mb-4">üìÅ</div>' +
                        '<p class="text-gray-600 mb-4">ÏïÑÏßÅ ÏÉùÏÑ±Îêú Ìè¥ÎçîÍ∞Ä ÏóÜÏäµÎãàÎã§</p>' +
                        '<button onclick="openNewFolderModal()" class="px-6 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors">' +
                            'Ï≤´ Ìè¥Îçî ÎßåÎì§Í∏∞' +
                        '</button>' +
                    '</div>';
                return;
            }

            const foldersHtml = allFolders.map(folder => {
                const pagesInFolder = allPages.filter(p => p.folder_id === folder.id).length;
                const viewsInFolder = allPages.filter(p => p.folder_id === folder.id).reduce((sum, page) => sum + (page.view_count || 0), 0);
                const lastUpdated = folder.updated_at ? new Date(folder.updated_at).toLocaleDateString('ko-KR') : '-';
                
                return \`
                    <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-gradient-to-br from-white to-gray-50">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-500 rounded-xl flex items-center justify-center shadow-md">
                                    <span class="text-2xl">üìÅ</span>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">\${folder.name}</h3>
                                    \${folder.description ? '<p class="text-sm text-gray-600 mt-1">' + folder.description + '</p>' : ''}
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openEditFolderModal(\${folder.id}, '\${folder.name}', '\${folder.description || ''}')" 
                                        class="px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
                                    ‚úèÔ∏è ÏàòÏ†ï
                                </button>
                                <button onclick="deleteFolder(\${folder.id})" 
                                        class="px-3 py-2 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                                    üóëÔ∏è ÏÇ≠Ï†ú
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-4 pt-4 border-t border-gray-200">
                            <div class="text-center">
                                <p class="text-sm text-gray-600">ÌéòÏù¥ÏßÄ</p>
                                <p class="text-2xl font-bold text-purple-600">\${pagesInFolder}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Ï°∞ÌöåÏàò</p>
                                <p class="text-2xl font-bold text-green-600">\${viewsInFolder.toLocaleString()}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">ÏÉùÏÑ±Ïùº</p>
                                <p class="text-sm font-medium text-gray-900">\${new Date(folder.created_at).toLocaleDateString('ko-KR')}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">ÏµúÏ¢Ö ÏàòÏ†ï</p>
                                <p class="text-sm font-medium text-gray-900">\${lastUpdated}</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <a href="/tools/landing-manager" class="block text-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                üìÑ Ìè¥Îçî ÎÇ¥ ÌéòÏù¥ÏßÄ Î≥¥Í∏∞
                            </a>
                        </div>
                    </div>
                \`;
            }).join('');

            container.innerHTML = foldersHtml;
        }

        // ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞ Î™®Îã¨
        function openNewFolderModal() {
            document.getElementById('newFolderName').value = '';
            document.getElementById('newFolderDescription').value = '';
            document.getElementById('newFolderModal').classList.remove('hidden');
        }

        function closeNewFolderModal() {
            document.getElementById('newFolderModal').classList.add('hidden');
        }

        async function createNewFolder() {
            const name = document.getElementById('newFolderName').value.trim();
            const description = document.getElementById('newFolderDescription').value.trim();
            
            if (!name) {
                alert('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/api/landing/folders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        userId: user.id, 
                        name,
                        description: description || null
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                    closeNewFolderModal();
                    loadData();
                } else {
                    alert('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
            }
        }

        // Ìè¥Îçî ÏàòÏ†ï Î™®Îã¨
        function openEditFolderModal(id, name, description) {
            document.getElementById('editFolderId').value = id;
            document.getElementById('editFolderName').value = name;
            document.getElementById('editFolderDescription').value = description;
            document.getElementById('editFolderModal').classList.remove('hidden');
        }

        function closeEditFolderModal() {
            document.getElementById('editFolderModal').classList.add('hidden');
        }

        async function updateFolder() {
            const id = document.getElementById('editFolderId').value;
            const name = document.getElementById('editFolderName').value.trim();
            const description = document.getElementById('editFolderDescription').value.trim();
            
            if (!name) {
                alert('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/api/landing/folders/' + id, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description: description || null })
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Ìè¥ÎçîÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§!');
                    closeEditFolderModal();
                    loadData();
                } else {
                    alert('Ìè¥Îçî ÏàòÏ†ï Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
            }
        }

        async function deleteFolder(id) {
            const folder = allFolders.find(f => f.id === id);
            const pagesInFolder = allPages.filter(p => p.folder_id === id).length;
            
            if (pagesInFolder > 0) {
                if (!confirm(\`Ïù¥ Ìè¥ÎçîÏóêÎäî \${pagesInFolder}Í∞úÏùò ÌéòÏù¥ÏßÄÍ∞Ä ÏûàÏäµÎãàÎã§.\\nÌè¥ÎçîÎ•º ÏÇ≠Ï†úÌïòÎ©¥ ÌéòÏù¥ÏßÄÎì§ÏùÄ ÎØ∏Î∂ÑÎ•ò ÏÉÅÌÉúÍ∞Ä Îê©ÎãàÎã§.\\nÏ†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) {
                    return;
                }
            } else {
                if (!confirm('Ìè¥ÎçîÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }
            }

            try {
                const response = await fetch('/api/landing/folders/' + id + '?userId=' + user.id, {
                    method: 'DELETE'
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Ìè¥ÎçîÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    loadData();
                } else {
                    alert('Ìè¥Îçî ÏÇ≠Ï†ú Ïã§Ìå®: ' + result.error);
                }
            } catch (err) {
                alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
            }
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/';
        }
        </script>
    </body>
    </html>
  `)
})

// ÌöåÏÇ¨ ÏÜåÍ∞ú ÌéòÏù¥ÏßÄ
app.get('/about', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌöåÏÇ¨ ÏÜåÍ∞ú - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-white">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <a href="/" class="flex items-center space-x-3">
                        <span class="text-xl font-bold text-gray-900">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-10">
                        <a href="/" class="text-gray-700 hover:text-purple-600 font-medium">Ìôà</a>
                        <a href="/programs" class="text-gray-700 hover:text-purple-600 font-medium">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a>
                        <a href="/success" class="text-gray-700 hover:text-purple-600 font-medium">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a>
                        <a href="/about" class="text-purple-600 font-medium">ÌöåÏÇ¨ ÏÜåÍ∞ú</a>
                        <a href="/contact" class="text-gray-700 hover:text-purple-600 font-medium">Î¨∏ÏùòÌïòÍ∏∞</a>
                        <a href="/login" class="gradient-purple text-white px-6 py-2.5 rounded-full font-medium">Î°úÍ∑∏Ïù∏</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="pt-32 pb-20 px-6 bg-gradient-to-br from-purple-50 to-white">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
                    Ïö∞Î¶¨Îäî<br>
                    <span class="text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</span>
                </h1>
                <p class="text-xl lg:text-2xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
                    ÌòÑÏóÖ ÌïôÏõêÏû•Ïù¥ ÏßÅÏ†ë Ïö¥ÏòÅÌïòÎ©∞<br>
                    Ï†ÑÍµ≠ 500Í∞ú ÌïôÏõêÏùò ÏÑ±Í≥µÏùÑ Ìï®ÍªòÌïú<br>
                    <span class="font-bold text-gray-900">ÌïôÏõê ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏ ÍµêÏú° Í∏∞ÏóÖ</span>ÏûÖÎãàÎã§
                </p>
            </div>
        </section>

        <!-- Story Section -->
        <section class="py-20 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="grid lg:grid-cols-2 gap-16 items-center">
                    <div>
                        <h2 class="text-4xl font-bold text-gray-900 mb-6">Ïö∞Î¶¨Ïùò ÏãúÏûë</h2>
                        <div class="space-y-4 text-lg text-gray-600 leading-relaxed">
                            <p>
                                Ïù∏Ï≤ú ÏÑúÍµ¨ÏóêÏÑú <strong class="text-gray-900">Íæ∏Î©îÎïÖÌïôÏõê</strong>ÏùÑ Ïö¥ÏòÅÌïòÎçò Ïö∞Î¶¨ Î∂ÄÎ∂ÄÎäî 
                                Ï≤òÏùåÏóêÎäî ÌïôÏÉù Î™®ÏßëÏóê ÌÅ∞ Ïñ¥Î†§ÏõÄÏùÑ Í≤™ÏóàÏäµÎãàÎã§.
                            </p>
                            <p>
                                ÌïòÏßÄÎßå ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî, Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ, ÌçºÎÑê ÏãúÏä§ÌÖúÏùÑ 
                                ÏßÅÏ†ë Í≥µÎ∂ÄÌïòÍ≥† Ï†ÅÏö©ÌïòÎ©¥ÏÑú <strong class="text-purple-600">ÎÜÄÎùºÏö¥ Î≥ÄÌôî</strong>Î•º Í≤ΩÌóòÌñàÏäµÎãàÎã§.
                            </p>
                            <p>
                                3Í∞úÏõî ÎßåÏóê Ïã†Í∑ú Î¨∏ÏùòÍ∞Ä 2Î∞∞ Ï¶ùÍ∞ÄÌñàÍ≥†,<br>
                                1ÎÖÑ ÎßåÏóê ÌïôÏõê Í∑úÎ™®Í∞Ä 3Î∞∞Î°ú ÏÑ±Ïû•ÌñàÏäµÎãàÎã§.
                            </p>
                            <p class="text-gray-900 font-bold">
                                "Ïù¥ ÎÖ∏ÌïòÏö∞Î•º Îã§Î•∏ ÌïôÏõêÏû•ÎãòÎì§Í≥º ÎÇòÎàÑÍ≥† Ïã∂Îã§"<br>
                                Í∑∏Î†áÍ≤å 'Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§'Í∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.
                            </p>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-3xl p-12">
                        <div class="space-y-8">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full gradient-purple flex items-center justify-center text-white font-bold flex-shrink-0">1</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 mb-2">2015ÎÖÑ</h3>
                                    <p class="text-gray-600">Íæ∏Î©îÎïÖÌïôÏõê Í∞úÏõê, ÌïôÏÉù Î™®Ïßë Ïñ¥Î†§ÏõÄ</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full gradient-purple flex items-center justify-center text-white font-bold flex-shrink-0">2</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 mb-2">2020ÎÖÑ</h3>
                                    <p class="text-gray-600">ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ ÎèÖÌïô, 1ÏúÑ Îã¨ÏÑ±</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full gradient-purple flex items-center justify-center text-white font-bold flex-shrink-0">3</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 mb-2">2021ÎÖÑ</h3>
                                    <p class="text-gray-600">Ïò§ÌîàÏ±ÑÌåÖÎ∞© ÏãúÏûë, ÎÖ∏ÌïòÏö∞ Í≥µÏú†</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full gradient-purple flex items-center justify-center text-white font-bold flex-shrink-0">4</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 mb-2">2022ÎÖÑ~ÌòÑÏû¨</h3>
                                    <p class="text-gray-600">Ï†ÑÍµ≠ 500Í∞ú ÌïôÏõê ÍµêÏú° ÏßÑÌñâ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Values Section -->
        <section class="py-20 px-6 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Ïö∞Î¶¨Ïùò Í∞ÄÏπò</h2>
                    <p class="text-xl text-gray-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§Î•º ÎßåÎìúÎäî 3Í∞ÄÏßÄ ÏõêÏπô</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white rounded-3xl p-10 text-center">
                        <div class="w-20 h-20 gradient-purple rounded-2xl flex items-center justify-center mx-auto mb-6">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Ïã§Ï†Ñ Í≤ΩÌóò</h3>
                        <p class="text-gray-600 leading-relaxed">
                            Ïù¥Î°†Ïù¥ ÏïÑÎãå Ïö∞Î¶¨Í∞Ä ÏßÅÏ†ë ÌïôÏõêÏùÑ Ïö¥ÏòÅÌïòÎ©∞ Í≤ÄÏ¶ùÌïú 
                            Ïã§Ï†Ñ ÎßàÏºÄÌåÖ ÎÖ∏ÌïòÏö∞Îßå Ï†ÑÎã¨Ìï©ÎãàÎã§
                        </p>
                    </div>

                    <div class="bg-white rounded-3xl p-10 text-center">
                        <div class="w-20 h-20 bg-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Ïª§ÎÆ§ÎãàÌã∞</h3>
                        <p class="text-gray-600 leading-relaxed">
                            Ïò§ÌîàÏ±ÑÌåÖÎ∞©Í≥º Ïò§ÌîÑÎùºÏù∏ Î™®ÏûÑÏùÑ ÌÜµÌï¥ 
                            Ï†ÑÍµ≠ ÌïôÏõêÏû•ÎãòÎì§Í≥º Ìï®Íªò ÏÑ±Ïû•Ìï©ÎãàÎã§
                        </p>
                    </div>

                    <div class="bg-white rounded-3xl p-10 text-center">
                        <div class="w-20 h-20 gradient-purple rounded-2xl flex items-center justify-center mx-auto mb-6">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">ÏßÄÏÜç ÏÑ±Ïû•</h3>
                        <p class="text-gray-600 leading-relaxed">
                            ÏùºÌöåÏÑ± ÍµêÏú°Ïù¥ ÏïÑÎãå ÏßÄÏÜçÏ†ÅÏù∏ ÏΩòÌÖêÏ∏† ÏóÖÎç∞Ïù¥Ìä∏ÏôÄ 
                            Ïã§ÏãúÍ∞Ñ Q&AÎ°ú Í≥ÑÏÜç Ìï®ÍªòÌï©ÎãàÎã§
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Achievements Section -->
        <section class="py-20 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Ïö∞Î¶¨Ïùò ÏÑ±Í≥º</h2>
                    <p class="text-xl text-gray-600">Ïà´ÏûêÎ°ú Ï¶ùÎ™ÖÌïòÎäî Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞</p>
                </div>

                <div class="grid md:grid-cols-4 gap-8">
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-3">500+</div>
                        <div class="text-lg text-gray-700 font-medium">ÍµêÏú° ÏàòÎ£å ÌïôÏõê</div>
                        <div class="text-sm text-gray-500 mt-2">Ï†ÑÍµ≠ Í∞ÅÏßÄÏùò ÌïôÏõê</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-orange-500 mb-3">95%</div>
                        <div class="text-lg text-gray-700 font-medium">ÎßåÏ°±ÎèÑ</div>
                        <div class="text-sm text-gray-500 mt-2">Ïã§Ï†ú Ìö®Í≥º Ï≤¥Í∞ê</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-purple-600 mb-3">24/7</div>
                        <div class="text-lg text-gray-700 font-medium">Ïª§ÎÆ§ÎãàÌã∞ Ïö¥ÏòÅ</div>
                        <div class="text-sm text-gray-500 mt-2">Ïã§ÏãúÍ∞Ñ ÏßàÏùòÏùëÎãµ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-orange-500 mb-3">4ÎÖÑ+</div>
                        <div class="text-lg text-gray-700 font-medium">Ïö¥ÏòÅ Í≤ΩÌóò</div>
                        <div class="text-sm text-gray-500 mt-2">Ï∂ïÏ†ÅÎêú ÎÖ∏ÌïòÏö∞</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team Section -->
        <section class="py-20 px-6 bg-gradient-to-br from-purple-50 to-blue-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">ÎåÄÌëú ÏÜåÍ∞ú</h2>
                    <p class="text-xl text-gray-600">ÌòÑÏóÖ ÌïôÏõêÏû•Ïù¥ ÏßÅÏ†ë Í∞ÄÎ•¥Ïπ©ÎãàÎã§</p>
                </div>

                <div class="grid md:grid-cols-2 gap-12 max-w-5xl mx-auto">
                    <div class="bg-white rounded-3xl p-10">
                        <div class="w-64 h-64 mx-auto mb-6 rounded-3xl overflow-hidden">
                            <img src="/static/images/ceo-ko-heejun.jpg" 
                                 alt="Í≥†Ìù¨Ï§Ä ÎåÄÌëúÏù¥ÏÇ¨" 
                                 class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">Í≥†Ìù¨Ï§Ä ÎåÄÌëúÏù¥ÏÇ¨</h3>
                        <p class="text-center text-purple-600 font-medium mb-6">CEO ¬∑ Ïù∏Î¨∏Ìïô Î∞ïÏÇ¨</p>
                        <div class="space-y-3 text-gray-600">
                            <p>‚úì 2005~ Í≥µÎ∂ÄÎ∞© ÏãúÏûë</p>
                            <p>‚úì 2012~ Ïù∏Î¨∏Ìïô Î∞ïÏÇ¨ Ï∑®Îìù</p>
                            <p>‚úì 2015~ Íæ∏Î©îÎïÖÌïôÏõê Ï∞ΩÎ¶Ω</p>
                            <p>‚úì 2022~ (Ï£º)ÎßòÏä§Ïò® ÎåÄÌëúÏù¥ÏÇ¨</p>
                            <p>‚úì 2022~ ÌÇπÌÅ¥ÎûòÏä§ ÌïôÏõêÏû•ÏÜåÌÜµ Ïò§Ìîà</p>
                            <p>‚úì 2024~ ÌïúÍµ≠ÌïôÏõêÎåÄÌïôÍµê ÌòëÏóÖ</p>
                            <p>‚úì 2025~ (Ï£º)Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§ ÎåÄÌëúÏù¥ÏÇ¨</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl p-10">
                        <div class="w-64 h-64 mx-auto mb-6 rounded-3xl overflow-hidden">
                            <img src="/static/images/team-ko-sunwoo.jpg" 
                                 alt="Í≥†ÏÑ†Ïö∞ ÎßàÏºÄÌåÖ 1ÌåÄÏû•" 
                                 class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">Í≥†ÏÑ†Ïö∞ ÎßàÏºÄÌåÖ 1ÌåÄÏû•</h3>
                        <p class="text-center text-orange-600 font-medium mb-6">Marketing Team Leader</p>
                        <div class="space-y-3 text-gray-600">
                            <p>‚úì ÏûêÎèôÌôî ÌçºÎÑê Ï†ÑÎ¨∏Í∞Ä</p>
                            <p>‚úì Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Î∞îÏù¥Îü¥ ÏòÅÏÉÅ Ï†úÏûë</p>
                            <p>‚úì ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú</p>
                            <p>‚úì ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†úÏûë Î∞è Í∞úÎ∞ú</p>
                            <p>‚úì Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú Í∏Ä ÏûëÏÑ±</p>
                            <p>‚úì AI Ïª®ÏÑ§ÌÑ¥Ìä∏ Ï†ÑÎ¨∏Í∞Ä</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="py-20 px-6 gradient-purple">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl lg:text-5xl font-bold text-white mb-8">
                    Ìï®Íªò ÏÑ±Ïû•ÌïòÎäî ÌïôÏõêÏùÑ<br>
                    ÎßåÎì§Ïñ¥Í∞ÄÏã§ Ï§ÄÎπÑÍ∞Ä ÎêòÏÖ®ÎÇòÏöî?
                </h2>
                <p class="text-xl text-white/90 mb-12">
                    Ïö∞Î¶¨Ïùò Í≤ΩÌóòÍ≥º ÎÖ∏ÌïòÏö∞Í∞Ä Ïó¨Îü¨Î∂ÑÏùò ÌïôÏõê ÏÑ±Í≥µÏóê ÎèÑÏõÄÏù¥ ÎêòÍ∏∏ Î∞îÎûçÎãàÎã§
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/contact" class="bg-white text-purple-600 px-12 py-5 rounded-full text-lg font-medium shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all">
                        Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÍ∏∞
                    </a>
                    <a href="/programs" class="bg-white/10 backdrop-blur-sm border-2 border-white/40 text-white px-12 py-5 rounded-full text-lg font-medium hover:bg-white hover:text-purple-600 transition-all">
                        ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Î≥¥Í∏∞
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-50 text-gray-600 py-20 px-6 border-t border-gray-100">
            <div class="max-w-7xl mx-auto">
                <div class="grid md:grid-cols-4 gap-12 mb-16">
                    <div>
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-xl font-bold text-gray-900">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</span>
                        </div>
                        <p class="text-gray-500 text-sm leading-relaxed">
                            ÌïôÏõê ÎßàÏºÄÌåÖÏùò ÏÉàÎ°úÏö¥ Í∏∞Ï§Ä
                        </p>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">ÏÑúÎπÑÏä§</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/programs" class="hover:text-purple-600 transition">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</a></li>
                            <li><a href="/success" class="hover:text-purple-600 transition">ÏÑ±Í≥µ ÏÇ¨Î°Ä</a></li>
                            <li><a href="/contact" class="hover:text-purple-600 transition">Î¨∏ÏùòÌïòÍ∏∞</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">ÌöåÏÇ¨</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/about" class="hover:text-purple-600 transition">ÌöåÏÇ¨ ÏÜåÍ∞ú</a></li>
                            <li><a href="#" class="hover:text-purple-600 transition">Ïù¥Ïö©ÏïΩÍ¥Ä</a></li>
                            <li><a href="#" class="hover:text-purple-600 transition">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 mb-4">Ïó∞ÎùΩÏ≤ò</h4>
                        <ul class="space-y-3 text-sm">
                            <li>Ïù∏Ï≤úÍ¥ëÏó≠Ïãú ÏÑúÍµ¨</li>
                            <li>wangholy1@naver.com</li>
                            <li>Î¨∏Ïùò ÏñëÏãù Ïù¥Ïö© Í∞ÄÎä•</li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-200 pt-8 text-center text-gray-500 text-sm">
                    <p>&copy; 2024 Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </body>
    </html>
  `)
})

// ÎûúÎî©ÌéòÏù¥ÏßÄ Î≥¥Í∏∞ ÎùºÏö∞Ìä∏
app.get('/landing/:slug', async (c) => {
  try {
    const slug = c.req.param('slug')
    const query = 'SELECT * FROM landing_pages WHERE slug = ? AND status = ?'
    const page = await c.env.DB.prepare(query).bind(slug, 'active').first()
    
    if (!page) {
      return c.html('<h1>ÌéòÏù¥ÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</h1>', 404)
    }
    
    // Ï°∞ÌöåÏàò Ï¶ùÍ∞Ä
    await c.env.DB.prepare('UPDATE landing_pages SET view_count = view_count + 1 WHERE slug = ?').bind(slug).run()
    
    // OG Î©îÌÉÄ ÌÉúÍ∑∏ Ï∂îÍ∞Ä
    let htmlContent = page.html_content as string
    const fullUrl = `${c.req.header('origin') || 'https://superplace-academy.pages.dev'}/landing/${slug}`
    const thumbnailUrl = (page.thumbnail_url as string) || 'https://via.placeholder.com/1200x630.png?text=Super+Place+Academy'
    
    // Ïª§Ïä§ÌÖÄ OG Ï†úÎ™©/ÏÑ§Î™Ö ÎòêÎäî Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©
    const ogTitle = (page.og_title as string) || (page.title as string) || 'Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§'
    const ogDescription = (page.og_description as string) || 'Íæ∏Î©îÎïÖÌïôÏõêÏùò Ï†ÑÎ¨∏Ï†ÅÏù∏ ÍµêÏú° ÏÑúÎπÑÏä§Î•º ÎßåÎÇòÎ≥¥ÏÑ∏Ïöî'
    
    // <head> ÌÉúÍ∑∏Ïóê OG Î©îÌÉÄ ÌÉúÍ∑∏ Ï£ºÏûÖ
    const ogTags = `
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="${fullUrl}">
    <meta property="og:title" content="${ogTitle}">
    <meta property="og:description" content="${ogDescription}">
    <meta property="og:image" content="${thumbnailUrl}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="${fullUrl}">
    <meta property="twitter:title" content="${ogTitle}">
    <meta property="twitter:description" content="${ogDescription}">
    <meta property="twitter:image" content="${thumbnailUrl}">
    `
    
    // </head> ÏßÅÏ†ÑÏóê OG ÌÉúÍ∑∏ Ï∂îÍ∞Ä
    htmlContent = htmlContent.replace('</head>', `${ogTags}</head>`)
    
    // HTML Î∞òÌôò
    return c.html(htmlContent)
  } catch (err) {
    return c.html('<h1>Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</h1>', 500)
  }
})

// Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Î¶¨Îã§Ïù¥Î†âÌä∏ (Î°úÏª¨ Í∞úÎ∞úÏö©)
// ÌîÑÎ°úÎçïÏÖòÏóêÏÑúÎäî Cloudflare PagesÍ∞Ä ÏûêÎèôÏúºÎ°ú dist/admin/*.htmlÏùÑ ÏÑúÎπôÌï©ÎãàÎã§
// Admin redirects removed - using direct routes

// ==================== SMS Î∞úÏÜ° Ìó¨Ìçº Ìï®Ïàò ====================

// Aligo SMS API Î∞úÏÜ° Ìï®Ïàò
// Aligo SMS API Î∞úÏÜ° Ìï®Ïàò
async function sendSMSAligo(phone: string, message: string, apiKey: string, userId: string, sender: string, realMode: string): Promise<any> {
  const formData = new FormData()
  formData.append('key', apiKey)
  formData.append('user_id', userId)
  formData.append('sender', sender)
  formData.append('receiver', phone)
  formData.append('msg', message)
  formData.append('testmode_yn', realMode === 'Y' ? 'N' : 'Y') // realMode=YÎ©¥ Ïã§Ï†úÎ∞úÏÜ°
  
  try {
    const response = await fetch('https://apis.aligo.in/send/', {
      method: 'POST',
      body: formData
    })
    return await response.json()
  } catch (err) {
    console.error('Aligo SMS error:', err)
    return { result_code: -1, message: 'SMS Î∞úÏÜ° Ïã§Ìå®' }
  }
}

// Solapi SMS API Î∞úÏÜ° Ìï®Ïàò
async function sendSMSSolapi(phone: string, message: string, apiKey: string, apiSecret: string): Promise<any> {
  try {
    const response = await fetch('https://api.solapi.com/messages/v4/send', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        message: {
          to: phone,
          from: '01012345678', // Î∞úÏã†Î≤àÌò∏
          text: message
        }
      })
    })
    return await response.json()
  } catch (err) {
    console.error('Solapi SMS error:', err)
    return { statusCode: 500, message: 'SMS Î∞úÏÜ° Ïã§Ìå®' }
  }
}

// ==================== SMS Í¥ÄÎ¶¨ API ====================

// SMS ÌÖúÌîåÎ¶ø Î™©Î°ù
app.get('/api/sms/templates', async (c) => {
  try {
    const { results } = await c.env.DB.prepare(`
      SELECT * FROM sms_templates WHERE is_active = 1 ORDER BY category, name
    `).all()
    
    return c.json({ success: true, templates: results })
  } catch (err) {
    console.error('Get templates error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// SMS ÌÖúÌîåÎ¶ø Ï∂îÍ∞Ä
app.post('/api/sms/templates', async (c) => {
  try {
    const { name, category, content, variables } = await c.req.json()
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    const result = await c.env.DB.prepare(`
      INSERT INTO sms_templates (name, category, content, variables, created_by)
      VALUES (?, ?, ?, ?, ?)
    `).bind(name, category, content, JSON.stringify(variables || []), user.id).run()
    
    return c.json({ success: true, message: 'ÌÖúÌîåÎ¶øÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', id: result.meta.last_row_id })
  } catch (err) {
    console.error('Add template error:', err)
    return c.json({ success: false, error: 'ÌÖúÌîåÎ¶ø Ï∂îÍ∞Ä Ïã§Ìå®' }, 500)
  }
})

// SMS Ï¶âÏãú Î∞úÏÜ°
app.post('/api/sms/send', async (c) => {
  try {
    const { recipient_phone, recipient_name, message_content, template_id } = await c.req.json()
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    // ÌôòÍ≤ΩÎ≥ÄÏàòÏóêÏÑú API ÌÇ§ Í∞ÄÏ†∏Ïò§Í∏∞
    const apiKey = c.env.ALIGO_API_KEY || ''
    const userId = c.env.ALIGO_USER_ID || ''
    const sender = c.env.ALIGO_SENDER || '01012345678'
    const realMode = c.env.SMS_REAL_MODE || 'N'
    
    let smsResult = null
    let status = 'sent'
    let resultCode = null
    let resultMessage = null
    
    // API ÌÇ§Í∞Ä ÏûàÏúºÎ©¥ Ïã§Ï†ú Î∞úÏÜ° ÏãúÎèÑ
    if (apiKey && userId) {
      smsResult = await sendSMSAligo(recipient_phone, message_content, apiKey, userId, sender, realMode)
      resultCode = smsResult.result_code?.toString() || null
      resultMessage = smsResult.message || null
      
      // Î∞úÏÜ° Ïã§Ìå® Ïãú statusÎ•º failedÎ°ú
      if (smsResult.result_code !== 1) {
        status = 'failed'
      }
    }
    
    // DBÏóê Í∏∞Î°ù
    const result = await c.env.DB.prepare(`
      INSERT INTO sms_history (template_id, recipient_name, recipient_phone, message_content, status, sent_at, result_code, result_message, created_by)
      VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?, ?)
    `).bind(template_id || null, recipient_name, recipient_phone, message_content, status, resultCode, resultMessage, user.id).run()
    
    return c.json({ 
      success: status !== 'failed', 
      message: status === 'failed' ? 'SMS Î∞úÏÜ° Ïã§Ìå®: ' + resultMessage : 'SMSÍ∞Ä Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§.',
      id: result.meta.last_row_id,
      note: apiKey ? (realMode === 'Y' ? 'Ïã§Ï†ú Î∞úÏÜ° ÏôÑÎ£å' : 'ÌÖåÏä§Ìä∏ Î™®Îìú (Ïã§Ï†ú Î∞úÏÜ° ÏïàÎê®)') : 'API ÌÇ§Î•º ÏÑ§Ï†ïÌïòÎ©¥ Ïã§Ï†ú Î∞úÏÜ°Îê©ÎãàÎã§.',
      smsResult: smsResult
    })
  } catch (err) {
    console.error('Send SMS error:', err)
    return c.json({ success: false, error: 'SMS Î∞úÏÜ° Ïã§Ìå®' }, 500)
  }
})

// SMS ÏòàÏïΩ Î∞úÏÜ°
app.post('/api/sms/schedule', async (c) => {
  try {
    const { recipient_phone, recipient_name, message_content, template_id, scheduled_at } = await c.req.json()
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    const result = await c.env.DB.prepare(`
      INSERT INTO sms_history (template_id, recipient_name, recipient_phone, message_content, status, scheduled_at, created_by)
      VALUES (?, ?, ?, ?, 'scheduled', ?, ?)
    `).bind(template_id || null, recipient_name, recipient_phone, message_content, scheduled_at, user.id).run()
    
    return c.json({ 
      success: true, 
      message: 'SMSÍ∞Ä ÏòàÏïΩÎêòÏóàÏäµÎãàÎã§.',
      id: result.meta.last_row_id
    })
  } catch (err) {
    console.error('Schedule SMS error:', err)
    return c.json({ success: false, error: 'SMS ÏòàÏïΩ Ïã§Ìå®' }, 500)
  }
})

// SMS Î∞úÏÜ° Í∏∞Î°ù Ï°∞Ìöå
app.get('/api/sms/history', async (c) => {
  try {
    const { results } = await c.env.DB.prepare(`
      SELECT 
        sh.*,
        st.name as template_name
      FROM sms_history sh
      LEFT JOIN sms_templates st ON sh.template_id = st.id
      ORDER BY sh.created_at DESC
      LIMIT 100
    `).all()
    
    return c.json({ success: true, history: results })
  } catch (err) {
    console.error('Get SMS history error:', err)
    return c.json({ success: false, error: 'Î∞úÏÜ° Í∏∞Î°ù Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// SMS Î∞úÏÜ° ÌÜµÍ≥Ñ
app.get('/api/sms/stats', async (c) => {
  try {
    // Ïò§Îäò Î∞úÏÜ° Ïàò
    const today = await c.env.DB.prepare(`
      SELECT COUNT(*) as count FROM sms_history 
      WHERE DATE(created_at) = DATE('now')
    `).first()
    
    // Ïù¥Î≤à Îã¨ Î∞úÏÜ° Ïàò
    const thisMonth = await c.env.DB.prepare(`
      SELECT COUNT(*) as count FROM sms_history 
      WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now')
    `).first()
    
    // ÏÉÅÌÉúÎ≥Ñ ÌÜµÍ≥Ñ
    const byStatus = await c.env.DB.prepare(`
      SELECT status, COUNT(*) as count FROM sms_history 
      GROUP BY status
    `).all()
    
    return c.json({ 
      success: true, 
      stats: {
        today: today?.count || 0,
        thisMonth: thisMonth?.count || 0,
        byStatus: byStatus.results || []
      }
    })
  } catch (err) {
    console.error('Get SMS stats error:', err)
    return c.json({ success: false, error: 'ÌÜµÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌïôÏÉù Í¥ÄÎ¶¨ API

// GET /api/students/:id/stats - ÌïôÏÉù ÌÜµÍ≥Ñ Ï°∞Ìöå (Í∞ÄÏû• Íµ¨Ï≤¥Ï†ÅÏù∏ ÎùºÏö∞Ìä∏ Î®ºÏ†Ä) - VERIFIED
app.get('/api/students/:id/stats', async (c) => {
  try {
    const studentId = c.req.param('id')
    const startDate = c.req.query('startDate')
    const endDate = c.req.query('endDate')
    
    if (!studentId) {
      return c.json({ success: false, error: 'ÌïôÏÉù IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // daily_records ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú Í∏∞Î≥∏Í∞í Î∞òÌôò
    try {
      const stats = await c.env.DB.prepare('SELECT COUNT(*) as total_records, AVG(CASE WHEN attendance = \'Ï∂úÏÑù\' THEN 1 ELSE 0 END) * 100 as attendance_rate, AVG(understanding_level) as avg_understanding, AVG(homework_completion) as avg_homework FROM daily_records WHERE student_id = ? AND date BETWEEN ? AND ?').bind(studentId, startDate || '2020-01-01', endDate || '2099-12-31').first()
      
      return c.json({ 
        success: true, 
        stats: stats || {
          total_records: 0,
          attendance_rate: 0,
          avg_understanding: 0,
          avg_homework: 0
        }
      })
    } catch (dbError) {
      console.error('[GetStudentStats] DB Error:', dbError)
      // ÌÖåÏù¥Î∏îÏù¥ ÏóÜÍ±∞ÎÇò ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïòÎ©¥ Í∏∞Î≥∏Í∞í Î∞òÌôò
      return c.json({ 
        success: true, 
        stats: {
          total_records: 0,
          attendance_rate: 0,
          avg_understanding: 0,
          avg_homework: 0
        }
      })
    }
  } catch (error) {
    console.error('[GetStudentStats] Error:', error)
    return c.json({ 
      success: true,
      stats: {
        total_records: 0,
        attendance_rate: 0,
        avg_understanding: 0,
        avg_homework: 0
      }
    })
  }
})

// GET /api/students/:id - ÌïôÏÉù ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï°∞Ìöå
app.get('/api/students/:id', async (c) => {
  try {
    const studentId = c.req.param('id')
    
    if (!studentId) {
      return c.json({ success: false, error: 'ÌïôÏÉù IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÌïôÏÉù Ï†ïÎ≥¥ÏôÄ Î∞ò Ï†ïÎ≥¥Î•º Ìï®Íªò Ï°∞Ìöå
    const student = await c.env.DB.prepare('SELECT s.*, c.class_name FROM students s LEFT JOIN classes c ON s.class_id = c.id WHERE s.id = ? AND s.status = \'active\'').bind(studentId).first()
    
    if (!student) {
      return c.json({ 
        success: false, 
        error: 'ÌïôÏÉùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' 
      }, 404)
    }
    
    return c.json({ 
      success: true, 
      student: student 
    })
  } catch (error) {
    console.error('[GetStudentDetail] Error:', error)
    return c.json({ 
      success: false, 
      error: 'ÌïôÏÉù Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
    }, 500)
  }
})

// GET /api/students - ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå (Îß§Í∞úÎ≥ÄÏàò ÏóÜÎäî ÎùºÏö∞Ìä∏Îäî ÎÇòÏ§ëÏóê)
// GET /api/students - ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå (ÏôÑÏ†Ñ Ïû¨ÏûëÏÑ± - Îã®Ïàú Î≤ÑÏ†Ñ)
app.get('/api/students', async (c) => {
  console.log('\nüë• [GetStudents] ==========================================')
  console.log('üë• [GetStudents] Request started')
  
  try {
    // Step 1: DB Ïó∞Í≤∞ ÌôïÏù∏
    if (!c.env.DB) {
      console.error('‚ùå [GetStudents] FATAL: DB not available')
      return c.json({ success: false, error: 'DB Ïó∞Í≤∞ Ïã§Ìå®' }, 500)
    }
    console.log('‚úÖ [GetStudents] DB connection OK')
    
    // Step 2: ÏÇ¨Ïö©Ïûê ID Ï∂îÏ∂ú (Ìó§Îçî ÎòêÎäî ÏÑ∏ÏÖò)
    let userId
    
    try {
      const userHeader = c.req.header('X-User-Data-Base64')
      if (userHeader) {
        const userData = JSON.parse(decodeURIComponent(escape(atob(userHeader))))
        userId = userData.id || userData.academy_id
        console.log('üë• [GetStudents] Got userId from header:', userId)
      }
    } catch (headerErr) {
      console.log('‚ö†Ô∏è  [GetStudents] Header parse failed, trying session')
    }
    
    // ÏÑ∏ÏÖòÏóêÏÑú ÏãúÎèÑ
    if (!userId) {
      const sessionId = c.req.header('cookie')?.match(/session_id=([^;]+)/)?.[1]
      if (sessionId) {
        const session = await c.env.DB.prepare(
          "SELECT user_id FROM sessions WHERE session_id = ? AND expires_at > datetime('now')"
        ).bind(sessionId).first()
        userId = session?.user_id
        console.log('üë• [GetStudents] Got userId from session:', userId)
      }
    }
    
    if (!userId) {
      console.error('‚ùå [GetStudents] No userId')
      return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 401)
    }
    
    console.log('üë• [GetStudents] Final userId:', userId)
    
    // Step 3: Í∞ÄÏû• Îã®ÏàúÌïú ÏøºÎ¶¨ - Î™®Îì† active ÌïôÏÉù
    let students = []
    
    // Try 1: academy_idÎ°ú Ï°∞Ìöå
    try {
      console.log('üë• [GetStudents] Try 1: WHERE academy_id =', userId)
      const result1 = await c.env.DB.prepare(
        "SELECT * FROM students WHERE academy_id = ? AND status = 'active' ORDER BY id DESC"
      ).bind(userId).all()
      
      students = result1.results || []
      console.log('‚úÖ [GetStudents] SUCCESS! Found', students.length, 'students')
    } catch (err1) {
      console.log('‚ö†Ô∏è  [GetStudents] Try 1 failed:', err1.message)
      
      // Try 2: Î™®Îì† active ÌïôÏÉù
      try {
        console.log('üë• [GetStudents] Try 2: All active students')
        const result2 = await c.env.DB.prepare(
          "SELECT * FROM students WHERE status = 'active' ORDER BY id DESC LIMIT 1000"
        ).all()
        
        students = result2.results || []
        console.log('‚úÖ [GetStudents] Found', students.length, 'active students')
      } catch (err2) {
        console.log('‚ö†Ô∏è  [GetStudents] Try 2 failed:', err2.message)
        
        // Try 3: Î™®Îì† ÌïôÏÉù (ÌïÑÌÑ∞ ÏóÜÏù¥)
        try {
          console.log('üë• [GetStudents] Try 3: All students (no filter)')
          const result3 = await c.env.DB.prepare(
            'SELECT * FROM students ORDER BY id DESC LIMIT 1000'
          ).all()
          
          students = result3.results || []
          console.log('‚úÖ [GetStudents] Found', students.length, 'total students')
        } catch (err3) {
          console.error('‚ùå [GetStudents] ALL queries failed!')
          throw err3
        }
      }
    }
    
    console.log('‚úÖ [GetStudents] Returning', students.length, 'students')
    console.log('üë• [GetStudents] ==========================================\n')
    
    return c.json({ success: true, students })
    
  } catch (error) {
    console.error('‚ùå [GetStudents] FATAL ERROR:', error)
    console.error('‚ùå [GetStudents] Message:', error.message)
    console.error('‚ùå [GetStudents] Stack:', error.stack)
    console.log('üë• [GetStudents] ==========================================\n')
    
    return c.json({ 
      success: false, 
      error: 'ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®: ' + error.message
    }, 500)
  }
})


// ÌïôÏÉù Ï∂îÍ∞Ä
app.post('/api/students', async (c) => {
  try {
    console.log('‚ûï [AddStudent] ==================== START ====================')
    
    // DB Ïó∞Í≤∞ ÌôïÏù∏
    if (!c.env.DB) {
      console.error('‚ùå [AddStudent] DB not available')
      return c.json({ success: false, error: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ Ïã§Ìå®' }, 500)
    }
    console.log('‚úÖ [AddStudent] DB connected')
    
    const data = await c.req.json()
    console.log('‚ûï [AddStudent] Received data:', JSON.stringify(data, null, 2))
    
    const { 
      name, phone, grade, subjects, school,
      parent_name, parentName,
      parent_phone, parentPhone,
      notes, memo,
      classId, class_id,
      enrollmentDate, enrollment_date,
      academyId
    } = data
    
    // academyId Í≤∞Ï†ï
    let finalAcademyId = academyId || data.academyId
    
    // Ìó§ÎçîÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï∂îÏ∂ú
    try {
      const userHeader = c.req.header('X-User-Data-Base64')
      if (userHeader && !finalAcademyId) {
        const userData = JSON.parse(decodeURIComponent(escape(atob(userHeader))))
        finalAcademyId = userData.id || userData.academy_id
        console.log('‚ûï [AddStudent] Academy ID from header:', finalAcademyId)
      }
    } catch (err) {
      console.error('‚ûï [AddStudent] Header parse error:', err)
    }
    
    // ÌïÑÎìúÎ™Ö ÌÜµÏùº (camelCaseÏôÄ snake_case Î™®Îëê ÏßÄÏõê)
    const finalParentName = parentName || parent_name
    const finalParentPhone = parentPhone || parent_phone
    const finalNotes = memo || notes
    const finalClassId = classId || class_id
    const finalEnrollmentDate = enrollmentDate || enrollment_date || new Date().toISOString().split('T')[0]
    
    console.log('‚ûï [AddStudent] Final values:', {
      name,
      grade,
      finalParentName,
      finalParentPhone,
      finalAcademyId,
      finalClassId
    })
    
    // ÌïÑÏàò Ìï≠Î™© ÌôïÏù∏
    if (!name || !grade || !finalParentName || !finalParentPhone) {
      return c.json({ 
        success: false, 
        error: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (Ïù¥Î¶Ñ, ÌïôÎÖÑ, ÌïôÎ∂ÄÎ™® Ïù¥Î¶Ñ, ÌïôÎ∂ÄÎ™® Ïó∞ÎùΩÏ≤ò)' 
      }, 400)
    }
    
    if (!finalAcademyId) {
      return c.json({ success: false, error: 'ÌïôÏõê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ‚úÖ ÌïôÏÉù Ïàò ÌïúÎèÑ Ï≤¥ÌÅ¨
    console.log('üîç [AddStudent] Checking student limit...')
    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(finalAcademyId).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏöîÍ∏àÏ†úÎ•º Íµ¨Îß§Ìï¥Ï£ºÏÑ∏Ïöî.' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(finalAcademyId, subscription.id).first()

    const currentStudents = usage?.current_students || 0
    if (currentStudents >= subscription.student_limit) {
      return c.json({ 
        success: false, 
        error: `‚õî ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä Î™®Îëê ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§.\n\nÌòÑÏû¨ ÌïôÏÉù Ïàò: ${currentStudents}Î™Ö / ÌïúÎèÑ: ${subscription.student_limit}Î™Ö\n\nÎçî ÎßéÏùÄ ÌïôÏÉùÏùÑ Îì±Î°ùÌïòÏãúÎ†§Î©¥ ÏÉÅÏúÑ ÌîåÎûúÏúºÎ°ú ÏóÖÍ∑∏Î†àÏù¥ÎìúÌï¥Ï£ºÏÑ∏Ïöî.` 
      }, 403)
    }
    console.log(`‚úÖ [AddStudent] Limit check passed: ${currentStudents}/${subscription.student_limit}`)
    
    // Í∞ÄÏû• Í∏∞Î≥∏Ï†ÅÏù∏ Ïª¨ÎüºÎßå ÏÇ¨Ïö© (enrollment_date ÎåÄÏã† created_at ÏÇ¨Ïö©)
    let result
    try {
      // Î®ºÏ†Ä Í∏∞Î≥∏ Ïª¨ÎüºÎßåÏúºÎ°ú ÏãúÎèÑ
      result = await c.env.DB.prepare(`
        INSERT INTO students (
          name, phone, grade, subjects, school, parent_name, parent_phone, 
          academy_id, class_id, notes, status, created_at
        )
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'active', datetime('now'))
      `).bind(
        name, 
        phone || null, 
        grade, 
        subjects || '', 
        school || null,
        finalParentName, 
        finalParentPhone, 
        finalAcademyId, 
        finalClassId || null,
        finalNotes || null
      ).run()
    } catch (err1) {
      console.error('‚ûï [AddStudent] First attempt failed:', err1.message)
      
      // enrollment_date Ïª¨ÎüºÏù¥ ÏûàÎäî Í≤ΩÏö∞ ÏãúÎèÑ
      try {
        result = await c.env.DB.prepare(`
          INSERT INTO students (
            name, phone, grade, subjects, school, parent_name, parent_phone, 
            academy_id, enrollment_date, notes, status, class_id
          )
          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'active', ?)
        `).bind(
          name, 
          phone || null, 
          grade, 
          subjects || '', 
          school || null,
          finalParentName, 
          finalParentPhone, 
          finalAcademyId, 
          finalEnrollmentDate,
          finalNotes || null,
          finalClassId || null
        ).run()
      } catch (err2) {
        console.error('‚ûï [AddStudent] Second attempt failed:', err2.message)
        
        // Í∞ÄÏû• ÏµúÏÜåÌïúÏùò Ïª¨ÎüºÎßå ÏÇ¨Ïö© (school Ï†úÏô∏)
        result = await c.env.DB.prepare(`
          INSERT INTO students (
            name, grade, parent_name, parent_phone, academy_id, status
          )
          VALUES (?, ?, ?, ?, ?, 'active')
        `).bind(
          name, 
          grade, 
          finalParentName, 
          finalParentPhone, 
          finalAcademyId
        ).run()
        
        // class_idÎ•º Î≥ÑÎèÑÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
        if (finalClassId && result.meta.last_row_id) {
          try {
            await c.env.DB.prepare(
              'UPDATE students SET class_id = ? WHERE id = ?'
            ).bind(finalClassId, result.meta.last_row_id).run()
          } catch (err3) {
            console.error('‚ûï [AddStudent] Class ID update failed:', err3.message)
          }
        }
      }
    }
    
    const studentId = result.meta.last_row_id
    console.log('‚úÖ [AddStudent] Success! Student ID:', studentId)
    console.log('‚úÖ [AddStudent] Changes:', result.meta.changes)
    
    // Ï∂îÍ∞ÄÎêú ÌïôÏÉùÏùÑ Îã§Ïãú Ï°∞ÌöåÌï¥ÏÑú ÌôïÏù∏
    try {
      const verifyResult = await c.env.DB.prepare(
        'SELECT id, name, grade, academy_id FROM students WHERE id = ?'
      ).bind(studentId).first()
      console.log('‚úÖ [AddStudent] Verified student:', verifyResult)
    } catch (verifyErr) {
      console.error('‚ö†Ô∏è [AddStudent] Verification failed:', verifyErr.message)
    }
    
    console.log('‚ûï [AddStudent] ==================== END ====================')
    
    // ‚úÖ ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
    try {
      await c.env.DB.prepare(`
        UPDATE usage_tracking 
        SET current_students = current_students + 1, updated_at = CURRENT_TIMESTAMP
        WHERE academy_id = ? AND subscription_id = ?
      `).bind(finalAcademyId, subscription.id).run()
      console.log('üìà [AddStudent] Usage incremented successfully')
    } catch (usageErr) {
      console.error('‚ö†Ô∏è [AddStudent] Failed to increment usage:', usageErr)
    }
    
    return c.json({ 
      success: true, 
      message: 'ÌïôÏÉùÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 
      id: studentId 
    })
  } catch (err) {
    console.error('‚ûï [AddStudent] Error:', err)
    console.error('‚ûï [AddStudent] Stack:', err.stack)
    return c.json({ 
      success: false, 
      error: `ÌïôÏÉù Ï∂îÍ∞Ä Ïã§Ìå®: ${err.message || err}` 
    }, 500)
  }
})



// DELETE /api/students/:id - ÌïôÏÉù ÏÇ≠Ï†ú (Soft Delete)
app.delete('/api/students/:id', async (c) => {
  try {
    const studentId = c.req.param('id')
    
    console.log('[DeleteStudent] üóëÔ∏è Starting deletion for student:', studentId)
    
    if (!studentId) {
      return c.json({ success: false, error: 'ÌïôÏÉù IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // üîí Î≥¥Ïïà 1Îã®Í≥Ñ: X-User-Data-Base64 Ìó§ÎçîÏóêÏÑú academy_id Ï∂îÏ∂ú
    let academyId
    let userData
    try {
      const userHeader = c.req.header('X-User-Data-Base64')
      console.log('[DeleteStudent] üì° User header exists:', !!userHeader)
      console.log('[DeleteStudent] üì° User header length:', userHeader?.length)
      
      if (!userHeader) {
        console.error('[DeleteStudent] ‚ùå No X-User-Data-Base64 header found')
        return c.json({ success: false, error: 'Ïù∏Ï¶ù Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.' }, 401)
      }
      
      // Base64 ÎîîÏΩîÎî© - Îã§Î•∏ APIÏôÄ ÎèôÏùºÌïú Î∞©Ïãù ÏÇ¨Ïö©
      const decoded = atob(userHeader)
      console.log('[DeleteStudent] üîì Decoded length:', decoded.length)
      
      // JSON ÌååÏã±
      userData = JSON.parse(decoded)
      console.log('[DeleteStudent] üë§ Parsed user data:', {
        id: userData.id,
        academy_id: userData.academy_id,
        user_type: userData.user_type,
        email: userData.email
      })
      
      academyId = userData.id || userData.academy_id
      console.log('[DeleteStudent] üè´ Extracted academy ID:', academyId)
      
    } catch (err) {
      console.error('[DeleteStudent] ‚ùå Failed to parse user header:', err)
      console.error('[DeleteStudent] ‚ùå Error stack:', err.stack)
      return c.json({ 
        success: false, 
        error: 'Ïù∏Ï¶ù Ï†ïÎ≥¥ ÌååÏã± Ïã§Ìå®. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.',
        details: err.message 
      }, 400)
    }
    
    if (!academyId) {
      console.error('[DeleteStudent] ‚ùå No academy ID in user data:', userData)
      return c.json({ success: false, error: 'ÌïôÏõê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }
    
    console.log('[DeleteStudent] Soft deleting student:', studentId, 'academy:', academyId)
    
    // üîí Î≥¥Ïïà 2Îã®Í≥Ñ: Ìï¥Îãπ ÌïôÏÉùÏù¥ ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò ÌïôÏõê ÏÜåÏÜçÏù∏ÏßÄ ÌôïÏù∏
    const studentCheck = await c.env.DB.prepare(`
      SELECT id, academy_id FROM students WHERE id = ?
    `).bind(studentId).first()
    
    if (!studentCheck) {
      return c.json({ 
        success: false, 
        error: 'Ìï¥Îãπ ÌïôÏÉùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' 
      }, 404)
    }
    
    if (studentCheck.academy_id !== academyId) {
      console.error('[DeleteStudent] Security breach attempt:', {
        studentId,
        studentAcademyId: studentCheck.academy_id,
        userAcademyId: academyId
      })
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    // üîí Î≥¥Ïïà 3Îã®Í≥Ñ: academy_id Ï°∞Í±¥ Ï∂îÍ∞ÄÌïòÏó¨ Ïù¥Ï§ë ÌôïÏù∏
    const result = await c.env.DB.prepare(`
      UPDATE students 
      SET status = 'deleted', updated_at = CURRENT_TIMESTAMP
      WHERE id = ? AND academy_id = ?
    `).bind(studentId, academyId).run()
    
    if (result.meta.changes === 0) {
      return c.json({ 
        success: false, 
        error: 'ÌïôÏÉù ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' 
      }, 400)
    }
    
    console.log('[DeleteStudent] Successfully soft deleted student')
    return c.json({ 
      success: true, 
      message: 'ÌïôÏÉùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (error) {
    console.error('[DeleteStudent] Error:', error)
    return c.json({ 
      success: false, 
      error: 'ÌïôÏÉù ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
    }, 500)
  }
})

// ÌïôÏÉù Ï†ïÎ≥¥ ÏàòÏ†ï
app.put('/api/students/:id', async (c) => {
  try {
    const studentId = c.req.param('id')
    const data = await c.req.json()
    
    console.log('‚úèÔ∏è [UpdateStudent] Updating student:', studentId)
    console.log('‚úèÔ∏è [UpdateStudent] Data:', data)
    
    const { 
      name, phone, grade, subjects, school,
      parentName, parentPhone,
      classId, enrollmentDate, memo
    } = data
    
    // ÌïÑÏàò Ìï≠Î™© ÌôïÏù∏
    if (!name || !grade || !parentName || !parentPhone) {
      return c.json({ 
        success: false, 
        error: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (Ïù¥Î¶Ñ, ÌïôÎÖÑ, ÌïôÎ∂ÄÎ™® Ïù¥Î¶Ñ, ÌïôÎ∂ÄÎ™® Ïó∞ÎùΩÏ≤ò)' 
      }, 400)
    }
    
    // UPDATE ÏøºÎ¶¨ (Í∞ÄÎä•Ìïú Î™®Îì† ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏)
    try {
      const result = await c.env.DB.prepare(`
        UPDATE students 
        SET name = ?, phone = ?, grade = ?, subjects = ?, school = ?,
            parent_name = ?, parent_phone = ?, class_id = ?, 
            enrollment_date = ?, notes = ?
        WHERE id = ?
      `).bind(
        name,
        phone || null,
        grade,
        subjects || '',
        school || null,
        parentName,
        parentPhone,
        classId || null,
        enrollmentDate || null,
        memo || null,
        studentId
      ).run()
      
      console.log('‚úÖ [UpdateStudent] Updated rows:', result.meta.changes)
      
      if (result.meta.changes === 0) {
        return c.json({ success: false, error: 'ÌïôÏÉùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
      }
      
      return c.json({ 
        success: true, 
        message: 'ÌïôÏÉù Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.',
        id: studentId
      })
      
    } catch (err) {
      console.error('‚ùå [UpdateStudent] Error:', err)
      return c.json({ 
        success: false, 
        error: 'ÌïôÏÉù Ï†ïÎ≥¥ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
        details: err.message 
      }, 500)
    }
    
  } catch (error) {
    console.error('‚ùå [UpdateStudent] Fatal error:', error)
    return c.json({ 
      success: false, 
      error: 'ÌïôÏÉù Ï†ïÎ≥¥ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' 
    }, 500)
  }
})

// ÌïôÏÉù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ (Î¶¨Îã§Ïù¥Î†âÌä∏)
app.get('/tools/student-management', (c) => {
  return c.redirect('/students')
})

// AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏ ÌéòÏù¥ÏßÄ
app.get('/tools/ai-learning-report', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
        <div class="max-w-7xl mx-auto p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900">ü§ñ AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h1>
                <a href="/dashboard" class="px-6 py-3 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition">
                    ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                </a>
            </div>

            <!-- ÏïàÎÇ¥ Ïπ¥Îìú -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-8 text-white mb-8">
                <h2 class="text-2xl font-bold mb-4">‚ú® AIÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                        <div class="text-3xl mb-2">üìä</div>
                        <div class="font-bold mb-1">ÏÑ±Ï†Å Î∂ÑÏÑù</div>
                        <div class="text-sm text-white/90">Í≥ºÎ™©Î≥Ñ ÏÑ±Ï†Å Ï∂îÏù¥ÏôÄ Í∞ïÏïΩÏ†ê ÌååÏïÖ</div>
                    </div>
                    <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                        <div class="text-3xl mb-2">üìà</div>
                        <div class="font-bold mb-1">ÌïôÏäµ Ìå®ÌÑ¥</div>
                        <div class="text-sm text-white/90">Ï∂úÏÑùÎ•†, ÌïôÏäµ ÌÉúÎèÑ Ï¢ÖÌï© Î∂ÑÏÑù</div>
                    </div>
                    <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                        <div class="text-3xl mb-2">üí°</div>
                        <div class="font-bold mb-1">ÎßûÏ∂§ Ï∂îÏ≤ú</div>
                        <div class="text-sm text-white/90">Í∞úÏù∏Î≥Ñ ÌïôÏäµ Ï†ÑÎûµ Ï†úÏãú</div>
                    </div>
                </div>
            </div>

            <!-- Ìè¥Îçî Í¥ÄÎ¶¨ ÏÑπÏÖò -->
            <div class="bg-white rounded-2xl p-8 border border-gray-200 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">üìÅ Î¶¨Ìè¨Ìä∏ Ìè¥Îçî</h2>
                    <button onclick="showCreateFolderModal()" class="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition">
                        + ÏÉà Ìè¥Îçî
                    </button>
                </div>
                
                <div id="foldersList" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <p class="text-gray-500 col-span-full text-center py-8">Ìè¥ÎçîÎ•º ÏÉùÏÑ±ÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>
                </div>
            </div>

            <!-- Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± ÏÑπÏÖò -->
            <div class="bg-white rounded-2xl p-8 border border-gray-200 mb-8">
                <h2 class="text-2xl font-bold mb-6">üìù Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±</h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ï†ÄÏû•Ìï† Ìè¥Îçî</label>
                        <select id="folderSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Ìè¥Îçî ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÌïôÏÉù ÏÑ†ÌÉù</label>
                        <select id="studentSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î¶¨Ìè¨Ìä∏ Ïõî</label>
                        <input type="month" id="reportMonth" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>

                <button onclick="generateReport()" class="w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                    ü§ñ AI Î¶¨Ìè¨Ìä∏ ÏûêÎèô ÏÉùÏÑ±
                </button>

                <div id="generateResult" class="mt-4"></div>
            </div>

            <!-- ÏÉùÏÑ±Îêú Î¶¨Ìè¨Ìä∏ Î™©Î°ù -->
            <div class="bg-white rounded-2xl p-8 border border-gray-200">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">üìö ÏÉùÏÑ±Îêú Î¶¨Ìè¨Ìä∏</h2>
                    <select id="filterFolder" onchange="filterReportsByFolder()" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500">
                        <option value="">Ï†ÑÏ≤¥ Ìè¥Îçî</option>
                    </select>
                </div>
                <div id="reportsList" class="space-y-4">
                    <p class="text-gray-500 text-center py-12">Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±ÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>
                </div>
            </div>

            <!-- Ìè¥Îçî ÏÉùÏÑ± Î™®Îã¨ -->
            <div id="folderModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl max-w-md w-full p-6">
                    <h3 class="text-xl font-bold mb-4">ÏÉà Ìè¥Îçî ÎßåÎì§Í∏∞</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ìè¥Îçî Ïù¥Î¶Ñ</label>
                            <input type="text" id="folderName" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Ïòà: 2024ÎÖÑ 1ÌïôÍ∏∞">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÏÑ§Î™Ö (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                            <textarea id="folderDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Ìè¥Îçî ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ìè¥Îçî ÏÉâÏÉÅ</label>
                            <div class="grid grid-cols-6 gap-2">
                                <button onclick="selectFolderColor('#6366f1')" class="w-10 h-10 rounded-lg bg-indigo-500 hover:ring-2 ring-indigo-600" data-color="#6366f1"></button>
                                <button onclick="selectFolderColor('#8b5cf6')" class="w-10 h-10 rounded-lg bg-purple-500 hover:ring-2 ring-purple-600" data-color="#8b5cf6"></button>
                                <button onclick="selectFolderColor('#ec4899')" class="w-10 h-10 rounded-lg bg-pink-500 hover:ring-2 ring-pink-600" data-color="#ec4899"></button>
                                <button onclick="selectFolderColor('#f43f5e')" class="w-10 h-10 rounded-lg bg-rose-500 hover:ring-2 ring-rose-600" data-color="#f43f5e"></button>
                                <button onclick="selectFolderColor('#10b981')" class="w-10 h-10 rounded-lg bg-emerald-500 hover:ring-2 ring-emerald-600" data-color="#10b981"></button>
                                <button onclick="selectFolderColor('#06b6d4')" class="w-10 h-10 rounded-lg bg-cyan-500 hover:ring-2 ring-cyan-600" data-color="#06b6d4"></button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="selectedColor" value="#6366f1">
                    <div class="flex space-x-3 mt-6">
                        <button onclick="createFolder()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition">
                            ÏÉùÏÑ±
                        </button>
                        <button onclick="closeFolderModal()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400 transition">
                            Ï∑®ÏÜå
                        </button>
                    </div>
                </div>
            </div>

            <!-- Î¶¨Ìè¨Ìä∏ ÏÉÅÏÑ∏ Î™®Îã¨ -->
            <div id="reportModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center">
                        <h3 class="text-2xl font-bold">ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h3>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="reportDetail" class="p-6"></div>
                </div>
            </div>

            <!-- Î¶¨Ìè¨Ìä∏ ÏàòÏ†ï Î™®Îã¨ -->
            <div id="editReportModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center">
                        <h3 class="text-2xl font-bold">üìù Î¶¨Ìè¨Ìä∏ ÏàòÏ†ï</h3>
                        <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="editReportDetail" class="p-6"></div>
                </div>
            </div>
        </div>

        <script>
            let currentUser = null;
            let folders = [];
            let allReports = [];

            // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
            window.addEventListener('DOMContentLoaded', () => {
                const userData = localStorage.getItem('user');
                if (!userData) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/login';
                    return;
                }
                currentUser = JSON.parse(userData);
                loadFolders();
                loadStudents();
                setDefaultMonth();
            });

            // Ìè¥Îçî Î™©Î°ù Î°úÎìú
            async function loadFolders() {
                try {
                    const response = await fetch(\`/api/report-folders?academyId=\${currentUser.id}\`);
                    const data = await response.json();
                    
                    if (data.success && data.folders) {
                        folders = data.folders;
                        renderFolders();
                        updateFolderSelects();
                    }
                } catch (err) {
                    console.error('Ìè¥Îçî Î™©Î°ù Î°úÎìú Ïã§Ìå®:', err);
                }
            }

            // Ìè¥Îçî Î†åÎçîÎßÅ
            function renderFolders() {
                const container = document.getElementById('foldersList');
                if (folders.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Ìè¥ÎçîÎ•º ÏÉùÏÑ±ÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>';
                    return;
                }

                container.innerHTML = folders.map(folder => \`
                    <div class="p-4 rounded-xl border-2 hover:shadow-lg transition cursor-pointer group" 
                         style="border-color: \${folder.color}20; background: \${folder.color}10;"
                         onclick="filterByFolder(\${folder.id})">
                        <div class="flex items-center space-x-3 mb-2">
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white text-xl" 
                                 style="background: \${folder.color};">
                                üìÅ
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-gray-900">\${folder.folder_name}</div>
                                <div class="text-xs text-gray-500">\${folder.description || ''}</div>
                            </div>
                        </div>
                        <button onclick="event.stopPropagation(); deleteFolder(\${folder.id})" 
                                class="text-xs text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition">
                            ÏÇ≠Ï†ú
                        </button>
                    </div>
                \`).join('');
            }

            // Ìè¥Îçî ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ ÏóÖÎç∞Ïù¥Ìä∏
            function updateFolderSelects() {
                const folderSelect = document.getElementById('folderSelect');
                const filterFolder = document.getElementById('filterFolder');
                
                const folderOptions = folders.map(f => \`<option value="\${f.id}">\${f.folder_name}</option>\`).join('');
                
                folderSelect.innerHTML = '<option value="">Ìè¥Îçî ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)</option>' + folderOptions;
                filterFolder.innerHTML = '<option value="">Ï†ÑÏ≤¥ Ìè¥Îçî</option>' + folderOptions;
            }

            // Ìè¥Îçî ÏÉùÏÑ± Î™®Îã¨ Ïó¥Í∏∞
            function showCreateFolderModal() {
                document.getElementById('folderModal').classList.remove('hidden');
            }

            // Ìè¥Îçî ÏÉùÏÑ± Î™®Îã¨ Îã´Í∏∞
            function closeFolderModal() {
                document.getElementById('folderModal').classList.add('hidden');
                document.getElementById('folderName').value = '';
                document.getElementById('folderDescription').value = '';
            }

            // Ìè¥Îçî ÏÉâÏÉÅ ÏÑ†ÌÉù
            function selectFolderColor(color) {
                document.getElementById('selectedColor').value = color;
                document.querySelectorAll('[data-color]').forEach(btn => {
                    btn.classList.remove('ring-2');
                });
                event.target.classList.add('ring-2');
            }

            // Ìè¥Îçî ÏÉùÏÑ±
            async function createFolder() {
                const folderName = document.getElementById('folderName').value.trim();
                const description = document.getElementById('folderDescription').value.trim();
                const color = document.getElementById('selectedColor').value;

                if (!folderName) {
                    alert('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    const response = await fetch('/api/report-folders', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            academyId: currentUser.id,
                            folderName,
                            description,
                            color
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        closeFolderModal();
                        loadFolders();
                        alert('Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.');
                    } else {
                        alert('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®: ' + data.error);
                    }
                } catch (err) {
                    console.error('Ìè¥Îçî ÏÉùÏÑ± Ïã§Ìå®:', err);
                    alert('Ìè¥Îçî ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // Ìè¥Îçî ÏÇ≠Ï†ú
            async function deleteFolder(folderId) {
                if (!confirm('Ïù¥ Ìè¥ÎçîÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Ìè¥Îçî ÎÇ¥ Î¶¨Ìè¨Ìä∏Îäî Ïú†ÏßÄÎê©ÎãàÎã§)')) {
                    return;
                }

                try {
                    const response = await fetch(\`/api/report-folders/\${folderId}\`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();
                    if (data.success) {
                        loadFolders();
                        alert('Ìè¥ÎçîÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    }
                } catch (err) {
                    console.error('Ìè¥Îçî ÏÇ≠Ï†ú Ïã§Ìå®:', err);
                }
            }

            // Ìè¥ÎçîÎ≥Ñ ÌïÑÌÑ∞ÎßÅ
            function filterByFolder(folderId) {
                document.getElementById('filterFolder').value = folderId;
                filterReportsByFolder();
            }

            function filterReportsByFolder() {
                const folderId = document.getElementById('filterFolder').value;
                // Î¶¨Ìè¨Ìä∏ Î™©Î°ùÏùÑ folderIdÎ°ú ÌïÑÌÑ∞ÎßÅÌïòÏó¨ ÌëúÏãú
                // loadReportsForStudent Ìï®ÏàòÏóêÏÑú Ï≤òÎ¶¨
            }

            // Í∏∞Î≥∏ Ïõî ÏÑ§Ï†ï (Ïù¥Î≤à Îã¨)
            function setDefaultMonth() {
                const now = new Date();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                document.getElementById('reportMonth').value = \`\${year}-\${month}\`;
            }

            // ÌïôÏÉù Î™©Î°ù Î°úÎìú
            // ÌïôÎÖÑ Ï†ïÎ†¨ Ìï®Ïàò
            function sortByGrade(students) {
                const gradeOrder = {
                    'Ï¥à1': 1, 'Ï¥à2': 2, 'Ï¥à3': 3, 'Ï¥à4': 4, 'Ï¥à5': 5, 'Ï¥à6': 6,
                    'Ï§ë1': 7, 'Ï§ë2': 8, 'Ï§ë3': 9,
                    'Í≥†1': 10, 'Í≥†2': 11, 'Í≥†3': 12
                };
                
                return students.sort((a, b) => {
                    const orderA = gradeOrder[a.grade] || 999;
                    const orderB = gradeOrder[b.grade] || 999;
                    
                    if (orderA !== orderB) {
                        return orderA - orderB;
                    }
                    
                    // Í∞ôÏùÄ ÌïôÎÖÑÏù¥Î©¥ Ïù¥Î¶ÑÏàú
                    return a.name.localeCompare(b.name, 'ko');
                });
            }

            async function loadStudents() {
                try {
                    console.log('üë• [LoadStudents] Starting to load students...');
                    
                    const userDataBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(currentUser))));
                    const response = await fetch('/api/students', {
                        headers: {
                            'X-User-Data-Base64': userDataBase64
                        }
                    });
                    const data = await response.json();
                    
                    console.log('üë• [LoadStudents] Response:', data.success, 'Students count:', data.students?.length);
                    
                    const select = document.getElementById('studentSelect');
                    select.innerHTML = '<option value="">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                    
                    if (data.success && data.students && data.students.length > 0) {
                        // ÌïôÎÖÑÎ≥ÑÎ°ú Ï†ïÎ†¨
                        const sortedStudents = sortByGrade([...data.students]);
                        
                        console.log('üë• [LoadStudents] Sorted students:', sortedStudents.length);
                        
                        // Ï†ïÎ†¨Îêú ÌïôÏÉù Î™©Î°ù ÌëúÏãú
                        sortedStudents.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.id;
                            option.textContent = \`\${student.name} (\${student.grade})\`;
                            select.appendChild(option);
                        });
                        
                        console.log('‚úÖ [LoadStudents] Students loaded successfully');
                    } else {
                        console.warn('‚ö†Ô∏è [LoadStudents] No students found');
                        select.innerHTML += '<option disabled>Îì±Î°ùÎêú ÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§</option>';
                    }
                } catch (err) {
                    console.error('‚ùå [LoadStudents] Error:', err);
                    console.error('‚ùå [LoadStudents] Error message:', err.message);
                    console.error('‚ùå [LoadStudents] Error stack:', err.stack);
                }
            }

            // AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±
            async function generateReport() {
                const studentId = document.getElementById('studentSelect').value;
                const reportMonth = document.getElementById('reportMonth').value;
                const folderId = document.getElementById('folderSelect').value;
                const resultDiv = document.getElementById('generateResult');

                if (!studentId) {
                    resultDiv.innerHTML = '<div class="p-4 bg-red-50 text-red-600 rounded-xl">ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.</div>';
                    return;
                }

                if (!reportMonth) {
                    resultDiv.innerHTML = '<div class="p-4 bg-red-50 text-red-600 rounded-xl">Î¶¨Ìè¨Ìä∏ ÏõîÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.</div>';
                    return;
                }

                resultDiv.innerHTML = '<div class="p-4 bg-blue-50 text-blue-600 rounded-xl">ü§ñ AIÍ∞Ä Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>';

                try {
                    const response = await fetch('/api/learning-reports/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            student_id: studentId,
                            report_month: reportMonth,
                            folder_id: folderId || null
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        resultDiv.innerHTML = \`
                            <div class="p-6 bg-green-50 border-2 border-green-200 rounded-xl">
                                <div class="text-green-600 font-bold text-lg mb-3">‚úÖ AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å!</div>
                                <div class="grid grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <div class="text-gray-600 mb-1">ÌèâÍ∑† Ï†êÏàò</div>
                                        <div class="text-2xl font-bold text-green-600">\${data.preview.overall_score}Ï†ê</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-600 mb-1">Ï∂úÏÑùÎ•†</div>
                                        <div class="text-2xl font-bold text-blue-600">\${data.preview.attendance_rate}%</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-600 mb-1">ÌïôÏäµ ÌÉúÎèÑ</div>
                                        <div class="text-2xl font-bold text-purple-600">\${data.preview.study_attitude}</div>
                                    </div>
                                </div>
                                <button onclick="viewReport(\${data.report_id})" class="mt-4 w-full px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition">
                                    üìÑ Î¶¨Ìè¨Ìä∏ ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                                </button>
                            </div>
                        \`;
                        loadReportsForStudent(studentId);
                    } else {
                        resultDiv.innerHTML = \`
                            <div class="p-6 bg-red-50 border-2 border-red-200 rounded-xl">
                                <div class="text-red-600 font-bold text-lg mb-3">‚ùå AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ïã§Ìå®</div>
                                <div class="text-gray-700 whitespace-pre-line">\${data.error}</div>
                            </div>
                        \`;
                    }
                } catch (err) {
                    console.error('Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ïã§Ìå®:', err);
                    resultDiv.innerHTML = '<div class="p-4 bg-red-50 text-red-600 rounded-xl">Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
                }
            }

            // ÌïôÏÉùÎ≥Ñ Î¶¨Ìè¨Ìä∏ Î™©Î°ù Î°úÎìú
            async function loadReportsForStudent(studentId) {
                try {
                    const response = await fetch(\`/api/learning-reports/\${studentId}\`);
                    const data = await response.json();

                    const listDiv = document.getElementById('reportsList');
                    
                    if (data.success && data.reports && data.reports.length > 0) {
                        listDiv.innerHTML = data.reports.map(report => \`
                            <div class="p-6 border-2 border-gray-200 rounded-xl hover:border-purple-400 transition">
                                <div class="flex justify-between items-start mb-4">
                                    <div onclick="viewReport(\${report.id})" class="cursor-pointer flex-1">
                                        <div class="text-lg font-bold text-gray-900">\${report.report_month} Î¶¨Ìè¨Ìä∏</div>
                                        <div class="text-sm text-gray-600">\${new Date(report.created_at).toLocaleDateString('ko-KR')}</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium">\${report.study_attitude}</span>
                                        <button onclick="event.stopPropagation(); editReport(\${report.id})" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition text-sm">
                                            <i class="fas fa-edit"></i> ÏàòÏ†ï
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-sm" onclick="viewReport(\${report.id})" class="cursor-pointer">
                                    <div class="text-gray-600">ÌèâÍ∑† Ï†êÏàò: <span class="font-bold text-gray-900">\${report.overall_score}Ï†ê</span></div>
                                    <div class="text-gray-600">ÏÉùÏÑ±Ïùº: <span class="font-bold text-gray-900">\${new Date(report.created_at).toLocaleDateString('ko-KR')}</span></div>
                                </div>
                            </div>
                        \`).join('');
                    } else {
                        listDiv.innerHTML = \`
                            <div class="text-center py-12 bg-gray-50 rounded-xl">
                                <div class="text-6xl mb-4">üìã</div>
                                <div class="text-xl font-bold text-gray-900 mb-2">ÏÉùÏÑ±Îêú Î¶¨Ìè¨Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>
                                <div class="text-gray-600">ÌïôÏÉùÍ≥º Î¶¨Ìè¨Ìä∏ ÏõîÏùÑ ÏÑ†ÌÉùÌïú ÌõÑ 'Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±ÌïòÍ∏∞' Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.</div>
                            </div>
                        \`;
                    }
                } catch (err) {
                    console.error('Î¶¨Ìè¨Ìä∏ Î™©Î°ù Î°úÎìú Ïã§Ìå®:', err);
                }
            }

            // Î¶¨Ìè¨Ìä∏ ÏÉÅÏÑ∏ Î≥¥Í∏∞
            async function viewReport(reportId) {
                try {
                    const response = await fetch(\`/api/learning-reports/detail/\${reportId}\`);
                    const data = await response.json();

                    if (data.success && data.report) {
                        const report = data.report;
                        document.getElementById('reportDetail').innerHTML = \`
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl">
                                    <div class="text-sm text-gray-600 mb-2">\${report.report_month}</div>
                                    <div class="text-2xl font-bold text-gray-900 mb-2">\${report.student_name} ÌïôÏÉù ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
                                    <div class="flex gap-4 text-sm">
                                        <span class="px-3 py-1 bg-purple-500 text-white rounded-full">\${report.study_attitude}</span>
                                        <span class="px-3 py-1 bg-pink-500 text-white rounded-full">ÌèâÍ∑† \${report.overall_score}Ï†ê</span>
                                    </div>
                                </div>

                                <div class="border-l-4 border-green-500 pl-4">
                                    <div class="text-sm text-gray-600 mb-1">üí™ Í∞ïÏ†ê</div>
                                    <div class="text-gray-900">\${report.strengths}</div>
                                </div>

                                <div class="border-l-4 border-yellow-500 pl-4">
                                    <div class="text-sm text-gray-600 mb-1">üéØ Í∞úÏÑ† ÌïÑÏöî</div>
                                    <div class="text-gray-900">\${report.weaknesses}</div>
                                </div>

                                <div class="border-l-4 border-blue-500 pl-4">
                                    <div class="text-sm text-gray-600 mb-1">üìù Í∞úÏÑ†ÏÇ¨Ìï≠</div>
                                    <div class="text-gray-900">\${report.improvements}</div>
                                </div>

                                <div class="border-l-4 border-purple-500 pl-4">
                                    <div class="text-sm text-gray-600 mb-1">üí° ÏÑ†ÏÉùÎãòÏùò Ï∂îÏ≤ú</div>
                                    <div class="text-gray-900">\${report.recommendations}</div>
                                </div>

                                <div class="border-l-4 border-pink-500 pl-4">
                                    <div class="text-sm text-gray-600 mb-1">üéØ Îã§Ïùå Îã¨ Î™©Ìëú</div>
                                    <div class="text-gray-900">\${report.next_month_goals}</div>
                                </div>

                                <div class="bg-gray-50 p-6 rounded-xl">
                                    <div class="text-sm text-gray-600 mb-2">ü§ñ AI Ï¢ÖÌï© Î∂ÑÏÑù</div>
                                    <div class="text-gray-900 whitespace-pre-line">\${report.ai_analysis}</div>
                                </div>

                                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200">
                                    <div class="text-sm text-gray-600 mb-2">üíå ÌïôÎ∂ÄÎ™®ÎãòÍªò Î≥¥ÎÇº Î©îÏãúÏßÄ</div>
                                    <div id="parentMessage\${report.id}" class="text-gray-900 whitespace-pre-line text-sm leading-relaxed">\${report.parent_message}</div>
                                    <button onclick="copyMessageById('parentMessage\${report.id}')" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition">
                                        üìã Î©îÏãúÏßÄ Î≥µÏÇ¨ÌïòÍ∏∞
                                    </button>
                                </div>
                            </div>
                        \`;
                        document.getElementById('reportModal').classList.remove('hidden');
                    }
                } catch (err) {
                    console.error('Î¶¨Ìè¨Ìä∏ ÏÉÅÏÑ∏ Ï°∞Ìöå Ïã§Ìå®:', err);
                    alert('Î¶¨Ìè¨Ìä∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // Î¶¨Ìè¨Ìä∏ ÏàòÏ†ï
            async function editReport(reportId) {
                try {
                    const response = await fetch(\`/api/learning-reports/detail/\${reportId}\`);
                    const data = await response.json();

                    if (data.success && data.report) {
                        const report = data.report;
                        document.getElementById('editReportDetail').innerHTML = \`
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl">
                                    <div class="text-sm text-gray-600 mb-2">\${report.report_month}</div>
                                    <div class="text-2xl font-bold text-gray-900 mb-2">\${report.student_name} ÌïôÏÉù ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏ ÏàòÏ†ï</div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÌèâÍ∑† Ï†êÏàò</label>
                                    <input type="number" id="edit_overall_score" value="\${report.overall_score}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" step="0.1">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÌïôÏäµ ÌÉúÎèÑ</label>
                                    <select id="edit_study_attitude" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="Îß§Ïö∞ Ïö∞Ïàò" \${report.study_attitude === 'Îß§Ïö∞ Ïö∞Ïàò' ? 'selected' : ''}>Îß§Ïö∞ Ïö∞Ïàò</option>
                                        <option value="Ïö∞Ïàò" \${report.study_attitude === 'Ïö∞Ïàò' ? 'selected' : ''}>Ïö∞Ïàò</option>
                                        <option value="ÏñëÌò∏" \${report.study_attitude === 'ÏñëÌò∏' ? 'selected' : ''}>ÏñëÌò∏</option>
                                        <option value="Í∞úÏÑ† ÌïÑÏöî" \${report.study_attitude === 'Í∞úÏÑ† ÌïÑÏöî' ? 'selected' : ''}>Í∞úÏÑ† ÌïÑÏöî</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üí™ Í∞ïÏ†ê</label>
                                    <textarea id="edit_strengths" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.strengths}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üéØ ÏïΩÏ†ê</label>
                                    <textarea id="edit_weaknesses" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.weaknesses}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üìù Í∞úÏÑ†ÏÇ¨Ìï≠</label>
                                    <textarea id="edit_improvements" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.improvements}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üí° Ï∂îÏ≤úÏÇ¨Ìï≠</label>
                                    <textarea id="edit_recommendations" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.recommendations}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üéØ Îã§Ïùå Îã¨ Î™©Ìëú</label>
                                    <textarea id="edit_next_month_goals" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.next_month_goals}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ü§ñ AI Ï¢ÖÌï© Î∂ÑÏÑù</label>
                                    <textarea id="edit_ai_analysis" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.ai_analysis}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">üíå ÌïôÎ∂ÄÎ™®ÎãòÍªò Î≥¥ÎÇº Î©îÏãúÏßÄ</label>
                                    <textarea id="edit_parent_message" rows="8" class="w-full px-4 py-2 border border-gray-300 rounded-lg">\${report.parent_message}</textarea>
                                </div>

                                <div class="flex gap-3">
                                    <button onclick="saveReport(\${reportId})" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition font-bold">
                                        üíæ Ï†ÄÏû•ÌïòÍ∏∞
                                    </button>
                                    <button onclick="closeEditModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400 transition font-bold">
                                        Ï∑®ÏÜå
                                    </button>
                                </div>
                            </div>
                        \`;
                        document.getElementById('editReportModal').classList.remove('hidden');
                    }
                } catch (err) {
                    console.error('Î¶¨Ìè¨Ìä∏ Î°úÎìú Ïã§Ìå®:', err);
                    alert('Î¶¨Ìè¨Ìä∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // Î¶¨Ìè¨Ìä∏ Ï†ÄÏû•
            async function saveReport(reportId) {
                try {
                    const payload = {
                        overall_score: parseFloat(document.getElementById('edit_overall_score').value),
                        study_attitude: document.getElementById('edit_study_attitude').value,
                        strengths: document.getElementById('edit_strengths').value,
                        weaknesses: document.getElementById('edit_weaknesses').value,
                        improvements: document.getElementById('edit_improvements').value,
                        recommendations: document.getElementById('edit_recommendations').value,
                        next_month_goals: document.getElementById('edit_next_month_goals').value,
                        ai_analysis: document.getElementById('edit_ai_analysis').value,
                        parent_message: document.getElementById('edit_parent_message').value
                    };

                    const response = await fetch(\`/api/learning-reports/\${reportId}\`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('Î¶¨Ìè¨Ìä∏Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§!');
                        closeEditModal();
                        const studentId = document.getElementById('studentSelect').value;
                        if (studentId) {
                            loadReportsForStudent(studentId);
                        }
                    } else {
                        alert('Ï†ÄÏû• Ïã§Ìå®: ' + data.error);
                    }
                } catch (err) {
                    console.error('Î¶¨Ìè¨Ìä∏ Ï†ÄÏû• Ïã§Ìå®:', err);
                    alert('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // ÏàòÏ†ï Î™®Îã¨ Îã´Í∏∞
            function closeEditModal() {
                document.getElementById('editReportModal').classList.add('hidden');
            }

            // Î™®Îã¨ Îã´Í∏∞
            function closeModal() {
                document.getElementById('reportModal').classList.add('hidden');
            }

            // Î©îÏãúÏßÄ Î≥µÏÇ¨
            function copyMessageById(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    const message = element.textContent;
                    navigator.clipboard.writeText(message).then(() => {
                        alert('Î©îÏãúÏßÄÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                    }).catch(err => {
                        console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                    });
                }
            }
        </script>
    </body>
    </html>
  `)
})

// Í≤ÄÏÉâÎüâ Ï°∞Ìöå ÌéòÏù¥ÏßÄ
app.get('/tools/search-volume', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Í≤ÄÏÉâÎüâ Ï°∞Ìöå - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="max-w-7xl mx-auto p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900">üîç Í≤ÄÏÉâÎüâ Ï°∞Ìöå</h1>
                <a href="/dashboard" class="px-6 py-3 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition">
                    ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                </a>
            </div>

            <!-- Í≤ÄÏÉâ ÏûÖÎ†• ÏÑπÏÖò -->
            <div class="bg-white rounded-2xl p-8 shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î∂ÑÏÑù ÌÇ§ÏõåÎìú</label>
                        <input type="text" id="keyword" placeholder="Ïòà: Ïù∏Ï≤úÏòÅÏñ¥ÌïôÏõê" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <p class="text-sm text-red-600 font-bold mt-2">‚ö†Ô∏è Ï§ëÏöî: ÎùÑÏñ¥Ïì∞Í∏∞ ÏóÜÏù¥ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî! (Ïòà: Í≤ÄÎã®ÏòÅÏñ¥ÌïôÏõê ‚≠ï / Í≤ÄÎã® ÏòÅÏñ¥ÌïôÏõê ‚ùå)</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ URL (ÏÑ†ÌÉù)</label>
                        <input type="text" id="placeUrl" placeholder="https://m.place.naver.com/..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-2">‚Äª Î≥∏Ïù∏ ÌïôÏõêÏùò ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ URLÏùÑ ÏûÖÎ†•ÌïòÎ©¥ ÏàúÏúÑÎ•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§</p>
                    </div>

                    <button onclick="analyzeKeyword()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-4 rounded-xl hover:from-purple-700 hover:to-purple-800 transition-all shadow-lg hover:shadow-xl font-bold text-lg">
                        üîç Î∂ÑÏÑù ÏãúÏûë
                    </button>
                </div>
            </div>

            <!-- Î°úÎî© ÏÉÅÌÉú -->
            <div id="loading" class="hidden bg-white rounded-2xl p-12 shadow-lg text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mx-auto mb-4"></div>
                <p class="text-gray-600 text-lg">Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
                <p class="text-gray-500 text-sm mt-2">ÎÑ§Ïù¥Î≤Ñ Îç∞Ïù¥ÌÑ∞Î•º ÏàòÏßëÌïòÍ≥† ÏûàÏäµÎãàÎã§</p>
            </div>

            <!-- Í≤ÄÏÉâÎüâ Í≤∞Í≥º -->
            <div id="searchVolumeResult" class="hidden bg-white rounded-2xl p-8 shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä Í≤ÄÏÉâÎüâ Î∂ÑÏÑù Í≤∞Í≥º</h2>
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border border-blue-200">
                        <div class="text-sm text-blue-700 mb-2">Ïõî ÌèâÍ∑† Í≤ÄÏÉâÎüâ</div>
                        <div class="text-4xl font-bold text-blue-900" id="monthlyVolume">-</div>
                        <div class="text-xs text-blue-600 mt-2" id="searchDetails">PC: - / Î™®Î∞îÏùº: -</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200">
                        <div class="text-sm text-green-700 mb-2">Í≤ΩÏüÅ Í∞ïÎèÑ</div>
                        <div class="text-4xl font-bold text-green-900" id="competition">-</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200">
                        <div class="text-sm text-purple-700 mb-2">Ï∂îÏ≤úÎèÑ</div>
                        <div class="text-4xl font-bold text-purple-900" id="recommendation">-</div>
                    </div>
                </div>
                
                <!-- ÌÅ¥Î¶≠Î•† Ï†ïÎ≥¥ -->
                <div class="bg-yellow-50 rounded-xl p-6 border border-yellow-200">
                    <h3 class="text-lg font-bold text-yellow-900 mb-4">üñ±Ô∏è ÌèâÍ∑† ÌÅ¥Î¶≠Î•† (CTR)</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <div class="text-sm text-yellow-700 mb-1">Ï†ÑÏ≤¥ ÌèâÍ∑†</div>
                            <div class="text-2xl font-bold text-yellow-900" id="averageCtr">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-yellow-700 mb-1">PC ÌÅ¥Î¶≠Î•†</div>
                            <div class="text-2xl font-bold text-yellow-900" id="pcCtr">-</div>
                        </div>
                        <div>
                            <div class="text-sm text-yellow-700 mb-1">Î™®Î∞îÏùº ÌÅ¥Î¶≠Î•†</div>
                            <div class="text-2xl font-bold text-yellow-900" id="mobileCtr">-</div>
                        </div>
                    </div>
                    <p class="text-xs text-yellow-700 mt-3">üí° ÌÅ¥Î¶≠Î•†Ïù¥ ÎÜíÏùÑÏàòÎ°ù Í¥ëÍ≥† Ìö®Í≥ºÍ∞Ä Ï¢ãÏäµÎãàÎã§</p>
                </div>
            </div>

            <!-- Í¥ÄÎ†® ÌÇ§ÏõåÎìú Í≤∞Í≥º -->
            <div id="relatedKeywordsResult" class="hidden bg-white rounded-2xl p-8 shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üîë Í¥ÄÎ†® ÌÇ§ÏõåÎìú TOP 10</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="text-left p-3 text-gray-700 font-bold">ÏàúÏúÑ</th>
                                <th class="text-left p-3 text-gray-700 font-bold">ÌÇ§ÏõåÎìú</th>
                                <th class="text-right p-3 text-gray-700 font-bold">Ïõî Í≤ÄÏÉâÎüâ</th>
                                <th class="text-right p-3 text-gray-700 font-bold">ÌèâÍ∑† CTR</th>
                                <th class="text-center p-3 text-gray-700 font-bold">Í≤ΩÏüÅÎèÑ</th>
                            </tr>
                        </thead>
                        <tbody id="relatedKeywordsList">
                            <!-- Í¥ÄÎ†® ÌÇ§ÏõåÎìú Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        </tbody>
                    </table>
                </div>
            </div>
            </div>

            <!-- ÏàúÏúÑ Í≤∞Í≥º -->
            <div id="rankingResult" class="hidden bg-white rounded-2xl p-8 shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üèÜ ÌîåÎ†àÏù¥Ïä§ ÏàúÏúÑ</h2>
                <div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white mb-6">
                    <div class="text-lg mb-2">ÎÇ¥ ÏàúÏúÑ (Í¥ëÍ≥† Ï†úÏô∏)</div>
                    <div class="text-5xl font-bold" id="myRanking">-</div>
                </div>
                
                <h3 class="text-xl font-bold text-gray-900 mb-4">Í≤ΩÏüÅÏÇ¨ ÏàúÏúÑ</h3>
                <div id="competitorList" class="space-y-3">
                    <!-- Í≤ΩÏüÅÏÇ¨ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- ÌÇ§ÏõåÎìú Î∂ÑÏÑù Í≤∞Í≥º -->
            <div id="keywordResult" class="hidden bg-white rounded-2xl p-8 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üè∑Ô∏è Í≤ΩÏüÅÏÇ¨ ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h2>
                <div id="competitorKeywords" class="grid md:grid-cols-2 gap-6">
                    <!-- ÌÇ§ÏõåÎìú Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- ÏïàÎÇ¥ Î©îÏãúÏßÄ -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mt-8">
                <h3 class="text-lg font-bold text-yellow-900 mb-3">‚ö†Ô∏è ÏÇ¨Ïö© ÏïàÎÇ¥</h3>
                <ul class="space-y-2 text-yellow-800 text-sm">
                    <li>‚Ä¢ Í≤ÄÏÉâÎüâ Îç∞Ïù¥ÌÑ∞Îäî ÎÑ§Ïù¥Î≤Ñ Í¥ëÍ≥† APIÎ•º ÌÜµÌï¥ Ï†úÍ≥µÎê©ÎãàÎã§</li>
                    <li>‚Ä¢ ÏàúÏúÑ Ï°∞ÌöåÎäî Ïã§ÏãúÍ∞Ñ ÌÅ¨Î°§ÎßÅÏúºÎ°ú ÏßÑÌñâÎêòÎ©∞, 2-3Î∂Ñ ÏÜåÏöîÎê† Ïàò ÏûàÏäµÎãàÎã§</li>
                    <li>‚Ä¢ Ï†ïÌôïÌïú Î∂ÑÏÑùÏùÑ ÏúÑÌï¥ Ï†ïÌôïÌïú ÌîåÎ†àÏù¥Ïä§ URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</li>
                    <li>‚Ä¢ ÏùºÏùº Ï°∞Ìöå ÌïúÎèÑ: 100Ìöå (Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê ÏóÜÏùå)</li>
                </ul>
            </div>
        </div>

        <script>
            async function analyzeKeyword() {
                const keyword = document.getElementById('keyword').value.trim();
                const placeUrl = document.getElementById('placeUrl').value.trim();

                if (!keyword) {
                    alert('Î∂ÑÏÑùÌï† ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                // placeUrlÏùÄ ÏÑ†ÌÉùÏÇ¨Ìï≠ÏúºÎ°ú Î≥ÄÍ≤Ω

                // Î°úÎî© ÌëúÏãú
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('searchVolumeResult').classList.add('hidden');
                document.getElementById('relatedKeywordsResult').classList.add('hidden');
                document.getElementById('rankingResult').classList.add('hidden');
                document.getElementById('keywordResult').classList.add('hidden');

                try {
                    const user = JSON.parse(localStorage.getItem('user'));
                    
                    const response = await fetch('/api/search-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            userId: user?.id,
                            keyword: keyword,
                            placeUrl: placeUrl
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Í≤ÄÏÉâÎüâ Í≤∞Í≥º ÌëúÏãú (Í∏∞Î≥∏)
                        document.getElementById('monthlyVolume').textContent = 
                            data.searchVolume?.monthlyAvg?.toLocaleString() || 'ÏßëÍ≥ÑÏ§ë';
                        document.getElementById('competition').textContent = 
                            data.searchVolume?.competition || 'Î≥¥ÌÜµ';
                        document.getElementById('recommendation').textContent = 
                            data.searchVolume?.recommendation || 'Î∂ÑÏÑùÏ§ë';
                        
                        // ÌôïÏû• Îç∞Ïù¥ÌÑ∞ ÌëúÏãú (CTR Ìè¨Ìï®)
                        if (data.searchVolumeExtended) {
                            const ext = data.searchVolumeExtended;
                            const pcSearch = ext.monthlyPcSearch?.toLocaleString() || 0;
                            const mobileSearch = ext.monthlyMobileSearch?.toLocaleString() || 0;
                            document.getElementById('searchDetails').textContent = 
                                'PC: ' + pcSearch + ' / Î™®Î∞îÏùº: ' + mobileSearch;
                            document.getElementById('averageCtr').textContent = 
                                ((ext.averageCtr || 0) * 100).toFixed(2) + '%';
                            document.getElementById('pcCtr').textContent = 
                                ((ext.pcCtr || 0) * 100).toFixed(2) + '%';
                            document.getElementById('mobileCtr').textContent = 
                                ((ext.mobileCtr || 0) * 100).toFixed(2) + '%';
                        }
                        
                        document.getElementById('searchVolumeResult').classList.remove('hidden');
                        
                        // Í¥ÄÎ†® ÌÇ§ÏõåÎìú ÌëúÏãú
                        if (data.relatedKeywords && data.relatedKeywords.length > 0) {
                            const keywordsHtml = data.relatedKeywords.map((kw, idx) => {
                                const compClass = kw.competition === 'ÎÇÆÏùå' ? 'bg-green-100 text-green-700' :
                                                 kw.competition === 'Î≥¥ÌÜµ' ? 'bg-yellow-100 text-yellow-700' :
                                                 kw.competition === 'ÎÜíÏùå' ? 'bg-orange-100 text-orange-700' :
                                                 'bg-red-100 text-red-700';
                                return '<tr class="border-b border-gray-100 hover:bg-gray-50">' +
                                    '<td class="p-3 text-gray-600 font-bold">' + (idx + 1) + '</td>' +
                                    '<td class="p-3 text-gray-900 font-medium">' + kw.keyword + '</td>' +
                                    '<td class="p-3 text-right text-blue-600 font-bold">' + (kw.monthlySearchVolume?.toLocaleString() || 0) + '</td>' +
                                    '<td class="p-3 text-right text-green-600 font-bold">' + ((kw.averageCtr || 0) * 100).toFixed(2) + '%</td>' +
                                    '<td class="p-3 text-center">' +
                                    '<span class="px-3 py-1 rounded-full text-xs font-bold ' + compClass + '">' + kw.competition + '</span>' +
                                    '</td>' +
                                    '</tr>';
                            }).join('');
                            document.getElementById('relatedKeywordsList').innerHTML = keywordsHtml;
                            document.getElementById('relatedKeywordsResult').classList.remove('hidden');
                        }

                        // ÏàúÏúÑ Í≤∞Í≥º ÌëúÏãú
                        if (data.ranking) {
                            document.getElementById('myRanking').textContent = 
                                data.ranking.myRank ? data.ranking.myRank + 'ÏúÑ' : 'ÏàúÏúÑÍ∂å Î∞ñ';
                            
                            // Í≤ΩÏüÅÏÇ¨ Î™©Î°ù ÌëúÏãú
                            const competitorHtml = data.ranking.competitors.map((comp, idx) => \`
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                                    <div class="flex items-center gap-4">
                                        <div class="text-2xl font-bold text-gray-400">\${idx + 1}</div>
                                        <div>
                                            <div class="font-bold text-gray-900">\${comp.name}</div>
                                            <div class="text-sm text-gray-600">\${comp.category || 'ÏóÖÏ¢Ö Ï†ïÎ≥¥ ÏóÜÏùå'}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm text-gray-600">Î¶¨Î∑∞</div>
                                        <div class="font-bold text-gray-900">\${comp.reviewCount || 0}Í∞ú</div>
                                    </div>
                                </div>
                            \`).join('');
                            document.getElementById('competitorList').innerHTML = competitorHtml;
                            document.getElementById('rankingResult').classList.remove('hidden');
                        }

                        // ÌÇ§ÏõåÎìú Î∂ÑÏÑù Í≤∞Í≥º ÌëúÏãú
                        if (data.keywords && data.keywords.length > 0) {
                            const keywordHtml = data.keywords.map(item => \`
                                <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                                    <div class="font-bold text-gray-900 mb-3">\${item.businessName}</div>
                                    <div class="flex flex-wrap gap-2">
                                        \${item.keywords.map(kw => \`
                                            <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">
                                                \${kw}
                                            </span>
                                        \`).join('')}
                                    </div>
                                </div>
                            \`).join('');
                            document.getElementById('competitorKeywords').innerHTML = keywordHtml;
                            document.getElementById('keywordResult').classList.remove('hidden');
                        }
                    } else {
                        alert('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                    }
                } catch (err) {
                    console.error('Î∂ÑÏÑù Ïò§Î•ò:', err);
                    alert('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                } finally {
                    document.getElementById('loading').classList.add('hidden');
                }
            }

            // ÏóîÌÑ∞ ÌÇ§Î°ú Í≤ÄÏÉâ
            document.getElementById('keyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') analyzeKeyword();
            });
            document.getElementById('placeUrl').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') analyzeKeyword();
            });
        </script>
    </body>
    </html>
  `)
})

// ÌÜµÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú ÌéòÏù¥ÏßÄ
app.get('/tools/dashboard-analytics', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌÜµÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    <body class="bg-gradient-to-br from-teal-50 to-blue-50 min-h-screen">
        <div class="max-w-7xl mx-auto p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900">üìä ÌÜµÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</h1>
                <a href="/dashboard" class="px-6 py-3 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition">
                    ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                </a>
            </div>

            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-2xl p-6 border-2 border-green-200">
                    <div class="text-sm text-gray-600 mb-2">Ïù¥Î≤à Îã¨ Îß§Ï∂ú</div>
                    <div class="text-3xl font-bold text-green-600">‚Ç©0</div>
                </div>
                <div class="bg-white rounded-2xl p-6 border-2 border-blue-200">
                    <div class="text-sm text-gray-600 mb-2">Ïã†Í∑ú ÌïôÏÉù</div>
                    <div class="text-3xl font-bold text-blue-600">0Î™Ö</div>
                </div>
                <div class="bg-white rounded-2xl p-6 border-2 border-purple-200">
                    <div class="text-sm text-gray-600 mb-2">Ï†ÑÏ≤¥ ÌïôÏÉù</div>
                    <div class="text-3xl font-bold text-purple-600">0Î™Ö</div>
                </div>
                <div class="bg-white rounded-2xl p-6 border-2 border-orange-200">
                    <div class="text-sm text-gray-600 mb-2">ÌèâÍ∑† Ï∂úÏÑùÎ•†</div>
                    <div class="text-3xl font-bold text-orange-600">0%</div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-8 border border-gray-200">
                    <h2 class="text-xl font-bold mb-4">ÏõîÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥</h2>
                    <canvas id="revenueChart" height="200"></canvas>
                </div>

                <div class="bg-white rounded-2xl p-8 border border-gray-200">
                    <h2 class="text-xl font-bold mb-4">ÌïôÏÉù ÌòÑÌô©</h2>
                    <canvas id="studentChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <script>
            // Îß§Ï∂ú Ï∂îÏù¥ Ï∞®Ìä∏
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî'],
                    datasets: [{
                        label: 'Îß§Ï∂ú (ÎßåÏõê)',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });

            // ÌïôÏÉù ÌòÑÌô© Ï∞®Ìä∏
            const studentCtx = document.getElementById('studentChart').getContext('2d');
            new Chart(studentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ÏàòÍ∞ï Ï§ë', 'ÏùºÏãúÏ†ïÏßÄ', 'Ï°∏ÏóÖ'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgb(34, 197, 94)',
                            'rgb(234, 179, 8)',
                            'rgb(156, 163, 175)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        </script>
    </body>
    </html>
  `)
})

// AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏ API

// ÌïôÏÉùÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Ï°¥Ïû¨ Ïó¨Î∂Ä ÌôïÏù∏
app.get('/api/students/has-data/:student_id', async (c) => {
  try {
    const studentId = c.req.param('student_id')
    const month = c.req.query('month') || new Date().toISOString().slice(0, 7)
    
    console.log('üîç [CheckData] Checking data for student:', studentId, 'month:', month)
    
    let hasGrades = false
    let hasAttendance = false
    let hasDailyRecords = false
    
    // ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
    try {
      const gradesResult = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM grades 
        WHERE student_id = ? AND strftime('%Y-%m', test_date) = ?
      `).bind(studentId, month).first()
      hasGrades = gradesResult && gradesResult.count > 0
      console.log('üìù [CheckData] Grades:', hasGrades, '(count:', gradesResult?.count, ')')
    } catch (err) {
      console.warn('‚ö†Ô∏è [CheckData] Grades table not found:', err.message)
    }
    
    // Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
    try {
      const attendanceResult = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM attendance 
        WHERE student_id = ? AND strftime('%Y-%m', attendance_date) = ?
      `).bind(studentId, month).first()
      hasAttendance = attendanceResult && attendanceResult.count > 0
      console.log('üìÖ [CheckData] Attendance:', hasAttendance, '(count:', attendanceResult?.count, ')')
    } catch (err) {
      console.warn('‚ö†Ô∏è [CheckData] Attendance table not found:', err.message)
    }
    
    // ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù ÌôïÏù∏
    try {
      const dailyResult = await c.env.DB.prepare(`
        SELECT COUNT(*) as count FROM daily_records 
        WHERE student_id = ? AND strftime('%Y-%m', record_date) = ?
      `).bind(studentId, month).first()
      hasDailyRecords = dailyResult && dailyResult.count > 0
      console.log('üìã [CheckData] Daily records:', hasDailyRecords, '(count:', dailyResult?.count, ')')
    } catch (err) {
      console.warn('‚ö†Ô∏è [CheckData] Daily records table not found:', err.message)
    }
    
    const hasData = hasGrades || hasAttendance || hasDailyRecords
    
    console.log('‚úÖ [CheckData] Final result - hasData:', hasData)
    
    return c.json({ 
      success: true, 
      hasData,
      details: {
        hasGrades,
        hasAttendance,
        hasDailyRecords,
        month
      }
    })
  } catch (err) {
    console.error('‚ùå [CheckData] Error:', err)
    console.error('‚ùå [CheckData] Stack:', err.stack)
    // ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï¥ÎèÑ ÏùºÎã® trueÎ°ú Î∞òÌôò (ÏÑ†ÌÉù Í∞ÄÎä•ÌïòÎèÑÎ°ù)
    return c.json({ 
      success: true, 
      hasData: true, 
      error: 'Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ Ïã§Ìå® - Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÏÑ†ÌÉù Í∞ÄÎä•'
    }, 200)
  }
})

// ÌïôÏÉùÎ≥Ñ Î¶¨Ìè¨Ìä∏ Î™©Î°ù Ï°∞Ìöå
app.get('/api/learning-reports/:student_id', async (c) => {
  try {
    const studentId = c.req.param('student_id')
    
    const { results } = await c.env.DB.prepare(`
      SELECT * FROM learning_reports 
      WHERE student_id = ? 
      ORDER BY report_month DESC
    `).bind(studentId).all()
    
    return c.json({ success: true, reports: results })
  } catch (err) {
    console.error('Get learning reports error:', err)
    return c.json({ success: false, error: 'Î¶¨Ìè¨Ìä∏ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ============================================
// Î¶¨Ìè¨Ìä∏ Ìè¥Îçî Í¥ÄÎ¶¨ API
// ============================================

// Ìè¥Îçî Î™©Î°ù Ï°∞Ìöå
app.get('/api/report-folders', async (c) => {
  try {
    const academyId = c.req.query('academyId')
    
    if (!academyId) {
      return c.json({ success: false, error: 'ÌïôÏõê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    try {
      const result = await c.env.DB.prepare(`
        SELECT * FROM report_folders
        WHERE academy_id = ?
        ORDER BY created_at DESC
      `).bind(academyId).all()
      
      return c.json({ success: true, folders: result.results || [] })
    } catch (err) {
      console.warn('‚ö†Ô∏è report_folders table not found:', err.message)
      // ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥ Î∞òÌôò
      return c.json({ success: true, folders: [] })
    }
  } catch (error) {
    console.error('‚ùå Get report folders error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Ìè¥Îçî ÏÉùÏÑ±
app.post('/api/report-folders', async (c) => {
  try {
    const { academyId, folderName, description, color } = await c.req.json()
    
    console.log('üìÅ [CreateFolder] Creating folder')
    console.log('üìÅ [CreateFolder] academyId:', academyId)
    console.log('üìÅ [CreateFolder] folderName:', folderName)
    console.log('üìÅ [CreateFolder] description:', description)
    console.log('üìÅ [CreateFolder] color:', color)
    
    if (!academyId || !folderName) {
      console.error('‚ùå [CreateFolder] Missing required fields')
      return c.json({ success: false, error: 'ÌïôÏõê IDÏôÄ Ìè¥Îçî Ïù¥Î¶ÑÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    const result = await c.env.DB.prepare(`
      INSERT INTO report_folders (academy_id, folder_name, description, color)
      VALUES (?, ?, ?, ?)
    `).bind(academyId, folderName, description || '', color || '#6366f1').run()
    
    console.log('‚úÖ [CreateFolder] Folder created successfully, ID:', result.meta.last_row_id)
    
    return c.json({ success: true, folderId: result.meta.last_row_id })
  } catch (error) {
    console.error('‚ùå [CreateFolder] Error:', error)
    console.error('‚ùå [CreateFolder] Error message:', error.message)
    console.error('‚ùå [CreateFolder] Error stack:', error.stack)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Ìè¥Îçî ÏÇ≠Ï†ú
app.delete('/api/report-folders/:folderId', async (c) => {
  try {
    const folderId = c.req.param('folderId')
    
    // Ìè¥Îçî ÎÇ¥ Î¶¨Ìè¨Ìä∏Ïùò folder_idÎ•º NULLÎ°ú ÏÑ§Ï†ï
    await c.env.DB.prepare(`
      UPDATE learning_reports SET folder_id = NULL WHERE folder_id = ?
    `).bind(folderId).run()
    
    // Ìè¥Îçî ÏÇ≠Ï†ú
    await c.env.DB.prepare(`
      DELETE FROM report_folders WHERE id = ?
    `).bind(folderId).run()
    
    return c.json({ success: true })
  } catch (error) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// AI Î¶¨Ìè¨Ìä∏ ÏûêÎèô ÏÉùÏÑ±
app.post('/api/learning-reports/generate', async (c) => {
  try {
    const { student_id, report_month, folder_id } = await c.req.json()
    
    console.log('üìä [GenerateReport] Starting report generation')
    console.log('üìä [GenerateReport] Student ID:', student_id)
    console.log('üìä [GenerateReport] Report month:', report_month)
    
    // ÌïôÏÉù Ï†ïÎ≥¥ Ï°∞Ìöå
    const student = await c.env.DB.prepare(`
      SELECT * FROM students WHERE id = ?
    `).bind(student_id).first()
    
    if (!student) {
      console.error('‚ùå [GenerateReport] Student not found:', student_id)
      return c.json({ success: false, error: 'ÌïôÏÉùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('‚úÖ [GenerateReport] Student found:', student.name)
    
    // ‚úÖ AI Î¶¨Ìè¨Ìä∏ ÏõîÍ∞Ñ ÌïúÎèÑ Ï≤¥ÌÅ¨
    console.log('üîç [GenerateReport] Checking AI report limit...')
    const subscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(student.academy_id).first()

    if (!subscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏöîÍ∏àÏ†úÎ•º Íµ¨Îß§Ìï¥Ï£ºÏÑ∏Ïöî.' 
      }, 403)
    }

    const usage = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking 
      WHERE academy_id = ? AND subscription_id = ?
    `).bind(student.academy_id, subscription.id).first()

    const currentReports = usage?.ai_reports_used_this_month || 0
    if (currentReports >= subscription.ai_report_limit) {
      return c.json({ 
        success: false, 
        error: `‚õî ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä Î™®Îëê ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§.\n\nÏù¥Î≤à Îã¨ AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ïàò: ${currentReports}Í∞ú / ÌïúÎèÑ: ${subscription.ai_report_limit}Í∞ú\n\nÎçî ÎßéÏùÄ Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±ÌïòÏãúÎ†§Î©¥ ÏÉÅÏúÑ ÌîåÎûúÏúºÎ°ú ÏóÖÍ∑∏Î†àÏù¥ÎìúÌïòÍ±∞ÎÇò Îã§Ïùå Îã¨ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.` 
      }, 403)
    }
    console.log(`‚úÖ [GenerateReport] Limit check passed: ${currentReports}/${subscription.ai_report_limit}`)
    
    // ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ)
    let grades = []
    try {
      const gradesResult = await c.env.DB.prepare(`
        SELECT * FROM grades 
        WHERE student_id = ? 
        AND strftime('%Y-%m', test_date) = ?
        ORDER BY test_date DESC
      `).bind(student_id, report_month).all()
      grades = gradesResult.results || []
      console.log('üìù [GenerateReport] Grades found:', grades.length)
    } catch (err) {
      console.warn('‚ö†Ô∏è [GenerateReport] Grades table not found or error:', err.message)
    }
    
    // Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ)
    let attendance = []
    try {
      const attendanceResult = await c.env.DB.prepare(`
        SELECT status, COUNT(*) as count
        FROM attendance 
        WHERE student_id = ? 
        AND strftime('%Y-%m', attendance_date) = ?
        GROUP BY status
      `).bind(student_id, report_month).all()
      attendance = attendanceResult.results || []
      console.log('üìÖ [GenerateReport] Attendance records found:', attendance.length)
    } catch (err) {
      console.warn('‚ö†Ô∏è [GenerateReport] Attendance table not found or error:', err.message)
    }
    
    // ÏÉÅÎã¥ Í∏∞Î°ù Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ)
    let counselings = []
    try {
      const counselingResult = await c.env.DB.prepare(`
        SELECT * FROM counseling 
        WHERE student_id = ? 
        AND strftime('%Y-%m', counseling_date) = ?
        ORDER BY counseling_date DESC
        LIMIT 3
      `).bind(student_id, report_month).all()
      counselings = counselingResult.results || []
      console.log('üí¨ [GenerateReport] Counseling records found:', counselings.length)
    } catch (err) {
      console.warn('‚ö†Ô∏è [GenerateReport] Counseling table not found or error:', err.message)
    }
    
    // ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù Ï°∞Ìöå (ÎåÄÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§)
    let dailyRecords = []
    try {
      const dailyResult = await c.env.DB.prepare(`
        SELECT * FROM daily_records 
        WHERE student_id = ? 
        AND strftime('%Y-%m', record_date) = ?
        ORDER BY record_date DESC
      `).bind(student_id, report_month).all()
      dailyRecords = dailyResult.results || []
      console.log('üìã [GenerateReport] Daily records found:', dailyRecords.length)
    } catch (err) {
      console.warn('‚ö†Ô∏è [GenerateReport] Daily records table not found or error:', err.message)
    }
    
    // Îç∞Ïù¥ÌÑ∞ Ï°¥Ïû¨ Ïó¨Î∂Ä ÌôïÏù∏
    const hasData = grades.length > 0 || attendance.length > 0 || dailyRecords.length > 0
    
    if (!hasData) {
      console.warn('‚ö†Ô∏è [GenerateReport] No data available for this period')
      return c.json({ 
        success: false, 
        error: `${report_month}Ïóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎã§ÏùåÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî:\n1. ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûÖÎ†•ÎêòÏóàÎäîÏßÄ\n2. Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûÖÎ†•ÎêòÏóàÎäîÏßÄ\n3. ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ùÏù¥ ÏûàÎäîÏßÄ\n\nÎç∞Ïù¥ÌÑ∞Î•º Î®ºÏ†Ä ÏûÖÎ†•Ìïú ÌõÑ Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.` 
      }, 400)
    }
    
    console.log('‚úÖ [GenerateReport] Data found - proceeding with report generation')
    
    // Ï∂úÏÑùÎ•† Í≥ÑÏÇ∞
    let attendanceRate = null
    let totalAttendance = 0
    let presentCount = 0
    let attendanceSource = 'none'
    
    if (attendance.length > 0) {
      totalAttendance = attendance.reduce((sum, a) => sum + (a.count || 0), 0)
      presentCount = attendance.find(a => a.status === 'present')?.count || 0
      attendanceRate = totalAttendance > 0 ? (presentCount / totalAttendance * 100).toFixed(1) : 0
      attendanceSource = 'attendance'
    } else if (dailyRecords.length > 0) {
      // ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ùÏóêÏÑú Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
      const attendanceData = dailyRecords.filter(r => r.attendance)
      totalAttendance = attendanceData.length
      presentCount = attendanceData.filter(r => r.attendance === 'Ï∂úÏÑù').length
      if (totalAttendance > 0) {
        attendanceRate = (presentCount / totalAttendance * 100).toFixed(1)
        attendanceSource = 'daily_records'
      }
    }
    
    if (attendanceRate === null) {
      console.error('‚ùå [GenerateReport] No attendance data available')
      return c.json({ 
        success: false, 
        error: `${report_month}Ïóê Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÏ∂úÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î®ºÏ†Ä ÏûÖÎ†•Ìïú ÌõÑ Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.` 
      }, 400)
    }
    
    console.log('üìä [GenerateReport] Attendance rate:', attendanceRate + '%', '(source:', attendanceSource + ')')
    
    // ÌèâÍ∑† Ï†êÏàò Í≥ÑÏÇ∞
    let avgScore = null
    let scoreSource = 'none'
    
    if (grades.length > 0) {
      avgScore = (grades.reduce((sum, g) => sum + (g.score / g.max_score * 100), 0) / grades.length).toFixed(1)
      scoreSource = 'grades'
    } else if (dailyRecords.length > 0) {
      // ÏùºÏùº ÏÑ±Í≥ºÏóêÏÑú Ïù¥Ìï¥ÎèÑ, Ï∞∏Ïó¨ÎèÑ ÌèâÍ∑†
      const understandingScores = dailyRecords.filter(r => r.lesson_understanding).map(r => parseFloat(r.lesson_understanding))
      const participationScores = dailyRecords.filter(r => r.lesson_participation).map(r => parseFloat(r.lesson_participation))
      
      if (understandingScores.length > 0 || participationScores.length > 0) {
        const allScores = [...understandingScores, ...participationScores]
        avgScore = (allScores.reduce((sum, s) => sum + s, 0) / allScores.length * 10).toFixed(1)
        scoreSource = 'daily_records'
      }
    }
    
    if (avgScore === null) {
      console.error('‚ùå [GenerateReport] No score data available')
      return c.json({ 
        success: false, 
        error: `${report_month}Ïóê ÏÑ±Ï†Å/ÌïôÏäµ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ ÎòêÎäî ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ùÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìïú ÌõÑ Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.` 
      }, 400)
    }
    
    console.log('üìä [GenerateReport] Average score:', avgScore, '(source:', scoreSource + ')')
    
    // ÌïôÏäµ ÌÉúÎèÑ ÌåêÎã®
    let studyAttitude = 'ÌèâÍ∞Ä Î∂àÍ∞Ä'
    if (attendanceRate >= 95 && avgScore >= 85) studyAttitude = 'Îß§Ïö∞ Ïö∞Ïàò'
    else if (attendanceRate >= 90 && avgScore >= 80) studyAttitude = 'Ïö∞Ïàò'
    else if (attendanceRate >= 80 && avgScore >= 70) studyAttitude = 'ÏñëÌò∏'
    else studyAttitude = 'Í∞úÏÑ† ÌïÑÏöî'
    
    // Í∞ïÏ†ê Î∂ÑÏÑù
    let strengths = ''
    const topSubject = grades.length > 0 
      ? grades.reduce((max, g) => (g.score / g.max_score) > (max.score / max.max_score) ? g : max)
      : null
    
    if (topSubject) {
      strengths = topSubject.subject + ' Í≥ºÎ™©ÏóêÏÑú ' + (topSubject.score / topSubject.max_score * 100).toFixed(1) + 'Ï†êÏúºÎ°ú Ïö∞ÏàòÌïú ÏÑ±Ï†ÅÏùÑ Î≥¥ÏòÄÏäµÎãàÎã§. Íæ∏Ï§ÄÌïú ÎÖ∏Î†•Ïù¥ ÎèãÎ≥¥ÏûÖÎãàÎã§.'
    } else if (dailyRecords.length > 0 && dailyRecords.filter(r => r.lesson_participation).length > 0) {
      const avgParticipation = (dailyRecords.filter(r => r.lesson_participation).reduce((sum, r) => sum + parseFloat(r.lesson_participation), 0) / dailyRecords.filter(r => r.lesson_participation).length).toFixed(1)
      strengths = 'ÏàòÏóÖ Ï∞∏Ïó¨ÎèÑÍ∞Ä ÌèâÍ∑† ' + avgParticipation + 'Ï†êÏúºÎ°ú Ï†ÅÍ∑πÏ†ÅÏù∏ ÌïôÏäµ ÌÉúÎèÑÎ•º Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.'
    } else {
      strengths = 'ÌòÑÏû¨ Í∏∞Í∞ÑÏùò ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä Î∂ÄÏ°±ÌïòÏó¨ Í∞ïÏ†êÏùÑ ÌååÏïÖÌïòÍ∏∞ Ïñ¥Î†µÏäµÎãàÎã§. ÏßÄÏÜçÏ†ÅÏù∏ ÌïôÏäµ ÌôúÎèô Í∏∞Î°ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
    }
    
    // ÏïΩÏ†ê Î∂ÑÏÑù
    let weaknesses = ''
    const weakSubject = grades.length > 0 
      ? grades.reduce((min, g) => (g.score / g.max_score) < (min.score / min.max_score) ? g : min)
      : null
    
    if (weakSubject && (weakSubject.score / weakSubject.max_score * 100) < 75) {
      weaknesses = weakSubject.subject + ' Í≥ºÎ™©ÏóêÏÑú ' + (weakSubject.score / weakSubject.max_score * 100).toFixed(1) + 'Ï†êÏúºÎ°ú Î≥¥ÏôÑÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
    } else if (dailyRecords.length > 0 && dailyRecords.filter(r => r.homework_status === 'ÎØ∏ÏôÑÎ£å').length > 0) {
      weaknesses = 'Í≥ºÏ†ú ÏôÑÏÑ±Î•†Ïù¥ ÎÇÆÏäµÎãàÎã§. Î≥µÏäµ ÏãúÍ∞ÑÏùÑ ÎäòÎ†§ Í≥ºÏ†úÎ•º ÏôÑÎ£åÌïòÎäî ÏäµÍ¥ÄÏùÑ Í∏∞Î•¥Î©¥ Ï¢ãÍ≤†ÏäµÎãàÎã§.'
    } else {
      weaknesses = 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í∑†ÌòïÏû°Ìûå ÌïôÏäµÏùÑ ÌïòÍ≥† ÏûàÏäµÎãàÎã§.'
    }
    
    // Í∞úÏÑ†ÏÇ¨Ìï≠
    const improvements = attendanceRate < 90 
      ? 'Ï∂úÏÑùÎ•† Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. Í∑úÏπôÏ†ÅÏù∏ ÏàòÏóÖ Ï∞∏Ïó¨Í∞Ä ÏÑ±Ï†Å Ìñ•ÏÉÅÏùò Í∏∞Î≥∏ÏûÖÎãàÎã§.'
      : avgScore < 80
      ? 'Í∏∞Î≥∏ Í∞úÎÖê Î≥µÏäµÏóê Îçî ÎßéÏùÄ ÏãúÍ∞ÑÏùÑ Ìà¨ÏûêÌïòÎ©¥ Ï¢ãÍ≤†ÏäµÎãàÎã§.'
      : 'ÌòÑÏû¨ ÌïôÏäµ Ìå®ÌÑ¥ÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú Ïã¨Ìôî ÌïôÏäµÏúºÎ°ú ÎÇòÏïÑÍ∞ÄÎ©¥ Ï¢ãÍ≤†ÏäµÎãàÎã§.'
    
    // Ï∂îÏ≤úÏÇ¨Ìï≠
    const recommendations = avgScore >= 85
      ? 'ÏÉÅÏúÑÍ∂å Ïú†ÏßÄÎ•º ÏúÑÌï¥ Ïã¨Ìôî Î¨∏Ï†ú ÌíÄÏù¥Î•º Ï∂îÏ≤úÌï©ÎãàÎã§. Í≤ΩÏãúÎåÄÌöå Ï§ÄÎπÑÎèÑ Í≥†Î†§Ìï¥Î≥º ÎßåÌï©ÎãàÎã§.'
      : avgScore >= 75
      ? 'Í∏∞Î≥∏Í∏∞ Í∞ïÌôîÏôÄ Ìï®Íªò Î¨∏Ï†ú ÌíÄÏù¥ ÏÜçÎèÑÎ•º ÎÜíÏù¥Îäî Ïó∞ÏäµÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.'
      : 'Í∞úÎÖê Ïù¥Ìï¥Î•º ÏúÑÌïú 1:1 Î≥¥Ï∂© ÏàòÏóÖÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§. Í∏∞Ï¥àÎ∂ÄÌÑ∞ Ï∞®Í∑ºÏ∞®Í∑º Îã§Ï†∏Í∞ÄÎ©¥ Ï∂©Î∂ÑÌûà ÏÑ±Ï†ÅÏù¥ Ïò§Î•º Ïàò ÏûàÏäµÎãàÎã§.'
    
    // Îã§Ïùå Îã¨ Î™©Ìëú
    const nextMonthGoals = avgScore >= 85
      ? 'ÌòÑÏû¨ ÌèâÍ∑† ' + avgScore + 'Ï†ê ÏàòÏ§ÄÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú, ' + (weakSubject?.subject || 'Ï∑®ÏïΩ Í≥ºÎ™©') + 'ÏóêÏÑú 5Ï†ê Ïù¥ÏÉÅ Ìñ•ÏÉÅ Î™©Ìëú'
      : 'ÌèâÍ∑† Ï†êÏàò ' + avgScore + 'Ï†êÏóêÏÑú ' + Math.min(100, parseFloat(avgScore) + 10).toFixed(0) + 'Ï†êÏúºÎ°ú Ìñ•ÏÉÅ, Ï∂úÏÑùÎ•† ' + attendanceRate + '%ÏóêÏÑú 95% Ïù¥ÏÉÅ Îã¨ÏÑ±'
    
    // AI Ï¢ÖÌï© Î∂ÑÏÑù
    const aiAnalysis = student.name + ' ÌïôÏÉùÏùÄ Ïù¥Î≤à Îã¨ ÌèâÍ∑† ' + avgScore + 'Ï†êÏùò ÏÑ±Ï†ÅÏùÑ Í∏∞Î°ùÌñàÏúºÎ©∞, Ï∂úÏÑùÎ•†ÏùÄ ' + attendanceRate + '%ÏûÖÎãàÎã§. ' +
      (studyAttitude === 'Îß§Ïö∞ Ïö∞Ïàò' || studyAttitude === 'Ïö∞Ïàò' 
        ? 'Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú ÏÑ±Ïã§ÌïòÍ≤å ÌïôÏóÖÏóê ÏûÑÌïòÍ≥† ÏûàÏúºÎ©∞, ÏßÄÏÜçÏ†ÅÏù∏ ÏÑ±Ïû•Ïù¥ Í∏∞ÎåÄÎê©ÎãàÎã§.' 
        : 'ÌïôÏäµ ÌÉúÎèÑÏôÄ Ï∂úÏÑù Í¥ÄÎ¶¨Ïóê Îçî ÎßéÏùÄ Í¥ÄÏã¨Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.') +
      (topSubject ? ' ÌäπÌûà ' + topSubject.subject + ' Í≥ºÎ™©ÏóêÏÑú Í∞ïÏ†êÏùÑ Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.' : '') +
      ' Íæ∏Ï§ÄÌïú ÎÖ∏Î†•ÏúºÎ°ú ÎçîÏö± Î∞úÏ†ÑÌï† Ïàò ÏûàÏäµÎãàÎã§.'
    
    // ÌïôÎ∂ÄÎ™® Î©îÏãúÏßÄ
    const parentMessage = `ÌïôÎ∂ÄÎ™®Îãò, ÏïàÎÖïÌïòÏÑ∏Ïöî.

${student.name} ÌïôÏÉùÏùò ${report_month} ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏Î•º Ï†ÑÎã¨ÎìúÎ¶ΩÎãàÎã§.

üìä Ïù¥Î≤à Îã¨ ÏÑ±Í≥º
- ÌèâÍ∑† Ï†êÏàò: ${avgScore}Ï†ê
- Ï∂úÏÑùÎ•†: ${attendanceRate}%
- ÌïôÏäµ ÌÉúÎèÑ: ${studyAttitude}

üí™ Í∞ïÏ†ê
${strengths}

üéØ Í∞úÏÑ† ÌïÑÏöî ÏÇ¨Ìï≠
${weaknesses}

üìù ÏÑ†ÏÉùÎãòÏùò Ï∂îÏ≤ú
${recommendations}

Îã§Ïùå Îã¨ Î™©Ìëú: ${nextMonthGoals}

ÏïûÏúºÎ°úÎèÑ ${student.name} ÌïôÏÉùÏù¥ ÎçîÏö± ÏÑ±Ïû•Ìï† Ïàò ÏûàÎèÑÎ°ù ÏµúÏÑ†ÏùÑ Îã§ÌïòÍ≤†ÏäµÎãàÎã§.
Í∂ÅÍ∏àÌïòÏã† Ï†êÏùÄ Ïñ∏Ï†úÎì† Ïó∞ÎùΩ Ï£ºÏÑ∏Ïöî!

- ÏäàÌçºÌîåÎ†àÏù¥Ïä§ ${counselings[0]?.counselor_name || 'ÏÑ†ÏÉùÎãò'}`
    
    console.log('üíæ [GenerateReport] Saving report to database')
    
    // Î¶¨Ìè¨Ìä∏ Ï†ÄÏû•
    const result = await c.env.DB.prepare(`
      INSERT INTO learning_reports 
      (student_id, report_month, overall_score, study_attitude, strengths, weaknesses, improvements, recommendations, next_month_goals, ai_analysis, parent_message, folder_id)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      student_id, 
      report_month, 
      avgScore, 
      studyAttitude, 
      strengths, 
      weaknesses, 
      improvements, 
      recommendations, 
      nextMonthGoals, 
      aiAnalysis, 
      parentMessage,
      folder_id || null
    ).run()
    
    console.log('‚úÖ [GenerateReport] Report saved successfully, ID:', result.meta.last_row_id)
    
    // ‚úÖ ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
    try {
      await c.env.DB.prepare(`
        UPDATE usage_tracking 
        SET ai_reports_used_this_month = ai_reports_used_this_month + 1, updated_at = CURRENT_TIMESTAMP
        WHERE academy_id = ? AND subscription_id = ?
      `).bind(student.academy_id, subscription.id).run()
      console.log('üìà [GenerateReport] Usage incremented successfully')
    } catch (usageErr) {
      console.error('‚ö†Ô∏è [GenerateReport] Failed to increment usage:', usageErr)
    }
    
    return c.json({ 
      success: true, 
      message: 'AI ÌïôÏäµ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.',
      report_id: result.meta.last_row_id,
      preview: {
        overall_score: avgScore,
        attendance_rate: attendanceRate,
        study_attitude: studyAttitude
      }
    })
  } catch (err) {
    console.error('‚ùå [GenerateReport] Fatal error:', err)
    console.error('‚ùå [GenerateReport] Error message:', err.message)
    console.error('‚ùå [GenerateReport] Error stack:', err.stack)
    return c.json({ 
      success: false, 
      error: 'AI Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ïã§Ìå®: ' + err.message 
    }, 500)
  }
})

// Î¶¨Ìè¨Ìä∏ ÏÉÅÏÑ∏ Ï°∞Ìöå
app.get('/api/learning-reports/detail/:report_id', async (c) => {
  try {
    const reportId = c.req.param('report_id')
    
    const report = await c.env.DB.prepare(`
      SELECT lr.*, s.name as student_name, s.parent_name, s.parent_phone
      FROM learning_reports lr
      JOIN students s ON lr.student_id = s.id
      WHERE lr.id = ?
    `).bind(reportId).first()
    
    if (!report) {
      return c.json({ success: false, error: 'Î¶¨Ìè¨Ìä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    return c.json({ success: true, report })
  } catch (err) {
    console.error('Get report detail error:', err)
    return c.json({ success: false, error: 'Î¶¨Ìè¨Ìä∏ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// Î¶¨Ìè¨Ìä∏ ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏ API
app.put('/api/learning-reports/:report_id/update-field', async (c) => {
  try {
    const reportId = c.req.param('report_id')
    const { field, value } = await c.req.json()
    
    const allowedFields = ['strengths', 'weaknesses', 'improvements', 'recommendations', 'next_month_goals', 'ai_analysis', 'parent_message', 'study_attitude']
    
    if (!allowedFields.includes(field)) {
      return c.json({ success: false, error: 'ÌóàÏö©ÎêòÏßÄ ÏïäÏùÄ ÌïÑÎìúÏûÖÎãàÎã§.' }, 400)
    }
    
    const report = await c.env.DB.prepare('SELECT id FROM learning_reports WHERE id = ?').bind(reportId).first()
    
    if (!report) {
      return c.json({ success: false, error: 'Î¶¨Ìè¨Ìä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    try {
      // updated_at Ïª¨ÎüºÏù¥ ÏûàÎäî Í≤ΩÏö∞
      await c.env.DB.prepare(`UPDATE learning_reports SET ${field} = ?, updated_at = datetime('now') WHERE id = ?`).bind(value, reportId).run()
    } catch (updateErr) {
      console.warn('‚ö†Ô∏è updated_at column not found, trying without it')
      // updated_at Ïª¨ÎüºÏù¥ ÏóÜÎäî Í≤ΩÏö∞
      await c.env.DB.prepare(`UPDATE learning_reports SET ${field} = ? WHERE id = ?`).bind(value, reportId).run()
    }
    
    console.log(`Report ${reportId} field ${field} updated`)
    
    return c.json({ success: true, message: 'Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', field, value })
  } catch (err) {
    console.error('Update report field error:', err)
    return c.json({ success: false, error: 'Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î¶¨Ìè¨Ìä∏ Ï†ÑÏ≤¥ ÏóÖÎç∞Ïù¥Ìä∏ API
app.put('/api/learning-reports/:report_id', async (c) => {
  try {
    const reportId = c.req.param('report_id')
    const data = await c.req.json()
    
    console.log('‚úèÔ∏è [UpdateReport] Updating report:', reportId)
    console.log('‚úèÔ∏è [UpdateReport] Data:', JSON.stringify(data))
    
    // Î¶¨Ìè¨Ìä∏ Ï°¥Ïû¨ ÌôïÏù∏
    const report = await c.env.DB.prepare('SELECT id FROM learning_reports WHERE id = ?').bind(reportId).first()
    
    if (!report) {
      console.error('‚ùå [UpdateReport] Report not found:', reportId)
      return c.json({ success: false, error: 'Î¶¨Ìè¨Ìä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('‚úÖ [UpdateReport] Report found:', reportId)
    
    const { 
      overall_score, study_attitude, strengths, weaknesses, 
      improvements, recommendations, next_month_goals, 
      ai_analysis, parent_message 
    } = data
    
    // ÌïÑÏàò ÌïÑÎìú Í≤ÄÏ¶ù
    if (overall_score === undefined || !study_attitude) {
      console.error('‚ùå [UpdateReport] Missing required fields')
      return c.json({ success: false, error: 'ÌïÑÏàò ÌïÑÎìúÍ∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }
    
    console.log('‚úèÔ∏è [UpdateReport] Executing UPDATE query...')
    
    try {
      // updated_at Ïª¨ÎüºÏù¥ ÏûàÎäî Í≤ΩÏö∞
      const result = await c.env.DB.prepare(`
        UPDATE learning_reports 
        SET overall_score = ?, study_attitude = ?, strengths = ?, 
            weaknesses = ?, improvements = ?, recommendations = ?, 
            next_month_goals = ?, ai_analysis = ?, parent_message = ?,
            updated_at = datetime('now')
        WHERE id = ?
      `).bind(
        overall_score,
        study_attitude,
        strengths,
        weaknesses,
        improvements,
        recommendations,
        next_month_goals,
        ai_analysis,
        parent_message,
        reportId
      ).run()
      
      console.log('‚úÖ [UpdateReport] UPDATE result:', JSON.stringify(result.meta))
    } catch (updateErr) {
      console.warn('‚ö†Ô∏è [UpdateReport] updated_at column not found, trying without it:', updateErr.message)
      
      // updated_at Ïª¨ÎüºÏù¥ ÏóÜÎäî Í≤ΩÏö∞ (fallback)
      const result = await c.env.DB.prepare(`
        UPDATE learning_reports 
        SET overall_score = ?, study_attitude = ?, strengths = ?, 
            weaknesses = ?, improvements = ?, recommendations = ?, 
            next_month_goals = ?, ai_analysis = ?, parent_message = ?
        WHERE id = ?
      `).bind(
        overall_score,
        study_attitude,
        strengths,
        weaknesses,
        improvements,
        recommendations,
        next_month_goals,
        ai_analysis,
        parent_message,
        reportId
      ).run()
      
      console.log('‚úÖ [UpdateReport] UPDATE result (without updated_at):', JSON.stringify(result.meta))
    }
    
    console.log('‚úÖ [UpdateReport] Report updated successfully')
    
    return c.json({ success: true, message: 'Î¶¨Ìè¨Ìä∏Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('‚ùå [UpdateReport] Fatal error:', err)
    console.error('‚ùå [UpdateReport] Error message:', err.message)
    console.error('‚ùå [UpdateReport] Error stack:', err.stack)
    return c.json({ 
      success: false, 
      error: 'Î¶¨Ìè¨Ìä∏ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: err.message 
    }, 500)
  }
})

// ÌîÑÎ°úÌïÑ ÏàòÏ†ï ÌéòÏù¥ÏßÄ
app.get('/profile', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌîÑÎ°úÌïÑ ÏàòÏ†ï - Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <a href="/dashboard" class="text-xl font-bold text-purple-600">Ïö∞Î¶¨Îäî ÏäàÌçºÌîåÎ†àÏù¥Ïä§Îã§</a>
                    <div class="flex items-center space-x-4">
                        <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                        <a href="/profile" class="text-purple-600 font-medium">ÌîÑÎ°úÌïÑ</a>
                        <button onclick="logout()" class="text-red-600 hover:text-red-700">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-4xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">ÌîÑÎ°úÌïÑ ÏàòÏ†ï</h1>
                    <p class="text-gray-600">ÌöåÏõê Ï†ïÎ≥¥Î•º ÏàòÏ†ïÌïòÍ≥† ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- ÌîÑÎ°úÌïÑ Ï†ïÎ≥¥ ÏàòÏ†ï -->
                    <div class="bg-white rounded-2xl border border-gray-200 p-8">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">üìù Í∏∞Î≥∏ Ï†ïÎ≥¥</h2>
                        <form id="profileForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ïù¥Î©îÏùº</label>
                                <input type="email" id="email" readonly class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏõêÏû•Îãò ÏÑ±Ìï® <span class="text-red-500">*</span></label>
                                <input type="text" id="name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span></label>
                                <input type="tel" id="phone" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê Ïù¥Î¶Ñ <span class="text-red-500">*</span></label>
                                <input type="text" id="academy_name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê ÏúÑÏπò <span class="text-red-500">*</span></label>
                                <input type="text" id="academy_location" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <button type="submit" class="w-full gradient-purple text-white py-3 rounded-xl font-medium hover:shadow-xl transition-all">
                                ÌîÑÎ°úÌïÑ Ï†ÄÏû•
                            </button>
                            <div id="profileMessage" class="hidden mt-4 p-4 rounded-xl"></div>
                        </form>
                    </div>

                    <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω -->
                    <div class="bg-white rounded-2xl border border-gray-200 p-8">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">üîê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</h2>
                        <form id="passwordForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ <span class="text-red-500">*</span></label>
                                <input type="password" id="current_password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ <span class="text-red-500">*</span></label>
                                <input type="password" id="new_password" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                                <p class="text-xs text-gray-500 mt-1">ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅ</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ <span class="text-red-500">*</span></label>
                                <input type="password" id="new_password_confirm" required minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition">
                            </div>
                            <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-xl font-medium hover:bg-orange-600 transition-all">
                                ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
                            </button>
                            <div id="passwordMessage" class="hidden mt-4 p-4 rounded-xl"></div>
                        </form>
                    </div>
                </div>

                <!-- Í∞ÄÏûÖ Ï†ïÎ≥¥ -->
                <div class="mt-6 bg-white rounded-2xl border border-gray-200 p-6">
                    <h2 class="text-lg font-bold text-gray-900 mb-4">‚ÑπÔ∏è Í≥ÑÏ†ï Ï†ïÎ≥¥</h2>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Í∞ÄÏûÖÏùº:</span>
                            <span id="created_at" class="ml-2 font-medium text-gray-900"></span>
                        </div>
                        <div>
                            <span class="text-gray-600">ÌöåÏõê Îì±Í∏â:</span>
                            <span id="role" class="ml-2 font-medium text-purple-600"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
        const user = JSON.parse(localStorage.getItem('user') || 'null')
        if (!user) {
            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.')
            window.location.href = '/login'
        }

        function logout() {
            localStorage.removeItem('user')
            window.location.href = '/'
        }

        // ÌîÑÎ°úÌïÑ Î°úÎìú
        async function loadProfile() {
            try {
                const res = await fetch('/api/user/profile', {
                    headers: { 'X-User-Id': user.id }
                })
                const data = await res.json()
                if (data.success) {
                    document.getElementById('email').value = data.user.email
                    document.getElementById('name').value = data.user.name
                    document.getElementById('phone').value = data.user.phone || ''
                    document.getElementById('academy_name').value = data.user.academy_name || ''
                    document.getElementById('academy_location').value = data.user.academy_location || ''
                    document.getElementById('created_at').textContent = new Date(data.user.created_at).toLocaleDateString()
                    document.getElementById('role').textContent = data.user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÏùºÎ∞ò ÌöåÏõê'
                }
            } catch (err) {
                console.error('ÌîÑÎ°úÌïÑ Î°úÎìú Ïã§Ìå®:', err)
            }
        }

        // ÌîÑÎ°úÌïÑ ÏàòÏ†ï
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const data = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                academy_name: document.getElementById('academy_name').value,
                academy_location: document.getElementById('academy_location').value
            }

            try {
                const res = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-User-Id': user.id
                    },
                    body: JSON.stringify(data)
                })
                const result = await res.json()
                const messageEl = document.getElementById('profileMessage')
                messageEl.classList.remove('hidden')

                if (result.success) {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                    messageEl.textContent = result.message
                    
                    // localStorage ÏóÖÎç∞Ïù¥Ìä∏
                    user.name = data.name
                    user.academy_name = data.academy_name
                    localStorage.setItem('user', JSON.stringify(user))
                } else {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                    messageEl.textContent = result.error
                }
            } catch (err) {
                const messageEl = document.getElementById('profileMessage')
                messageEl.classList.remove('hidden')
                messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                messageEl.textContent = 'ÌîÑÎ°úÌïÑ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
            }
        })

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
        document.getElementById('passwordForm').addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const current_password = document.getElementById('current_password').value
            const new_password = document.getElementById('new_password').value
            const new_password_confirm = document.getElementById('new_password_confirm').value

            if (new_password !== new_password_confirm) {
                const messageEl = document.getElementById('passwordMessage')
                messageEl.classList.remove('hidden')
                messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                messageEl.textContent = 'ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.'
                return
            }

            try {
                const res = await fetch('/api/user/change-password', {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-User-Id': user.id
                    },
                    body: JSON.stringify({ current_password, new_password })
                })
                const result = await res.json()
                const messageEl = document.getElementById('passwordMessage')
                messageEl.classList.remove('hidden')

                if (result.success) {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-green-50 text-green-800 border border-green-200'
                    messageEl.textContent = result.message
                    document.getElementById('passwordForm').reset()
                } else {
                    messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                    messageEl.textContent = result.error
                }
            } catch (err) {
                const messageEl = document.getElementById('passwordMessage')
                messageEl.classList.remove('hidden')
                messageEl.className = 'mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200'
                messageEl.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
            }
        })

        loadProfile()
        </script>
    </body>
    </html>
  `)
})

// ÌöåÏõê ÌîÑÎ°úÌïÑ Ï°∞Ìöå API
app.get('/api/user/profile', async (c) => {
  try {
    const userId = c.req.header('X-User-Id')
    if (!userId) {
      return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 401)
    }

    const user = await c.env.DB.prepare(`
      SELECT id, email, name, phone, academy_name, academy_location, role, created_at
      FROM users WHERE id = ?
    `).bind(userId).first()

    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    return c.json({ success: true, user })
  } catch (err) {
    console.error('Get profile error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÌïÑ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌöåÏõê ÌîÑÎ°úÌïÑ ÏàòÏ†ï API
app.put('/api/user/profile', async (c) => {
  try {
    const userId = c.req.header('X-User-Id')
    if (!userId) {
      return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 401)
    }

    const { name, phone, academy_name, academy_location } = await c.req.json()

    if (!name || !phone || !academy_name || !academy_location) {
      return c.json({ success: false, error: 'Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    await c.env.DB.prepare(`
      UPDATE users 
      SET name = ?, phone = ?, academy_name = ?, academy_location = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(name, phone, academy_name, academy_location, userId).run()

    return c.json({ success: true, message: 'ÌîÑÎ°úÌïÑÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Update profile error:', err)
    return c.json({ success: false, error: 'ÌîÑÎ°úÌïÑ ÏàòÏ†ï Ïã§Ìå®' }, 500)
  }
})

// ÌöåÏõê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω API
app.put('/api/user/change-password', async (c) => {
  try {
    const userId = c.req.header('X-User-Id')
    if (!userId) {
      return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 401)
    }

    const { current_password, new_password } = await c.req.json()

    if (!current_password || !new_password) {
      return c.json({ success: false, error: 'ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ÏôÄ ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }

    if (new_password.length < 6) {
      return c.json({ success: false, error: 'ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.' }, 400)
    }

    // ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
    const user = await c.env.DB.prepare(`
      SELECT id FROM users WHERE id = ? AND password = ?
    `).bind(userId, current_password).first()

    if (!user) {
      return c.json({ success: false, error: 'ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.' }, 400)
    }

    // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
    await c.env.DB.prepare(`
      UPDATE users SET password = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?
    `).bind(new_password, userId).run()

    return c.json({ success: true, message: 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.' })
  } catch (err) {
    console.error('Change password error:', err)
    return c.json({ success: false, error: 'ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ïã§Ìå®' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê - ÌöåÏõêÏúºÎ°ú Î°úÍ∑∏Ïù∏ (Impersonate)
app.post('/api/admin/impersonate', async (c) => {
  try {
    const adminId = c.req.header('X-User-Id')
    if (!adminId) {
      return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 401)
    }

    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    const admin = await c.env.DB.prepare(`
      SELECT role FROM users WHERE id = ? AND role = 'admin'
    `).bind(adminId).first()

    if (!admin) {
      return c.json({ success: false, error: 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' }, 403)
    }

    const { user_id } = await c.req.json()

    // ÎåÄÏÉÅ ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    const targetUser = await c.env.DB.prepare(`
      SELECT id, email, name, role, academy_name FROM users WHERE id = ?
    `).bind(user_id).first()

    if (!targetUser) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }

    return c.json({ 
      success: true, 
      message: 'ÏÇ¨Ïö©ÏûêÎ°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§.',
      user: targetUser,
      is_impersonating: true,
      original_admin_id: adminId
    })
  } catch (err) {
    console.error('Impersonate error:', err)
    return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏ Ïã§Ìå®' }, 500)
  }
})

// ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ ÎèÑÍµ¨
app.get('/programs/naver-place', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÎßàÏºÄÌåÖ ÎèÑÍµ¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    </head>
    <body class="bg-gray-50">
        <!-- Ìó§Îçî -->
        <nav class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/programs" class="text-2xl font-bold text-blue-600">üó∫Ô∏è ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÎèÑÍµ¨</a>
                        <div class="hidden md:flex gap-6">
                            <a href="#keyword" class="text-gray-600 hover:text-blue-600">ÌÇ§ÏõåÎìú Î∂ÑÏÑù</a>
                            <a href="#competitor" class="text-gray-600 hover:text-blue-600">Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù</a>
                            <a href="#review" class="text-gray-600 hover:text-blue-600">Î¶¨Î∑∞ Í¥ÄÎ¶¨</a>
                            <a href="#optimization" class="text-gray-600 hover:text-blue-600">ÏµúÏ†ÅÌôî</a>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="history.back()" class="px-4 py-2 text-gray-600 hover:text-gray-900">
                            <i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú
                        </button>
                        <a href="/programs" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- 1. ÌÇ§ÏõåÎìú Í≤ÄÏÉâÎüâ Î∂ÑÏÑù -->
            <section id="keyword" class="mb-12">
                <div class="bg-white rounded-2xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-search text-blue-600 mr-3"></i>
                        ÌÇ§ÏõåÎìú Í≤ÄÏÉâÎüâ Î∂ÑÏÑù
                    </h2>
                    <p class="text-gray-600 mb-6">Ïö∞Î¶¨ ÌïôÏõêÏù¥ ÌÉÄÍ≤üÌï¥Ïïº Ìï† ÏßÄÏó≠ + ÏóÖÏ¢Ö ÌÇ§ÏõåÎìúÏùò ÏòàÏÉÅ Í≤ÄÏÉâÎüâÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                    
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÏßÄÏó≠ ÏÑ†ÌÉù</label>
                            <input type="text" id="location" placeholder="Ïòà: Ïù∏Ï≤ú ÏÑúÍµ¨, Í∞ïÎÇ®Íµ¨, Î™©Îèô" 
                                   class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÏóÖÏ¢Ö/ÌÇ§ÏõåÎìú</label>
                            <input type="text" id="keyword" placeholder="Ïòà: ÏòÅÏñ¥ÌïôÏõê, ÏàòÌïôÌïôÏõê, ÏΩîÎî©ÌïôÏõê" 
                                   class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <button onclick="analyzeKeyword()" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                        <i class="fas fa-chart-line mr-2"></i>Í≤ÄÏÉâÎüâ Î∂ÑÏÑùÌïòÍ∏∞
                    </button>
                    
                    <div id="keywordResult" class="hidden mt-8">
                        <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-lg">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Î∂ÑÏÑù Í≤∞Í≥º</h3>
                            <div class="grid md:grid-cols-3 gap-6">
                                <div class="bg-white p-4 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">ÏõîÌèâÍ∑† Í≤ÄÏÉâÎüâ</div>
                                    <div class="text-3xl font-bold text-blue-600" id="searchVolume">-</div>
                                    <div class="text-xs text-gray-500 mt-1">ÏßÄÏó≠ ÎÇ¥ Í≤ÄÏÉâ Ï∂îÏ†ïÏπò</div>
                                </div>
                                <div class="bg-white p-4 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Í≤ΩÏüÅ Í∞ïÎèÑ</div>
                                    <div class="text-3xl font-bold" id="competition">-</div>
                                    <div class="text-xs text-gray-500 mt-1">ÎÇÆÏùÑÏàòÎ°ù Ïú†Î¶¨</div>
                                </div>
                                <div class="bg-white p-4 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Ï∂îÏ≤ú Ï†êÏàò</div>
                                    <div class="text-3xl font-bold text-green-600" id="score">-</div>
                                    <div class="text-xs text-gray-500 mt-1">/100Ï†ê</div>
                                </div>
                            </div>
                            <div class="mt-6 p-4 bg-white rounded-lg">
                                <h4 class="font-semibold text-gray-900 mb-3">Ï∂îÏ≤ú ÌÇ§ÏõåÎìú Ï°∞Ìï©</h4>
                                <div id="keywordSuggestions" class="space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù -->
            <section id="competitor" class="mb-12">
                <div class="bg-white rounded-2xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-users text-purple-600 mr-3"></i>
                        Í≤ΩÏüÅÏÇ¨ Î≤§ÏπòÎßàÌÇπ
                    </h2>
                    <p class="text-gray-600 mb-6">Ï£ºÎ≥Ä Í≤ΩÏüÅ ÌïôÏõêÍ≥º Ïö∞Î¶¨ ÌïôÏõêÏùÑ ÎπÑÍµê Î∂ÑÏÑùÌïòÏÑ∏Ïöî</p>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïö∞Î¶¨ ÌïôÏõê Ï†ïÎ≥¥</label>
                        <div class="grid md:grid-cols-3 gap-4">
                            <input type="text" id="myAcademy" placeholder="ÌïôÏõêÎ™Ö" class="px-4 py-3 border rounded-lg">
                            <input type="number" id="myReviews" placeholder="Î¶¨Î∑∞ Ïàò" class="px-4 py-3 border rounded-lg">
                            <input type="number" id="myRating" placeholder="ÌèâÏ†ê (1-5)" step="0.1" max="5" class="px-4 py-3 border rounded-lg">
                        </div>
                    </div>
                    
                    <button onclick="analyzeCompetitor()" class="w-full md:w-auto px-8 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold">
                        <i class="fas fa-chart-bar mr-2"></i>Í≤ΩÏüÅÎ†• Î∂ÑÏÑùÌïòÍ∏∞
                    </button>
                    
                    <div id="competitorResult" class="hidden mt-8">
                        <div class="bg-purple-50 border-l-4 border-purple-600 p-6 rounded-lg">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Î≤§ÏπòÎßàÌÇπ Í≤∞Í≥º</h3>
                            <canvas id="competitorChart" class="max-w-2xl mx-auto"></canvas>
                            <div class="mt-6 grid md:grid-cols-2 gap-4">
                                <div class="bg-white p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-green-600">üí™ Ïö∞Î¶¨Ïùò Í∞ïÏ†ê</h4>
                                    <ul id="strengths" class="space-y-2 text-sm"></ul>
                                </div>
                                <div class="bg-white p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-orange-600">üìà Í∞úÏÑ† Ìè¨Ïù∏Ìä∏</h4>
                                    <ul id="improvements" class="space-y-2 text-sm"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. Î¶¨Î∑∞ ÏùëÎãµ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±Í∏∞ -->
            <section id="review" class="mb-12">
                <div class="bg-white rounded-2xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-star text-yellow-500 mr-3"></i>
                        Î¶¨Î∑∞ ÏùëÎãµ ÏûêÎèô ÏÉùÏÑ±Í∏∞
                    </h2>
                    <p class="text-gray-600 mb-6">Í≥†Í∞ù Î¶¨Î∑∞Ïóê ÎßûÏ∂§Ìòï ÏùëÎãµÏùÑ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî</p>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î¶¨Î∑∞ Ïú†Ìòï ÏÑ†ÌÉù</label>
                        <select id="reviewType" class="w-full px-4 py-3 border rounded-lg">
                            <option value="positive">Í∏çÏ†ïÏ†Å Î¶¨Î∑∞ (‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê)</option>
                            <option value="neutral">Î≥¥ÌÜµ Î¶¨Î∑∞ (‚≠ê‚≠ê‚≠ê)</option>
                            <option value="negative">Î∂ÄÏ†ïÏ†Å Î¶¨Î∑∞ (‚≠ê‚≠ê)</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Î¶¨Î∑∞ ÎÇ¥Ïö© (ÏÑ†ÌÉù)</label>
                        <textarea id="reviewContent" rows="3" placeholder="Ïòà: ÏÑ†ÏÉùÎãòÏù¥ ÏπúÏ†àÌïòÏãúÍ≥† ÏÑ§Î™ÖÏùÑ ÏûòÌï¥Ï£ºÏÖîÏÑú ÏïÑÏù¥Í∞Ä Ï¢ãÏïÑÌï©ÎãàÎã§" 
                                  class="w-full px-4 py-3 border rounded-lg"></textarea>
                    </div>
                    
                    <button onclick="generateReviewResponse()" class="w-full md:w-auto px-8 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-semibold">
                        <i class="fas fa-magic mr-2"></i>ÏùëÎãµ ÏÉùÏÑ±ÌïòÍ∏∞
                    </button>
                    
                    <div id="reviewResponse" class="hidden mt-8">
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-lg">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Ï∂îÏ≤ú ÏùëÎãµ</h3>
                            <div class="bg-white p-6 rounded-lg mb-4">
                                <p id="responseText" class="text-gray-800 leading-relaxed whitespace-pre-wrap"></p>
                            </div>
                            <button onclick="copyResponse()" class="px-6 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                <i class="fas fa-copy mr-2"></i>Î≥µÏÇ¨ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ -->
            <section id="optimization" class="mb-12">
                <div class="bg-white rounded-2xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                    </h2>
                    <p class="text-gray-600 mb-6">ÏÉÅÏúÑÎÖ∏Ï∂úÏùÑ ÏúÑÌïú ÌïÑÏàò Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                    
                    <div class="space-y-4">
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check1" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check1" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">Ï†ïÌôïÌïú Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ§Ï†ï</div>
                                <div class="text-sm text-gray-600">ÏóÖÏ¢ÖÏóê ÎßûÎäî Ï†ïÌôïÌïú Ïπ¥ÌÖåÍ≥†Î¶¨Î•º 1ÏàúÏúÑÎ°ú ÏÑ§Ï†ïÌñàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check2" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check2" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">ÏÉÅÏÑ∏ Ï†ïÎ≥¥ 100% ÏûÖÎ†•</div>
                                <div class="text-sm text-gray-600">ÏòÅÏóÖÏãúÍ∞Ñ, Ï†ÑÌôîÎ≤àÌò∏, Ï£ºÏÜå, ÌôàÌéòÏù¥ÏßÄ Îì± Î™®Îì† Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌñàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check3" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check3" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">Í≥†ÌÄÑÎ¶¨Ìã∞ ÏÇ¨ÏßÑ Îì±Î°ù</div>
                                <div class="text-sm text-gray-600">ÎÇ¥Î∂Ä/Ïô∏Î∂Ä ÏÇ¨ÏßÑ 10Ïû• Ïù¥ÏÉÅ, Ìï¥ÏÉÅÎèÑ ÎÜíÏùÄ ÏÇ¨ÏßÑÏùÑ Îì±Î°ùÌñàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check4" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check4" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">Ï†ïÍ∏∞Ï†ÅÏù∏ Í≤åÏãúÍ∏Ä ÏóÖÎ°úÎìú</div>
                                <div class="text-sm text-gray-600">Ï£º 2-3Ìöå Ïù¥ÏÉÅ ÏÜåÏãù, Ïù¥Î≤§Ìä∏, ÏàòÏóÖ ÌõÑÍ∏∞ Îì±ÏùÑ Ïò¨Î¶¨Í≥† ÏûàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check5" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check5" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">Î¶¨Î∑∞ Í¥ÄÎ¶¨ (ÏùëÎãµÎ•† 80% Ïù¥ÏÉÅ)</div>
                                <div class="text-sm text-gray-600">Î™®Îì† Î¶¨Î∑∞Ïóê 24ÏãúÍ∞Ñ ÎÇ¥ Ï†ïÏÑ±Ïä§Îü¨Ïö¥ ÎãµÎ≥ÄÏùÑ Îã¨Í≥† ÏûàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check6" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check6" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">ÏòàÏïΩ / Î¨∏Ïùò Í∏∞Îä• ÌôúÏÑ±Ìôî</div>
                                <div class="text-sm text-gray-600">ÎÑ§Ïù¥Î≤Ñ ÏòàÏïΩ ÎòêÎäî ÌÜ°ÌÜ° ÏÉÅÎã¥ÏùÑ ÏºúÎëêÏóàÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check7" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check7" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">Î©îÎâ¥/Í∞ÄÍ≤© Ï†ïÎ≥¥ Í≥µÍ∞ú</div>
                                <div class="text-sm text-gray-600">ÏàòÏóÖÎ£å, ÏàòÍ∞ï ÌîÑÎ°úÍ∑∏Îû® Îì± Ìà¨Î™ÖÌïú Í∞ÄÍ≤© Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎÇòÏöî?</div>
                            </label>
                        </div>
                        
                        <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <input type="checkbox" id="check8" class="w-6 h-6 mt-1 text-green-600 rounded">
                            <label for="check8" class="flex-1 cursor-pointer">
                                <div class="font-semibold text-gray-900">ÌÇ§ÏõåÎìú ÏûêÏó∞Ïä§ÎüΩÍ≤å Ìè¨Ìï®</div>
                                <div class="text-sm text-gray-600">ÏÜåÍ∞úÍ∏ÄÍ≥º Í≤åÏãúÍ∏ÄÏóê ÏßÄÏó≠+ÏóÖÏ¢Ö ÌÇ§ÏõåÎìúÍ∞Ä ÏûêÏó∞Ïä§ÎüΩÍ≤å Îì§Ïñ¥Í∞Ä ÏûàÎÇòÏöî?</div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mt-8 p-6 bg-green-50 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-lg font-semibold text-gray-900">ÏµúÏ†ÅÌôî Ï†êÏàò</span>
                            <span id="optimizationScore" class="text-3xl font-bold text-green-600">0/8</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="optimizationBar" class="bg-green-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-3">üí° 8Í∞ú Ìï≠Î™©ÏùÑ Î™®Îëê Ï≤¥ÌÅ¨ÌïòÎ©¥ ÏÉÅÏúÑÎÖ∏Ï∂ú ÌôïÎ•†Ïù¥ ÌÅ¨Í≤å ÎÜíÏïÑÏßëÎãàÎã§!</p>
                    </div>
                </div>
            </section>

            <!-- 5. ÏµúÏ†Å ÏòÅÏóÖÏãúÍ∞Ñ Ï∂îÏ≤ú -->
            <section class="mb-12">
                <div class="bg-white rounded-2xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-clock text-indigo-600 mr-3"></i>
                        ÏµúÏ†Å ÏòÅÏóÖÏãúÍ∞Ñ & Í≤åÏãú ÏãúÍ∞Ñ Ï∂îÏ≤ú
                    </h2>
                    <p class="text-gray-600 mb-6">ÌïôÏõê ÏóÖÏ¢Ö ÌäπÏÑ±Ïóê ÎßûÎäî ÏµúÏ†ÅÏùò Ïö¥ÏòÅ ÏãúÍ∞ÑÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§</p>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="p-6 bg-indigo-50 rounded-lg">
                            <h3 class="font-bold text-gray-900 mb-4">üìå Ï∂îÏ≤ú ÏòÅÏóÖÏãúÍ∞Ñ</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">ÌèâÏùº</span>
                                    <span class="font-semibold">14:00 - 22:00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ï£ºÎßê</span>
                                    <span class="font-semibold">09:00 - 18:00</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-3">* ÌïôÏõê ÏóÖÏ¢ÖÏùÄ Î∞©Í≥º ÌõÑ ~ Ï†ÄÎÖÅ ÏãúÍ∞ÑÎåÄ ÏßëÏ§ë ÎÖ∏Ï∂úÏù¥ Ïú†Î¶¨Ìï©ÎãàÎã§</p>
                            </div>
                        </div>
                        
                        <div class="p-6 bg-indigo-50 rounded-lg">
                            <h3 class="font-bold text-gray-900 mb-4">üì± Ï∂îÏ≤ú Í≤åÏãúÍ∏Ä ÏóÖÎ°úÎìú ÏãúÍ∞Ñ</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="w-24 text-gray-600">ÌèâÏùº Ïò§Ï†Ñ</span>
                                    <span class="font-semibold">10:00 - 11:00</span>
                                    <span class="text-xs text-gray-500">(ÌïôÎ∂ÄÎ™® ÌôúÎèô ÏãúÍ∞Ñ)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="w-24 text-gray-600">ÌèâÏùº Ï†ÄÎÖÅ</span>
                                    <span class="font-semibold">19:00 - 20:00</span>
                                    <span class="text-xs text-gray-500">(Ìá¥Í∑º ÌõÑ Í≤ÄÏÉâ)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="w-24 text-gray-600">Ï£ºÎßê</span>
                                    <span class="font-semibold">11:00 - 13:00</span>
                                    <span class="text-xs text-gray-500">(Ï£ºÎßê ÌïôÏõê Í≤ÄÏÉâ)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <script>
            // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
            function analyzeKeyword() {
                const location = document.getElementById('location').value.trim();
                const keyword = document.getElementById('keyword').value.trim();
                
                if (!location || !keyword) {
                    alert('ÏßÄÏó≠Í≥º ÌÇ§ÏõåÎìúÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }
                
                // ÏãúÎÆ¨Î†àÏù¥ÏÖò Îç∞Ïù¥ÌÑ∞
                const searchVolume = Math.floor(Math.random() * 1500) + 500;
                const competition = ['ÎÇÆÏùå', 'Î≥¥ÌÜµ', 'ÎÜíÏùå'][Math.floor(Math.random() * 3)];
                const score = Math.floor(Math.random() * 30) + 70;
                
                document.getElementById('searchVolume').textContent = searchVolume.toLocaleString();
                document.getElementById('competition').textContent = competition;
                document.getElementById('competition').className = 'text-3xl font-bold ' + 
                    (competition === 'ÎÇÆÏùå' ? 'text-green-600' : competition === 'Î≥¥ÌÜµ' ? 'text-yellow-600' : 'text-red-600');
                document.getElementById('score').textContent = score;
                
                // Ï∂îÏ≤ú ÌÇ§ÏõåÎìú
                const suggestions = [
                    \`\${location} \${keyword}\`,
                    \`\${location} \${keyword} Ï∂îÏ≤ú\`,
                    \`\${location} \${keyword} Í∞ÄÍ≤©\`,
                    \`\${location} Ï¥àÎì± \${keyword}\`,
                    \`\${location} Ï§ëÎì± \${keyword}\`,
                ];
                
                const suggestionsHTML = suggestions.map(s => 
                    \`<div class="flex items-center gap-3 text-sm">
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-medium">\${s}</span>
                        <span class="text-gray-500">Í≤ÄÏÉâÎüâ: \${Math.floor(Math.random() * 500) + 100}</span>
                    </div>\`
                ).join('');
                
                document.getElementById('keywordSuggestions').innerHTML = suggestionsHTML;
                document.getElementById('keywordResult').classList.remove('hidden');
                
                // Ïä§ÌÅ¨Î°§
                document.getElementById('keywordResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù
            let competitorChart = null;
            
            function analyzeCompetitor() {
                const myAcademy = document.getElementById('myAcademy').value.trim();
                const myReviews = parseInt(document.getElementById('myReviews').value) || 0;
                const myRating = parseFloat(document.getElementById('myRating').value) || 0;
                
                if (!myAcademy) {
                    alert('ÌïôÏõêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }
                
                // ÏãúÎÆ¨Î†àÏù¥ÏÖò Îç∞Ïù¥ÌÑ∞
                const competitors = [
                    { name: 'Í≤ΩÏüÅÏÇ¨ A', reviews: Math.floor(Math.random() * 100) + 50, rating: (Math.random() * 1 + 4).toFixed(1) },
                    { name: 'Í≤ΩÏüÅÏÇ¨ B', reviews: Math.floor(Math.random() * 100) + 50, rating: (Math.random() * 1 + 4).toFixed(1) },
                    { name: 'Í≤ΩÏüÅÏÇ¨ C', reviews: Math.floor(Math.random() * 100) + 50, rating: (Math.random() * 1 + 4).toFixed(1) },
                ];
                
                const avgReviews = Math.floor((competitors.reduce((sum, c) => sum + c.reviews, 0)) / 3);
                const avgRating = (competitors.reduce((sum, c) => sum + parseFloat(c.rating), 0) / 3).toFixed(1);
                
                // Ï∞®Ìä∏ ÏÉùÏÑ±
                const ctx = document.getElementById('competitorChart');
                if (competitorChart) competitorChart.destroy();
                
                competitorChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [myAcademy, ...competitors.map(c => c.name), 'ÌèâÍ∑†'],
                        datasets: [{
                            label: 'Î¶¨Î∑∞ Ïàò',
                            data: [myReviews, ...competitors.map(c => c.reviews), avgReviews],
                            backgroundColor: ['#3B82F6', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#FCD34D'],
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: true } }
                    }
                });
                
                // Í∞ïÏ†ê/Í∞úÏÑ†Ï†ê
                const strengths = [];
                const improvements = [];
                
                if (myReviews > avgReviews) strengths.push('Î¶¨Î∑∞ ÏàòÍ∞Ä ÌèâÍ∑†Î≥¥Îã§ ÎßéÏäµÎãàÎã§');
                else improvements.push(\`Î¶¨Î∑∞Î•º \${avgReviews - myReviews}Í∞ú Îçî ÌôïÎ≥¥ÌïòÏÑ∏Ïöî\`);
                
                if (myRating >= parseFloat(avgRating)) strengths.push('ÌèâÏ†êÏù¥ ÌèâÍ∑† Ïù¥ÏÉÅÏûÖÎãàÎã§');
                else improvements.push('ÌèâÏ†êÏùÑ ÎÜíÏù¥Í∏∞ ÏúÑÌï¥ ÏÑúÎπÑÏä§ ÌíàÏßà Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§');
                
                if (myReviews < 50) improvements.push('Î¶¨Î∑∞ 50Í∞ú Ïù¥ÏÉÅ ÌôïÎ≥¥Î•º Î™©ÌëúÎ°ú ÌïòÏÑ∏Ïöî');
                if (myRating < 4.5) improvements.push('4.5Ï†ê Ïù¥ÏÉÅ ÌèâÏ†ê Ïú†ÏßÄÎ•º ÏúÑÌï¥ ÎÖ∏Î†•ÌïòÏÑ∏Ïöî');
                
                document.getElementById('strengths').innerHTML = strengths.map(s => 
                    \`<li class="flex items-start gap-2"><span class="text-green-600">‚úì</span><span>\${s}</span></li>\`
                ).join('') || '<li class="text-gray-500">Î∂ÑÏÑù Í≤∞Í≥º ÏóÜÏùå</li>';
                
                document.getElementById('improvements').innerHTML = improvements.map(s => 
                    \`<li class="flex items-start gap-2"><span class="text-orange-600">‚Üí</span><span>\${s}</span></li>\`
                ).join('') || '<li class="text-gray-500">Î∂ÑÏÑù Í≤∞Í≥º ÏóÜÏùå</li>';
                
                document.getElementById('competitorResult').classList.remove('hidden');
                document.getElementById('competitorResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Î¶¨Î∑∞ ÏùëÎãµ ÏÉùÏÑ±
            function generateReviewResponse() {
                const type = document.getElementById('reviewType').value;
                const content = document.getElementById('reviewContent').value.trim();
                
                const responses = {
                    positive: [
                        "ÏÜåÏ§ëÌïú Î¶¨Î∑∞ Ï†ïÎßê Í∞êÏÇ¨ÎìúÎ¶ΩÎãàÎã§! üòä\\n{name} ÌïôÎ∂ÄÎ™®ÎãòÏùò Îî∞ÎúªÌïú ÎßêÏîÄÏóê Ï†ÄÌù¨ Î™®Îì† ÏÑ†ÏÉùÎãòÎì§Ïù¥ ÌÅ∞ ÌûòÏùÑ ÏñªÏäµÎãàÎã§.\\nÏïûÏúºÎ°úÎèÑ ÌïôÏÉùÏùò ÏÑ±Ïû•ÏùÑ ÏúÑÌï¥ ÏµúÏÑ†ÏùÑ Îã§ÌïòÎäî {academy}Ïù¥ ÎêòÍ≤†ÏäµÎãàÎã§.\\nÌï≠ÏÉÅ Í∞êÏÇ¨Ìï©ÎãàÎã§! üôè",
                        "Î¶¨Î∑∞ ÎÇ®Í≤®Ï£ºÏÖîÏÑú ÏßÑÏã¨ÏúºÎ°ú Í∞êÏÇ¨Ìï©ÎãàÎã§! ‚ù§Ô∏è\\nÌïôÏÉùÏù¥ Ï¶êÍ≤ÅÍ≤å Í≥µÎ∂ÄÌïòÎäî Î™®ÏäµÏùÑ Î≥¥Îãà Ï†ÄÌù¨ÎèÑ Ï†ïÎßê ÎøåÎìØÌï©ÎãàÎã§.\\nÎçî ÎÇòÏùÄ ÏàòÏóÖ, Îçî Ï¢ãÏùÄ Í≤∞Í≥ºÎ°ú Î≥¥ÎãµÌïòÍ≤†ÏäµÎãàÎã§.\\nÏñ∏Ï†úÎì†ÏßÄ Í∂ÅÍ∏àÌïú Ï†ê ÏûàÏúºÏãúÎ©¥ Ìé∏ÌïòÍ≤å Ïó∞ÎùΩÏ£ºÏÑ∏Ïöî! üòä"
                    ],
                    neutral: [
                        "ÏÜåÏ§ëÌïú ÏùòÍ≤¨ Í∞êÏÇ¨Ìï©ÎãàÎã§.\\nÎçî ÎÇòÏùÄ ÏàòÏóÖ ÌôòÍ≤ΩÏùÑ ÎßåÎì§Í∏∞ ÏúÑÌï¥ ÎÖ∏Î†•ÌïòÍ≤†ÏäµÎãàÎã§.\\nÌòπÏãú Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÏù¥ ÏûàÎã§Î©¥ Ïñ∏Ï†úÎì† ÎßêÏîÄÌï¥ Ï£ºÏÑ∏Ïöî!\\n{name} ÌïôÏÉùÏùò Î∞úÏ†ÑÏùÑ ÏúÑÌï¥ ÏµúÏÑ†ÏùÑ Îã§ÌïòÍ≤†ÏäµÎãàÎã§. üôè",
                        "Î¶¨Î∑∞ ÎÇ®Í≤®Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§!\\nÌïôÎ∂ÄÎ™®ÎãòÏùò ÏùòÍ≤¨ÏùÑ Î∞òÏòÅÌïòÏó¨ Îçî ÎÇòÏùÄ ÌïôÏõêÏù¥ ÎêòÎèÑÎ°ù ÎÖ∏Î†•ÌïòÍ≤†ÏäµÎãàÎã§.\\nÏïûÏúºÎ°úÎèÑ ÎßéÏùÄ Í¥ÄÏã¨ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§. üòä"
                    ],
                    negative: [
                        "Î∂àÌé∏ÏùÑ ÎìúÎ†§ Ï†ïÎßê Ï£ÑÏÜ°Ìï©ÎãàÎã§. üòî\\nÎßêÏîÄÌï¥Ï£ºÏã† Î∂ÄÎ∂ÑÏùÄ Ï¶âÏãú Í∞úÏÑ†ÌïòÎèÑÎ°ù ÌïòÍ≤†ÏäµÎãàÎã§.\\nÌïôÎ∂ÄÎ™®ÎãòÍ≥º ÏßÅÏ†ë ÌÜµÌôîÌïòÏó¨ ÏûêÏÑ∏Ìïú Ïù¥ÏïºÍ∏∞Î•º ÎÇòÎàÑÍ≥† Ïã∂ÏäµÎãàÎã§.\\nÌïôÏõêÏúºÎ°ú Ïó∞ÎùΩ Ï£ºÏãúÎ©¥ ÏÑ±Ïã¨ÏÑ±ÏùòÍªè Ìï¥Í≤∞Ìï¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.\\nÎã§Ïãú ÌïúÎ≤à Ï£ÑÏÜ°ÌïòÎã§Îäî ÎßêÏîÄ ÎìúÎ¶ΩÎãàÎã§.",
                        "Í∑ÄÌïú ÏùòÍ≤¨ Í∞êÏÇ¨ÎìúÎ¶¨Î©∞, Î∂àÌé∏ÏùÑ ÎìúÎ¶∞ Ï†ê ÏßÑÏã¨ÏúºÎ°ú ÏÇ¨Í≥ºÎìúÎ¶ΩÎãàÎã§.\\nÏ¶âÏãú Î¨∏Ï†úÎ•º ÌååÏïÖÌïòÏó¨ Í∞úÏÑ† Ï°∞ÏπòÎ•º Ï∑®ÌïòÍ≤†ÏäµÎãàÎã§.\\nÏßÅÏ†ë Ï∞æÏïÑÎµôÍ≥† ÎßêÏîÄÎìúÎ¶¨Í≥† Ïã∂ÏäµÎãàÎã§.\\nÌïôÏõêÏúºÎ°ú Ïó∞ÎùΩ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§. üôè"
                    ]
                };
                
                const templates = responses[type];
                const response = templates[Math.floor(Math.random() * templates.length)]
                    .replace('{name}', 'ÌïôÏÉù')
                    .replace('{academy}', 'ÌïôÏõê');
                
                document.getElementById('responseText').textContent = response;
                document.getElementById('reviewResponse').classList.remove('hidden');
                document.getElementById('reviewResponse').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            function copyResponse() {
                const text = document.getElementById('responseText').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ ÏùëÎãµÏù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                });
            }
            
            // ÏµúÏ†ÅÌôî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateOptimizationScore);
            });
            
            function updateOptimizationScore() {
                const total = 8;
                const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
                const percentage = Math.round((checked / total) * 100);
                
                document.getElementById('optimizationScore').textContent = \`\${checked}/\${total}\`;
                document.getElementById('optimizationBar').style.width = percentage + '%';
            }
        </script>
    </body>
    </html>
  \`)
})
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú ÍµêÏú° - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <meta name="description" content="ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≤ÄÏÉâ ÏµúÏÉÅÏúÑ ÏßÑÏûÖÏùÑ ÏúÑÌïú SEO ÏµúÏ†ÅÌôî Ïã§Ï†Ñ ÍµêÏú°">
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm fixed w-full top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold gradient-orange bg-clip-text text-transparent">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <div class="hidden md:flex space-x-8">
                        <a href="/" class="text-gray-600 hover:text-orange-500">Ìôà</a>
                        <a href="/about" class="text-gray-600 hover:text-orange-500">ÌöåÏÇ¨ ÏÜåÍ∞ú</a>
                        <a href="/contact" class="text-gray-600 hover:text-orange-500">ÎåÄÌñâ Î¨∏Ïùò</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-20">
            <!-- Hero Section -->
            <section class="bg-gradient-to-br from-pink-50 to-white py-20 px-6">
                <div class="max-w-4xl mx-auto text-center">
                    <div class="w-20 h-20 gradient-orange rounded-3xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-blog text-3xl text-white"></i>
                    </div>
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                        Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú
                    </h1>
                    <p class="text-xl text-gray-600 mb-8">
                        ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≤ÄÏÉâ ÏµúÏÉÅÏúÑ ÏßÑÏûÖ Ï†ÑÎûµ<br>
                        SEO ÏµúÏ†ÅÌôîÏôÄ ÏΩòÌÖêÏ∏† Í∏∞ÌöçÏùò Î™®Îì† Í≤É
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="/contact" class="px-8 py-4 gradient-orange text-white rounded-full font-bold hover:shadow-lg transition-all">
                            ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞
                        </a>
                        <a href="/" class="px-8 py-4 bg-white text-gray-700 rounded-full font-bold border-2 border-gray-200 hover:border-pink-500 transition-all">
                            ÎèåÏïÑÍ∞ÄÍ∏∞
                        </a>
                    </div>
                </div>
            </section>

            <!-- ÍµêÏú° ÎÇ¥Ïö© -->
            <section class="py-20 px-6">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">Î¨¥ÏóáÏùÑ Î∞∞Ïö∞ÎÇòÏöî?</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-brain text-pink-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">Í≤ÄÏÉâ ÏïåÍ≥†Î¶¨Ï¶ò ÏôÑÎ≤Ω Ïù¥Ìï¥</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ Î°úÏßÅ Î∂ÑÏÑù</li>
                                <li>‚úì ÏÉÅÏúÑÎÖ∏Ï∂ú ÌïµÏã¨ ÏöîÏÜå</li>
                                <li>‚úì C-Rank, DA Ï†êÏàò Ïù¥Ìï¥</li>
                                <li>‚úì ÏïåÍ≥†Î¶¨Ï¶ò Î≥ÄÌôî ÎåÄÏùëÎ≤ï</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-pen text-pink-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">SEO ÏµúÏ†ÅÌôî Í∏ÄÏì∞Í∏∞</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì ÌÇ§ÏõåÎìú Î¶¨ÏÑúÏπò Î∞©Î≤ï</li>
                                <li>‚úì Ï†úÎ™©/Î≥∏Î¨∏ ÏµúÏ†ÅÌôî</li>
                                <li>‚úì Ïù¥ÎØ∏ÏßÄ SEO Ï†ÑÎûµ</li>
                                <li>‚úì ÎÇ¥Î∂ÄÎßÅÌÅ¨ ÌôúÏö©Î≤ï</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-lightbulb text-pink-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">ÏΩòÌÖêÏ∏† Í∏∞Ìöç Ï†ÑÎûµ</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì ÌïôÏõêÏóÖ ÌäπÌôî Ï£ºÏ†ú Î∞úÍµ¥</li>
                                <li>‚úì ÏãúÎ¶¨Ï¶à ÏΩòÌÖêÏ∏† Í∏∞Ìöç</li>
                                <li>‚úì Í≥ÑÏ†àÎ≥Ñ ÏΩòÌÖêÏ∏† Ï†ÑÎûµ</li>
                                <li>‚úì Î∞îÏù¥Îü¥ ÏΩòÌÖêÏ∏† Ï†úÏûë</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-rocket text-pink-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">ÏßÄÏÜç ÏÑ±Ïû• Ï†ÑÎûµ</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì Ìè¨Ïä§ÌåÖ Ï£ºÍ∏∞ Í¥ÄÎ¶¨</li>
                                <li>‚úì Ïù¥ÏõÉ Í¥ÄÎ¶¨ ÎÖ∏ÌïòÏö∞</li>
                                <li>‚úì Í≥µÍ∞ê/ÎåìÍ∏Ä Ï†ÑÎûµ</li>
                                <li>‚úì ÌÜµÍ≥Ñ Î∂ÑÏÑù Î∞è Í∞úÏÑ†</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ïã§Ï†ú ÏÑ±Í≥º -->
            <section class="py-20 px-6 bg-white">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-gray-900 mb-12">Ïã§Ï†ú ÏÑ±Í≥º</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div>
                            <div class="text-5xl font-bold text-pink-600 mb-2">Top 3</div>
                            <div class="text-gray-600">ÌèâÍ∑† Îã¨ÏÑ± Í∏∞Í∞Ñ<br>1-2Í∞úÏõî</div>
                        </div>
                        <div>
                            <div class="text-5xl font-bold text-pink-600 mb-2">500%</div>
                            <div class="text-gray-600">ÌèâÍ∑† Î∞©Î¨∏Ïûê Ï¶ùÍ∞ÄÏú®</div>
                        </div>
                        <div>
                            <div class="text-5xl font-bold text-pink-600 mb-2">50+</div>
                            <div class="text-gray-600">ÏõîÌèâÍ∑† Ïã†Í∑ú Î¨∏Ïùò</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA -->
            <section class="py-20 px-6 gradient-orange">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl font-bold text-white mb-8">
                        ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                    </h2>
                    <p class="text-xl text-white/90 mb-12">
                        Í≤ÄÏÉâ 1ÌéòÏù¥ÏßÄ ÏßÑÏûÖ, Îçî Ïù¥ÏÉÅ Ïñ¥Î†µÏßÄ ÏïäÏäµÎãàÎã§
                    </p>
                    <a href="/contact" class="inline-block px-12 py-5 bg-white text-pink-600 rounded-full font-bold text-lg hover:shadow-2xl transition-all">
                        ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí
                    </a>
                </div>
            </section>
        </div>
    </body>
    </html>
  `)
})

// ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ - ÌçºÎÑê ÎßàÏºÄÌåÖ
app.get('/programs/funnel', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌçºÎÑê ÎßàÏºÄÌåÖ ÍµêÏú° - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <meta name="description" content="ÏûêÎèôÌôî ÌçºÎÑêÎ°ú 24ÏãúÍ∞Ñ ÌïôÏÉù Î™®Ïßë ÏãúÏä§ÌÖú Íµ¨Ï∂ï Ïã§Ï†Ñ ÍµêÏú°">
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm fixed w-full top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold gradient-purple bg-clip-text text-transparent">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <div class="hidden md:flex space-x-8">
                        <a href="/" class="text-gray-600 hover:text-purple-600">Ìôà</a>
                        <a href="/about" class="text-gray-600 hover:text-purple-600">ÌöåÏÇ¨ ÏÜåÍ∞ú</a>
                        <a href="/contact" class="text-gray-600 hover:text-purple-600">ÎåÄÌñâ Î¨∏Ïùò</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-20">
            <!-- Hero Section -->
            <section class="bg-gradient-to-br from-purple-50 to-white py-20 px-6">
                <div class="max-w-4xl mx-auto text-center">
                    <div class="w-20 h-20 gradient-purple rounded-3xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-filter text-3xl text-white"></i>
                    </div>
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                        ÌçºÎÑê ÎßàÏºÄÌåÖ
                    </h1>
                    <p class="text-xl text-gray-600 mb-8">
                        ÏûêÎèôÌôî ÌçºÎÑêÎ°ú 24ÏãúÍ∞Ñ ÌïôÏÉù Î™®Ïßë<br>
                        ÎûúÎî©ÌéòÏù¥ÏßÄÎ∂ÄÌÑ∞ Ï†ÑÌôòÍπåÏßÄ ÏôÑÎ≤ΩÌïú ÏãúÏä§ÌÖú Íµ¨Ï∂ï
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="/contact" class="px-8 py-4 gradient-purple text-white rounded-full font-bold hover:shadow-lg transition-all">
                            ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞
                        </a>
                        <a href="/" class="px-8 py-4 bg-white text-gray-700 rounded-full font-bold border-2 border-gray-200 hover:border-purple-600 transition-all">
                            ÎèåÏïÑÍ∞ÄÍ∏∞
                        </a>
                    </div>
                </div>
            </section>

            <!-- ÍµêÏú° ÎÇ¥Ïö© -->
            <section class="py-20 px-6">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">Î¨¥ÏóáÏùÑ Î∞∞Ïö∞ÎÇòÏöî?</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-file-alt text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†úÏûë</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì Í≥†Ï†ÑÌôò ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÑ§Í≥Ñ</li>
                                <li>‚úì Ïπ¥ÌîºÎùºÏù¥ÌåÖ Í∏∞Î≤ï</li>
                                <li>‚úì CTA ÏµúÏ†ÅÌôî Ï†ÑÎûµ</li>
                                <li>‚úì Î¨¥Î£å ÎèÑÍµ¨ ÌôúÏö©Î≤ï</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-ad text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">Í¥ëÍ≥† Ïö¥ÏòÅ Ï†ÑÎûµ</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì ÎÑ§Ïù¥Î≤Ñ/Íµ¨Í∏Ä Í¥ëÍ≥† ÏÑ∏ÌåÖ</li>
                                <li>‚úì ÌÉÄÍ≤üÌåÖ ÏµúÏ†ÅÌôî</li>
                                <li>‚úì ÏòàÏÇ∞ Í¥ÄÎ¶¨ ÎÖ∏ÌïòÏö∞</li>
                                <li>‚úì A/B ÌÖåÏä§Ìä∏ Î∞©Î≤ï</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-robot text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">ÏûêÎèôÌôî ÏãúÏä§ÌÖú Íµ¨Ï∂ï</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì Ï±óÎ¥á ÏÉÅÎã¥ ÏãúÏä§ÌÖú</li>
                                <li>‚úì ÏûêÎèô SMS/Ïù¥Î©îÏùº</li>
                                <li>‚úì CRM ÎèÑÍµ¨ ÌôúÏö©</li>
                                <li>‚úì Î¶¨ÌÉÄÍ≤åÌåÖ Ï†ÑÎûµ</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 shadow-sm">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                                <i class="fas fa-chart-pie text-purple-600 text-xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">Ï†ÑÌôòÏú® ÏµúÏ†ÅÌôî</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>‚úì Í≥†Í∞ù Ïó¨Ï†ï ÏÑ§Í≥Ñ</li>
                                <li>‚úì Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Î∞è Í∞úÏÑ†</li>
                                <li>‚úì Ï†ÑÌôò Ìè¨Ïù∏Ìä∏ ÏµúÏ†ÅÌôî</li>
                                <li>‚úì ROI Í∑πÎåÄÌôî Ï†ÑÎûµ</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ïã§Ï†ú ÏÑ±Í≥º -->
            <section class="py-20 px-6 bg-white">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-gray-900 mb-12">Ïã§Ï†ú ÏÑ±Í≥º</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div>
                            <div class="text-5xl font-bold text-purple-600 mb-2">24ÏãúÍ∞Ñ</div>
                            <div class="text-gray-600">ÏûêÎèô ÏÉÅÎã¥ ÏãúÏä§ÌÖú<br>Ïö¥ÏòÅ</div>
                        </div>
                        <div>
                            <div class="text-5xl font-bold text-purple-600 mb-2">800%</div>
                            <div class="text-gray-600">ÌèâÍ∑† ROI<br>Í¥ëÍ≥†ÎπÑ ÎåÄÎπÑ</div>
                        </div>
                        <div>
                            <div class="text-5xl font-bold text-purple-600 mb-2">70%</div>
                            <div class="text-gray-600">ÌèâÍ∑† Ï†ÑÌôòÏú®<br>Î¨∏Ïùò‚ÜíÎì±Î°ù</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA -->
            <section class="py-20 px-6 gradient-purple">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl font-bold text-white mb-8">
                        ÏßÄÍ∏à Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî
                    </h2>
                    <p class="text-xl text-white/90 mb-12">
                        ÏûêÎäî ÎèôÏïàÏóêÎèÑ ÌïôÏÉùÏù¥ Î™®ÏßëÎêòÎäî ÏãúÏä§ÌÖúÏùÑ ÎßåÎìúÏÑ∏Ïöî
                    </p>
                    <a href="/contact" class="inline-block px-12 py-5 bg-white text-purple-600 rounded-full font-bold text-lg hover:shadow-2xl transition-all">
                        ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí
                    </a>
                </div>
            </section>
        </div>
    </body>
    </html>
  `)
})



// SNS ÎßàÏºÄÌåÖ
app.get('/programs/sns', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SNS ÎßàÏºÄÌåÖ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-blue-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üì±</div><h1 class="text-4xl font-bold text-gray-900 mb-4">SNS ÎßàÏºÄÌåÖ</h1><p class="text-xl text-gray-600">Ïù∏Ïä§ÌÉÄÍ∑∏Îû®, ÌéòÏù¥Ïä§Î∂ÅÏúºÎ°ú ÌïôÏÉù Î™®Ïßë</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">SNS ÎßàÏºÄÌåÖÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-blue-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// ÏòÅÏÉÅ ÎßàÏºÄÌåÖ
app.get('/programs/video', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ÏòÅÏÉÅ ÎßàÏºÄÌåÖ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-red-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üé•</div><h1 class="text-4xl font-bold text-gray-900 mb-4">ÏòÅÏÉÅ ÎßàÏºÄÌåÖ</h1><p class="text-xl text-gray-600">Ïú†ÌäúÎ∏å, ÏàèÌèºÏúºÎ°ú ÌïôÏõê ÌôçÎ≥¥</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-red-600 to-red-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">ÏòÅÏÉÅ ÎßàÏºÄÌåÖÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-red-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Ïò®ÎùºÏù∏ Í¥ëÍ≥†
app.get('/programs/ad', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ïò®ÎùºÏù∏ Í¥ëÍ≥† - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-green-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üí∞</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Ïò®ÎùºÏù∏ Í¥ëÍ≥†</h1><p class="text-xl text-gray-600">ÎÑ§Ïù¥Î≤Ñ, Íµ¨Í∏Ä Í¥ëÍ≥† Ïö¥ÏòÅ Ï†ÑÎûµ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-green-600 to-green-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Ïò®ÎùºÏù∏ Í¥ëÍ≥†ÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-green-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖ
app.get('/programs/community', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üë•</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖ</h1><p class="text-xl text-gray-600">ÌïôÎ∂ÄÎ™® Ïª§ÎÆ§ÎãàÌã∞ ÌôúÏÑ±Ìôî Ï†ÑÎûµ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-purple-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Î∏åÎûúÎî©
app.get('/programs/branding', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Î∏åÎûúÎî© - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-pink-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üé®</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Î∏åÎûúÎî©</h1><p class="text-xl text-gray-600">ÌïôÏõê Î∏åÎûúÎìú ÏïÑÏù¥Îç¥Ìã∞Ìã∞ Íµ¨Ï∂ï</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-pink-600 to-pink-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Î∏åÎûúÎî©ÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-pink-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù
// Í≤ÄÏÉâÎüâ Ï°∞Ìöå ÌîÑÎ°úÍ∑∏Îû® Î¶¨Îã§Ïù¥Î†âÌä∏
app.get('/programs/data', (c) => {
  return c.redirect('/tools/search-volume')
})

// ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖ
app.get('/programs/carrot', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-orange-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">ü•ï</div><h1 class="text-4xl font-bold text-gray-900 mb-4">ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖ</h1><p class="text-xl text-gray-600">ÏßÄÏó≠ Í∏∞Î∞ò ÎãπÍ∑ºÎßàÏºì ÌôúÏö© Ï†ÑÎûµ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-orange-600 to-orange-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-orange-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Î©îÌÉÄ Í¥ëÍ≥†
app.get('/programs/meta', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Î©îÌÉÄ Í¥ëÍ≥† - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-blue-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üìò</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Î©îÌÉÄ Í¥ëÍ≥†</h1><p class="text-xl text-gray-600">Facebook/Instagram Í¥ëÍ≥† Ïö¥ÏòÅ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Î©îÌÉÄ Í¥ëÍ≥†ÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-blue-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Ïú†ÌäúÎ∏å Í¥ëÍ≥†
app.get('/programs/youtube-ad', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ïú†ÌäúÎ∏å Í¥ëÍ≥† - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-red-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üì∫</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Ïú†ÌäúÎ∏å Í¥ëÍ≥†</h1><p class="text-xl text-gray-600">Ïú†ÌäúÎ∏å Í¥ëÍ≥† Ï∫†ÌéòÏù∏ Ïö¥ÏòÅ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-red-600 to-red-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Ïú†ÌäúÎ∏å Í¥ëÍ≥†ÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-red-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// Ïì∞Î†àÎìú ÎßàÏºÄÌåÖ
app.get('/programs/threads', (c) => c.html(`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ïì∞Î†àÎìú ÎßàÏºÄÌåÖ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50"><nav class="bg-white shadow-sm border-b sticky top-0 z-50"><div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><button onclick="history.back()" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"><i class="fas fa-arrow-left mr-2"></i>Îí§Î°ú Í∞ÄÍ∏∞</button><a href="/programs" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù</a></div></div></nav><main class="max-w-5xl mx-auto px-6 py-16"><div class="text-center mb-12"><div class="text-6xl mb-4">üßµ</div><h1 class="text-4xl font-bold text-gray-900 mb-4">Ïì∞Î†àÎìú ÎßàÏºÄÌåÖ</h1><p class="text-xl text-gray-600">Meta Threads ÌôúÏö© Ï†ÑÎûµ</p></div><div class="bg-white rounded-2xl p-8 shadow-sm mb-8"><h2 class="text-2xl font-bold mb-6">üéØ ÌîÑÎ°úÍ∑∏Îû® ÏßÑÌñâÏ§ë</h2><p class="text-gray-600 text-center py-8">Ïù¥ ÌîÑÎ°úÍ∑∏Îû®ÏùÄ ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.<br>ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÍµêÏú° Ïã†Ï≤≠ ÌõÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</p></div><div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-2xl p-12 text-center text-white"><h2 class="text-3xl font-bold mb-4">ÌîÑÎ°úÍ∑∏Îû® ÏãúÏûëÌïòÍ∏∞</h2><p class="text-xl mb-8">Ïì∞Î†àÎìú ÎßàÏºÄÌåÖÏúºÎ°ú ÌïôÏõêÏùÑ ÏÑ±Ïû•ÏãúÌÇ§ÏÑ∏Ïöî</p><a href="/contact" class="inline-block px-8 py-4 bg-white text-purple-600 rounded-lg font-semibold hover:shadow-lg">ÍµêÏú° Ïã†Ï≤≠ÌïòÍ∏∞ ‚Üí</a></div></main></body></html>`))

// ÎåÄÌñâ Î¨∏Ïùò ÌéòÏù¥ÏßÄ
app.get('/contact', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎåÄÌñâ Î¨∏Ïùò - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <meta name="description" content="ÌïôÏõê ÎßàÏºÄÌåÖ ÎåÄÌñâ Î∞è ÍµêÏú° Î¨∏Ïùò">
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm fixed w-full top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold gradient-purple bg-clip-text text-transparent">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <div class="hidden md:flex space-x-8">
                        <a href="/" class="text-gray-600 hover:text-purple-600">Ìôà</a>
                        <a href="/about" class="text-gray-600 hover:text-purple-600">ÌöåÏÇ¨ ÏÜåÍ∞ú</a>
                        <a href="/contact" class="text-purple-600 font-bold">ÎåÄÌñâ Î¨∏Ïùò</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-20">
            <!-- Hero Section -->
            <section class="bg-gradient-to-br from-purple-50 to-white py-20 px-6">
                <div class="max-w-4xl mx-auto text-center">
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                        ÎåÄÌñâ Î¨∏Ïùò
                    </h1>
                    <p class="text-xl text-gray-600 mb-8">
                        ÌïôÏõê ÎßàÏºÄÌåÖ ÍµêÏú° Î∞è ÎåÄÌñâ ÏÑúÎπÑÏä§ Î¨∏Ïùò<br>
                        24ÏãúÍ∞Ñ ÎÇ¥Ïóê Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§
                    </p>
                </div>
            </section>

            <!-- Î¨∏Ïùò ÏñëÏãù -->
            <section class="py-20 px-6">
                <div class="max-w-3xl mx-auto">
                    <!-- Ïπ¥Ïπ¥Ïò§Ï±ÑÎÑê Î¨∏Ïùò Î≤ÑÌäº -->
                    <div class="mb-8">
                        <a href="https://pf.kakao.com/_tnZzn/chat" target="_blank" rel="noopener noreferrer"
                            class="block bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all transform hover:-translate-y-1">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="w-16 h-16 bg-yellow-300 rounded-2xl flex items-center justify-center">
                                        <svg class="w-10 h-10" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 3C6.5 3 2 6.58 2 11c0 2.95 2.03 5.53 5 6.74V22l4.5-3.5c.67.09 1.36.14 2.5.14 5.5 0 10-3.58 10-8s-4.5-8-10-8z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold mb-1">üí¨ Ïπ¥Ïπ¥Ïò§Ï±ÑÎÑêÎ°ú Îπ†Î•∏ Î¨∏Ïùò</h3>
                                        <p class="text-sm text-gray-700">Ïã§ÏãúÍ∞Ñ ÏÉÅÎã¥ Í∞ÄÎä• (ÌèâÏùº 9:00-18:00)</p>
                                    </div>
                                </div>
                                <div class="text-2xl">‚Üí</div>
                            </div>
                        </a>
                    </div>

                    <div class="text-center mb-8">
                        <span class="inline-block px-4 py-2 bg-gray-100 rounded-full text-sm text-gray-600">
                            ÎòêÎäî ÏïÑÎûò ÏñëÏãùÏúºÎ°ú Î¨∏ÏùòÌïòÏÑ∏Ïöî
                        </span>
                    </div>

                    <div class="bg-white rounded-3xl shadow-lg p-8 md:p-12">
                        <form id="contactForm" class="space-y-6">
                            <!-- Î¨∏Ïùò Ïú†Ìòï -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">Î¨∏Ïùò Ïú†Ìòï *</label>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-purple-600">
                                        <input type="radio" name="type" value="ÍµêÏú°" required class="mr-3">
                                        <span>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Î¨∏Ïùò</span>
                                    </label>
                                    <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-purple-600">
                                        <input type="radio" name="type" value="ÎåÄÌñâ" required class="mr-3">
                                        <span>ÎßàÏºÄÌåÖ ÎåÄÌñâ Î¨∏Ïùò</span>
                                    </label>
                                </div>
                            </div>

                            <!-- ÌïôÏõêÎ™Ö -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">ÌïôÏõêÎ™Ö *</label>
                                <input type="text" name="academy" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-600 focus:outline-none"
                                    placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê">
                            </div>

                            <!-- ÏõêÏû•Îãò ÏÑ±Ìï® -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">ÏõêÏû•Îãò ÏÑ±Ìï® *</label>
                                <input type="text" name="name" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-600 focus:outline-none"
                                    placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî">
                            </div>

                            <!-- Ïó∞ÎùΩÏ≤ò -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">Ïó∞ÎùΩÏ≤ò *</label>
                                <input type="tel" name="phone" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-600 focus:outline-none"
                                    placeholder="010-0000-0000">
                            </div>

                            <!-- Ïù¥Î©îÏùº -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">Ïù¥Î©îÏùº</label>
                                <input type="email" name="email" 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-600 focus:outline-none"
                                    placeholder="academy@example.com">
                            </div>

                            <!-- Í¥ÄÏã¨ ÌîÑÎ°úÍ∑∏Îû® -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">Í¥ÄÏã¨ ÌîÑÎ°úÍ∑∏Îû®</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="program" value="ÎÑ§Ïù¥Î≤ÑÌîåÎ†àÏù¥Ïä§" class="mr-2">
                                        <span>ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="program" value="Î∏îÎ°úÍ∑∏" class="mr-2">
                                        <span>Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="program" value="ÌçºÎÑê" class="mr-2">
                                        <span>ÌçºÎÑê ÎßàÏºÄÌåÖ</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Î¨∏Ïùò ÎÇ¥Ïö© -->
                            <div>
                                <label class="block text-gray-700 font-bold mb-3">Î¨∏Ïùò ÎÇ¥Ïö© *</label>
                                <textarea name="message" required rows="6"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-600 focus:outline-none"
                                    placeholder="Í∂ÅÍ∏àÌïòÏã† ÎÇ¥Ïö©ÏùÑ ÏûêÏú†Î°≠Í≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî"></textarea>
                            </div>

                            <!-- Ï†úÏ∂ú Î≤ÑÌäº -->
                            <button type="submit" 
                                class="w-full py-4 gradient-purple text-white rounded-xl font-bold text-lg hover:shadow-lg transition-all">
                                Î¨∏ÏùòÌïòÍ∏∞
                            </button>

                            <p class="text-center text-sm text-gray-500">
                                * ÌëúÏãúÎäî ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§
                            </p>
                        </form>

                        <!-- ÏÑ±Í≥µ Î©îÏãúÏßÄ (Ïà®ÍπÄ) -->
                        <div id="successMessage" class="hidden text-center py-12">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-check text-3xl text-green-600"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Î¨∏ÏùòÍ∞Ä Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§!</h3>
                            <p class="text-gray-600 mb-8">
                                Îπ†Î•∏ ÏãúÍ∞Ñ ÎÇ¥Ïóê Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.<br>
                                Í∞êÏÇ¨Ìï©ÎãàÎã§.
                            </p>
                            <a href="/" class="inline-block px-8 py-3 gradient-purple text-white rounded-full font-bold hover:shadow-lg transition-all">
                                ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ïó∞ÎùΩÏ≤ò Ï†ïÎ≥¥ -->
            <section class="py-20 px-6 bg-white">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">Ïó∞ÎùΩÏ≤ò</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-phone text-purple-600 text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">Ï†ÑÌôî Î¨∏Ïùò</h3>
                            <p class="text-gray-600">010-8739-9697</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-envelope text-purple-600 text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">Ïù¥Î©îÏùº</h3>
                            <p class="text-gray-600">wangholy1@naver.com</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-map-marker-alt text-purple-600 text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">ÏúÑÏπò</h3>
                            <p class="text-gray-600">Ïù∏Ï≤úÍ¥ëÏó≠Ïãú ÏÑúÍµ¨ Ï≤≠ÎùºÏª§ÎÇºÎ°ú 270, 2Ï∏µ</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <script>
            document.getElementById('contactForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const data = {
                    type: formData.get('type'),
                    academy: formData.get('academy'),
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    email: formData.get('email'),
                    programs: formData.getAll('program'),
                    message: formData.get('message')
                };

                try {
                    const response = await fetch('/api/contact', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        document.getElementById('contactForm').classList.add('hidden');
                        document.getElementById('successMessage').classList.remove('hidden');
                    } else {
                        alert('Î¨∏Ïùò Ï†ëÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    }
                } catch (err) {
                    alert('Î¨∏Ïùò Ï†ëÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            });
        </script>
    </body>
    </html>
  `)
})

// ============================================
// ÎßàÏºÄÌåÖ Ìà¥ 10Í∞ú
// ============================================

// 1. ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞
app.get('/tools/keyword-analyzer', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">üîç ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞</h1>
                <p class="text-xl text-gray-600">ÌïôÏõê Ï£ºÎ≥Ä Í≤ΩÏüÅ ÌÇ§ÏõåÎìúÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏµúÏ†ÅÏùò ÌÇ§ÏõåÎìúÎ•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <form id="keywordForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÏßÄÏó≠ ÏûÖÎ†•</label>
                        <input type="text" id="location" placeholder="Ïòà: Ïù∏Ï≤ú ÏÑúÍµ¨ Í≤ÄÎã®Îèô" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê Ï¢ÖÎ•ò</label>
                        <input type="text" id="type" placeholder="Ïòà: ÏòÅÏñ¥ÌïôÏõê, ÏàòÌïôÌïôÏõê" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <button type="submit" class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-xl transition">
                        ÌÇ§ÏõåÎìú Î∂ÑÏÑùÌïòÍ∏∞
                    </button>
                </form>
            </div>

            <div id="results" class="hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Î∂ÑÏÑù Í≤∞Í≥º</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 bg-purple-50 rounded-xl">
                        <h3 class="font-bold text-purple-900 mb-2">Ï∂îÏ≤ú ÌÇ§ÏõåÎìú</h3>
                        <ul id="recommendedKeywords" class="space-y-2 text-sm"></ul>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-xl">
                        <h3 class="font-bold text-orange-900 mb-2">Í≤ΩÏüÅ Î∂ÑÏÑù</h3>
                        <ul id="competition" class="space-y-2 text-sm"></ul>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.getElementById('keywordForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const location = document.getElementById('location').value;
                const type = document.getElementById('type').value;
                
                const results = document.getElementById('results');
                results.classList.remove('hidden');
                
                const recommended = [
                    location + ' ' + type,
                    location + ' ' + type + ' Ï∂îÏ≤ú',
                    location + ' ' + type + ' ÏûòÌïòÎäîÍ≥≥',
                    type + ' ' + location + ' ÌèâÏ†êÎÜíÏùÄ',
                    'Ï¥àÎì± ' + type + ' ' + location
                ];
                
                const recommendedEl = document.getElementById('recommendedKeywords');
                recommendedEl.innerHTML = recommended.map(k => 
                    '<li class="flex items-center"><i class="fas fa-check-circle text-purple-600 mr-2"></i>' + k + '</li>'
                ).join('');
                
                const competitionEl = document.getElementById('competition');
                competitionEl.innerHTML = \`
                    <li>Í≤ΩÏüÅ ÌïôÏõê Ïàò: <span class="font-bold">12Í∞ú</span></li>
                    <li>ÌèâÍ∑† Î¶¨Î∑∞ Ïàò: <span class="font-bold">23Í∞ú</span></li>
                    <li>ÌèâÍ∑† ÌèâÏ†ê: <span class="font-bold">4.5Ï†ê</span></li>
                    <li>Í≤ΩÏüÅ Í∞ïÎèÑ: <span class="font-bold text-orange-600">Ï§ëÍ∞Ñ</span></li>
                \`;
            });
        </script>
    </body>
    </html>
  `)
})

// 2. Î¶¨Î∑∞ ÏùëÎãµ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±Í∏∞
app.get('/tools/review-template', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¶¨Î∑∞ ÏùëÎãµ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üí¨ Î¶¨Î∑∞ ÏùëÎãµ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±Í∏∞</h1>
            <p class="text-xl text-gray-600 text-center mb-12">Í≥†Í∞ù Î¶¨Î∑∞Ïóê ÎßûÏ∂§Ìòï ÎãµÎ≥ÄÏùÑ ÏûêÎèô ÏÉùÏÑ±Ìï©ÎãàÎã§</p>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">Î¶¨Î∑∞ Ïú†Ìòï ÏÑ†ÌÉù</label>
                        <select id="reviewType" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="positive">Í∏çÏ†ï Î¶¨Î∑∞</option>
                            <option value="negative">Î∂ÄÏ†ï Î¶¨Î∑∞</option>
                            <option value="neutral">Ï§ëÎ¶Ω Î¶¨Î∑∞</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">Î¶¨Î∑∞ ÎÇ¥Ïö©</label>
                        <textarea id="reviewContent" rows="4" placeholder="Í≥†Í∞ùÏù¥ ÎÇ®Í∏¥ Î¶¨Î∑∞ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none"></textarea>
                    </div>
                    <button onclick="generateTemplate()" class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-xl transition">
                        ÏùëÎãµ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±
                    </button>
                </div>
            </div>

            <div id="templateResult" class="hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">ÏÉùÏÑ±Îêú ÏùëÎãµ</h2>
                <div class="p-6 bg-gray-50 rounded-xl mb-4">
                    <p id="generatedResponse" class="text-gray-800 whitespace-pre-wrap"></p>
                </div>
                <button onclick="copyResponse()" class="gradient-purple text-white px-6 py-3 rounded-xl font-medium hover:shadow-lg transition">
                    üìã Î≥µÏÇ¨ÌïòÍ∏∞
                </button>
            </div>
        </div>

        <script>
            function generateTemplate() {
                const type = document.getElementById('reviewType').value;
                const content = document.getElementById('reviewContent').value;
                
                let response = '';
                if(type === 'positive') {
                    response = content + '\\n\\nÏÜåÏ§ëÌïú Î¶¨Î∑∞ Í∞êÏÇ¨Ìï©ÎãàÎã§! üòä\\nÏïûÏúºÎ°úÎèÑ Îçî ÎÇòÏùÄ ÍµêÏú°ÏúºÎ°ú Î≥¥ÎãµÌïòÍ≤†ÏäµÎãàÎã§.\\nÌï≠ÏÉÅ ÏùëÏõêÌï¥Ï£ºÏÑ∏Ïöî!\\n\\n- Íæ∏Î©îÎïÖÌïôÏõê ÏõêÏû• ÎìúÎ¶º';
                } else if(type === 'negative') {
                    response = 'ÏÜåÏ§ëÌïú ÏùòÍ≤¨ Í∞êÏÇ¨ÎìúÎ¶ΩÎãàÎã§.\\nÎßêÏîÄÌï¥Ï£ºÏã† Î∂ÄÎ∂ÑÏóê ÎåÄÌï¥ ÍπäÏù¥ Î∞òÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§.\\nÏ¶âÏãú Í∞úÏÑ†ÌïòÏó¨ Îçî ÎÇòÏùÄ ÏÑúÎπÑÏä§Î°ú Î≥¥ÎãµÌïòÍ≤†ÏäµÎãàÎã§.\\nÎã§Ïãú Ìïú Î≤à Ï£ÑÏÜ°Ìï©ÎãàÎã§.\\n\\n- Íæ∏Î©îÎïÖÌïôÏõê ÏõêÏû• ÎìúÎ¶º';
                } else {
                    response = 'Î¶¨Î∑∞ ÎÇ®Í≤®Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§.\\nÎçî Ï¢ãÏùÄ ÍµêÏú° ÌôòÍ≤ΩÏùÑ ÎßåÎì§Í∏∞ ÏúÑÌï¥ ÎÖ∏Î†•ÌïòÍ≤†ÏäµÎãàÎã§.\\nÍ∞êÏÇ¨Ìï©ÎãàÎã§.\\n\\n- Íæ∏Î©îÎïÖÌïôÏõê ÏõêÏû• ÎìúÎ¶º';
                }
                
                document.getElementById('generatedResponse').textContent = response;
                document.getElementById('templateResult').classList.remove('hidden');
            }
            
            function copyResponse() {
                const text = document.getElementById('generatedResponse').textContent;
                navigator.clipboard.writeText(text);
                alert('Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            }
        </script>
    </body>
    </html>
  `)
})

// 3. ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞
app.get('/tools/ad-copy-generator', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">‚ú® ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞</h1>
            <p class="text-xl text-gray-600 text-center mb-12">Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÏõê Í¥ëÍ≥† Î¨∏Íµ¨Î•º ÏûêÎèôÏúºÎ°ú ÎßåÎì§Ïñ¥ÎìúÎ¶ΩÎãàÎã§</p>

            <div class="bg-white rounded-2xl shadow-lg p-8">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö</label>
                        <input type="text" id="academyName" placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">Í≥ºÎ™©</label>
                        <input type="text" id="subject" placeholder="Ïòà: ÏòÅÏñ¥, ÏàòÌïô" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">Í∞ïÏ†ê</label>
                        <input type="text" id="strength" placeholder="Ïòà: ÏÜåÏàòÏ†ïÏòà, 1:1 ÎßûÏ∂§" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <button onclick="generateAdCopy()" class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-xl transition">
                        ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±
                    </button>
                </div>

                <div id="copyResults" class="hidden mt-8 space-y-4">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">ÏÉùÏÑ±Îêú ÌôçÎ≥¥ Î¨∏Íµ¨ (5Í∞ú)</h2>
                    <div id="copyList"></div>
                </div>
            </div>
        </div>

        <script>
            function generateAdCopy() {
                const name = document.getElementById('academyName').value;
                const subject = document.getElementById('subject').value;
                const strength = document.getElementById('strength').value;
                
                const copies = [
                    name + 'ÏóêÏÑú ' + subject + ' Ïã§Î†•ÏùÑ ÏôÑÏÑ±ÌïòÏÑ∏Ïöî! ' + strength + ' ÏàòÏóÖÏúºÎ°ú ÏÑ±Ï†Å UP! üìà',
                    subject + ' Í≥†ÎØºÎêòÏãúÏ£†? ' + name + 'Ïùò ' + strength + ' ÏãúÏä§ÌÖúÏù¥ ÎãµÏûÖÎãàÎã§! üéØ',
                    'Ïö∞Î¶¨ ÏïÑÏù¥ ' + subject + ' ÏÑ±Ï†Å, ' + name + 'ÏóêÏÑú Ï±ÖÏûÑÏßëÎãàÎã§! ' + strength + ' ÍµêÏú° üí™',
                    name + ' | ' + subject + ' Ï†ÑÎ¨∏ | ' + strength + ' | ÏßÄÍ∏à ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÏÑ∏Ïöî! ‚òéÔ∏è',
                    strength + 'Î°ú Ï∞®Î≥ÑÌôîÎêú ' + subject + ' ÍµêÏú°, ' + name + 'ÏûÖÎãàÎã§! ‚ú®'
                ];
                
                const listEl = document.getElementById('copyList');
                listEl.innerHTML = copies.map((copy, i) => \`
                    <div class="p-4 bg-purple-50 rounded-xl">
                        <div class="flex justify-between items-start">
                            <p class="text-gray-800 flex-1">\${i+1}. \${copy}</p>
                            <button onclick="copySingle('\${copy}')" class="ml-4 text-purple-600 hover:text-purple-700">
                                üìã
                            </button>
                        </div>
                    </div>
                \`).join('');
                
                document.getElementById('copyResults').classList.remove('hidden');
            }
            
            function copySingle(text) {
                navigator.clipboard.writeText(text);
                alert('Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            }
        </script>
    </body>
    </html>
  `)
})

// 4. ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú
app.get('/tools/photo-optimizer', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌîåÎ†àÏù¥Ïä§ ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üì∏ ÌîåÎ†àÏù¥Ïä§ ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú</h1>
            <p class="text-xl text-gray-600 text-center mb-12">ÌÅ¥Î¶≠Î•†ÏùÑ ÎÜíÏù¥Îäî ÏÇ¨ÏßÑ Ï¥¨ÏòÅ Í∞ÄÏù¥Îìú</p>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-green-600 mb-6">‚úÖ Ï¢ãÏùÄ ÏÇ¨ÏßÑ</h2>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üìê</span>
                            <div>
                                <div class="font-bold text-gray-900">Ï†ïÎ∞©Ìòï (1:1) ÎπÑÏú®</div>
                                <div class="text-sm text-gray-600">ÌîåÎ†àÏù¥Ïä§ÏóêÏÑú Í∞ÄÏû• Ïûò Î≥¥Ïù¥Îäî ÎπÑÏú®</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">‚òÄÔ∏è</span>
                            <div>
                                <div class="font-bold text-gray-900">Î∞ùÍ≥† ÏÑ†Î™ÖÌïú Ï°∞Î™Ö</div>
                                <div class="text-sm text-gray-600">ÏûêÏó∞Í¥ëÏù¥ÎÇò Î∞ùÏùÄ Ïã§ÎÇ¥</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üéØ</span>
                            <div>
                                <div class="font-bold text-gray-900">Ìè¨Ïù∏Ìä∏Í∞Ä Î™ÖÌôï</div>
                                <div class="text-sm text-gray-600">ÍµêÏã§, ÌïôÏäµÏûêÎ£å, ÏàòÏóÖ Ïû•Î©¥</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üßπ</span>
                            <div>
                                <div class="font-bold text-gray-900">ÍπîÎÅîÌïú Ï†ïÎ¶¨ ÏÉÅÌÉú</div>
                                <div class="text-sm text-gray-600">Î∂àÌïÑÏöîÌïú Î¨ºÍ±¥ Ï†úÍ±∞</div>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-red-600 mb-6">‚ùå ÌîºÌï¥Ïïº Ìï† ÏÇ¨ÏßÑ</h2>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üåë</span>
                            <div>
                                <div class="font-bold text-gray-900">Ïñ¥Îë°Í≥† ÌùêÎ¶øÌï®</div>
                                <div class="text-sm text-gray-600">ÎÖ∏Ï∂ú Î∂ÄÏ°±, Ï¥àÏ†ê Î∂àÎüâ</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">ü§≥</span>
                            <div>
                                <div class="font-bold text-gray-900">ÏÇ¨Îûå ÏñºÍµ¥ ÎÖ∏Ï∂ú</div>
                                <div class="text-sm text-gray-600">Ï¥àÏÉÅÍ∂å Î¨∏Ï†ú Î∞úÏÉù Í∞ÄÎä•</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üì±</span>
                            <div>
                                <div class="font-bold text-gray-900">Ïä§ÌÅ¨Î¶∞ÏÉ∑Ïù¥ÎÇò Ï∫°Ï≤ò</div>
                                <div class="text-sm text-gray-600">ÏßÅÏ†ë Ï¥¨ÏòÅÌïú ÏÇ¨ÏßÑ ÏÇ¨Ïö©</div>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-3">üóëÔ∏è</span>
                            <div>
                                <div class="font-bold text-gray-900">Ïñ¥ÏßÄÎü¨Ïö¥ Î∞∞Í≤Ω</div>
                                <div class="text-sm text-gray-600">Ï£ºÎ™©ÎèÑ Îñ®Ïñ¥Ïßê</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="mt-8 bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìã Ï∂îÏ≤ú ÏÇ¨ÏßÑ Íµ¨ÏÑ± (Ï¥ù 10Ïû•)</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 bg-white rounded-xl border border-purple-200">
                        <div class="font-bold text-purple-600 mb-2">1. Ïô∏Î∂Ä Ï†ÑÍ≤Ω (2Ïû•)</div>
                        <div class="text-sm text-gray-600">Í±¥Î¨º Ïô∏Í¥Ä, Í∞ÑÌåê</div>
                    </div>
                    <div class="p-4 bg-white rounded-xl border border-purple-200">
                        <div class="font-bold text-purple-600 mb-2">2. ÍµêÏã§ ÎÇ¥Î∂Ä (3Ïû•)</div>
                        <div class="text-sm text-gray-600">Ï±ÖÏÉÅ Î∞∞Ïπò, Ïπ†Ìåê, ÌïôÏäµ ÌôòÍ≤Ω</div>
                    </div>
                    <div class="p-4 bg-white rounded-xl border border-purple-200">
                        <div class="font-bold text-purple-600 mb-2">3. ÏàòÏóÖ ÏûêÎ£å (2Ïû•)</div>
                        <div class="text-sm text-gray-600">ÍµêÏû¨, ÌïôÏäµ ÎèÑÍµ¨</div>
                    </div>
                    <div class="p-4 bg-white rounded-xl border border-purple-200">
                        <div class="font-bold text-purple-600 mb-2">4. Î∂ÄÎåÄÏãúÏÑ§ (2Ïû•)</div>
                        <div class="text-sm text-gray-600">ÏÉÅÎã¥Ïã§, ÎåÄÍ∏∞Ïã§, ÌôîÏû•Ïã§</div>
                    </div>
                    <div class="p-4 bg-white rounded-xl border border-purple-200">
                        <div class="font-bold text-purple-600 mb-2">5. Ïù¥Î≤§Ìä∏/ÏÑ±Í≥º (1Ïû•)</div>
                        <div class="text-sm text-gray-600">ÏàòÏÉÅ ÎÇ¥Ïó≠, ÌäπÎ≥Ñ ÌîÑÎ°úÍ∑∏Îû®</div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// 5. Í≤ΩÏüÅ ÌïôÏõê Î∂ÑÏÑù ÎèÑÍµ¨
app.get('/tools/competitor-analysis', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Í≤ΩÏüÅ ÌïôÏõê Î∂ÑÏÑù ÎèÑÍµ¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üîé Í≤ΩÏüÅ ÌïôÏõê Î∂ÑÏÑù ÎèÑÍµ¨</h1>
            <p class="text-xl text-gray-600 text-center mb-12">Ï£ºÎ≥Ä Í≤ΩÏüÅ ÌïôÏõêÏùÑ Î∂ÑÏÑùÌïòÍ≥† Ï∞®Î≥ÑÌôî Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌïòÏÑ∏Ïöî</p>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Î∂ÑÏÑù Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h2>
                <div class="space-y-6">
                    <div class="p-6 bg-purple-50 rounded-xl">
                        <h3 class="font-bold text-purple-900 mb-4">1. Í∏∞Î≥∏ Ï†ïÎ≥¥ Ï°∞ÏÇ¨</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÌïôÏõêÎ™ÖÍ≥º ÏúÑÏπò ÌôïÏù∏</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Ïö¥ÏòÅ ÏãúÍ∞Ñ Î∞è ÏöîÏùº ÌôïÏù∏</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Í≥ºÎ™© Î∞è ÌîÑÎ°úÍ∑∏Îû® Ï¢ÖÎ•ò</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÌïôÏõê Í∑úÎ™® (Í∞ïÏÇ¨ Ïàò, ÍµêÏã§ Ïàò)</label>
                        </div>
                    </div>

                    <div class="p-6 bg-orange-50 rounded-xl">
                        <h3 class="font-bold text-orange-900 mb-4">2. Ïò®ÎùºÏù∏ ÌèâÌåê Î∂ÑÏÑù</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌèâÏ†ê</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Î¶¨Î∑∞ Í∞úÏàò Î∞è ÏµúÍ∑º Î¶¨Î∑∞</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Î¶¨Î∑∞ ÏùëÎãµÎ•†</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Î∏îÎ°úÍ∑∏ Ïö¥ÏòÅ ÌòÑÌô©</label>
                        </div>
                    </div>

                    <div class="p-6 bg-green-50 rounded-xl">
                        <h3 class="font-bold text-green-900 mb-4">3. ÎßàÏºÄÌåÖ Ï†ÑÎûµ ÌååÏïÖ</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÌôàÌéòÏù¥ÏßÄ/SNS ÌôúÎèô</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÌîÑÎ°úÎ™®ÏÖò Î∞è Ïù¥Î≤§Ìä∏</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÏàòÍ∞ïÎ£å Ï†ïÏ±Ö</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Î¨¥Î£å Ï≤¥Ìóò Ï†úÍ≥µ Ïó¨Î∂Ä</label>
                        </div>
                    </div>

                    <div class="p-6 bg-blue-50 rounded-xl">
                        <h3 class="font-bold text-blue-900 mb-4">4. Ï∞®Î≥ÑÌôî Ìè¨Ïù∏Ìä∏ Ï∞æÍ∏∞</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Í≤ΩÏüÅÏÇ¨Ïùò ÏïΩÏ†ê ÌååÏïÖ</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Ïö∞Î¶¨ÎßåÏùò Í∞ïÏ†ê Ï†ïÎ¶¨</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">ÌãàÏÉàÏãúÏû• Î∞úÍ≤¨</label>
                            <label class="flex items-center"><input type="checkbox" class="mr-3 w-4 h-4">Ï∞®Î≥ÑÌôî Î©îÏãúÏßÄ ÏûëÏÑ±</label>
                        </div>
                    </div>
                </div>

                <div class="mt-8 p-6 bg-gradient-to-br from-purple-100 to-orange-100 rounded-xl">
                    <h3 class="font-bold text-gray-900 mb-3">üí° Î∂ÑÏÑù ÌõÑ Ïã§Ìñâ TIP</h3>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li>‚úÖ Í≤ΩÏüÅÏÇ¨Î≥¥Îã§ Îπ†Î•∏ Î¶¨Î∑∞ ÏùëÎãµ</li>
                        <li>‚úÖ Ï∞®Î≥ÑÌôîÎêú ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥</li>
                        <li>‚úÖ Ï†ïÍ∏∞Ï†ÅÏù∏ Î∏îÎ°úÍ∑∏/SNS ÏóÖÎç∞Ïù¥Ìä∏</li>
                        <li>‚úÖ Í≥†Í∞ù ÎßûÏ∂§ ÏÉÅÎã¥ ÏãúÏä§ÌÖú Íµ¨Ï∂ï</li>
                    </ul>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// 6. Î∏îÎ°úÍ∑∏ Ìè¨Ïä§ÌåÖ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
app.get('/tools/blog-checklist', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∏îÎ°úÍ∑∏ Ìè¨Ïä§ÌåÖ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üìù Î∏îÎ°úÍ∑∏ Ìè¨Ïä§ÌåÖ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h1>
            <p class="text-xl text-gray-600 text-center mb-12">SEO ÏµúÏ†ÅÌôîÎêú Î∏îÎ°úÍ∑∏ Í∏Ä ÏûëÏÑ± Í∞ÄÏù¥Îìú</p>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-purple-600 mb-6">‚úçÔ∏è ÏûëÏÑ± Ï†Ñ Ï§ÄÎπÑ</h2>
                    <div class="space-y-3">
                        <label class="flex items-start p-3 hover:bg-purple-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">ÌÇ§ÏõåÎìú ÏÑ†Ï†ï</div>
                                <div class="text-sm text-gray-600">Í≤ÄÏÉâÎüâ ÎßéÏùÄ ÌÇ§ÏõåÎìú 3-5Í∞ú</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-purple-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Î™©Ï∞® Íµ¨ÏÑ±</div>
                                <div class="text-sm text-gray-600">ÏÑúÎ°†-Î≥∏Î°†-Í≤∞Î°† 3Îã® Íµ¨ÏÑ±</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-purple-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Ïù¥ÎØ∏ÏßÄ Ï§ÄÎπÑ</div>
                                <div class="text-sm text-gray-600">2-3Ïû•Ïùò Í≥†ÌíàÏßà Ïù¥ÎØ∏ÏßÄ</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-orange-600 mb-6">‚úÖ ÏûëÏÑ± Ï§ë Ï≤¥ÌÅ¨</h2>
                    <div class="space-y-3">
                        <label class="flex items-start p-3 hover:bg-orange-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Ï†úÎ™© ÏµúÏ†ÅÌôî</div>
                                <div class="text-sm text-gray-600">ÌÇ§ÏõåÎìú Ìè¨Ìï®, 25Ïûê Ïù¥ÎÇ¥</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-orange-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Ï†ÅÏ†àÌïú Í∏∏Ïù¥</div>
                                <div class="text-sm text-gray-600">1500-2000Ïûê ÏûëÏÑ±</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-orange-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">ÏÜåÏ†úÎ™© ÌôúÏö©</div>
                                <div class="text-sm text-gray-600">3-4Í∞úÏùò ÏÜåÏ†úÎ™©</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-green-600 mb-6">üé® Ìé∏Ïßë Î∞è ÎîîÏûêÏù∏</h2>
                    <div class="space-y-3">
                        <label class="flex items-start p-3 hover:bg-green-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Îã®ÎùΩ Íµ¨Î∂Ñ</div>
                                <div class="text-sm text-gray-600">3-4Ï§ÑÎßàÎã§ Îã®ÎùΩ ÎÇòÎàÑÍ∏∞</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-green-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Í∞ïÏ°∞ ÌëúÏãú</div>
                                <div class="text-sm text-gray-600">Ï§ëÏöî ÎÇ¥Ïö© Î≥ºÎìú/Ïª¨Îü¨</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-green-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Ïù¥ÎØ∏ÏßÄ ALT</div>
                                <div class="text-sm text-gray-600">Ïù¥ÎØ∏ÏßÄ ÏÑ§Î™Ö ÌÖçÏä§Ìä∏ Ï∂îÍ∞Ä</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-blue-600 mb-6">üöÄ Î∞úÌñâ ÌõÑ Í¥ÄÎ¶¨</h2>
                    <div class="space-y-3">
                        <label class="flex items-start p-3 hover:bg-blue-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">SNS Í≥µÏú†</div>
                                <div class="text-sm text-gray-600">Ïπ¥Ïπ¥Ïò§ÌÜ°, Î∞¥Îìú, Ïù∏Ïä§ÌÉÄ</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-blue-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">ÎåìÍ∏Ä ÌôïÏù∏</div>
                                <div class="text-sm text-gray-600">24ÏãúÍ∞Ñ ÎÇ¥ ÎåìÍ∏Ä ÏùëÎãµ</div>
                            </div>
                        </label>
                        <label class="flex items-start p-3 hover:bg-blue-50 rounded-lg cursor-pointer">
                            <input type="checkbox" class="mt-1 mr-3 w-5 h-5">
                            <div>
                                <div class="font-bold text-gray-900">Ï°∞ÌöåÏàò Î™®ÎãàÌÑ∞ÎßÅ</div>
                                <div class="text-sm text-gray-600">ÏùºÏ£ºÏùºÍ∞Ñ ÌÜµÍ≥Ñ ÌôïÏù∏</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="mt-8 bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">üéØ Í∏ÄÍ∞ê Ï∂îÏ≤ú TOP 10</h2>
                <div class="grid md:grid-cols-2 gap-3">
                    <div class="p-3 bg-white rounded-lg">1. Ïö∞Î¶¨ ÌïôÏõê ÏÜåÍ∞ú Î∞è ÌäπÏßï</div>
                    <div class="p-3 bg-white rounded-lg">2. ÏàòÏóÖ Ïª§Î¶¨ÌÅòÎüº ÏïàÎÇ¥</div>
                    <div class="p-3 bg-white rounded-lg">3. ÌïôÏÉù ÏÑ±Í≥µ ÏÇ¨Î°Ä (ÏÑ±Ï†Å Ìñ•ÏÉÅ)</div>
                    <div class="p-3 bg-white rounded-lg">4. ÌïôÎ∂ÄÎ™® ÌõÑÍ∏∞ Î∞è Ïù∏ÌÑ∞Î∑∞</div>
                    <div class="p-3 bg-white rounded-lg">5. Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÏäµÎ≤ï ÌåÅ</div>
                    <div class="p-3 bg-white rounded-lg">6. ÍµêÏû¨ Î∞è ÌïôÏäµ ÏûêÎ£å ÏÜåÍ∞ú</div>
                    <div class="p-3 bg-white rounded-lg">7. ÌïôÏõê ÏãúÏÑ§ Î∞è ÌôòÍ≤Ω ÏÜåÍ∞ú</div>
                    <div class="p-3 bg-white rounded-lg">8. Í∞ïÏÇ¨ ÏÜåÍ∞ú Î∞è Í≤ΩÎ†•</div>
                    <div class="p-3 bg-white rounded-lg">9. Ïù¥Î≤§Ìä∏ Î∞è ÌîÑÎ°úÎ™®ÏÖò ÏïàÎÇ¥</div>
                    <div class="p-3 bg-white rounded-lg">10. ÏßÄÏó≠Î≥Ñ ÍµêÏú° Ï†ïÎ≥¥</div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// 7. SNS ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî
app.get('/tools/content-calendar', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SNS ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-6xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üìÖ SNS ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî</h1>
            <p class="text-xl text-gray-600 text-center mb-12">Ìïú Îã¨ ÏΩòÌÖêÏ∏†Î•º ÎØ∏Î¶¨ Í≥ÑÌöçÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Ï£ºÍ∞Ñ ÏΩòÌÖêÏ∏† Ï∂îÏ≤ú (ÏòàÏãú)</h2>
                <div class="grid md:grid-cols-7 gap-2">
                    <div class="p-4 bg-purple-50 rounded-xl">
                        <div class="font-bold text-purple-900 mb-2">ÏõîÏöîÏùº</div>
                        <div class="text-sm text-gray-700">ÎèôÍ∏∞Î∂ÄÏó¨ Î™ÖÏñ∏</div>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-xl">
                        <div class="font-bold text-blue-900 mb-2">ÌôîÏöîÏùº</div>
                        <div class="text-sm text-gray-700">ÌïôÏäµ ÌåÅ Í≥µÏú†</div>
                    </div>
                    <div class="p-4 bg-green-50 rounded-xl">
                        <div class="font-bold text-green-900 mb-2">ÏàòÏöîÏùº</div>
                        <div class="text-sm text-gray-700">ÌïôÏõê ÏùºÏÉÅ</div>
                    </div>
                    <div class="p-4 bg-yellow-50 rounded-xl">
                        <div class="font-bold text-yellow-900 mb-2">Î™©ÏöîÏùº</div>
                        <div class="text-sm text-gray-700">ÍµêÏû¨/ÏûêÎ£å ÏÜåÍ∞ú</div>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-xl">
                        <div class="font-bold text-orange-900 mb-2">Í∏àÏöîÏùº</div>
                        <div class="text-sm text-gray-700">ÌïôÏÉù ÏÑ±Í≥º ÏÜåÏãù</div>
                    </div>
                    <div class="p-4 bg-red-50 rounded-xl">
                        <div class="font-bold text-red-900 mb-2">ÌÜ†ÏöîÏùº</div>
                        <div class="text-sm text-gray-700">Ïù¥Î≤§Ìä∏ ÏïàÎÇ¥</div>
                    </div>
                    <div class="p-4 bg-pink-50 rounded-xl">
                        <div class="font-bold text-pink-900 mb-2">ÏùºÏöîÏùº</div>
                        <div class="text-sm text-gray-700">Ìú¥Ïãù & Í≥µÍ∞ê</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏõîÍ∞Ñ ÏΩòÌÖêÏ∏† ÏïÑÏù¥ÎîîÏñ¥ (30Í∞ú)</h2>
                <div class="grid md:grid-cols-3 gap-4">
                    ${Array.from({length: 30}, (_, i) => `
                        <div class="p-4 bg-gray-50 rounded-xl hover:bg-purple-50 transition cursor-pointer">
                            <div class="font-bold text-purple-600">${i+1}ÏùºÏ∞®</div>
                            <div class="text-sm text-gray-700 mt-1">
                                ${['ÌïôÏõê ÏÜåÍ∞ú', 'ÏàòÏóÖ ÌòÑÏû•', 'ÌïôÏäµ ÌåÅ', 'Î™ÖÏñ∏', 'Ïù¥Î≤§Ìä∏', 'ÌõÑÍ∏∞', 'ÏãúÏÑ§ ÏïàÎÇ¥', 'Í∞ïÏÇ¨ ÏÜåÍ∞ú', 'ÏÑ±Ï†Å Ìñ•ÏÉÅ', 'ÌîÑÎ°úÎ™®ÏÖò'][i % 10]}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üéØ ÏΩòÌÖêÏ∏† Ï†úÏûë TIP</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-purple-900 mb-3">‚úÖ Ïù∏Ïä§ÌÉÄÍ∑∏Îû®</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li>‚Ä¢ Ï†ïÎ∞©Ìòï(1:1) Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©</li>
                            <li>‚Ä¢ Ìï¥ÏãúÌÉúÍ∑∏ 10-15Í∞ú</li>
                            <li>‚Ä¢ Ïä§ÌÜ†Î¶¨ Îß§Ïùº 1-2Í∞ú</li>
                            <li>‚Ä¢ Î¶¥Ïä§ Ï£º 2-3Ìöå</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-orange-900 mb-3">‚úÖ Î∏îÎ°úÍ∑∏</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li>‚Ä¢ Ï£º 2-3Ìöå Ï†ïÍ∏∞ Ìè¨Ïä§ÌåÖ</li>
                            <li>‚Ä¢ 1500Ïûê Ïù¥ÏÉÅ ÏûëÏÑ±</li>
                            <li>‚Ä¢ Ïù¥ÎØ∏ÏßÄ 2-3Ïû• Ìè¨Ìï®</li>
                            <li>‚Ä¢ ÌÇ§ÏõåÎìú ÏûêÏó∞Ïä§ÎüΩÍ≤å Î∞∞Ïπò</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// 8. ÌïôÏõê ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÉùÏÑ±Í∏∞
app.get('/tools/consultation-script', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üí¨ ÌïôÏõê ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÉùÏÑ±Í∏∞</h1>
            <p class="text-xl text-gray-600 text-center mb-12">Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥ ÎåÄÎ≥∏ÏùÑ ÎßåÎì§Ïñ¥ÎìúÎ¶ΩÎãàÎã§</p>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="space-y-8">
                    <div class="p-6 bg-purple-50 rounded-xl">
                        <h3 class="font-bold text-purple-900 mb-4 text-lg">1Îã®Í≥Ñ: Ïù∏ÏÇ¨ Î∞è Í¥ÄÏã¨ ÌôïÏù∏</h3>
                        <div class="p-4 bg-white rounded-lg text-gray-700">
                            "ÏïàÎÖïÌïòÏÑ∏Ïöî, [ÌïôÏõêÎ™Ö]ÏûÖÎãàÎã§. Î¨∏Ïùò Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§. üòä<br>
                            ÌòπÏãú Ïñ¥Îñ§ Í≥ºÎ™©Ïóê Í¥ÄÏã¨Ïù¥ ÏûàÏúºÏã†Í∞ÄÏöî?<br>
                            ÏïÑÏù¥Ïùò ÌòÑÏû¨ ÌïôÎÖÑÍ≥º ÌïôÏäµ Î™©ÌëúÎ•º ÎßêÏîÄÌï¥Ï£ºÏãúÎ©¥<br>
                            ÎßûÏ∂§ ÏÉÅÎã¥ÏùÑ ÎèÑÏôÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§."
                        </div>
                    </div>

                    <div class="p-6 bg-blue-50 rounded-xl">
                        <h3 class="font-bold text-blue-900 mb-4 text-lg">2Îã®Í≥Ñ: ÎãàÏ¶à ÌååÏïÖ</h3>
                        <div class="p-4 bg-white rounded-lg text-gray-700">
                            "ÌòÑÏû¨ ÌïôÏäµÏóêÏÑú Í∞ÄÏû• Ïñ¥Î†§Ïö¥ Î∂ÄÎ∂ÑÏùÄ Î¨¥ÏóáÏù∏Í∞ÄÏöî?<br><br>
                            <strong>Ï£ºÏöî ÏßàÎ¨∏ ÏòàÏãú:</strong><br>
                            ‚Ä¢ ÏÑ±Ï†Å Ìñ•ÏÉÅÏù¥ Î™©ÌëúÏù¥Ïã†Í∞ÄÏöî?<br>
                            ‚Ä¢ ÎÇ¥Ïã† ÎåÄÎπÑÏù∏Í∞ÄÏöî, ÏàòÎä• ÎåÄÎπÑÏù∏Í∞ÄÏöî?<br>
                            ‚Ä¢ ÌïôÏäµ ÏäµÍ¥Ä Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?<br>
                            ‚Ä¢ ÌäπÏ†ï Îã®ÏõêÏù¥ÎÇò ÏòÅÏó≠Ïóê ÏïΩÏ†êÏù¥ ÏûàÎÇòÏöî?"
                        </div>
                    </div>

                    <div class="p-6 bg-green-50 rounded-xl">
                        <h3 class="font-bold text-green-900 mb-4 text-lg">3Îã®Í≥Ñ: ÌïôÏõê Í∞ïÏ†ê ÏÜåÍ∞ú</h3>
                        <div class="p-4 bg-white rounded-lg text-gray-700">
                            "Ï†ÄÌù¨ ÌïôÏõêÏùò <strong>[Ï∞®Î≥ÑÌôî Ìè¨Ïù∏Ìä∏]</strong>Î•º ÏÜåÍ∞úÌï¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.<br><br>
                            <strong>ÏòàÏãú:</strong><br>
                            ‚úÖ ÏÜåÏàòÏ†ïÏòà ÎßûÏ∂§ ÏàòÏóÖ (ÌïôÏÉù 1:4 ÎπÑÏú®)<br>
                            ‚úÖ Îß§Ï£º ÌïôÏäµ Î¶¨Ìè¨Ìä∏ Ï†úÍ≥µ<br>
                            ‚úÖ 20ÎÖÑ Í≤ΩÎ†• Ï†ÑÎ¨∏ Í∞ïÏÇ¨ÏßÑ<br>
                            ‚úÖ Ï≤¥Í≥ÑÏ†ÅÏù∏ Î†àÎ≤® ÌÖåÏä§Ìä∏<br>
                            ‚úÖ ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥ Ïõî 1Ìöå ÏßÑÌñâ"
                        </div>
                    </div>

                    <div class="p-6 bg-orange-50 rounded-xl">
                        <h3 class="font-bold text-orange-900 mb-4 text-lg">4Îã®Í≥Ñ: ÌñâÎèô Ïú†ÎèÑ (CTA)</h3>
                        <div class="p-4 bg-white rounded-lg text-gray-700">
                            "Î¨¥Î£å Î†àÎ≤® ÌÖåÏä§Ìä∏ÏôÄ 1Ìöå Ï≤¥Ìóò ÏàòÏóÖÏùÑ Ï†úÍ≥µÌï¥ÎìúÎ¶¨Í≥† ÏûàÏäµÎãàÎã§.<br>
                            Ïù¥Î≤à Ï£º Ï§ë Î∞©Î¨∏ Í∞ÄÎä•ÌïòÏã† ÎÇ†ÏßúÍ∞Ä ÏûàÏúºÏã†Í∞ÄÏöî?<br><br>
                            <strong>ÏÉÅÎã¥ ÏòàÏïΩ Í∞ÄÎä• ÏãúÍ∞Ñ:</strong><br>
                            ‚Ä¢ ÌèâÏùº: Ïò§ÌõÑ 3Ïãú~8Ïãú<br>
                            ‚Ä¢ ÌÜ†ÏöîÏùº: Ïò§Ï†Ñ 10Ïãú~Ïò§ÌõÑ 5Ïãú<br><br>
                            Ìé∏ÌïòÏã† ÏãúÍ∞ÑÏóê Î∞©Î¨∏Ìï¥Ï£ºÏãúÎ©¥<br>
                            ÏûêÏÑ∏Ìïú Ïª§Î¶¨ÌÅòÎüºÍ≥º ÏàòÍ∞ïÎ£åÎ•º ÏïàÎÇ¥Ìï¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§."
                        </div>
                    </div>

                    <div class="p-6 bg-pink-50 rounded-xl">
                        <h3 class="font-bold text-pink-900 mb-4 text-lg">5Îã®Í≥Ñ: ÎßàÎ¨¥Î¶¨</h3>
                        <div class="p-4 bg-white rounded-lg text-gray-700">
                            "Ï∂îÍ∞ÄÎ°ú Í∂ÅÍ∏àÌïòÏã† Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Ïó∞ÎùΩ Ï£ºÏÑ∏Ïöî!<br>
                            Ïπ¥Ïπ¥Ïò§ÌÜ°/Ï†ÑÌôî ÏÉÅÎã¥ÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§. üòä<br><br>
                            <strong>Ïó∞ÎùΩÏ≤ò:</strong><br>
                            üìû Ï†ÑÌôî: 010-XXXX-XXXX<br>
                            üí¨ Ïπ¥ÌÜ°: [Ïπ¥Ïπ¥Ïò§ÌÜ° ID]<br>
                            üìß Ïù¥Î©îÏùº: [Ïù¥Î©îÏùº Ï£ºÏÜå]<br><br>
                            Í∞êÏÇ¨Ìï©ÎãàÎã§!"
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üéØ ÏÉÅÎã¥ ÏÑ±Í≥µ TIP</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-purple-900 mb-3">‚úÖ Ìï¥Ïïº Ìï† Í≤É</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li>‚Ä¢ ÌïôÎ∂ÄÎ™® Ïù¥Î¶ÑÏúºÎ°ú Ìò∏Ïπ≠ÌïòÍ∏∞</li>
                            <li>‚Ä¢ Í≤ΩÏ≤≠ÌïòÍ≥† Í≥µÍ∞ê ÌëúÌòÑÌïòÍ∏∞</li>
                            <li>‚Ä¢ Íµ¨Ï≤¥Ï†ÅÏù∏ Ïà´Ïûê/ÏÇ¨Î°Ä Ï†úÏãú</li>
                            <li>‚Ä¢ Í∏çÏ†ïÏ†ÅÏù∏ ÌÜ§ Ïú†ÏßÄÌïòÍ∏∞</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-red-900 mb-3">‚ùå ÌïòÏßÄ ÎßêÏïÑÏïº Ìï† Í≤É</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li>‚Ä¢ Îã§Î•∏ ÌïôÏõê ÎπÑÎ∞©ÌïòÍ∏∞</li>
                            <li>‚Ä¢ Í≥ºÎèÑÌïú ÏïΩÏÜçÌïòÍ∏∞</li>
                            <li>‚Ä¢ Í∞ïÏïïÏ†ÅÏù∏ Îì±Î°ù Ïú†ÎèÑ</li>
                            <li>‚Ä¢ ÏùºÎ∞©Ï†ÅÏúºÎ°ú ÎßêÌïòÍ∏∞</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// 9. ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï†êÍ≤ÄÌëú
app.get('/tools/place-optimization', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï†êÍ≤ÄÌëú - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">‚úÖ ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî Ï†êÍ≤ÄÌëú</h1>
            <p class="text-xl text-gray-600 text-center mb-12">100Ï†ê ÎßåÏ†ê ÌîåÎ†àÏù¥Ïä§ ÎßåÎì§Í∏∞</p>

            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="mb-6 p-4 bg-purple-50 rounded-xl text-center">
                    <div class="text-4xl font-bold text-purple-600" id="score">0</div>
                    <div class="text-gray-600 mt-2">ÌòÑÏû¨ Ï†êÏàò / 100Ï†ê</div>
                </div>

                <div class="space-y-6">
                    <div class="p-6 bg-gray-50 rounded-xl">
                        <h3 class="font-bold text-gray-900 mb-4">Í∏∞Î≥∏ Ï†ïÎ≥¥ (30Ï†ê)</h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ï†ïÌôïÌïú ÌïôÏõêÎ™Ö (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ï†ïÌôïÌïú Ï£ºÏÜå Î∞è ÏßÄÎèÑ ÏúÑÏπò (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ï†ÑÌôîÎ≤àÌò∏ Îì±Î°ù (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ïö¥ÏòÅ ÏãúÍ∞Ñ Ï†ïÌôïÌûà ÏûÖÎ†• (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">ÏÉÅÏÑ∏Ìïú ÏÜåÍ∞úÍ∏Ä ÏûëÏÑ± (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">ÌÇ§ÏõåÎìú 3Í∞ú Ïù¥ÏÉÅ ÏÑ§Ï†ï (5Ï†ê)</span>
                            </label>
                        </div>
                    </div>

                    <div class="p-6 bg-gray-50 rounded-xl">
                        <h3 class="font-bold text-gray-900 mb-4">ÏÇ¨ÏßÑ Í¥ÄÎ¶¨ (25Ï†ê)</h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="10">
                                <span class="flex-1">ÏÇ¨ÏßÑ 10Ïû• Ïù¥ÏÉÅ Îì±Î°ù (10Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Í≥†ÌíàÏßà ÏÇ¨ÏßÑ (Î∞ùÍ≥† ÏÑ†Î™Ö) (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Îã§ÏñëÌïú Í∞ÅÎèÑ Ï¥¨ÏòÅ (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ï†ïÍ∏∞Ï†Å ÏóÖÎç∞Ïù¥Ìä∏ (Ïõî 1Ìöå) (5Ï†ê)</span>
                            </label>
                        </div>
                    </div>

                    <div class="p-6 bg-gray-50 rounded-xl">
                        <h3 class="font-bold text-gray-900 mb-4">Î¶¨Î∑∞ Í¥ÄÎ¶¨ (30Ï†ê)</h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="10">
                                <span class="flex-1">Î¶¨Î∑∞ 10Í∞ú Ïù¥ÏÉÅ (10Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="10">
                                <span class="flex-1">ÌèâÍ∑† ÌèâÏ†ê 4.5Ï†ê Ïù¥ÏÉÅ (10Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="10">
                                <span class="flex-1">Î™®Îì† Î¶¨Î∑∞Ïóê ÏùëÎãµ (10Ï†ê)</span>
                            </label>
                        </div>
                    </div>

                    <div class="p-6 bg-gray-50 rounded-xl">
                        <h3 class="font-bold text-gray-900 mb-4">ÌôúÎèôÏÑ± (15Ï†ê)</h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">ÏÜåÏãù Ï£º 1Ìöå ÏóÖÎç∞Ïù¥Ìä∏ (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Ïù¥Î≤§Ìä∏/ÌîÑÎ°úÎ™®ÏÖò Îì±Î°ù (5Ï†ê)</span>
                            </label>
                            <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition">
                                <input type="checkbox" class="score-checkbox mr-3 w-5 h-5" data-score="5">
                                <span class="flex-1">Î©îÎâ¥/ÏÑúÎπÑÏä§ Ï†ïÎ≥¥ ÏÉÅÏÑ∏ (5Ï†ê)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mt-8 p-6 rounded-xl" id="result">
                    <div class="text-center">
                        <button onclick="location.reload()" class="gradient-purple text-white px-8 py-3 rounded-xl font-bold hover:shadow-xl transition">
                            Îã§Ïãú Ï≤¥ÌÅ¨ÌïòÍ∏∞
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const checkboxes = document.querySelectorAll('.score-checkbox');
            const scoreEl = document.getElementById('score');
            const resultEl = document.getElementById('result');
            
            checkboxes.forEach(cb => {
                cb.addEventListener('change', updateScore);
            });
            
            function updateScore() {
                let total = 0;
                checkboxes.forEach(cb => {
                    if(cb.checked) {
                        total += parseInt(cb.dataset.score);
                    }
                });
                
                scoreEl.textContent = total;
                
                let resultHTML = '';
                let bgColor = '';
                
                if(total >= 90) {
                    bgColor = 'bg-green-50 border border-green-200';
                    resultHTML = '<div class="text-green-800 text-center"><div class="text-2xl font-bold mb-2">üéâ ÏôÑÎ≤ΩÌï©ÎãàÎã§!</div><div>ÌîåÎ†àÏù¥Ïä§Í∞Ä ÏµúÏ†ÅÌôîÎêòÏóàÏäµÎãàÎã§!</div></div>';
                } else if(total >= 70) {
                    bgColor = 'bg-blue-50 border border-blue-200';
                    resultHTML = '<div class="text-blue-800 text-center"><div class="text-2xl font-bold mb-2">üëç Ï¢ãÏäµÎãàÎã§!</div><div>Ï°∞Í∏àÎßå Îçî Î≥¥ÏôÑÌïòÎ©¥ ÏôÑÎ≤ΩÌï¥Ïöî!</div></div>';
                } else if(total >= 50) {
                    bgColor = 'bg-orange-50 border border-orange-200';
                    resultHTML = '<div class="text-orange-800 text-center"><div class="text-2xl font-bold mb-2">üí™ Í¥úÏ∞ÆÏäµÎãàÎã§!</div><div>Ï≤¥ÌÅ¨ Ïïà Îêú Ìï≠Î™©Îì§ÏùÑ Î≥¥ÏôÑÌï¥Î≥¥ÏÑ∏Ïöî!</div></div>';
                } else if(total > 0) {
                    bgColor = 'bg-red-50 border border-red-200';
                    resultHTML = '<div class="text-red-800 text-center"><div class="text-2xl font-bold mb-2">‚ö†Ô∏è Í∞úÏÑ† ÌïÑÏöî!</div><div>Í∏∞Î≥∏ Ìï≠Î™©Î∂ÄÌÑ∞ Ï∞®Í∑ºÏ∞®Í∑º ÏßÑÌñâÌïòÏÑ∏Ïöî!</div></div>';
                }
                
                resultEl.className = 'mt-8 p-6 rounded-xl ' + bgColor;
                if(total > 0) {
                    resultEl.innerHTML = resultHTML + '<div class="text-center mt-4"><button onclick="location.reload()" class="gradient-purple text-white px-8 py-3 rounded-xl font-bold hover:shadow-xl transition">Îã§Ïãú Ï≤¥ÌÅ¨ÌïòÍ∏∞</button></div>';
                }
            }
        </script>
    </body>
    </html>
  `)
})

// 10. ÌïôÏõê ÎßàÏºÄÌåÖ ROI Í≥ÑÏÇ∞Í∏∞
app.get('/tools/roi-calculator', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎßàÏºÄÌåÖ ROI Í≥ÑÏÇ∞Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>.gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }</style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">üí∞ ÌïôÏõê ÎßàÏºÄÌåÖ ROI Í≥ÑÏÇ∞Í∏∞</h1>
            <p class="text-xl text-gray-600 text-center mb-12">ÎßàÏºÄÌåÖ Ìà¨Ïûê ÎåÄÎπÑ ÏàòÏùµÎ•†ÏùÑ Í≥ÑÏÇ∞ÌïòÏÑ∏Ïöî</p>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">ÏûÖÎ†• Ï†ïÎ≥¥</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïõî ÎßàÏºÄÌåÖ ÎπÑÏö© (Ïõê)</label>
                            <input type="number" id="marketingCost" placeholder="300000" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Ïã†Í∑ú Îì±Î°ù ÌïôÏÉù Ïàò (Î™Ö)</label>
                            <input type="number" id="newStudents" placeholder="10" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏÉù 1Î™ÖÎãπ Ïõî ÏàòÍ∞ïÎ£å (Ïõê)</label>
                            <input type="number" id="tuitionPerStudent" placeholder="400000" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">ÌèâÍ∑† ÏàòÍ∞ï Í∏∞Í∞Ñ (Í∞úÏõî)</label>
                            <input type="number" id="avgDuration" placeholder="12" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        </div>
                        <button onclick="calculate()" class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-xl transition">
                            ROI Í≥ÑÏÇ∞ÌïòÍ∏∞
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Í≥ÑÏÇ∞ Í≤∞Í≥º</h2>
                    <div id="results" class="hidden space-y-6">
                        <div class="p-6 bg-purple-50 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">Ï¥ù Îß§Ï∂ú</div>
                            <div class="text-3xl font-bold text-purple-600" id="totalRevenue">0Ïõê</div>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">ÏàúÏù¥Ïùµ</div>
                            <div class="text-3xl font-bold text-blue-600" id="profit">0Ïõê</div>
                        </div>
                        <div class="p-6 bg-green-50 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">ROI (Ìà¨Ïûê ÎåÄÎπÑ ÏàòÏùµÎ•†)</div>
                            <div class="text-4xl font-bold text-green-600" id="roi">0%</div>
                        </div>
                        <div class="p-6 bg-orange-50 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">ÌïôÏÉù 1Î™ÖÎãπ ÌöçÎìù ÎπÑÏö©</div>
                            <div class="text-2xl font-bold text-orange-600" id="cpa">0Ïõê</div>
                        </div>
                    </div>

                    <div id="tips" class="hidden mt-8">
                        <h3 class="font-bold text-gray-900 mb-4">üí° Î∂ÑÏÑù TIP</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-4 bg-green-50 rounded-xl">
                                <div class="font-bold text-green-900 mb-1">‚úÖ ROI 300% Ïù¥ÏÉÅ</div>
                                <div class="text-gray-700">Îß§Ïö∞ Ìö®Ïú®Ï†Å! ÎßàÏºÄÌåÖ Ïú†ÏßÄ</div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-xl">
                                <div class="font-bold text-blue-900 mb-1">‚úÖ ROI 150-300%</div>
                                <div class="text-gray-700">Ï¢ãÏùÄ ÏàòÏ§Ä! ÏµúÏ†ÅÌôî Í∞ÄÎä•</div>
                            </div>
                            <div class="p-4 bg-orange-50 rounded-xl">
                                <div class="font-bold text-orange-900 mb-1">‚ö†Ô∏è ROI 100-150%</div>
                                <div class="text-gray-700">Í∞úÏÑ† ÌïÑÏöî, Ï†ÑÎûµ Ïû¨Í≤ÄÌÜ†</div>
                            </div>
                            <div class="p-4 bg-red-50 rounded-xl">
                                <div class="font-bold text-red-900 mb-1">‚ùå ROI 100% ÎØ∏Îßå</div>
                                <div class="text-gray-700">ÎßàÏºÄÌåÖ Ï†ÑÎûµ Ï†ÑÎ©¥ ÏàòÏ†ï ÌïÑÏöî</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä ÌïôÏõê ÎßàÏºÄÌåÖ ROI Í∞úÏÑ† Ï†ÑÎûµ</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="p-6 bg-white rounded-xl">
                        <div class="text-3xl mb-3">üéØ</div>
                        <h3 class="font-bold text-gray-900 mb-2">ÌÉÄÍ≤üÌåÖ Ï†ïÍµêÌôî</h3>
                        <p class="text-sm text-gray-600">Ïö∞Î¶¨ ÌïôÏõêÏóê Íº≠ ÎßûÎäî ÌïôÎ∂ÄÎ™®Îßå Í≥µÎûµ</p>
                    </div>
                    <div class="p-6 bg-white rounded-xl">
                        <div class="text-3xl mb-3">üí¨</div>
                        <h3 class="font-bold text-gray-900 mb-2">Ï†ÑÌôòÏú® Ìñ•ÏÉÅ</h3>
                        <p class="text-sm text-gray-600">ÏÉÅÎã¥ÏóêÏÑú Îì±Î°ùÍπåÏßÄÏùò Ï†ÑÌôòÏú® ÎÜíÏù¥Í∏∞</p>
                    </div>
                    <div class="p-6 bg-white rounded-xl">
                        <div class="text-3xl mb-3">üîÑ</div>
                        <h3 class="font-bold text-gray-900 mb-2">Ïû¨Îì±Î°ùÎ•† Í¥ÄÎ¶¨</h3>
                        <p class="text-sm text-gray-600">Í∏∞Ï°¥ ÌïôÏÉù ÎßåÏ°±ÎèÑ ÎÜíÏó¨ Ïû•Í∏∞ ÏàòÍ∞ï</p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function calculate() {
                const cost = parseInt(document.getElementById('marketingCost').value) || 0;
                const students = parseInt(document.getElementById('newStudents').value) || 0;
                const tuition = parseInt(document.getElementById('tuitionPerStudent').value) || 0;
                const duration = parseInt(document.getElementById('avgDuration').value) || 0;
                
                if(cost === 0 || students === 0 || tuition === 0 || duration === 0) {
                    alert('Î™®Îì† Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                    return;
                }
                
                const totalRevenue = students * tuition * duration;
                const profit = totalRevenue - cost;
                const roi = ((profit / cost) * 100).toFixed(1);
                const cpa = (cost / students).toFixed(0);
                
                document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString() + 'Ïõê';
                document.getElementById('profit').textContent = profit.toLocaleString() + 'Ïõê';
                document.getElementById('roi').textContent = roi + '%';
                document.getElementById('cpa').textContent = parseInt(cpa).toLocaleString() + 'Ïõê';
                
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('tips').classList.remove('hidden');
            }
        </script>
    </body>
    </html>
  `)
})

// ÎßàÏºÄÌåÖ Ìà¥ Î™©Î°ù ÌéòÏù¥ÏßÄ
app.get('/tools', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎßàÏºÄÌåÖ Ìà¥ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .card-hover { transition: all 0.3s ease; }
            .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -10px rgba(124, 58, 237, 0.3); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/" class="text-gray-600 hover:text-purple-600">‚Üê ÌôàÏúºÎ°ú</a>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="text-center mb-16">
                <h1 class="text-5xl font-bold text-gray-900 mb-6">üöÄ ÎßàÏºÄÌåÖ Ìà¥ Î™®Ïùå</h1>
                <p class="text-2xl text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖÏóê ÌïÑÏöîÌïú Î™®Îì† ÎèÑÍµ¨Î•º Ìïú Í≥≥ÏóêÏÑú</p>
                <div class="mt-6 inline-flex items-center px-6 py-3 bg-purple-50 rounded-full text-purple-700 font-medium">
                    <i class="fas fa-check-circle mr-2"></i>
                    100% Î¨¥Î£å ¬∑ ÌöåÏõêÍ∞ÄÏûÖ Î∂àÌïÑÏöî ¬∑ Ï¶âÏãú ÏÇ¨Ïö© Í∞ÄÎä•
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <a href="/tools/keyword-analyzer" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-search text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞</h3>
                    <p class="text-gray-600 mb-4">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†Å ÌÇ§ÏõåÎìú Î∞úÍµ¥</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/review-template" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-comment-dots text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Î¶¨Î∑∞ ÏùëÎãµ ÏÉùÏÑ±Í∏∞</h3>
                    <p class="text-gray-600 mb-4">Í≥†Í∞ù Î¶¨Î∑∞Ïóê ÎßûÏ∂§Ìòï ÎãµÎ≥Ä ÏûêÎèô ÏÉùÏÑ±</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/ad-copy-generator" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-bullhorn text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞</h3>
                    <p class="text-gray-600 mb-4">Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÏõê Í¥ëÍ≥† Î¨∏Íµ¨ 5Í∞ú ÏûêÎèô ÏÉùÏÑ±</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/photo-optimizer" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-camera text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú</h3>
                    <p class="text-gray-600 mb-4">ÌÅ¥Î¶≠Î•† ÎÜíÏù¥Îäî ÌîåÎ†àÏù¥Ïä§ ÏÇ¨ÏßÑ Ï¥¨ÏòÅÎ≤ï</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/competitor-analysis" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Í≤ΩÏüÅ ÌïôÏõê Î∂ÑÏÑù</h3>
                    <p class="text-gray-600 mb-4">Ï£ºÎ≥Ä Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù Î∞è Ï∞®Î≥ÑÌôî Ï†ÑÎûµ</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/blog-checklist" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-check-square text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Î∏îÎ°úÍ∑∏ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h3>
                    <p class="text-gray-600 mb-4">SEO ÏµúÏ†ÅÌôî Î∏îÎ°úÍ∑∏ ÏûëÏÑ± ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/content-calendar" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-calendar-alt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî</h3>
                    <p class="text-gray-600 mb-4">Ìïú Îã¨ SNS ÏΩòÌÖêÏ∏† ÎØ∏Î¶¨ Í≥ÑÌöçÌïòÍ∏∞</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/consultation-script" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-comments text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏</h3>
                    <p class="text-gray-600 mb-4">Ìö®Í≥ºÏ†ÅÏù∏ ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥ ÎåÄÎ≥∏ 5Îã®Í≥Ñ</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/place-optimization" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-tasks text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ÌîåÎ†àÏù¥Ïä§ Ï†êÍ≤ÄÌëú</h3>
                    <p class="text-gray-600 mb-4">100Ï†ê ÎßåÏ†ê ÌîåÎ†àÏù¥Ïä§ ÎßåÎì§Í∏∞ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>

                <a href="/tools/roi-calculator" class="bg-white rounded-2xl p-8 shadow-lg border-2 border-transparent hover:border-purple-300 card-hover">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mb-6">
                        <i class="fas fa-calculator text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">ROI Í≥ÑÏÇ∞Í∏∞</h3>
                    <p class="text-gray-600 mb-4">ÎßàÏºÄÌåÖ Ìà¨Ïûê ÎåÄÎπÑ ÏàòÏùµÎ•† Î∂ÑÏÑù ÎèÑÍµ¨</p>
                    <div class="flex items-center text-purple-600 font-medium">
                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ml-2"></i>
                    </div>
                </a>
            </div>

            <div class="mt-16 bg-gradient-to-br from-purple-50 to-white rounded-3xl p-12 text-center">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Îçî ÎßéÏùÄ ÎßàÏºÄÌåÖ ÏßÄÏõêÏù¥ ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?</h2>
                <p class="text-xl text-gray-600 mb-8">Ï†ÑÎ¨∏ Ïª®ÏÑ§ÌÑ¥Ìä∏ÏôÄ 1:1 ÏÉÅÎã¥ÏùÑ ÏßÑÌñâÌï¥Î≥¥ÏÑ∏Ïöî</p>
                <a href="/contact" class="inline-block gradient-purple text-white px-12 py-4 rounded-full text-lg font-bold shadow-xl hover:shadow-2xl transition-all hover:-translate-y-1">
                    Î¨¥Î£å ÏÉÅÎã¥ Ïã†Ï≤≠ÌïòÍ∏∞
                </a>
            </div>
        </div>
    </body>
    </html>
  `)
})

// Í≤ÄÏÉâÎüâ Ï°∞Ìöå Î∞è ÏàúÏúÑ Î∂ÑÏÑù API
app.post('/api/search-analysis', async (c) => {
  try {
    const { userId, keyword, placeUrl } = await c.req.json()

    if (!keyword) {
      return c.json({ success: false, error: 'ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' }, 400)
    }

    // Python ÌÅ¨Î°§ÎßÅ ÏÑúÎ≤ÑÏôÄ ÌÜµÏã†
    const CRAWLER_API_URL = 'https://web-production-14c4.up.railway.app/analyze'
    
    try {
      // Cloudflare WorkersÏóêÏÑúÎäî fetchÏóê ÏßÅÏ†ë ÌÉÄÏûÑÏïÑÏõÉÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏóÜÏúºÎØÄÎ°ú
      // Promise.raceÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÌÉÄÏûÑÏïÑÏõÉ Íµ¨ÌòÑ
      const fetchPromise = fetch(CRAWLER_API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          keyword: keyword,
          placeUrl: placeUrl || null
        })
      })

      const timeoutPromise = new Promise((_, reject) =>
        setTimeout(() => reject(new Error('Request timeout')), 50000)
      )

      const crawlerResponse = await Promise.race([fetchPromise, timeoutPromise]) as Response

      if (!crawlerResponse.ok) {
        throw new Error(`Crawler API error: ${crawlerResponse.status}`)
      }

      const analysisResult = await crawlerResponse.json()

      // Î∂ÑÏÑù Í∏∞Î°ù Ï†ÄÏû•
      const { env } = c
      if (userId) {
        try {
          await env.DB.prepare(`
            INSERT INTO search_analysis_logs (user_id, keyword, place_url, result_data, created_at)
            VALUES (?, ?, ?, ?, datetime('now'))
          `).bind(userId, keyword, placeUrl || '', JSON.stringify(analysisResult)).run()
        } catch (dbError) {
          console.error('DB save error:', dbError)
          // DB Ï†ÄÏû• Ïã§Ìå®Ìï¥ÎèÑ Í≤∞Í≥ºÎäî Î∞òÌôò
        }
      }

      return c.json(analysisResult)
      
    } catch (crawlerError) {
      console.error('Crawler API error:', crawlerError)
      
      // ÌÅ¨Î°§Îü¨ ÏÑúÎ≤Ñ Ïò§Î•ò Ïãú ÏûÑÏãú ÏùëÎãµ Î∞òÌôò
      const fallbackResponse = {
        success: false,
        error: 'ÌÅ¨Î°§ÎßÅ ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®',
        message: `Ïò§Î•ò: ${crawlerError instanceof Error ? crawlerError.message : 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`,
        searchVolume: {
          monthlyAvg: 0,
          competition: 'Î∂ÑÏÑù Î∂àÍ∞Ä',
          recommendation: 'ÏÑúÎ≤Ñ Ïò§Î•ò'
        },
        ranking: {
          myRank: null,
          competitors: []
        },
        keywords: []
      }

      return c.json(fallbackResponse)
    }
  } catch (err) {
    console.error('Search analysis error:', err)
    return c.json({ success: false, error: 'Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§' }, 500)
  }
})

// ÎåÄÌñâ Î¨∏Ïùò API
app.post('/api/contact', async (c) => {
  try {
    const { type, academy, name, phone, email, programs, message } = await c.req.json()
    
    // Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ï†ÄÏû•
    const { env } = c
    await env.DB.prepare(`
      INSERT INTO contacts (inquiry, academy, name, phone, email, programs, message, created_at)
      VALUES (?, ?, ?, ?, ?, ?, ?, datetime('now'))
    `).bind(type, academy, name, phone, email || '', JSON.stringify(programs || []), message).run()

    return c.json({ success: true, message: 'Î¨∏ÏùòÍ∞Ä Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§' })
  } catch (err) {
    console.error('Contact error:', err)
    return c.json({ success: false, error: 'Î¨∏Ïùò Ï†ëÏàò Ïã§Ìå®' }, 500)
  }
})

// Î°úÍ∑∏Ïù∏ API
app.post('/api/login', async (c) => {
  try {
    const { email, password } = await c.req.json()
    const { env } = c
    
    // ÏÇ¨Ïö©Ïûê Ï°∞Ìöå
    const user = await env.DB.prepare('SELECT * FROM users WHERE email = ?').bind(email).first()
    
    if (!user) {
      return c.json({ success: false, error: 'Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§' }, 401)
    }
    
    // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ (Ïã§Ï†úÎ°úÎäî Ìï¥Ïãú ÎπÑÍµêÎ•º Ìï¥Ïïº ÌïòÏßÄÎßå, ÌòÑÏû¨Îäî Îã®Ïàú ÎπÑÍµê)
    if (user.password !== password) {
      return c.json({ success: false, error: 'Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§' }, 401)
    }
    
    // ÎπÑÎ∞ÄÎ≤àÌò∏ Ï†úÏô∏ÌïòÍ≥† ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞òÌôò
    const userInfo: any = {
      id: user.id,
      email: user.email,
      name: user.name,
      phone: user.phone,
      academy_name: user.academy_name,
      role: user.role,
      user_type: user.role, // APIÏóêÏÑú user_typeÏùÑ Í∏∞ÎåÄÌï®
      parent_user_id: user.parent_user_id || null
    }
    
    // ÏÑ†ÏÉùÎãòÏù∏ Í≤ΩÏö∞ Í∂åÌïú Ï†ïÎ≥¥ Ï°∞Ìöå
    if (user.role === 'teacher') {
      try {
        const permData = await env.DB.prepare(`
          SELECT permissions 
          FROM teacher_permissions 
          WHERE teacher_id = ?
        `).bind(user.id).first()
        
        if (permData && permData.permissions) {
          userInfo.permissions = JSON.parse(permData.permissions)
          console.log('Teacher permissions loaded:', userInfo.permissions)
        } else {
          // Í∏∞Î≥∏ Í∂åÌïú ÏÑ§Ï†ï
          userInfo.permissions = {
            canViewAllStudents: false,
            canWriteDailyReports: false,
            assignedClasses: []
          }
          console.log('No permissions found, using defaults')
        }
      } catch (permErr) {
        console.error('Error loading teacher permissions:', permErr)
        // Í∂åÌïú Ï°∞Ìöå Ïã§Ìå® Ïãú Í∏∞Î≥∏ Í∂åÌïú
        userInfo.permissions = {
          canViewAllStudents: false,
          canWriteDailyReports: false,
          assignedClasses: []
        }
      }
    }
    
    return c.json({ success: true, message: 'Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ', user: userInfo })
  } catch (err) {
    console.error('Login error:', err)
    return c.json({ success: false, error: 'Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§' }, 500)
  }
})

// SMS Î∞úÏÜ° API (ÏïåÎ¶¨Í≥†)
app.post('/api/sms/send', async (c) => {
  try {
    const { userId, receivers, message, subject } = await c.req.json()
    
    // ÌïÑÏàò ÌååÎùºÎØ∏ÌÑ∞ Ï≤¥ÌÅ¨
    if (!receivers || receivers.length === 0) {
      return c.json({ success: false, error: 'ÏàòÏã†Ïûê Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' }, 400)
    }
    
    if (!message) {
      return c.json({ success: false, error: 'Î©îÏãúÏßÄ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' }, 400)
    }
    
    // ÏïåÎ¶¨Í≥† API ÏÑ§Ï†ï
    const ALIGO_API_KEY = '4bbi3l27pb5qh11tkujl578bttz6vb5j'
    const ALIGO_USER_ID = 'wangholy'
    const SENDER_PHONE = '010-8739-9697'
    
    // ÏàòÏã†Ïûê Î≤àÌò∏ Ìè¨Îß∑ÌåÖ (ÌïòÏù¥Ìîà Ï†úÍ±∞)
    const formattedReceivers = receivers.map((phone: string) => phone.replace(/-/g, ''))
    
    // ÏïåÎ¶¨Í≥† API Ìò∏Ï∂ú
    const aligoUrl = 'https://apis.aligo.in/send/'
    const formData = new URLSearchParams()
    formData.append('key', ALIGO_API_KEY)
    formData.append('user_id', ALIGO_USER_ID)
    formData.append('sender', SENDER_PHONE.replace(/-/g, ''))
    formData.append('receiver', formattedReceivers.join(','))
    formData.append('msg', message)
    
    if (subject) {
      formData.append('title', subject) // LMS/MMSÏùò Í≤ΩÏö∞ Ï†úÎ™©
    }
    
    // Î©îÏãúÏßÄ ÌÉÄÏûÖ ÏûêÎèô Í≤∞Ï†ï (90Ïûê Ïù¥Ìïò: SMS, Ïù¥ÏÉÅ: LMS)
    const msgType = message.length <= 90 ? 'SMS' : 'LMS'
    formData.append('msg_type', msgType)
    
    console.log('ÏïåÎ¶¨Í≥† SMS Î∞úÏÜ° ÏãúÎèÑ:', {
      receivers: formattedReceivers,
      messageLength: message.length,
      msgType: msgType
    })
    
    const response = await fetch(aligoUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: formData.toString()
    })
    
    const result = await response.json()
    
    console.log('ÏïåÎ¶¨Í≥† API ÏùëÎãµ:', result)
    
    // Í≤∞Í≥º ÌôïÏù∏
    if (result.result_code === '1') {
      // Î∞úÏÜ° ÏÑ±Í≥µ - DBÏóê Í∏∞Î°ù
      const { env } = c
      
      for (const receiver of formattedReceivers) {
        try {
          await env.DB.prepare(`
            INSERT INTO sms_history (
              recipient_phone, message_content, status, sent_at, 
              result_code, result_message, cost, created_by, created_at
            )
            VALUES (?, ?, ?, datetime('now'), ?, ?, ?, ?, datetime('now'))
          `).bind(
            receiver,
            message,
            'sent',
            result.result_code,
            result.message || 'Î∞úÏÜ° ÏÑ±Í≥µ',
            20, // SMS 1Í±¥Îãπ 20Ïõê (ÏòàÏÉÅ ÎπÑÏö©)
            userId || null
          ).run()
        } catch (dbError) {
          console.error('SMS Î°úÍ∑∏ Ï†ÄÏû• Ïò§Î•ò:', dbError)
        }
      }
      
      return c.json({
        success: true,
        message: 'Î¨∏Ïûê Î∞úÏÜ° ÏÑ±Í≥µ',
        data: {
          sentCount: result.success_cnt || formattedReceivers.length,
          failCount: result.error_cnt || 0,
          msgType: msgType,
          details: result
        }
      })
    } else {
      // Î∞úÏÜ° Ïã§Ìå®
      const { env } = c
      
      for (const receiver of formattedReceivers) {
        try {
          await env.DB.prepare(`
            INSERT INTO sms_logs (user_id, receiver, message, subject, status, result_code, result_message, created_at)
            VALUES (?, ?, ?, ?, ?, ?, ?, datetime('now'))
          `).bind(
            userId || null,
            receiver,
            message,
            subject || '',
            'failed',
            result.result_code || '-1',
            result.message || 'Î∞úÏÜ° Ïã§Ìå®'
          ).run()
        } catch (dbError) {
          console.error('SMS Î°úÍ∑∏ Ï†ÄÏû• Ïò§Î•ò:', dbError)
        }
      }
      
      return c.json({
        success: false,
        error: 'Î¨∏Ïûê Î∞úÏÜ° Ïã§Ìå®',
        message: result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò',
        resultCode: result.result_code
      }, 400)
    }
    
  } catch (err) {
    console.error('SMS Î∞úÏÜ° Ïò§Î•ò:', err)
    return c.json({ 
      success: false, 
      error: 'Î¨∏Ïûê Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§',
      details: error instanceof Error ? error.message : 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'
    }, 500)
  }
})

// SMS Î∞úÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/sms/logs', async (c) => {
  try {
    const userId = c.req.query('userId')
    const { env } = c
    
    let query = 'SELECT * FROM sms_history'
    let params: any[] = []
    
    if (userId) {
      query += ' WHERE created_by = ?'
      params.push(userId)
    }
    
    query += ' ORDER BY created_at DESC LIMIT 100'
    
    const { results } = await env.DB.prepare(query).bind(...params).all()
    
    return c.json({
      success: true,
      logs: results || []
    })
  } catch (err) {
    console.error('SMS Î°úÍ∑∏ Ï°∞Ìöå Ïò§Î•ò:', err)
    return c.json({ success: false, error: 'SMS Î°úÍ∑∏ Ï°∞Ìöå Ïã§Ìå®' }, 500)
  }
})

// ÌöåÏõêÍ∞ÄÏûÖ API
// ============================================
// ÎßàÏºÄÌåÖ Ìà¥ 10Í∞ú
// ============================================

// 1. ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞
app.get('/tools/place-keyword-analyzer', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-search text-purple-600 mr-3"></i>
                    ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞
                </h1>
                <p class="text-xl text-gray-600">ÏßÄÏó≠Î≥Ñ Í≤ÄÏÉâÎüâÍ≥º Í≤ΩÏüÅÎèÑÎ•º Î∂ÑÏÑùÌïòÏó¨ ÏµúÏ†ÅÏùò ÌÇ§ÏõåÎìúÎ•º Ï∞æÏïÑÎìúÎ¶ΩÎãàÎã§</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 sticky top-24">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">ÌÇ§ÏõåÎìú ÏûÖÎ†•</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏßÄÏó≠</label>
                                <input type="text" id="region" placeholder="Ïòà: Ïù∏Ï≤ú ÏÑúÍµ¨" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">ÏóÖÏ¢Ö</label>
                                <input type="text" id="keyword" placeholder="Ïòà: ÏòÅÏñ¥ÌïôÏõê" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            </div>

                            <button onclick="analyzeKeyword()" 
                                    class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-lg transition">
                                <i class="fas fa-chart-line mr-2"></i>Î∂ÑÏÑù ÏãúÏûë
                            </button>
                        </div>

                        <div class="mt-6 p-4 bg-blue-50 rounded-xl text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâÎüâÍ≥º Í≤ΩÏüÅ ÏóÖÏ≤¥ ÏàòÎ•º Î∂ÑÏÑùÌï©ÎãàÎã§
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Î∂ÑÏÑù Í≤∞Í≥º</h2>
                        
                        <div id="result" class="hidden">
                            <div class="grid md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-purple-50 rounded-xl p-6 text-center">
                                    <div class="text-3xl font-bold text-purple-600 mb-2" id="searchVolume">-</div>
                                    <div class="text-sm text-gray-600">Ïõî ÌèâÍ∑† Í≤ÄÏÉâÎüâ</div>
                                </div>
                                <div class="bg-orange-50 rounded-xl p-6 text-center">
                                    <div class="text-3xl font-bold text-orange-600 mb-2" id="competition">-</div>
                                    <div class="text-sm text-gray-600">Í≤ΩÏüÅ ÏóÖÏ≤¥ Ïàò</div>
                                </div>
                                <div class="bg-green-50 rounded-xl p-6 text-center">
                                    <div class="text-3xl font-bold text-green-600 mb-2" id="difficulty">-</div>
                                    <div class="text-sm text-gray-600">ÎÇúÏù¥ÎèÑ</div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-900">Ï∂îÏ≤ú ÌÇ§ÏõåÎìú</h3>
                                <div id="recommendations" class="space-y-3"></div>
                            </div>

                            <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl">
                                <h4 class="font-bold text-gray-900 mb-3">üí° ÏµúÏ†ÅÌôî ÌåÅ</h4>
                                <ul class="space-y-2 text-sm text-gray-700">
                                    <li>‚úì ÏßÄÏó≠Î™Ö + ÏóÖÏ¢ÖÏùÑ Ìï®Íªò ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî</li>
                                    <li>‚úì Í≤ΩÏüÅÏù¥ ÎÇÆÏùÄ Î°±ÌÖåÏùº ÌÇ§ÏõåÎìúÎ•º ÌôúÏö©ÌïòÏÑ∏Ïöî</li>
                                    <li>‚úì Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú ÌÇ§ÏõåÎìú ÏàúÏúÑÎ•º Î™®ÎãàÌÑ∞ÎßÅÌïòÏÑ∏Ïöî</li>
                                </ul>
                            </div>
                        </div>

                        <div id="empty" class="text-center py-20">
                            <div class="text-6xl mb-4">üîç</div>
                            <p class="text-gray-500 text-lg">ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÍ≥† Î∂ÑÏÑùÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function analyzeKeyword() {
                const region = document.getElementById('region').value;
                const keyword = document.getElementById('keyword').value;

                if (!region || !keyword) {
                    alert('ÏßÄÏó≠Í≥º ÏóÖÏ¢ÖÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }

                // ÏãúÎÆ¨Î†àÏù¥ÏÖò Îç∞Ïù¥ÌÑ∞
                const searchVolume = Math.floor(Math.random() * 5000) + 1000;
                const competition = Math.floor(Math.random() * 100) + 20;
                const difficulty = competition > 70 ? 'ÎÜíÏùå' : competition > 40 ? 'Î≥¥ÌÜµ' : 'ÎÇÆÏùå';

                document.getElementById('searchVolume').textContent = searchVolume.toLocaleString();
                document.getElementById('competition').textContent = competition + 'Í∞ú';
                document.getElementById('difficulty').textContent = difficulty;

                const recommendations = [
                    { keyword: region + ' ' + keyword, score: 95 },
                    { keyword: region + ' ' + keyword + ' Ï∂îÏ≤ú', score: 88 },
                    { keyword: region + ' Ï¥àÎì± ' + keyword, score: 82 },
                    { keyword: region + ' Ï§ëÎì± ' + keyword, score: 78 },
                    { keyword: 'Í≤ÄÎã® ' + keyword, score: 75 }
                ];

                const recommendationsHTML = recommendations.map(item => \`
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                        <div>
                            <div class="font-medium text-gray-900">\${item.keyword}</div>
                            <div class="text-sm text-gray-500">Ï∂îÏ≤úÎèÑ: \${item.score}Ï†ê</div>
                        </div>
                        <div class="text-purple-600 font-bold">\${item.score}</div>
                    </div>
                \`).join('');

                document.getElementById('recommendations').innerHTML = recommendationsHTML;
                document.getElementById('empty').classList.add('hidden');
                document.getElementById('result').classList.remove('hidden');
            }
        </script>
    </body>
    </html>
  `)
})

// 2. Î∏îÎ°úÍ∑∏ Ï†úÎ™© ÏÉùÏÑ±Í∏∞
app.get('/tools/blog-title-generator', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∏îÎ°úÍ∑∏ Ï†úÎ™© ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-lightbulb text-purple-600 mr-3"></i>
                    Î∏îÎ°úÍ∑∏ Ï†úÎ™© ÏÉùÏÑ±Í∏∞
                </h1>
                <p class="text-xl text-gray-600">ÌÅ¥Î¶≠Î•†ÏùÑ ÎÜíÏù¥Îäî Îß§Î†•Ï†ÅÏù∏ Î∏îÎ°úÍ∑∏ Ï†úÎ™©ÏùÑ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§</p>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-900 mb-3">Ï£ºÏ†ú ÏûÖÎ†•</label>
                    <input type="text" id="topic" placeholder="Ïòà: Ï¥àÎì±ÏòÅÏñ¥ ÌïôÏäµÎ≤ï" 
                           class="w-full px-6 py-4 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                </div>

                <div class="mb-8 grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌÜ§Ïï§Îß§ÎÑà</label>
                        <select id="tone" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="professional">Ï†ÑÎ¨∏Ï†ÅÏù∏</option>
                            <option value="friendly">ÏπúÍ∑ºÌïú</option>
                            <option value="exciting">Ìù•ÎØ∏Î°úÏö¥</option>
                            <option value="urgent">Í∏¥Í∏âÌïú</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌÉÄÍ≤ü</label>
                        <select id="target" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="parents">ÌïôÎ∂ÄÎ™®</option>
                            <option value="students">ÌïôÏÉù</option>
                            <option value="teachers">ÏÑ†ÏÉùÎãò</option>
                            <option value="general">ÏùºÎ∞ò</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">Í∞úÏàò</label>
                        <select id="count" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="5">5Í∞ú</option>
                            <option value="10" selected>10Í∞ú</option>
                            <option value="15">15Í∞ú</option>
                            <option value="20">20Í∞ú</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateTitles()" 
                        class="w-full gradient-purple text-white py-4 rounded-xl text-lg font-bold hover:shadow-lg transition">
                    <i class="fas fa-magic mr-2"></i>Ï†úÎ™© ÏÉùÏÑ±ÌïòÍ∏∞
                </button>

                <div id="results" class="mt-8 hidden">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">ÏÉùÏÑ±Îêú Ï†úÎ™©</h3>
                    <div id="titleList" class="space-y-3"></div>
                </div>
            </div>

            <div class="mt-8 bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4">üí° Ï¢ãÏùÄ Î∏îÎ°úÍ∑∏ Ï†úÎ™©Ïùò Ï°∞Í±¥</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-bold text-purple-600 mb-2">‚úì Ìè¨Ìï®Ìï¥Ïïº Ìï† ÏöîÏÜå</h4>
                        <ul class="space-y-1 text-sm text-gray-700">
                            <li>‚Ä¢ Íµ¨Ï≤¥Ï†ÅÏù∏ Ïà´ÏûêÎÇò ÏàòÏπò</li>
                            <li>‚Ä¢ ÌÉÄÍ≤ü ÎèÖÏûêÏ∏µ Î™ÖÏãú</li>
                            <li>‚Ä¢ Î™ÖÌôïÌïú ÌòúÌÉù Ï†úÏãú</li>
                            <li>‚Ä¢ Í∂ÅÍ∏àÏ¶ùÏùÑ Ïú†Î∞úÌïòÎäî Î¨∏Íµ¨</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-orange-600 mb-2">‚úó ÌîºÌï¥Ïïº Ìï† ÏöîÏÜå</h4>
                        <ul class="space-y-1 text-sm text-gray-700">
                            <li>‚Ä¢ Í≥ºÏû•Îêú ÌëúÌòÑ ÎÇ®Î∞ú</li>
                            <li>‚Ä¢ ÎÑàÎ¨¥ Í∏¥ Ï†úÎ™© (50Ïûê Ïù¥ÏÉÅ)</li>
                            <li>‚Ä¢ Î™®Ìò∏ÌïòÍ≥† Ï∂îÏÉÅÏ†ÅÏù∏ Îã®Ïñ¥</li>
                            <li>‚Ä¢ ÌÅ¥Î¶≠Î≤†Ïù¥Ìä∏ÏÑ± Ï†úÎ™©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function generateTitles() {
                const topic = document.getElementById('topic').value;
                const count = parseInt(document.getElementById('count').value);

                if (!topic) {
                    alert('Ï£ºÏ†úÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }

                const templates = [
                    \`\${topic}, Ïù¥Î†áÍ≤å ÌïòÎ©¥ ÏÑ±Í≥µÌï©ÎãàÎã§\`,
                    \`\${topic} ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú (2025ÎÖÑ ÏµúÏã†)\`,
                    \`\${topic} Ï≤òÏùå ÏãúÏûëÌïòÎäî Î∂ÑÎì§ÏùÑ ÏúÑÌïú 5Îã®Í≥Ñ\`,
                    \`Ï†ÑÎ¨∏Í∞ÄÍ∞Ä ÏïåÎ†§Ï£ºÎäî \${topic} ÌïµÏã¨ Ï†ÑÎûµ\`,
                    \`\${topic} Ïã§ÏàòÌïòÏßÄ ÏïäÎäî Î∞©Î≤ï 7Í∞ÄÏßÄ\`,
                    \`\${topic}Î°ú ÏÑ±Í≥º 200% ÎÜíÏù¥Îäî Î≤ï\`,
                    \`ÌïôÎ∂ÄÎ™®Í∞Ä Íº≠ ÏïåÏïÑÏïº Ìï† \${topic} Ï†ïÎ≥¥\`,
                    \`\${topic} Ìö®Í≥º Í∑πÎåÄÌôîÌïòÎäî ÍøÄÌåÅ\`,
                    \`\${topic} Ï†ÑÏóê Î∞òÎìúÏãú ÏïåÏïÑÏïº Ìï† Í≤ÉÎì§\`,
                    \`\${topic} ÏÑ±Í≥µ ÏÇ¨Î°ÄÏôÄ ÎÖ∏ÌïòÏö∞ ÎåÄÍ≥µÍ∞ú\`,
                    \`Ïôú \${topic}Ïù¥ Ï§ëÏöîÌïúÍ∞Ä? (Ïã§Ï†Ñ Í≤ΩÌóòÎã¥)\`,
                    \`\${topic} ÎπÑÏö©Î∂ÄÌÑ∞ Ìö®Í≥ºÍπåÏßÄ ÏôÑÎ≤Ω Î∂ÑÏÑù\`,
                    \`\${topic} Í≥†ÎØº Ìï¥Í≤∞! Ï†ÑÎ¨∏Í∞Ä Q&A\`,
                    \`\${topic} 1Îì±Ïùò ÎπÑÎ∞Ä, Ïù¥Í≤É ÎïåÎ¨∏Ïù¥ÏóàÏñ¥Ïöî\`,
                    \`\${topic} ÏãúÏûë Ï†Ñ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ 10Í∞ÄÏßÄ\`,
                    \`\${topic}Ïùò Î™®Îì† Í≤É A to Z\`,
                    \`\${topic} Ïã§Ï†Ñ Ï†ÅÏö© ÌõÑÍ∏∞ (ÏÜîÏßÅ Î¶¨Î∑∞)\`,
                    \`\${topic}, Ïù¥ Î∞©Î≤ïÏúºÎ°ú Î∞îÎ°ú ÏãúÏûëÌïòÏÑ∏Ïöî\`,
                    \`\${topic} Ï†ÑÎ¨∏Í∞ÄÍ∞Ä Ï∂îÏ≤úÌïòÎäî ÏµúÍ≥†Ïùò Î∞©Î≤ï\`,
                    \`\${topic} ÏÑ±Í≥µÎ•† ÎÜíÏù¥Îäî 3Í∞ÄÏßÄ ÏõêÏπô\`
                ];

                const selectedTitles = templates.sort(() => 0.5 - Math.random()).slice(0, count);

                const titlesHTML = selectedTitles.map((title, index) => \`
                    <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition group">
                        <div class="flex-shrink-0 w-8 h-8 gradient-purple rounded-lg flex items-center justify-center text-white font-bold text-sm">
                            \${index + 1}
                        </div>
                        <div class="flex-1">
                            <div class="text-gray-900 font-medium">\${title}</div>
                            <div class="text-xs text-gray-500 mt-1">\${title.length}Ïûê</div>
                        </div>
                        <button onclick="copyTitle('\${title.replace(/'/g, "\\\\'")}', this)" 
                                class="flex-shrink-0 px-4 py-2 text-sm text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition opacity-0 group-hover:opacity-100">
                            <i class="fas fa-copy mr-1"></i>Î≥µÏÇ¨
                        </button>
                    </div>
                \`).join('');

                document.getElementById('titleList').innerHTML = titlesHTML;
                document.getElementById('results').classList.remove('hidden');
            }

            function copyTitle(title, button) {
                navigator.clipboard.writeText(title).then(() => {
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check mr-1"></i>Î≥µÏÇ¨Îê®';
                    button.classList.add('text-green-600');
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.classList.remove('text-green-600');
                    }, 2000);
                });
            }
        </script>
    </body>
    </html>
  `)
})

// 3. ÏÉÅÎã¥ ÏòàÏïΩ Ï∫òÎ¶∞Îçî
app.get('/tools/consultation-calendar', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÉÅÎã¥ ÏòàÏïΩ Ï∫òÎ¶∞Îçî - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .calendar-day { min-height: 100px; }
            .time-slot { cursor: pointer; transition: all 0.2s; }
            .time-slot:hover { transform: scale(1.05); }
            .time-slot.selected { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-calendar-check text-purple-600 mr-3"></i>
                    ÏÉÅÎã¥ ÏòàÏïΩ Ï∫òÎ¶∞Îçî
                </h1>
                <p class="text-xl text-gray-600">ÏõêÌïòÏãúÎäî ÎÇ†ÏßúÏôÄ ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Î¨¥Î£å ÏÉÅÎã¥ÏùÑ ÏòàÏïΩÌïòÏÑ∏Ïöî</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-900">2025ÎÖÑ 1Ïõî</h2>
                            <div class="flex gap-2">
                                <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-7 gap-2 mb-4">
                            <div class="text-center text-sm font-medium text-red-500 py-2">Ïùº</div>
                            <div class="text-center text-sm font-medium text-gray-600 py-2">Ïõî</div>
                            <div class="text-center text-sm font-medium text-gray-600 py-2">Ìôî</div>
                            <div class="text-center text-sm font-medium text-gray-600 py-2">Ïàò</div>
                            <div class="text-center text-sm font-medium text-gray-600 py-2">Î™©</div>
                            <div class="text-center text-sm font-medium text-gray-600 py-2">Í∏à</div>
                            <div class="text-center text-sm font-medium text-blue-500 py-2">ÌÜ†</div>
                        </div>

                        <div class="grid grid-cols-7 gap-2" id="calendar"></div>

                        <div class="mt-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">ÏòàÏïΩ Í∞ÄÎä• ÏãúÍ∞Ñ</h3>
                            <div id="timeSlots" class="grid grid-cols-4 gap-3"></div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 sticky top-24">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">ÏòàÏïΩ Ï†ïÎ≥¥</h2>
                        
                        <div class="space-y-4 mb-6">
                            <div class="p-4 bg-purple-50 rounded-xl">
                                <div class="text-sm text-gray-600 mb-1">ÏÑ†ÌÉùÌïú ÎÇ†Ïßú</div>
                                <div class="font-bold text-gray-900" id="selectedDate">ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                            </div>

                            <div class="p-4 bg-purple-50 rounded-xl">
                                <div class="text-sm text-gray-600 mb-1">ÏÑ†ÌÉùÌïú ÏãúÍ∞Ñ</div>
                                <div class="font-bold text-gray-900" id="selectedTime">ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                            </div>
                        </div>

                        <div class="space-y-3 mb-6">
                            <input type="text" id="name" placeholder="Ïù¥Î¶Ñ" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <input type="tel" id="phone" placeholder="Ïó∞ÎùΩÏ≤ò" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <textarea id="message" placeholder="Î¨∏Ïùò ÎÇ¥Ïö©" rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none resize-none"></textarea>
                        </div>

                        <button onclick="submitReservation()" 
                                class="w-full gradient-purple text-white py-4 rounded-xl font-bold hover:shadow-lg transition">
                            <i class="fas fa-check mr-2"></i>ÏòàÏïΩÌïòÍ∏∞
                        </button>

                        <div class="mt-6 p-4 bg-blue-50 rounded-xl text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            ÏÉÅÎã¥ÏùÄ ÏïΩ 30Î∂Ñ ÏÜåÏöîÎê©ÎãàÎã§
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let selectedDate = null;
            let selectedTimeSlot = null;

            function generateCalendar() {
                const calendar = document.getElementById('calendar');
                const today = new Date();
                const daysInMonth = 31;
                const startDay = 3; // 1Ïõî 1ÏùºÏù¥ ÏàòÏöîÏùº

                let html = '';
                for (let i = 0; i < startDay; i++) {
                    html += '<div></div>';
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const isPast = day < today.getDate();
                    const isToday = day === today.getDate();
                    
                    html += \`
                        <div onclick="selectDate(\${day})" 
                             class="calendar-day border border-gray-200 rounded-lg p-2 text-center cursor-pointer hover:border-purple-400 transition \${isPast ? 'bg-gray-100 cursor-not-allowed' : ''} \${isToday ? 'border-purple-600 bg-purple-50' : ''}">
                            <div class="font-medium \${isPast ? 'text-gray-400' : 'text-gray-900'}">\${day}</div>
                            \${!isPast ? '<div class="text-xs text-green-600 mt-1">ÏòàÏïΩÍ∞ÄÎä•</div>' : ''}
                        </div>
                    \`;
                }

                calendar.innerHTML = html;
            }

            function selectDate(day) {
                const today = new Date();
                if (day < today.getDate()) return;

                selectedDate = \`2025ÎÖÑ 1Ïõî \${day}Ïùº\`;
                document.getElementById('selectedDate').textContent = selectedDate;

                const timeSlots = document.getElementById('timeSlots');
                const times = ['10:00', '11:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
                
                timeSlots.innerHTML = times.map(time => \`
                    <button onclick="selectTime('\${time}')" 
                            class="time-slot px-4 py-3 border-2 border-gray-200 rounded-lg text-sm font-medium hover:border-purple-400 transition">
                        \${time}
                    </button>
                \`).join('');
            }

            function selectTime(time) {
                selectedTimeSlot = time;
                document.getElementById('selectedTime').textContent = time;

                document.querySelectorAll('.time-slot').forEach(slot => {
                    slot.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }

            function submitReservation() {
                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;

                if (!selectedDate || !selectedTimeSlot) {
                    alert('ÎÇ†ÏßúÏôÄ ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }

                if (!name || !phone) {
                    alert('Ïù¥Î¶ÑÍ≥º Ïó∞ÎùΩÏ≤òÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }

                alert(\`ÏòàÏïΩÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÎÇ†Ïßú: \${selectedDate}\\nÏãúÍ∞Ñ: \${selectedTimeSlot}\\nÏù¥Î¶Ñ: \${name}\`);
            }

            generateCalendar();
        </script>
    </body>
    </html>
  `)
})

// 4. ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞
app.get('/tools/promo-generator', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-4xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                <i class="fas fa-bullhorn text-purple-600 mr-3"></i>ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞
            </h1>
            <p class="text-xl text-gray-600 mb-8">ÌïôÏÉù Î™®ÏßëÏóê Ìö®Í≥ºÏ†ÅÏù∏ ÌôçÎ≥¥ Î¨∏Íµ¨Î•º ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§</p>

            <div class="bg-white rounded-2xl shadow-sm border p-8 mb-8">
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">ÌïôÏõê Ïú†Ìòï</label>
                        <select id="type" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option>ÏòÅÏñ¥ÌïôÏõê</option>
                            <option>ÏàòÌïôÌïôÏõê</option>
                            <option>Í≥ºÌïôÌïôÏõê</option>
                            <option>ÎÖºÏà†ÌïôÏõê</option>
                            <option>ÏûÖÏãúÌïôÏõê</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ÌÉÄÍ≤ü ÌïôÎÖÑ</label>
                        <select id="grade" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                            <option>Ï¥àÎì±</option>
                            <option>Ï§ëÎì±</option>
                            <option>Í≥†Îì±</option>
                            <option>Ï†ÑÌïôÎÖÑ</option>
                        </select>
                    </div>
                </div>
                <button onclick="generate()" class="w-full gradient-purple text-white py-4 rounded-xl font-bold">
                    <i class="fas fa-magic mr-2"></i>Î¨∏Íµ¨ ÏÉùÏÑ±ÌïòÍ∏∞
                </button>
            </div>

            <div id="results" class="hidden space-y-4"></div>
        </div>

        <script>
            function generate() {
                const type = document.getElementById('type').value;
                const grade = document.getElementById('grade').value;
                const templates = [
                    \`\${grade} \${type} 1Îì±Ïùò ÎπÑÍ≤∞, ÏßÄÍ∏à Î∞îÎ°ú ÌôïÏù∏ÌïòÏÑ∏Ïöî!\`,
                    \`\${grade}ÏÉù ÏÑ±Ï†Å Ìñ•ÏÉÅ ÌîÑÎ°úÍ∑∏Îû® Î¨¥Î£å Ï≤¥Ìóò Ïù¥Î≤§Ìä∏\`,
                    \`ÏÜåÏàò Ï†ïÏòà \${grade} \${type} - 1:1 ÎßûÏ∂§ Í¥ÄÎ¶¨\`,
                    \`\${grade} ÎÇ¥Ïã†¬∑ÏàòÎä• ÏôÑÎ≤Ω ÎåÄÎπÑ \${type}\`,
                    \`Ìï©Í≤©Î•† 98%! \${grade} Ï†ÑÎ¨∏ \${type}\`,
                    \`\${grade} \${type} Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï Î™®Ïßë Ï§ë\`,
                    \`\${grade}ÏÉù ÌïôÎ∂ÄÎ™®Îãò, ÏÑ±Ï†Å Í±±Ï†ï ÎÅù! Í≤ÄÏ¶ùÎêú Ïª§Î¶¨ÌÅòÎüº\`,
                    \`\${grade} \${type} Ïã†Í∑ú Ïò§Ìîà Ïù¥Î≤§Ìä∏ - Ï≤´Îã¨ 50% Ìï†Ïù∏\`,
                    \`\${grade}ÏÉù Ï†ÑÎ¨∏ Í∞ïÏÇ¨ÏßÑÏùò 1:1 ÏºÄÏñ¥ ÏãúÏä§ÌÖú\`,
                    \`\${grade} \${type} ÏÑ±Ï†Å Î≥¥Ïû•Î∞ò Ïö¥ÏòÅ Ï§ë\`
                ];

                const html = templates.map((text, i) => \`
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm text-purple-600 font-medium mb-2">ÌôçÎ≥¥ Î¨∏Íµ¨ \${i+1}</div>
                                <div class="text-lg font-medium text-gray-900">\${text}</div>
                            </div>
                            <button onclick="copy('\${text.replace(/'/g, "\\\\'")}', this)" 
                                    class="px-4 py-2 text-sm text-purple-600 hover:bg-purple-50 rounded-lg">
                                <i class="fas fa-copy"></i> Î≥µÏÇ¨
                            </button>
                        </div>
                    </div>
                \`).join('');

                document.getElementById('results').innerHTML = html;
                document.getElementById('results').classList.remove('hidden');
            }

            function copy(text, btn) {
                navigator.clipboard.writeText(text);
                btn.innerHTML = '<i class="fas fa-check"></i> Î≥µÏÇ¨Îê®';
                setTimeout(() => btn.innerHTML = '<i class="fas fa-copy"></i> Î≥µÏÇ¨', 2000);
            }
        </script>
    </body>
    </html>
  `)
})

// 5. Î¶¨Î∑∞ ÎãµÎ≥Ä ÌÖúÌîåÎ¶ø
app.get('/tools/review-template', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¶¨Î∑∞ ÎãµÎ≥Ä ÌÖúÌîåÎ¶ø - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-4xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                <i class="fas fa-comment-dots text-purple-600 mr-3"></i>Î¶¨Î∑∞ ÎãµÎ≥Ä ÌÖúÌîåÎ¶ø
            </h1>
            <p class="text-xl text-gray-600 mb-8">Í∏çÏ†ï/Î∂ÄÏ†ï Î¶¨Î∑∞Ïóê Ï¶âÏãú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ï†ÑÎ¨∏Ï†ÅÏù∏ ÎãµÎ≥Ä ÌÖúÌîåÎ¶ø</p>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-6 shadow-sm border">
                    <h2 class="text-xl font-bold text-green-600 mb-4">
                        <i class="fas fa-smile mr-2"></i>Í∏çÏ†ï Î¶¨Î∑∞ ÎãµÎ≥Ä
                    </h2>
                    <div class="space-y-4">
                        ${['Í∞êÏÇ¨Ìï©ÎãàÎã§! ÏïûÏúºÎ°úÎèÑ ÏµúÏÑ†ÏùÑ Îã§ÌïòÍ≤†ÏäµÎãàÎã§.', 'ÏÜåÏ§ëÌïú ÌõÑÍ∏∞ Í∞êÏÇ¨ÎìúÎ¶ΩÎãàÎã§. ÎçîÏö± Î∞úÏ†ÑÌïòÎäî ÌïôÏõêÏù¥ ÎêòÍ≤†ÏäµÎãàÎã§.', 'ÏïÑÏù¥Îì§Ïùò ÏÑ±Ïû•Ïù¥ Ï†ÄÌù¨Ïùò Í∞ÄÏû• ÌÅ∞ Î≥¥ÎûåÏûÖÎãàÎã§. Ìï≠ÏÉÅ ÏùëÏõêÌï¥Ï£ºÏÑ∏Ïöî!'].map((text, i) => `
                            <div class="p-4 bg-green-50 rounded-xl">
                                <div class="text-sm text-gray-600 mb-2">ÌÖúÌîåÎ¶ø ${i+1}</div>
                                <div class="text-gray-900">${text}</div>
                                <button onclick="copyText('${text}')" class="mt-2 text-sm text-green-600 hover:underline">
                                    <i class="fas fa-copy"></i> Î≥µÏÇ¨
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border">
                    <h2 class="text-xl font-bold text-orange-600 mb-4">
                        <i class="fas fa-frown mr-2"></i>Î∂ÄÏ†ï Î¶¨Î∑∞ ÎãµÎ≥Ä
                    </h2>
                    <div class="space-y-4">
                        ${['ÏÜåÏ§ëÌïú ÏùòÍ≤¨ Í∞êÏÇ¨Ìï©ÎãàÎã§. Îçî ÎÇòÏùÄ ÏÑúÎπÑÏä§Î•º Ï†úÍ≥µÌïòÎèÑÎ°ù ÎÖ∏Î†•ÌïòÍ≤†ÏäµÎãàÎã§.', 'Î∂àÌé∏ÏùÑ ÎìúÎ†§ Ï£ÑÏÜ°Ìï©ÎãàÎã§. Îπ†Î•¥Í≤å Í∞úÏÑ†ÌïòÍ≤†ÏäµÎãàÎã§.', 'Ï†ÑÌôî Ï£ºÏãúÎ©¥ ÏûêÏÑ∏Ìûà ÏÉÅÎã¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§. Í∞êÏÇ¨Ìï©ÎãàÎã§.'].map((text, i) => `
                            <div class="p-4 bg-orange-50 rounded-xl">
                                <div class="text-sm text-gray-600 mb-2">ÌÖúÌîåÎ¶ø ${i+1}</div>
                                <div class="text-gray-900">${text}</div>
                                <button onclick="copyText('${text}')" class="mt-2 text-sm text-orange-600 hover:underline">
                                    <i class="fas fa-copy"></i> Î≥µÏÇ¨
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>

        <script>
            function copyText(text) {
                navigator.clipboard.writeText(text);
                alert('Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            }
        </script>
    </body>
    </html>
  `)
})

// 6. ÌïôÎ∂ÄÎ™® Î¨∏Ïûê Î©îÏãúÏßÄ ÌÖúÌîåÎ¶ø
app.get('/tools/parent-sms-template', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÎ∂ÄÎ™® Î¨∏Ïûê ÌÖúÌîåÎ¶ø - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-sms text-purple-600 mr-3"></i>ÌïôÎ∂ÄÎ™® Î¨∏Ïûê Î©îÏãúÏßÄ ÌÖúÌîåÎ¶ø
            </h1>
            <p class="text-xl text-gray-600 mb-8">ÏÉÅÌô©Î≥ÑÎ°ú Î∞îÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÌïôÎ∂ÄÎ™® Î¨∏Ïûê ÌÖúÌîåÎ¶ø</p>

            <div class="grid md:grid-cols-3 gap-6">
                ${[
                    {title: 'ÏÑ±Ï†Å Ìñ•ÏÉÅ ÏïàÎÇ¥', icon: 'chart-line', color: 'green', messages: [
                        'ÏïàÎÖïÌïòÏÑ∏Ïöî. Ïù¥Î≤à ÏãúÌóòÏóêÏÑú ÏàòÌïô ÏÑ±Ï†ÅÏù¥ ÎßéÏù¥ Ìñ•ÏÉÅÎêòÏóàÏäµÎãàÎã§! ÏïûÏúºÎ°úÎèÑ ÏùëÏõê Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.',
                        'ÌïôÏÉùÏùò Íæ∏Ï§ÄÌïú ÎÖ∏Î†•ÏúºÎ°ú ÏÑ±Ï†ÅÏù¥ Ïò¨ÎûêÏäµÎãàÎã§. Ï∂ïÌïòÎìúÎ¶ΩÎãàÎã§!',
                        'Ïù¥Î≤à Îã¨ ÌïôÏäµ ÏßÑÎèÑÍ∞Ä Ïö∞ÏàòÌï©ÎãàÎã§. Í≥ÑÏÜç ÏùëÏõêÌï¥Ï£ºÏÑ∏Ïöî.'
                    ]},
                    {title: 'Í≤∞ÏÑù ÌôïÏù∏', icon: 'calendar-times', color: 'orange', messages: [
                        'ÏïàÎÖïÌïòÏÑ∏Ïöî. Ïò§Îäò ÏàòÏóÖÏóê Î∂àÏ∞∏ÌïòÏÖ®ÎäîÎç∞ Í¥úÏ∞ÆÏúºÏã†Í∞ÄÏöî?',
                        'Í≤∞ÏÑù ÏÇ¨Ïú† ÌôïÏù∏ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§. Î≥¥Í∞ï ÏàòÏóÖ ÏïàÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.',
                        'ÏàòÏóÖ Î∂àÏ∞∏ ÌôïÏù∏ÎêòÏóàÏäµÎãàÎã§. Í±¥Í∞ï ÏÉÅÌÉú Í¥úÏ∞ÆÏúºÏã†ÏßÄÏöî?'
                    ]},
                    {title: 'Ïù¥Î≤§Ìä∏ ÏïàÎÇ¥', icon: 'gift', color: 'purple', messages: [
                        '[Ïù¥Î≤§Ìä∏] ÏπúÍµ¨ Ï∂îÏ≤ú Ïãú ÏÉÅÌíàÍ∂å Ï¶ùÏ†ï! ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÌïôÏõêÏúºÎ°ú Î¨∏ÏùòÏ£ºÏÑ∏Ïöî.',
                        'Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§. Ï°∞Í∏∞ Îì±Î°ù Ïãú Ìï†Ïù∏ ÌòúÌÉù!',
                        'ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥ Ï£ºÍ∞Ñ Ïö¥ÏòÅ Ï§ëÏûÖÎãàÎã§. ÏòàÏïΩ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.'
                    ]}
                ].map(category => `
                    <div class="bg-white rounded-2xl p-6 shadow-sm border">
                        <h2 class="text-lg font-bold text-${category.color}-600 mb-4">
                            <i class="fas fa-${category.icon} mr-2"></i>${category.title}
                        </h2>
                        <div class="space-y-3">
                            ${category.messages.map((msg, i) => `
                                <div class="p-3 bg-gray-50 rounded-lg text-sm">
                                    <div class="text-gray-900 mb-2">${msg}</div>
                                    <button onclick="copy('${msg.replace(/'/g, "\\\\'")}', this)" 
                                            class="text-xs text-purple-600 hover:underline">
                                        Î≥µÏÇ¨ÌïòÍ∏∞
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <script>
            function copy(text, btn) {
                navigator.clipboard.writeText(text);
                btn.textContent = 'Î≥µÏÇ¨Îê®!';
                setTimeout(() => btn.textContent = 'Î≥µÏÇ¨ÌïòÍ∏∞', 2000);
            }
        </script>
    </body>
    </html>
  `)
})

// 7. ÌïôÏõê Ìè¨Ïä§ÌÑ∞ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞
app.get('/tools/poster-generator', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê Ìè¨Ïä§ÌÑ∞ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .poster-preview { aspect-ratio: 3/4; }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-6xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-image text-purple-600 mr-3"></i>ÌïôÏõê Ìè¨Ïä§ÌÑ∞ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞
            </h1>
            <p class="text-xl text-gray-600 mb-8">ÎààÏóê ÎùÑÎäî ÌïôÏõê ÌôçÎ≥¥ Ìè¨Ïä§ÌÑ∞ Î¨∏Íµ¨Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§</p>

            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <h2 class="text-xl font-bold mb-6">Ìè¨Ïä§ÌÑ∞ ÏÑ§Ï†ï</h2>
                    <div class="space-y-4 mb-6">
                        <input type="text" id="title" placeholder="Î©îÏù∏ Î¨∏Íµ¨ (Ïòà: Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï)" 
                               class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        <input type="text" id="subtitle" placeholder="Î∂ÄÏ†úÎ™© (Ïòà: ÏÑ±Ï†Å Ìñ•ÏÉÅ Î≥¥Ïû•)" 
                               class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                        <input type="text" id="discount" placeholder="Ìï†Ïù∏Ïú® (Ïòà: 30% Ìï†Ïù∏)" 
                               class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                    </div>
                    <button onclick="generatePoster()" class="w-full gradient-purple text-white py-4 rounded-xl font-bold">
                        Ìè¨Ïä§ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞
                    </button>
                </div>

                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <h2 class="text-xl font-bold mb-6">ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
                    <div id="preview" class="poster-preview bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl p-8 flex flex-col justify-center items-center text-white">
                        <div class="text-center">
                            <div id="previewTitle" class="text-4xl font-bold mb-4">Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï</div>
                            <div id="previewSubtitle" class="text-2xl mb-4">ÏÑ±Ï†Å Ìñ•ÏÉÅ Î≥¥Ïû•</div>
                            <div id="previewDiscount" class="text-5xl font-bold mb-4">30% Ìï†Ïù∏</div>
                            <div class="text-lg">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ ÌïôÏõê</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function generatePoster() {
                const title = document.getElementById('title').value || 'Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï';
                const subtitle = document.getElementById('subtitle').value || 'ÏÑ±Ï†Å Ìñ•ÏÉÅ Î≥¥Ïû•';
                const discount = document.getElementById('discount').value || '30% Ìï†Ïù∏';

                document.getElementById('previewTitle').textContent = title;
                document.getElementById('previewSubtitle').textContent = subtitle;
                document.getElementById('previewDiscount').textContent = discount;
            }
        </script>
    </body>
    </html>
  `)
})

// 8. Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù ÎèÑÍµ¨
app.get('/tools/competitor-analysis', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù ÎèÑÍµ¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-chart-bar text-purple-600 mr-3"></i>Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù ÎèÑÍµ¨
            </h1>
            <p class="text-xl text-gray-600 mb-8">Ï£ºÎ≥Ä ÌïôÏõê Ï†ïÎ≥¥Î•º Î∂ÑÏÑùÌïòÏó¨ Ï∞®Î≥ÑÌôî Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌïòÏÑ∏Ïöî</p>

            <div class="grid lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl p-6 shadow-sm">
                    <h2 class="text-lg font-bold mb-4">
                        <i class="fas fa-map-marker-alt text-purple-600 mr-2"></i>ÏßÄÏó≠ Í≤ÄÏÉâ
                    </h2>
                    <input type="text" id="location" placeholder="Ïòà: Ïù∏Ï≤ú ÏÑúÍµ¨" 
                           class="w-full px-4 py-3 border rounded-xl mb-4 focus:ring-2 focus:ring-purple-500 outline-none">
                    <button onclick="analyze()" class="w-full gradient-purple text-white py-3 rounded-xl font-bold">
                        Î∂ÑÏÑù ÏãúÏûë
                    </button>
                </div>

                <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm">
                    <h2 class="text-lg font-bold mb-4">Î∂ÑÏÑù Í≤∞Í≥º</h2>
                    <div id="results" class="space-y-4">
                        <div class="text-center py-12 text-gray-500">
                            ÏßÄÏó≠ÏùÑ ÏûÖÎ†•ÌïòÍ≥† Î∂ÑÏÑùÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function analyze() {
                const location = document.getElementById('location').value;
                if (!location) {
                    alert('ÏßÄÏó≠ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }

                const data = [
                    { name: 'A ÏòÅÏñ¥ÌïôÏõê', rating: 4.5, reviews: 120, price: 'Ï§ëÍ∞Ñ' },
                    { name: 'B ÌïôÏõê', rating: 4.2, reviews: 85, price: 'ÎÜíÏùå' },
                    { name: 'C ÏòÅÏñ¥', rating: 4.7, reviews: 200, price: 'ÎÇÆÏùå' }
                ];

                const html = data.map(item => \`
                    <div class="p-4 border rounded-xl hover:border-purple-400 transition">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg">\${item.name}</h3>
                            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">
                                ‚≠ê \${item.rating}
                            </span>
                        </div>
                        <div class="text-sm text-gray-600 space-y-1">
                            <div>Î¶¨Î∑∞: \${item.reviews}Í∞ú</div>
                            <div>Í∞ÄÍ≤©ÎåÄ: \${item.price}</div>
                        </div>
                    </div>
                \`).join('');

                document.getElementById('results').innerHTML = html;
            }
        </script>
    </body>
    </html>
  `)
})

// 9. ÌïôÏõê Ïö¥ÏòÅ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
app.get('/tools/operation-checklist', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê Ïö¥ÏòÅ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-4xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-tasks text-purple-600 mr-3"></i>ÌïôÏõê Ïö¥ÏòÅ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
            </h1>
            <p class="text-xl text-gray-600 mb-8">Îß§Ïùº ÌôïÏù∏Ìï¥Ïïº Ìï† ÌïÑÏàò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</p>

            <div class="space-y-6">
                ${[
                    {title: 'Ïò§Ï†Ñ ÏóÖÎ¨¥', items: ['ÍµêÏã§ Ï≤≠ÏÜå Î∞è ÌôòÍ∏∞', 'ÌïôÏÉù Ï∂úÍ≤∞ ÌôïÏù∏', 'Ïò§ÎäòÏùò ÏàòÏóÖ ÏûêÎ£å Ï§ÄÎπÑ', 'ÌïôÎ∂ÄÎ™® Î¨∏Ïùò ÎãµÎ≥Ä']},
                    {title: 'ÏàòÏóÖ Ï§ë', items: ['ÌïôÏÉù ÏßëÏ§ëÎèÑ Ï≤¥ÌÅ¨', 'ÏàôÏ†ú Í≤ÄÏÇ¨', 'Ïù¥Ìï¥ÎèÑ ÌôïÏù∏', 'Î≥¥Ï∂© ÌïÑÏöî ÌïôÏÉù ÌååÏïÖ']},
                    {title: 'ÏàòÏóÖ ÌõÑ', items: ['Ïò§ÎäòÏùò ÏßÑÎèÑ Í∏∞Î°ù', 'ÌïôÎ∂ÄÎ™® ÏÉÅÎã¥ ÏòàÏïΩ', 'Îã§Ïùå ÏàòÏóÖ Ï§ÄÎπÑ', 'ÏãúÏÑ§ Ï†êÍ≤Ä']}
                ].map(section => `
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h2 class="text-xl font-bold text-purple-600 mb-4">
                            <i class="fas fa-clock mr-2"></i>${section.title}
                        </h2>
                        <div class="space-y-3">
                            ${section.items.map((item, i) => `
                                <label class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer">
                                    <input type="checkbox" class="w-5 h-5 text-purple-600 rounded">
                                    <span class="text-gray-900">${item}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>

            <div class="mt-8 text-center">
                <button onclick="resetAll()" class="px-8 py-3 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300">
                    Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî
                </button>
            </div>
        </div>

        <script>
            function resetAll() {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
        </script>
    </body>
    </html>
  `)
})

// 10. ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏ ÌîåÎûòÎÑà
app.get('/tools/campaign-planner', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏ ÌîåÎûòÎÑà - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/tools" class="text-gray-600 hover:text-purple-600">‚Üê Ìà¥ Î™©Î°ù</a>
                </div>
            </div>
        </nav>

        <div class="max-w-5xl mx-auto px-6 py-12">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-calendar-alt text-purple-600 mr-3"></i>ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏ ÌîåÎûòÎÑà
            </h1>
            <p class="text-xl text-gray-600 mb-8">ÏõîÎ≥Ñ ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏ÏùÑ Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í≥ÑÌöçÌïòÏÑ∏Ïöî</p>

            <div class="bg-white rounded-2xl p-8 shadow-sm mb-8">
                <h2 class="text-2xl font-bold mb-6">2025ÎÖÑ Ïó∞Í∞Ñ Ï∫†ÌéòÏù∏ Í≥ÑÌöç</h2>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${[
                        {month: '1Ïõî', campaign: 'Í≤®Ïö∏Î∞©Ìïô ÌäπÍ∞ï', status: 'active'},
                        {month: '2Ïõî', campaign: 'Ïã†ÌïôÍ∏∞ Ï§ÄÎπÑÎ∞ò', status: 'planning'},
                        {month: '3Ïõî', campaign: 'Î¥Ñ Ïã†Í∑ú Îì±Î°ù Ïù¥Î≤§Ìä∏', status: 'upcoming'},
                        {month: '4Ïõî', campaign: 'Ï§ëÍ∞ÑÍ≥†ÏÇ¨ ÎåÄÎπÑÎ∞ò', status: 'upcoming'},
                        {month: '7Ïõî', campaign: 'Ïó¨Î¶ÑÎ∞©Ìïô Ï∫†ÌîÑ', status: 'upcoming'},
                        {month: '12Ïõî', campaign: 'Ïó∞Îßê Í≤∞ÏÇ∞ Ïù¥Î≤§Ìä∏', status: 'upcoming'}
                    ].map(item => `
                        <div class="p-6 border-2 ${item.status === 'active' ? 'border-purple-500 bg-purple-50' : 'border-gray-200'} rounded-xl">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-bold text-lg">${item.month}</h3>
                                <span class="px-2 py-1 text-xs rounded-full ${
                                    item.status === 'active' ? 'bg-purple-200 text-purple-700' : 
                                    item.status === 'planning' ? 'bg-blue-200 text-blue-700' : 
                                    'bg-gray-200 text-gray-700'
                                }">
                                    ${item.status === 'active' ? 'ÏßÑÌñâÏ§ë' : item.status === 'planning' ? 'Ï§ÄÎπÑÏ§ë' : 'ÏòàÏ†ï'}
                                </span>
                            </div>
                            <p class="text-gray-700">${item.campaign}</p>
                            <button onclick="alert('Ï∫†ÌéòÏù∏ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ')" 
                                    class="mt-4 w-full py-2 text-sm text-purple-600 border border-purple-300 rounded-lg hover:bg-purple-50">
                                ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                            </button>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-8">
                <h3 class="text-xl font-bold mb-4">üí° Ìö®Í≥ºÏ†ÅÏù∏ Ï∫†ÌéòÏù∏ Ï†ÑÎûµ</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div>
                        <h4 class="font-bold text-purple-600 mb-2">ÌÉÄÏù¥Î∞ç</h4>
                        <p class="text-sm text-gray-700">Î∞©Ìïô 2Ï£º Ï†ÑÎ∂ÄÌÑ∞ ÌôçÎ≥¥ ÏãúÏûë</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-purple-600 mb-2">Ï±ÑÎÑê</h4>
                        <p class="text-sm text-gray-700">ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§, Î∏îÎ°úÍ∑∏, Î¨∏Ïûê</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-purple-600 mb-2">ÌòúÌÉù</h4>
                        <p class="text-sm text-gray-700">Ï°∞Í∏∞ Îì±Î°ù Ìï†Ïù∏ + ÏÇ¨ÏùÄÌíà</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// Ìà¥ Î©îÏù∏ ÌéòÏù¥ÏßÄ (Î™©Î°ù)
app.get('/tools', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎßàÏºÄÌåÖ Ìà¥ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .tool-card { transition: all 0.3s; }
            .tool-card:hover { transform: translateY(-4px); }
        </style>
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a>
                    <a href="/" class="text-gray-600 hover:text-purple-600">‚Üê ÌôàÏúºÎ°ú</a>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-gray-900 mb-4">ÎßàÏºÄÌåÖ Ìà¥</h1>
                <p class="text-xl text-gray-600">ÌïôÏõê ÎßàÏºÄÌåÖÏóê ÌïÑÏöîÌïú Î™®Îì† ÎèÑÍµ¨Î•º Ìïú Í≥≥ÏóêÏÑú</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${[
                    {url: '/tools/landing-builder', icon: 'rocket', title: 'ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞', desc: 'ÌïôÏõê ÎßûÏ∂§ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†úÏûë', color: 'purple'},
                    {url: '/tools/place-keyword-analyzer', icon: 'search', title: 'ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞', desc: 'ÏµúÏ†ÅÏùò ÌÇ§ÏõåÎìúÎ°ú ÏÉÅÏúÑ ÎÖ∏Ï∂ú', color: 'blue'},
                    {url: '/tools/blog-title-generator', icon: 'lightbulb', title: 'Î∏îÎ°úÍ∑∏ Ï†úÎ™© ÏÉùÏÑ±Í∏∞', desc: 'ÌÅ¥Î¶≠Î•† ÎÜíÏùÄ Ï†úÎ™© ÏûêÎèô ÏÉùÏÑ±', color: 'orange'},
                    {url: '/tools/consultation-calendar', icon: 'calendar-check', title: 'ÏÉÅÎã¥ ÏòàÏïΩ Ï∫òÎ¶∞Îçî', desc: 'Í∞ÑÌé∏Ìïú ÏÉÅÎã¥ ÏòàÏïΩ ÏãúÏä§ÌÖú', color: 'green'},
                    {url: '/tools/promo-generator', icon: 'bullhorn', title: 'ÌïôÏõê ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞', desc: 'Ìö®Í≥ºÏ†ÅÏù∏ ÌôçÎ≥¥ Î¨∏Íµ¨ ÏÉùÏÑ±', color: 'cyan'},
                    {url: '/tools/review-template', icon: 'comment-dots', title: 'Î¶¨Î∑∞ ÎãµÎ≥Ä ÌÖúÌîåÎ¶ø', desc: 'Ï¶âÏãú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÎãµÎ≥Ä', color: 'pink'},
                    {url: '/tools/parent-sms-template', icon: 'sms', title: 'ÌïôÎ∂ÄÎ™® Î¨∏Ïûê ÌÖúÌîåÎ¶ø', desc: 'ÏÉÅÌô©Î≥Ñ Î¨∏Ïûê Î©îÏãúÏßÄ', color: 'indigo'},
                    {url: '/tools/poster-generator', icon: 'image', title: 'Ìè¨Ïä§ÌÑ∞ Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞', desc: 'ÎààÏóê ÎùÑÎäî Ìè¨Ïä§ÌÑ∞ Ï†úÏûë', color: 'red'},
                    {url: '/tools/competitor-analysis', icon: 'chart-bar', title: 'Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù ÎèÑÍµ¨', desc: 'Ï£ºÎ≥Ä ÌïôÏõê Ï†ïÎ≥¥ Î∂ÑÏÑù', color: 'teal'},
                    {url: '/tools/operation-checklist', icon: 'tasks', title: 'ÌïôÏõê Ïö¥ÏòÅ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', desc: 'ÌïÑÏàò ÏóÖÎ¨¥ Í¥ÄÎ¶¨', color: 'yellow'},
                    {url: '/tools/campaign-planner', icon: 'calendar-alt', title: 'ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏ ÌîåÎûòÎÑà', desc: 'Ïó∞Í∞Ñ Ï∫†ÌéòÏù∏ Í≥ÑÌöç', color: 'emerald'}
                ].map(tool => `
                    <a href="${tool.url}" class="tool-card block bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-${tool.color}-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-${tool.icon} text-${tool.color}-600 text-xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-gray-900 mb-2">${tool.title}</h3>
                                <p class="text-sm text-gray-600">${tool.desc}</p>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </a>
                `).join('')}
            </div>

            <div class="mt-12 text-center">
                <div class="inline-block bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">
                        <i class="fas fa-rocket text-purple-600 mr-2"></i>
                        Îçî ÎßéÏùÄ Í∏∞Îä•Ïù¥ Í≥ÑÏÜç Ï∂îÍ∞ÄÎê©ÎãàÎã§!
                    </h3>
                    <p class="text-gray-600 mb-6">ÌïôÏõê Ïö¥ÏòÅÏóê ÌïÑÏöîÌïú Ìà¥Ïù¥ ÏûàÎã§Î©¥ Ï†úÏïàÌï¥Ï£ºÏÑ∏Ïöî</p>
                    <a href="/contact" class="inline-block gradient-purple text-white px-8 py-4 rounded-xl font-bold hover:shadow-lg">
                        Í∏∞Îä• Ï†úÏïàÌïòÍ∏∞
                    </a>
                </div>
            </div>
        </div>
    </body>
    </html>
  `)
})

// ============================================
// Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ
// ============================================

// Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú
app.get('/admin', async (c) => {
  const { env } = c
  
  // ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå
  const totalUsers = await env.DB.prepare('SELECT COUNT(*) as count FROM users').first()
  const totalContacts = await env.DB.prepare('SELECT COUNT(*) as count FROM contacts').first()
  const pendingContacts = await env.DB.prepare('SELECT COUNT(*) as count FROM contacts WHERE status = ?').bind('pending').first()
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .card-hover { transition: all 0.3s ease; }
            .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Ìó§Îçî -->
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin" class="text-purple-600 font-medium">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/deposits" class="text-gray-600 hover:text-purple-600">ÏûÖÍ∏à Ïã†Ï≤≠</a>
                            <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</h1>
                <p class="text-gray-600">ÏãúÏä§ÌÖú Ï†ÑÏ≤¥ ÌòÑÌô©ÏùÑ ÌïúÎààÏóê ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
            </div>

            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <!-- Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê -->
                <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                        <span class="text-sm text-gray-500">Ï†ÑÏ≤¥</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-1">${totalUsers?.count || 0}</div>
                    <div class="text-sm text-gray-600">Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê</div>
                </div>

                <!-- Ï†ÑÏ≤¥ Î¨∏Ïùò -->
                <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-envelope text-white text-xl"></i>
                        </div>
                        <span class="text-sm text-gray-500">Ï†ÑÏ≤¥</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-1">${totalContacts?.count || 0}</div>
                    <div class="text-sm text-gray-600">Ï†ÑÏ≤¥ Î¨∏Ïùò</div>
                </div>

                <!-- ÎåÄÍ∏∞Ï§ë Î¨∏Ïùò -->
                <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-white text-xl"></i>
                        </div>
                        <span class="text-sm text-orange-500">Ï≤òÎ¶¨ ÌïÑÏöî</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900 mb-1">${pendingContacts?.count || 0}</div>
                    <div class="text-sm text-gray-600">ÎåÄÍ∏∞Ï§ë Î¨∏Ïùò</div>
                </div>
            </div>

            <!-- Îπ†Î•∏ Î©îÎâ¥ -->
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 mb-6">Îπ†Î•∏ Î©îÎâ¥</h2>
                <div class="grid md:grid-cols-4 gap-4">
                    <a href="/admin/users" class="flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:border-purple-300 hover:bg-purple-50 transition">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-900">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</div>
                            <div class="text-sm text-gray-600">ÌöåÏõê Î™©Î°ù Î∞è Í¥ÄÎ¶¨</div>
                        </div>
                    </a>

                    <a href="/admin/contacts" class="flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition">
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-envelope text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-900">Î¨∏Ïùò Í¥ÄÎ¶¨</div>
                            <div class="text-sm text-gray-600">ÎåÄÌñâ Î¨∏Ïùò ÌôïÏù∏</div>
                        </div>
                    </a>

                    <a href="/admin/programs" class="flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:border-green-300 hover:bg-green-50 transition">
                        <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-900">ÌîÑÎ°úÍ∑∏Îû® Í¥ÄÎ¶¨</div>
                            <div class="text-sm text-gray-600">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Í¥ÄÎ¶¨</div>
                        </div>
                    </a>
                    
                    <button onclick="runMigration()" class="flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:border-red-300 hover:bg-red-50 transition text-left">
                        <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-database text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-900">DB ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò</div>
                            <div class="text-sm text-gray-600">Í∂åÌïú ÌÖåÏù¥Î∏î Ï¥àÍ∏∞Ìôî</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <script>
            async function runMigration() {
                if (!confirm('‚ö†Ô∏è Í∂åÌïú ÌÖåÏù¥Î∏îÏùÑ Ïû¨ÏÉùÏÑ±ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÍ∏∞Ï°¥ Í∂åÌïú Îç∞Ïù¥ÌÑ∞Îäî Î∞±ÏóÖÎêòÏßÄÎßå, Î™®Îì† ÏÇ¨Ïö©ÏûêÏùò Í∂åÌïúÏù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.')) {
                    return;
                }
                
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (!user.id) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                try {
                    const response = await fetch('/api/admin/run-migration', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ adminId: user.id })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert('‚úÖ ' + data.message + '\n\nÏù¥Ï†ú Í∂åÌïú ÏãúÏä§ÌÖúÏùÑ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                        location.reload();
                    } else {
                        alert('‚ùå Ïò§Î•ò: ' + data.error);
                    }
                } catch (err) {
                    alert('‚ùå ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
                }
            }
            
            function logout() {
                if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            }
        </script>
    </body>
    </html>
  `)
})

// ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/admin/users', async (c) => {
  const { env } = c
  
  // ÏÇ¨Ïö©Ïûê Î™©Î°ù Ï°∞Ìöå (Ìè¨Ïù∏Ìä∏ Ìè¨Ìï®)
  const users = await env.DB.prepare('SELECT id, email, name, phone, academy_name, role, points, created_at FROM users ORDER BY created_at DESC').all()
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <script src="/static/admin-users.js" defer></script>
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Ìó§Îçî -->
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-full mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/admin" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-purple-600 font-medium">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-full mx-auto px-6 py-8">
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h1>
                        <p class="text-gray-600">Ï†ÑÏ≤¥ <span id="totalUsers">${users?.results?.length || 0}</span>Î™ÖÏùò ÏÇ¨Ïö©Ïûê (<span id="filteredUsers">${users?.results?.length || 0}</span>Î™Ö ÌëúÏãú)</p>
                    </div>
                </div>
                
                <!-- Í≤ÄÏÉâ Î∞î -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                    <div class="flex gap-4 items-center">
                        <div class="flex-1">
                            <input type="text" id="searchInput" placeholder="üîç Ïù¥Î¶Ñ, Ïù¥Î©îÏùº, Ï†ÑÌôîÎ≤àÌò∏, ÌïôÏõêÎ™ÖÏúºÎ°ú Í≤ÄÏÉâ..." 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                onkeyup="filterUsers()">
                        </div>
                        <button onclick="clearSearch()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                            Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                </div>
            </div>

            <!-- ÏÇ¨Ïö©Ïûê Î™©Î°ù ÌÖåÏù¥Î∏î -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ïù¥Î©îÏùº</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ïù¥Î¶Ñ</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ï†ÑÌôîÎ≤àÌò∏</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÌïôÏõêÎ™Ö</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ìè¨Ïù∏Ìä∏</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Í∂åÌïú</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Í∞ÄÏûÖÏùº</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${users?.results?.map(user => {
                                // data ÏÜçÏÑ±ÏúºÎ°ú Ï†ÑÎã¨ (HTML ÏïàÏ†Ñ)
                                const userName = (user.name || '').replace(/"/g, '&quot;')
                                return `
                                <tr class="hover:bg-gray-50" data-user="${user.id}">
                                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-900">${user.id}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-900">${user.email}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs font-medium text-gray-900">${user.name}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600">${user.phone || '-'}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600">${user.academy_name || '-'}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs font-medium text-blue-600">${(user.points || 0).toLocaleString()}P</td>
                                    <td class="px-3 py-3 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-700'}">
                                            ${user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÌöåÏõê'}
                                        </span>
                                    </td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600">${new Date(user.created_at).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' })}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-xs">
                                        ${user.role !== 'admin' ? `
                                            <div class="flex gap-1">
                                                <button onclick="changePassword(${user.id}, '${userName}')" class="px-2 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 text-xs" title="ÎπÑÎ∞ÄÎ≤àÌò∏">
                                                    üîë
                                                </button>
                                                <button onclick="givePoints(${user.id}, '${userName}', ${user.points || 0})" class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs" title="Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â">
                                                    üí∞
                                                </button>
                                                <button onclick="deductPoints(${user.id}, '${userName}', ${user.points || 0})" class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs" title="Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê">
                                                    ‚ùå
                                                </button>
                                                <button onclick="loginAs(${user.id}, '${userName}')" class="px-2 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 text-xs" title="Î°úÍ∑∏Ïù∏">
                                                    üë§
                                                </button>
                                                <button onclick="managePermissions(${user.id}, '${userName}')" class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs" title="Í∂åÌïú">
                                                    ‚öôÔ∏è
                                                </button>
                                                <button onclick="manageUsageLimits(${user.id}, '${userName}')" class="px-2 py-1 bg-teal-600 text-white rounded hover:bg-teal-700 text-xs" title="ÏÇ¨Ïö© ÌïúÎèÑ">
                                                    üìä
                                                </button>
                                                <a href="/admin/users/${user.id}" class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-xs inline-block" title="ÏÉÅÏÑ∏">
                                                    üìã
                                                </a>
                                                <button onclick="deleteUser(${user.id}, '${userName}')" class="px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 text-xs" title="ÏÇ≠Ï†ú">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        ` : '-'}
                                    </td>
                                </tr>
                            `}).join('') || '<tr><td colspan="9" class="px-6 py-8 text-center text-gray-500">Îì±Î°ùÎêú ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Í∂åÌïú Í¥ÄÎ¶¨ Î™®Îã¨ -->
        <div id="permissionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">ÌîÑÎ°úÍ∑∏Îû® Í∂åÌïú Í¥ÄÎ¶¨</h2>
                            <p id="modalUserName" class="text-gray-600 mt-1"></p>
                        </div>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Í∂åÌïú ÏÑ§Ï†ï:</strong> Ï≤¥ÌÅ¨Î∞ïÏä§Î•º ÏÑ†ÌÉù/Ìï¥Ï†úÌïòÏó¨ ÏÇ¨Ïö©ÏûêÍ∞Ä ÎåÄÏãúÎ≥¥ÎìúÏóêÏÑú Î≥º Ïàò ÏûàÎäî ÎèÑÍµ¨Î•º Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                    
                    <!-- Í∂åÌïú Î™©Î°ù (Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú JSÏóêÏÑú ÎèôÏ†Å Î†åÎçîÎßÅ) -->
                    <div id="systemPermissions" class="space-y-6">
                        <!-- Í∂åÌïú Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                    </div>
                </div>

                <div class="p-6 border-t border-gray-200 bg-gray-50 sticky bottom-0 flex justify-between items-center">
                    <button onclick="selectAllPermissions()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition text-sm font-medium">
                        Ï†ÑÏ≤¥ ÏÑ†ÌÉù
                    </button>
                    <div class="flex gap-3">
                        <button onclick="closeModal()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Ï∑®ÏÜå
                        </button>
                        <button onclick="savePermissions()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                            Ï†ÄÏû•
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÏÇ¨Ïö© ÌïúÎèÑ Í¥ÄÎ¶¨ Î™®Îã¨ -->
        <div id="usageLimitsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">üìä ÏÇ¨Ïö© ÌïúÎèÑ Í¥ÄÎ¶¨</h2>
                            <p id="usageModalUserName" class="text-gray-600 mt-1"></p>
                        </div>
                        <button onclick="closeUsageLimitsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="usageLimitsContent">
                        <div class="animate-pulse flex space-x-4">
                            <div class="flex-1 space-y-4 py-1">
                                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                                <div class="space-y-2">
                                    <div class="h-4 bg-gray-200 rounded"></div>
                                    <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-6 border-t border-gray-200 bg-gray-50 sticky bottom-0 flex justify-between items-center">
                    <button id="revokePlanBtn" onclick="revokePlan()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium flex items-center gap-2">
                        <i class="fas fa-ban"></i>
                        ÌîåÎûú ÌöåÏàò
                    </button>
                    <div class="flex gap-3">
                        <button onclick="closeUsageLimitsModal()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Ï∑®ÏÜå
                        </button>
                        <button onclick="saveUsageLimits()" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-medium">
                            Ï†ÄÏû•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>
        let currentUsageUserId = null;
        
        // ÏÇ¨Ïö© ÌïúÎèÑ Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
        async function manageUsageLimits(userId, userName) {
            currentUsageUserId = userId;
            document.getElementById('usageModalUserName').textContent = userName + 'ÎãòÏùò ÏÇ¨Ïö© ÌïúÎèÑ';
            document.getElementById('usageLimitsModal').classList.remove('hidden');
            
            try {
                const response = await fetch('/api/admin/usage/' + userId);
                const data = await response.json();
                
                const content = document.getElementById('usageLimitsContent');
                
                if (!data.success || !data.hasSubscription) {
                    // Íµ¨ÎèÖ ÏóÜÏùÑ Îïå - ÏàòÎèôÏúºÎ°ú ÌïúÎèÑ ÏÑ§Ï†ï Í∞ÄÎä•
                    content.innerHTML = '<div class="space-y-6">' +
                        '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">' +
                        '<p class="text-sm text-yellow-800">' +
                        '<i class="fas fa-exclamation-triangle mr-2"></i>' +
                        '<strong>ÏïàÎÇ¥:</strong> ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú ÌïúÎèÑÎ•º ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.' +
                        '</p>' +
                        '</div>' +
                        '<!-- Íµ¨ÎèÖ Í∏∞Í∞Ñ ÏÑ§Ï†ï -->' +
                        '<div class="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-4 mb-4">' +
                        '<div class="flex items-center mb-3">' +
                        '<span class="text-sm font-semibold text-gray-800">üìÖ Íµ¨ÎèÖ Í∏∞Í∞Ñ (Í∞úÏõî)</span>' +
                        '</div>' +
                        '<div>' +
                        '<input type="number" id="subscriptionMonths" value="1" min="1" max="120" placeholder="Ïòà: 3" ' +
                        'class="w-full px-3 py-2 text-sm border-2 border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500">' +
                        '<p class="text-xs text-gray-600 mt-2">üí° ÏÑ§Ï†ïÌïú Í∞úÏõî ÏàòÎßåÌÅº Íµ¨ÎèÖÏù¥ Ïú†ÏßÄÎê©ÎãàÎã§. (Ïòà: 3Í∞úÏõî = Ïò§ÎäòÎ∂ÄÌÑ∞ 3Í∞úÏõî ÌõÑ Ï†ÑÎÇ†ÍπåÏßÄ)</p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">' +
                        '<!-- ÌïôÏÉù Ïàò -->' +
                        '<div class="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">' +
                        '<div class="flex items-center mb-3">' +
                        '<span class="text-sm font-semibold text-gray-800">üë• ÌïôÏÉù Ïàò ÌïúÎèÑ</span>' +
                        '</div>' +
                        '<div>' +
                        '<input type="number" id="studentLimit" value="30" min="0" placeholder="Ïòà: 30" ' +
                        'class="w-full px-3 py-2 text-sm border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500">' +
                        '</div>' +
                        '</div>' +
                        '<!-- AI Î¶¨Ìè¨Ìä∏ -->' +
                        '<div class="border-2 border-green-200 rounded-lg p-4 bg-green-50">' +
                        '<div class="flex items-center mb-3">' +
                        '<span class="text-sm font-semibold text-gray-800">üìä AI Î¶¨Ìè¨Ìä∏ ÌïúÎèÑ</span>' +
                        '</div>' +
                        '<div>' +
                        '<input type="number" id="aiReportLimit" value="30" min="0" placeholder="Ïòà: 30" ' +
                        'class="w-full px-3 py-2 text-sm border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-500">' +
                        '</div>' +
                        '</div>' +
                        '<!-- ÎûúÎî©ÌéòÏù¥ÏßÄ -->' +
                        '<div class="border-2 border-purple-200 rounded-lg p-4 bg-purple-50">' +
                        '<div class="flex items-center mb-3">' +
                        '<span class="text-sm font-semibold text-gray-800">üé® ÎûúÎî©ÌéòÏù¥ÏßÄ ÌïúÎèÑ</span>' +
                        '</div>' +
                        '<div>' +
                        '<input type="number" id="landingPageLimit" value="40" min="0" placeholder="Ïòà: 40" ' +
                        'class="w-full px-3 py-2 text-sm border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">' +
                        '</div>' +
                        '</div>' +
                        '<!-- ÏÑ†ÏÉùÎãò -->' +
                        '<div class="border-2 border-orange-200 rounded-lg p-4 bg-orange-50">' +
                        '<div class="flex items-center mb-3">' +
                        '<span class="text-sm font-semibold text-gray-800">üë®‚Äçüè´ ÏÑ†ÏÉùÎãò ÌïúÎèÑ</span>' +
                        '</div>' +
                        '<div>' +
                        '<input type="number" id="teacherLimit" value="2" min="0" placeholder="Ïòà: 2" ' +
                        'class="w-full px-3 py-2 text-sm border-2 border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500">' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">' +
                        '<p class="text-sm text-blue-800">' +
                        '<i class="fas fa-info-circle mr-2"></i>' +
                        '<strong>ÏïàÎÇ¥:</strong> Íµ¨ÎèÖ ÏóÜÏù¥ÎèÑ ÌïúÎèÑÎ•º ÏÑ§Ï†ïÌïòÎ©¥ Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÍ∞Ä Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.' +
                        '</p>' +
                        '</div>' +
                        '</div>';
                    return;
                }
                
                const sub = data.subscription;
                const use = data.usage;
                
                const studentPercent = Math.min((use.currentStudents / sub.studentLimit) * 100, 100);
                const reportPercent = Math.min((use.aiReportsUsed / sub.aiReportLimit) * 100, 100);
                const landingPercent = Math.min((use.landingPagesCreated / sub.landingPageLimit) * 100, 100);
                const teacherPercent = Math.min((use.currentTeachers / sub.teacherLimit) * 100, 100);
                
                content.innerHTML = '<div class="space-y-6">' +
                    '<!-- ÌîåÎûú Ï†ïÎ≥¥ -->' +
                    '<div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-4 border border-teal-200">' +
                    '<div class="flex justify-between items-start">' +
                    '<div>' +
                    '<h4 class="text-lg font-bold text-gray-900">' + sub.planName + '</h4>' +
                    '<p class="text-sm text-gray-600 mt-1">' + sub.startDate + ' ~ ' + sub.endDate + '</p>' +
                    '</div>' +
                    '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">ÌôúÏÑ±</span>' +
                    '</div>' +
                    '</div>' +
                    '<!-- Íµ¨ÎèÖ Í∏∞Í∞Ñ ÏÑ§Ï†ï -->' +
                    '<div class="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-4">' +
                    '<div class="flex items-center mb-3">' +
                    '<span class="text-sm font-semibold text-gray-800">üìÖ Íµ¨ÎèÖ Í∏∞Í∞Ñ (Í∞úÏõî)</span>' +
                    '</div>' +
                    '<div>' +
                    '<input type="number" id="subscriptionMonths" value="1" min="1" max="120" placeholder="Ïòà: 3" ' +
                    'class="w-full px-3 py-2 text-sm border-2 border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500">' +
                    '<p class="text-xs text-gray-600 mt-2">üí° ÏÑ§Ï†ïÌïú Í∞úÏõî ÏàòÎßåÌÅº Íµ¨ÎèÖÏù¥ Ïú†ÏßÄÎê©ÎãàÎã§. (Ïòà: 3Í∞úÏõî = Ïò§ÎäòÎ∂ÄÌÑ∞ 3Í∞úÏõî ÌõÑ Ï†ÑÎÇ†ÍπåÏßÄ)</p>' +
                    '</div>' +
                    '</div>' +
                    '<!-- ÏÇ¨Ïö©Îüâ & ÌïúÎèÑ Ï°∞Ï†à -->' +
                    '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">' +
                    '<!-- ÌïôÏÉù Ïàò -->' +
                    '<div class="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">' +
                    '<div class="flex items-center justify-between mb-3">' +
                    '<span class="text-sm font-semibold text-gray-800">üë• ÌïôÏÉù Ïàò</span>' +
                    '<span class="text-sm font-bold ' + (use.currentStudents >= sub.studentLimit ? 'text-red-600' : 'text-blue-600') + '">' +
                    use.currentStudents + ' / ' + sub.studentLimit +
                    '</span>' +
                    '</div>' +
                    '<div class="w-full bg-gray-200 rounded-full h-2 mb-3">' +
                    '<div class="bg-blue-600 h-2 rounded-full transition-all" style="width: ' + studentPercent + '%"></div>' +
                    '</div>' +
                    '<div>' +
                    '<label class="text-xs font-medium text-gray-700 mb-1 block">ÌïúÎèÑ ÏÑ§Ï†ï:</label>' +
                    '<input type="number" id="studentLimit" value="' + sub.studentLimit + '" min="0" ' +
                    'class="w-full px-3 py-2 text-sm border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">' +
                    '</div>' +
                    '</div>' +
                    '<!-- AI Î¶¨Ìè¨Ìä∏ -->' +
                    '<div class="border-2 border-green-200 rounded-lg p-4 bg-green-50">' +
                    '<div class="flex items-center justify-between mb-3">' +
                    '<span class="text-sm font-semibold text-gray-800">üìä AI Î¶¨Ìè¨Ìä∏</span>' +
                    '<span class="text-sm font-bold ' + (use.aiReportsUsed >= sub.aiReportLimit ? 'text-red-600' : 'text-green-600') + '">' +
                    use.aiReportsUsed + ' / ' + sub.aiReportLimit +
                    '</span>' +
                    '</div>' +
                    '<div class="w-full bg-gray-200 rounded-full h-2 mb-3">' +
                    '<div class="bg-green-600 h-2 rounded-full transition-all" style="width: ' + reportPercent + '%"></div>' +
                    '</div>' +
                    '<div>' +
                    '<label class="text-xs font-medium text-gray-700 mb-1 block">ÌïúÎèÑ ÏÑ§Ï†ï:</label>' +
                    '<input type="number" id="aiReportLimit" value="' + sub.aiReportLimit + '" min="0" ' +
                    'class="w-full px-3 py-2 text-sm border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">' +
                    '</div>' +
                    '</div>' +
                    '<!-- ÎûúÎî©ÌéòÏù¥ÏßÄ -->' +
                    '<div class="border-2 border-purple-200 rounded-lg p-4 bg-purple-50">' +
                    '<div class="flex items-center justify-between mb-3">' +
                    '<span class="text-sm font-semibold text-gray-800">üé® ÎûúÎî©ÌéòÏù¥ÏßÄ</span>' +
                    '<span class="text-sm font-bold ' + (use.landingPagesCreated >= sub.landingPageLimit ? 'text-red-600' : 'text-purple-600') + '">' +
                    use.landingPagesCreated + ' / ' + sub.landingPageLimit +
                    '</span>' +
                    '</div>' +
                    '<div class="w-full bg-gray-200 rounded-full h-2 mb-3">' +
                    '<div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ' + landingPercent + '%"></div>' +
                    '</div>' +
                    '<div>' +
                    '<label class="text-xs font-medium text-gray-700 mb-1 block">ÌïúÎèÑ ÏÑ§Ï†ï:</label>' +
                    '<input type="number" id="landingPageLimit" value="' + sub.landingPageLimit + '" min="0" ' +
                    'class="w-full px-3 py-2 text-sm border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">' +
                    '</div>' +
                    '</div>' +
                    '<!-- ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï -->' +
                    '<div class="border-2 border-orange-200 rounded-lg p-4 bg-orange-50">' +
                    '<div class="flex items-center justify-between mb-3">' +
                    '<span class="text-sm font-semibold text-gray-800">üë®‚Äçüè´ ÏÑ†ÏÉùÎãò</span>' +
                    '<span class="text-sm font-bold ' + (use.currentTeachers >= sub.teacherLimit ? 'text-red-600' : 'text-orange-600') + '">' +
                    use.currentTeachers + ' / ' + sub.teacherLimit +
                    '</span>' +
                    '</div>' +
                    '<div class="w-full bg-gray-200 rounded-full h-2 mb-3">' +
                    '<div class="bg-orange-600 h-2 rounded-full transition-all" style="width: ' + teacherPercent + '%"></div>' +
                    '</div>' +
                    '<div>' +
                    '<label class="text-xs font-medium text-gray-700 mb-1 block">ÌïúÎèÑ ÏÑ§Ï†ï:</label>' +
                    '<input type="number" id="teacherLimit" value="' + sub.teacherLimit + '" min="0" ' +
                    'class="w-full px-3 py-2 text-sm border-2 border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">' +
                    '<p class="text-sm text-blue-800">' +
                    '<i class="fas fa-info-circle mr-2"></i>' +
                    '<strong>ÏïàÎÇ¥:</strong> ÌïúÎèÑÎ•º Î≥ÄÍ≤ΩÌïòÎ©¥ Ï¶âÏãú Ï†ÅÏö©ÎêòÎ©∞, ÏÇ¨Ïö©ÏûêÎäî ÏÉàÎ°úÏö¥ ÌïúÎèÑÍπåÏßÄ Í∏∞Îä•ÏùÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.' +
                    '</p>' +
                    '</div>' +
                    '</div>';
            } catch (error) {
                console.error('Failed to load usage limits:', error);
                document.getElementById('usageLimitsContent').innerHTML =
                    '<div class="text-center py-12 text-red-500">' +
                    '<div class="text-6xl mb-4">‚ö†Ô∏è</div>' +
                    '<p class="text-lg">Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§</p>' +
                    '<p class="text-sm mt-2">' + error.message + '</p>' +
                    '</div>';
            }
        }
        
        // ÏÇ¨Ïö© ÌïúÎèÑ Ï†ÄÏû•
        async function saveUsageLimits() {
            const studentLimit = parseInt(document.getElementById('studentLimit')?.value);
            const aiReportLimit = parseInt(document.getElementById('aiReportLimit')?.value);
            const landingPageLimit = parseInt(document.getElementById('landingPageLimit')?.value);
            const teacherLimit = parseInt(document.getElementById('teacherLimit')?.value);
            const subscriptionMonths = parseInt(document.getElementById('subscriptionMonths')?.value) || 1;
            
            if (!studentLimit || !aiReportLimit || !landingPageLimit || !teacherLimit) {
                alert('‚ùå Î™®Îì† ÌïúÎèÑÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            if (studentLimit < 0 || aiReportLimit < 0 || landingPageLimit < 0 || teacherLimit < 0) {
                alert('‚ùå ÌïúÎèÑÎäî 0 Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§');
                return;
            }
            
            if (subscriptionMonths < 1 || subscriptionMonths > 120) {
                alert('‚ùå Íµ¨ÎèÖ Í∏∞Í∞ÑÏùÄ 1~120Í∞úÏõî ÏÇ¨Ïù¥Ïó¨Ïïº Ìï©ÎãàÎã§');
                return;
            }
            
            if (confirm('Ï†ïÎßê ÏÇ¨Ïö© ÌïúÎèÑÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\n\\nÍµ¨ÎèÖ Í∏∞Í∞Ñ: ' + subscriptionMonths + 'Í∞úÏõî\\nÌïôÏÉù: ' + studentLimit + '\\nAI Î¶¨Ìè¨Ìä∏: ' + aiReportLimit + '\\nÎûúÎî©ÌéòÏù¥ÏßÄ: ' + landingPageLimit + '\\nÏÑ†ÏÉùÎãò: ' + teacherLimit)) {
                try {
                    const response = await fetch('/api/admin/usage/' + currentUsageUserId + '/update-limits', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            studentLimit,
                            aiReportLimit,
                            landingPageLimit,
                            teacherLimit,
                            subscriptionMonths
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('‚úÖ ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!\\nÍµ¨ÎèÖ Í∏∞Í∞Ñ: ' + subscriptionMonths + 'Í∞úÏõî');
                        closeUsageLimitsModal();
                    } else {
                        alert('‚ùå ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                    }
                } catch (error) {
                    console.error('Update error:', error);
                    alert('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                }
            }
        }
        
        // ÌîåÎûú ÌöåÏàò
        async function revokePlan() {
            if (!currentUsageUserId) {
                alert('‚ùå ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            const userName = document.getElementById('usageModalUserName').textContent.replace('ÎãòÏùò ÏÇ¨Ïö© ÌïúÎèÑ', '');
            
            if (!confirm('‚ö†Ô∏è Ï†ïÎßê ' + userName + 'ÎãòÏùò ÌîåÎûúÏùÑ ÌöåÏàòÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\n\\nÌöåÏàò Ïãú:\\n‚Ä¢ Î™®Îì† Íµ¨ÎèÖÏù¥ ÎßåÎ£å Ï≤òÎ¶¨Îê©ÎãàÎã§\\n‚Ä¢ Î™®Îì† Í∂åÌïúÏù¥ ÎπÑÌôúÏÑ±ÌôîÎê©ÎãàÎã§\\n‚Ä¢ ÎåÄÏãúÎ≥¥Îìú Í∏∞Îä• Ïπ¥ÎìúÍ∞Ä Ïà®Í≤®ÏßëÎãàÎã§\\n\\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                return;
            }
            
            try {
                const response = await fetch('/api/admin/revoke-plan/' + currentUsageUserId, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ ÌîåÎûúÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÌöåÏàòÎêòÏóàÏäµÎãàÎã§!\\n\\n‚Ä¢ ÎßåÎ£åÎêú Íµ¨ÎèÖ: ' + (data.details.subscriptionsExpired || 0) + 'Í∞ú\\n‚Ä¢ ÎπÑÌôúÏÑ±ÌôîÎêú Í∂åÌïú: ' + (data.details.permissionsRevoked || 0) + 'Í∞ú');
                    closeUsageLimitsModal();
                    // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ ÏóÖÎç∞Ïù¥Ìä∏Îêú Ï†ïÎ≥¥ ÌëúÏãú
                    window.location.reload();
                } else {
                    alert('‚ùå ÌöåÏàò Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                console.error('Revoke error:', error);
                alert('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
            }
        }
        
        // ÏÇ¨Ïö© ÌïúÎèÑ Î™®Îã¨ Îã´Í∏∞
        function closeUsageLimitsModal() {
            document.getElementById('usageLimitsModal').classList.add('hidden');
            currentUsageUserId = null;
        }
        
        // ÏÇ¨Ïö©Ïûê Í≤ÄÏÉâ ÌïÑÌÑ∞ÎßÅ
        function filterUsers() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase().trim();
            const rows = document.querySelectorAll('tbody tr[data-user]');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const email = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const name = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const phone = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
                const academy = row.querySelector('td:nth-child(5)').textContent.toLowerCase();
                
                if (email.includes(searchInput) || name.includes(searchInput) || phone.includes(searchInput) || academy.includes(searchInput)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            document.getElementById('filteredUsers').textContent = visibleCount;
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            filterUsers();
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê Ïàò ÏÑ§Ï†ï
        window.addEventListener('DOMContentLoaded', () => {
            const rows = document.querySelectorAll('tbody tr[data-user]');
            document.getElementById('totalUsers').textContent = rows.length;
            document.getElementById('filteredUsers').textContent = rows.length;
        });
    </script>
    </html>
  `)
})

// ÏÇ¨Ïö©Ïûê: ÎÇ¥ ÏûÖÍ∏à ÎÇ¥Ïó≠ ÌéòÏù¥ÏßÄ (v3 - 2026-01-17 12:00 FORCED UPDATE)
app.get('/my-deposits', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎÇ¥ ÏûÖÍ∏à ÎÇ¥Ïó≠ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
            * { font-family: 'Pretendard Variable', sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="mb-8 flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">üí∞ ÎÇ¥ ÏûÖÍ∏à ÎÇ¥Ïó≠</h1>
                    <p class="text-gray-600">Ìè¨Ïù∏Ìä∏ Ï∂©Ï†Ñ Ïã†Ï≤≠ ÎÇ¥Ïó≠ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                </div>
                <a href="/dashboard" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                    <i class="fas fa-arrow-left mr-2"></i> ÎåÄÏãúÎ≥¥Îìú
                </a>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Ïã†Ï≤≠ÏùºÏãú</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Ï∂©Ï†Ñ Ìè¨Ïù∏Ìä∏</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Î∂ÄÍ∞ÄÏÑ∏ (10%)</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Ï¥ù ÏûÖÍ∏àÏï°</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ÏûÖÍ∏àÏûêÎ™Ö</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ÏùÄÌñâ</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">ÏÉÅÌÉú</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Ï≤òÎ¶¨ÏùºÏãú</th>
                            </tr>
                        </thead>
                        <tbody id="depositList" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                    Î°úÎî© Ï§ë...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            async function loadDeposits() {
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user || !user.id) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/';
                    return;
                }

                try {
                    const response = await fetch('/api/deposit/my-requests/' + user.id);
                    const data = await response.json();

                    const depositList = document.getElementById('depositList');
                    
                    if (!data.success || !data.requests || data.requests.length === 0) {
                        depositList.innerHTML = '<tr><td colspan="8" class="px-6 py-12 text-center text-gray-500"><i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i><div>ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</div></td></tr>';
                        return;
                    }

                    depositList.innerHTML = data.requests.map(req => {
                        const createdDate = new Date(req.created_at);
                        const processedDate = req.processed_at ? new Date(req.processed_at) : null;
                        
                        // Î∂ÄÍ∞ÄÏÑ∏ Í≥ÑÏÇ∞ (Ìè¨Ïù∏Ìä∏ Í∏àÏï°Ïùò 10%)
                        const points = parseInt(req.amount) || 0;
                        const vat = Math.round(points * 0.1);
                        const totalAmount = points + vat;

                        let statusBadge = '';
                        if (req.status === 'approved') {
                            statusBadge = '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">‚úì ÏäπÏù∏</span>';
                        } else if (req.status === 'rejected') {
                            statusBadge = '<span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">‚úó Í±∞Ï†à</span>';
                        } else {
                            statusBadge = '<span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium">‚è≥ ÎåÄÍ∏∞Ï§ë</span>';
                        }

                        return '<tr class="hover:bg-gray-50">' +
                            '<td class="px-6 py-4 text-sm text-gray-900">' + createdDate.toLocaleString('ko-KR') + '</td>' +
                            '<td class="px-6 py-4 text-sm font-bold text-blue-600">' + points.toLocaleString() + 'P</td>' +
                            '<td class="px-6 py-4 text-sm text-gray-600">+' + vat.toLocaleString() + 'Ïõê</td>' +
                            '<td class="px-6 py-4 text-sm font-bold text-gray-900">' + totalAmount.toLocaleString() + 'Ïõê</td>' +
                            '<td class="px-6 py-4 text-sm text-gray-700">' + (req.depositor_name || '-') + '</td>' +
                            '<td class="px-6 py-4 text-sm text-gray-600">' + (req.bank_name || '-') + '</td>' +
                            '<td class="px-6 py-4">' + statusBadge + '</td>' +
                            '<td class="px-6 py-4 text-sm text-gray-600">' + (processedDate ? processedDate.toLocaleString('ko-KR') : '-') + '</td>' +
                        '</tr>';
                    }).join('');
                } catch (error) {
                    console.error('ÏûÖÍ∏à ÎÇ¥Ïó≠ Î°úÎìú Ïã§Ìå®:', error);
                    const depositList = document.getElementById('depositList');
                    depositList.innerHTML = '<tr><td colspan="8" class="px-6 py-12 text-center text-red-500"><i class="fas fa-exclamation-circle text-4xl mb-4"></i><div>ÏûÖÍ∏à ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§</div></td></tr>';
                }
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏûêÎèô Ïã§Ìñâ
            window.addEventListener('DOMContentLoaded', loadDeposits);
        </script>
    </body>
    </html>
  `)
})

// ============================================
// ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ API
// ============================================

// ÏÑ†ÏÉùÎãò: Îì±Î°ù Ïã†Ï≤≠ (ÌöåÏõêÍ∞ÄÏûÖ)
app.post('/api/teachers/apply', async (c) => {
  try {
    // DB Ïä§ÌÇ§Îßà ÌôïÏù∏ Î∞è ÏûêÎèô ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
    try {
      await c.env.DB.prepare(`
        ALTER TABLE users ADD COLUMN user_type TEXT DEFAULT 'director'
      `).run()
      console.log('[Migration] user_type column added')
    } catch (e) {
      // Ïª¨ÎüºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ ÏóêÎü¨ Î¨¥Ïãú
    }
    
    try {
      await c.env.DB.prepare(`
        ALTER TABLE users ADD COLUMN parent_user_id INTEGER
      `).run()
      console.log('[Migration] parent_user_id column added')
    } catch (e) {
      // Ïª¨ÎüºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ ÏóêÎü¨ Î¨¥Ïãú
    }
    
    try {
      await c.env.DB.prepare(`
        ALTER TABLE users ADD COLUMN assigned_class TEXT
      `).run()
      console.log('[Migration] assigned_class column added')
    } catch (e) {
      // Ïª¨ÎüºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ ÏóêÎü¨ Î¨¥Ïãú
    }
    
    // teacher_applications ÌÖåÏù¥Î∏î ÏûêÎèô ÏÉùÏÑ±
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS teacher_applications (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          email TEXT NOT NULL,
          password TEXT NOT NULL,
          name TEXT NOT NULL,
          phone TEXT,
          academy_name TEXT NOT NULL,
          director_email TEXT,
          verification_code TEXT,
          status TEXT DEFAULT 'pending',
          applied_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          processed_at DATETIME,
          processed_by INTEGER,
          reject_reason TEXT,
          FOREIGN KEY (processed_by) REFERENCES users(id)
        )
      `).run()
      console.log('[Migration] teacher_applications table created')
    } catch (e) {
      console.log('[Migration] teacher_applications table already exists')
    }
    
    try {
      await c.env.DB.prepare(`
        CREATE INDEX IF NOT EXISTS idx_teacher_applications_status ON teacher_applications(status)
      `).run()
      await c.env.DB.prepare(`
        CREATE INDEX IF NOT EXISTS idx_teacher_applications_email ON teacher_applications(email)
      `).run()
      console.log('[Migration] teacher_applications indexes created')
    } catch (e) {
      // Ïù∏Îç±Ïä§Í∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ ÏóêÎü¨ Î¨¥Ïãú
    }
    
    const { email, password, name, phone, academyName, verificationCode } = await c.req.json()
    
    // ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏
    if (!email || !password || !name || !academyName || !verificationCode) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }
    
    // Ïù∏Ï¶ù ÏΩîÎìú ÌôïÏù∏ (Î®ºÏ†Ä ÌôïÏù∏)
    const codeInfo = await c.env.DB.prepare(`
      SELECT avc.*, u.id as director_id, u.email as director_email, u.name as director_name, u.academy_name
      FROM academy_verification_codes avc
      JOIN users u ON avc.user_id = u.id
      WHERE avc.code = ? AND avc.is_active = 1
    `).bind(verificationCode.toUpperCase()).first()
    
    if (!codeInfo) {
      return c.json({ success: false, error: 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïù∏Ï¶ù ÏΩîÎìúÏûÖÎãàÎã§.' }, 400)
    }
    
    // ÌïôÏõêÎ™ÖÏùÄ ÏõêÏû•ÎãòÏùò academy_name ÏÇ¨Ïö© (ÏûÖÎ†•Í∞í Î¨¥Ïãú)
    // Ïù∏Ï¶ù ÏΩîÎìúÎ°ú Ïù¥ÎØ∏ ÌïôÏõêÏù¥ Í≤ÄÏ¶ùÎêòÏóàÏúºÎØÄÎ°ú ÌïôÏõêÎ™Ö Î∂àÏùºÏπò Ï≤¥ÌÅ¨ Î∂àÌïÑÏöî
    const directorAcademyName = codeInfo.academy_name || academyName
    
    // Ïù¥Î©îÏùº Ï§ëÎ≥µ ÌôïÏù∏ - Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Ï≤òÎ¶¨
    const existingUser = await c.env.DB.prepare(
      'SELECT id, email, name FROM users WHERE email = ?'
    ).bind(email).first()
    
    if (existingUser) {
      // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûàÏúºÎ©¥ ÌïôÏõê Ïó∞Í≤∞ Ïã†Ï≤≠ÏúºÎ°ú Ï≤òÎ¶¨
      console.log('[TeacherApply] Existing user found, creating connection request:', existingUser)
      
      // Ïù¥ÎØ∏ Ïù¥ ÌïôÏõêÏóê Ïã†Ï≤≠ÌñàÎäîÏßÄ ÌôïÏù∏
      const existingApplication = await c.env.DB.prepare(
        'SELECT id, name, phone FROM teacher_applications WHERE email = ? AND director_email = ? AND status = "pending"'
      ).bind(email, codeInfo.director_email).first()
      
      if (existingApplication) {
        // Í∏∞Ï°¥ pending Ïã†Ï≤≠Ïù¥ ÏûàÏúºÎ©¥ Ï†ïÎ≥¥Î•º ÏóÖÎç∞Ïù¥Ìä∏
        console.log('[TeacherApply] Updating existing pending application:', existingApplication.id)
        
        await c.env.DB.prepare(`
          UPDATE teacher_applications 
          SET name = ?, phone = ?, academy_name = ?, verification_code = ?, applied_at = datetime('now')
          WHERE id = ?
        `).bind(
          existingUser.name || name,
          phone || null,
          directorAcademyName,
          verificationCode.toUpperCase(),
          existingApplication.id
        ).run()
        
        return c.json({ 
          success: true, 
          applicationId: existingApplication.id,
          message: `Ïù¥ÎØ∏ Ïã†Ï≤≠ÌïòÏã† ÎÇ¥Ïó≠Ïù¥ ÏûàÏäµÎãàÎã§.\nÏã†Ï≤≠ Ï†ïÎ≥¥Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏúºÎ©∞, ${codeInfo.director_name} ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏäµÎãàÎã§.`,
          directorName: codeInfo.director_name,
          isExistingUser: true,
          updated: true
        })
      }
      
      // ÌïôÏõê Ïó∞Í≤∞ Ïã†Ï≤≠ ÏÉùÏÑ± (ÎπÑÎ∞ÄÎ≤àÌò∏ Î∂àÌïÑÏöî)
      const result = await c.env.DB.prepare(`
        INSERT INTO teacher_applications (
          email, password, name, phone, academy_name, 
          director_email, verification_code, status, applied_at
        )
        VALUES (?, ?, ?, ?, ?, ?, ?, 'pending', datetime('now'))
      `).bind(
        email, 
        'EXISTING_USER', // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏ Î∂àÌïÑÏöî
        existingUser.name || name, 
        phone || null, 
        directorAcademyName,
        codeInfo.director_email,
        verificationCode.toUpperCase()
      ).run()
      
      return c.json({ 
        success: true, 
        applicationId: result.meta.last_row_id,
        message: `Í∏∞Ï°¥ Í≥ÑÏ†ïÏúºÎ°ú ÌïôÏõê Ïó∞Í≤∞ Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.\n${codeInfo.director_name} ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.`,
        directorName: codeInfo.director_name,
        isExistingUser: true
      })
    }
    
    // Ïã†Í∑ú ÏÇ¨Ïö©Ïûê - Ïù¥ ÌïôÏõêÏóê Ïù¥ÎØ∏ Ïã†Ï≤≠ÌñàÎäîÏßÄ ÌôïÏù∏
    const existingApplication = await c.env.DB.prepare(
      'SELECT id FROM teacher_applications WHERE email = ? AND director_email = ? AND status = "pending"'
    ).bind(email, codeInfo.director_email).first()
    
    if (existingApplication) {
      // Í∏∞Ï°¥ pending Ïã†Ï≤≠Ïù¥ ÏûàÏúºÎ©¥ Ï†ïÎ≥¥Î•º ÏóÖÎç∞Ïù¥Ìä∏
      console.log('[TeacherApply] Updating existing pending application for new user:', existingApplication.id)
      
      await c.env.DB.prepare(`
        UPDATE teacher_applications 
        SET name = ?, phone = ?, password = ?, academy_name = ?, verification_code = ?, applied_at = datetime('now')
        WHERE id = ?
      `).bind(
        name,
        phone || null,
        password,
        directorAcademyName,
        verificationCode.toUpperCase(),
        existingApplication.id
      ).run()
      
      return c.json({ 
        success: true, 
        applicationId: existingApplication.id,
        message: `Ïù¥ÎØ∏ Ïã†Ï≤≠ÌïòÏã† ÎÇ¥Ïó≠Ïù¥ ÏûàÏäµÎãàÎã§.\nÏã†Ï≤≠ Ï†ïÎ≥¥Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏúºÎ©∞, ${codeInfo.director_name} ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏäµÎãàÎã§.`,
        directorName: codeInfo.director_name,
        updated: true
      })
    }
    
    // Ïã†Í∑ú ÏÇ¨Ïö©Ïûê - Îì±Î°ù Ïã†Ï≤≠ Ï†ÄÏû•
    const result = await c.env.DB.prepare(`
      INSERT INTO teacher_applications (
        email, password, name, phone, academy_name, 
        director_email, verification_code, status, applied_at
      )
      VALUES (?, ?, ?, ?, ?, ?, ?, 'pending', datetime('now'))
    `).bind(
      email, 
      password, 
      name, 
      phone || null, 
      directorAcademyName,
      codeInfo.director_email,
      verificationCode.toUpperCase()
    ).run()
    
    return c.json({ 
      success: true, 
      applicationId: result.meta.last_row_id,
      message: `Îì±Î°ù Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. ${codeInfo.director_name} ÏõêÏû•ÎãòÏùò ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.`,
      directorName: codeInfo.director_name
    })
  } catch (error) {
    console.error('[TeacherApply] Error:', error)
    console.error('[TeacherApply] Error stack:', error.stack)
    console.error('[TeacherApply] Error message:', error.message)
    return c.json({ 
      success: false, 
      error: 'Îì±Î°ù Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 
      details: error.message,
      stack: error.stack
    }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò Îì±Î°ù Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå
app.get('/api/teachers/applications', async (c) => {
  try {
    const directorId = c.req.query('directorId')
    const status = c.req.query('status') || 'pending'
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏõêÏû•ÎãòÏùò Ïù¥Î©îÏùºÎ°ú Ïã†Ï≤≠Ìïú Î™©Î°ù Ï°∞Ìöå
    const director = await c.env.DB.prepare(
      'SELECT email FROM users WHERE id = ?'
    ).bind(directorId).first()
    
    if (!director) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('[GetApplications] Director:', director.email, 'Status:', status)
    
    const applications = await c.env.DB.prepare(`
      SELECT * FROM teacher_applications
      WHERE director_email = ? AND status = ?
      ORDER BY applied_at DESC
    `).bind(director.email, status).all()
    
    console.log('[GetApplications] Found applications:', applications.results?.length || 0)
    
    return c.json({ 
      success: true, 
      applications: applications.results || [],
      debug: {
        directorEmail: director.email,
        status: status,
        count: applications.results?.length || 0
      }
    })
  } catch (error) {
    console.error('Get applications error:', error)
    return c.json({ success: false, error: 'Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò Îì±Î°ù Ïã†Ï≤≠ ÏäπÏù∏
app.post('/api/teachers/applications/:id/approve', async (c) => {
  try {
    const applicationId = c.req.param('id')
    const { directorId } = await c.req.json()
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // Ïã†Ï≤≠ Ï†ïÎ≥¥ Ï°∞Ìöå
    const application = await c.env.DB.prepare(
      'SELECT * FROM teacher_applications WHERE id = ? AND status = "pending"'
    ).bind(applicationId).first()
    
    if (!application) {
      return c.json({ success: false, error: 'Ïã†Ï≤≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Ïù¥ÎØ∏ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.' }, 404)
    }
    
    // ÏõêÏû•Îãò Ï†ïÎ≥¥ ÌôïÏù∏
    const director = await c.env.DB.prepare(
      'SELECT id, academy_name FROM users WHERE id = ?'
    ).bind(directorId).first()
    
    if (!director) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÏù∏ÏßÄ ÌôïÏù∏
    const existingUser = await c.env.DB.prepare(
      'SELECT id, email, name, user_type, parent_user_id FROM users WHERE email = ?'
    ).bind(application.email).first()
    
    let teacherId
    
    if (existingUser) {
      // Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê - ÌïôÏõê Ïó∞Í≤∞Îßå ÏàòÌñâ (password Í∞íÏóê Í¥ÄÍ≥ÑÏóÜÏù¥)
      console.log('[ApproveTeacher] Existing user found, updating connection:', existingUser)
      
      teacherId = existingUser.id
      
      // parent_user_id ÏóÖÎç∞Ïù¥Ìä∏ (ÌïôÏõê Ïó∞Í≤∞)
      // ‚úÖ roleÍ≥º user_type Î™®Îëê 'teacher'Î°ú ÏÑ§Ï†ï (ÏùºÍ¥ÄÏÑ±)
      await c.env.DB.prepare(`
        UPDATE users 
        SET parent_user_id = ?, academy_name = ?, role = 'teacher'
        WHERE id = ?
      `).bind(directorId, director.academy_name, existingUser.id).run()
      
      console.log('[ApproveTeacher] User connected to academy')
      
    } else {
      // Ïã†Í∑ú ÏÇ¨Ïö©Ïûê - Í≥ÑÏ†ï ÏÉùÏÑ±
      console.log('[ApproveTeacher] New user, creating account')
      
      const userResult = await c.env.DB.prepare(`
        INSERT INTO users (
          email, password, name, phone, role, 
          parent_user_id, academy_name, created_at
        )
        VALUES (?, ?, ?, ?, 'teacher', ?, ?, datetime('now'))
      `).bind(
        application.email,
        application.password,
        application.name,
        application.phone,
        directorId,
        director.academy_name
      ).run()
      
      teacherId = userResult.meta.last_row_id
    }
    
    // Ïã†Ï≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE teacher_applications 
      SET status = 'approved', processed_at = datetime('now'), processed_by = ?
      WHERE id = ?
    `).bind(directorId, applicationId).run()
    
    return c.json({ 
      success: true, 
      teacherId: teacherId,
      message: `${application.name} ÏÑ†ÏÉùÎãòÏùò Îì±Î°ùÏù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§.`
    })
  } catch (error) {
    console.error('[ApproveTeacher] Error:', error)
    console.error('[ApproveTeacher] Error message:', error.message)
    console.error('[ApproveTeacher] Error stack:', error.stack)
    return c.json({ 
      success: false, 
      error: 'ÏäπÏù∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message,
      stack: error.stack
    }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò Îì±Î°ù Ïã†Ï≤≠ Í±∞Î∂Ä
app.post('/api/teachers/applications/:id/reject', async (c) => {
  try {
    const applicationId = c.req.param('id')
    const { directorId, reason } = await c.req.json()
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // Ïã†Ï≤≠ Ï†ïÎ≥¥ Ï°∞Ìöå
    const application = await c.env.DB.prepare(
      'SELECT * FROM teacher_applications WHERE id = ? AND status = "pending"'
    ).bind(applicationId).first()
    
    if (!application) {
      return c.json({ success: false, error: 'Ïã†Ï≤≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÍ±∞ÎÇò Ïù¥ÎØ∏ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.' }, 404)
    }
    
    // Ïã†Ï≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE teacher_applications 
      SET status = 'rejected', processed_at = datetime('now'), 
          processed_by = ?, reject_reason = ?
      WHERE id = ?
    `).bind(directorId, reason || 'ÏõêÏû•ÎãòÏóê ÏùòÌï¥ Í±∞Î∂ÄÎê®', applicationId).run()
    
    return c.json({ 
      success: true, 
      message: `${application.name} ÏÑ†ÏÉùÎãòÏùò Îì±Î°ù Ïã†Ï≤≠Ïù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.`
    })
  } catch (error) {
    console.error('Reject application error:', error)
    return c.json({ success: false, error: 'Í±∞Î∂Ä Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò ÏßÅÏ†ë Ï∂îÍ∞Ä (ÏäπÏù∏ ÏóÜÏù¥ Ï¶âÏãú Í≥ÑÏ†ï ÏÉùÏÑ±)
app.post('/api/teachers/add', async (c) => {
  try {
    // DB Ïä§ÌÇ§Îßà ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò: assigned_class Ïª¨Îüº Ï∂îÍ∞Ä
    try {
      await c.env.DB.prepare(`
        ALTER TABLE users ADD COLUMN assigned_class TEXT
      `).run()
      console.log('[Migration] assigned_class column added to users table')
    } catch (e) {
      // Ïª¨ÎüºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ ÏóêÎü¨ Î¨¥Ïãú
      console.log('[Migration] assigned_class column already exists or migration skipped')
    }
    
    const { name, email, phone, assigned_class, user_id, directorId, password } = await c.req.json()
    
    // user_id ÎòêÎäî directorId Ï§ë ÌïòÎÇòÎäî ÏûàÏñ¥Ïïº Ìï®
    const userId = user_id || directorId
    
    if (!userId || !name || !email) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }
    
    // üî• ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä ÌïúÎèÑ Ï≤¥ÌÅ¨
    // First, get the user's academy_id and ensure it exists
    const directorRecord = await c.env.DB.prepare(`SELECT id, academy_id FROM users WHERE id = ?`).bind(userId).first()
    
    let academyIdToUse = directorRecord?.academy_id
    if (!academyIdToUse) {
      // If user doesn't have academy_id, set it to userId
      academyIdToUse = userId
      try {
        await c.env.DB.prepare(`UPDATE users SET academy_id = ? WHERE id = ?`).bind(academyIdToUse, userId).run()
        console.log('üîß [AddTeacher] Auto-set academy_id for director:', userId)
      } catch (e) {
        console.error('Failed to set academy_id:', e)
      }
    }
    
    const activeSubscription = await c.env.DB.prepare(`
      SELECT id, teacher_limit 
      FROM subscriptions 
      WHERE academy_id = ?
        AND status = 'active' 
        AND subscription_end_date >= date('now')
      ORDER BY created_at DESC 
      LIMIT 1
    `).bind(academyIdToUse).first()
    
    if (!activeSubscription) {
      return c.json({ 
        success: false, 
        error: 'ÌôúÏÑ±ÌôîÎêú Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§. ÌîåÎûúÏùÑ Íµ¨Îß§Ìï¥Ï£ºÏÑ∏Ïöî.' 
      }, 403)
    }
    
    const usage = await c.env.DB.prepare(`
      SELECT current_teachers 
      FROM usage_tracking 
      WHERE subscription_id = ?
    `).bind(activeSubscription.id).first()
    
    const currentTeachers = usage?.current_teachers || 0
    const teacherLimit = activeSubscription.teacher_limit
    
    if (currentTeachers >= teacherLimit) {
      return c.json({ 
        success: false, 
        error: `‚õî ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä Î™®Îëê ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§.\n\nÌòÑÏû¨ ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï Ïàò: ${currentTeachers}Î™Ö / ÌïúÎèÑ: ${teacherLimit}Î™Ö\n\nÎçî ÎßéÏùÄ ÏÑ†ÏÉùÎãòÏùÑ Ï∂îÍ∞ÄÌïòÏãúÎ†§Î©¥ ÏÉÅÏúÑ ÌîåÎûúÏúºÎ°ú ÏóÖÍ∑∏Î†àÏù¥ÎìúÌï¥Ï£ºÏÑ∏Ïöî.` 
      }, 403)
    }
    
    // ÏõêÏû•Îãò Ï†ïÎ≥¥ Ï°∞Ìöå
    const director = await c.env.DB.prepare(
      'SELECT id, academy_name, email FROM users WHERE id = ?'
    ).bind(userId).first()
    
    if (!director) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Ïù¥Î©îÏùº Ï§ëÎ≥µ ÌôïÏù∏
    const existingUser = await c.env.DB.prepare(
      'SELECT id, name, user_type, parent_user_id FROM users WHERE email = ?'
    ).bind(email).first()
    
    let teacherId
    
    if (existingUser) {
      // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûàÏúºÎ©¥ ÌïôÏõê Ïó∞Í≤∞
      console.log('[AddTeacher] Existing user found, connecting to academy:', existingUser)
      
      // Ïù¥ÎØ∏ Ïù¥ ÌïôÏõêÏùò ÏÑ†ÏÉùÎãòÏù∏ÏßÄ ÌôïÏù∏
      if (existingUser.parent_user_id === parseInt(userId)) {
        return c.json({ success: false, error: 'Ïù¥ÎØ∏ Ïù¥ ÌïôÏõêÏùò ÏÑ†ÏÉùÎãòÏûÖÎãàÎã§.' }, 400)
      }
      
      teacherId = existingUser.id
      
      // Í∏∞Ï°¥ ÏÇ¨Ïö©ÏûêÎ•º Ïù¥ ÌïôÏõêÏùò ÏÑ†ÏÉùÎãòÏúºÎ°ú Ïó∞Í≤∞
      await c.env.DB.prepare(`
        UPDATE users 
        SET parent_user_id = ?, academy_name = ?, user_type = 'teacher', assigned_class = ?, updated_at = datetime('now')
        WHERE id = ?
      `).bind(userId, director.academy_name, assigned_class || null, existingUser.id).run()
      
      // üî• ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
      await c.env.DB.prepare(`
        UPDATE usage_tracking 
        SET current_teachers = current_teachers + 1, 
            updated_at = CURRENT_TIMESTAMP
        WHERE subscription_id = ?
      `).bind(activeSubscription.id).run()
      
      console.log('‚úÖ Existing teacher connected and usage incremented:', currentTeachers + 1, '/', teacherLimit)
      
      return c.json({ 
        success: true, 
        teacherId: teacherId,
        message: `${existingUser.name || name} ÏÑ†ÏÉùÎãòÏù¥ Ïù¥ ÌïôÏõêÏóê Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.`,
        isExistingUser: true,
        usage: {
          current: currentTeachers + 1,
          limit: teacherLimit
        }
      })
    }
    
    // Ïã†Í∑ú ÏÇ¨Ïö©Ïûê - ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÏÉùÏÑ± (ÎπÑÎ∞ÄÎ≤àÌò∏Îäî Í∏∞Î≥∏Í∞í ÎòêÎäî Ï†úÍ≥µÎêú Í∞í)
    const defaultPassword = password || 'teacher123' // Í∏∞Î≥∏ ÎπÑÎ∞ÄÎ≤àÌò∏
    const result = await c.env.DB.prepare(`
      INSERT INTO users (
        email, password, name, phone, role, user_type, 
        parent_user_id, academy_name, assigned_class, created_at
      )
      VALUES (?, ?, ?, ?, 'user', 'teacher', ?, ?, ?, datetime('now'))
    `).bind(
      email,
      defaultPassword,
      name,
      phone || null,
      userId,
      director.academy_name,
      assigned_class || null
    ).run()
    
    teacherId = result.meta.last_row_id
    
    // üî• ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
    await c.env.DB.prepare(`
      UPDATE usage_tracking 
      SET current_teachers = current_teachers + 1, 
          updated_at = CURRENT_TIMESTAMP
      WHERE subscription_id = ?
    `).bind(activeSubscription.id).run()
    
    console.log('‚úÖ Teacher added and usage incremented:', currentTeachers + 1, '/', teacherLimit)
    
    return c.json({ 
      success: true, 
      teacherId: teacherId,
      message: `${name} ÏÑ†ÏÉùÎãòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`,
      isExistingUser: false,
      usage: {
        current: currentTeachers + 1,
        limit: teacherLimit
      }
    })
  } catch (error) {
    console.error('Add teacher error:', error)
    return c.json({ 
      success: false, 
      error: 'ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message 
    }, 500)
  }
})

// ÏõêÏû•Îãò: Ïù∏Ï¶ù ÏΩîÎìú ÏÉùÏÑ±/Ï°∞Ìöå
app.get('/api/teachers/verification-code', async (c) => {
  try {
    const directorId = c.req.query('directorId')
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('[VerificationCode] GET request for directorId:', directorId)
    
    // ÌÖåÏù¥Î∏î Ï°¥Ïû¨ ÌôïÏù∏ Î∞è ÏûêÎèô ÏÉùÏÑ±
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS academy_verification_codes (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          user_id INTEGER NOT NULL,
          code TEXT NOT NULL UNIQUE,
          is_active INTEGER DEFAULT 1,
          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          expires_at DATETIME,
          FOREIGN KEY (user_id) REFERENCES users(id)
        )
      `).run()
      
      await c.env.DB.prepare(`
        CREATE INDEX IF NOT EXISTS idx_verification_codes_user ON academy_verification_codes(user_id)
      `).run()
      
      await c.env.DB.prepare(`
        CREATE INDEX IF NOT EXISTS idx_verification_codes_code ON academy_verification_codes(code)
      `).run()
      
      console.log('[VerificationCode] Table and indexes ensured')
    } catch (tableError) {
      console.log('[VerificationCode] Table already exists or creation skipped')
    }
    
    // ÏõêÏû•Îãò Ï†ïÎ≥¥ Î®ºÏ†Ä Ï°∞Ìöå
    const director = await c.env.DB.prepare(
      'SELECT id, academy_name, email FROM users WHERE id = ?'
    ).bind(directorId).first()
    
    if (!director) {
      console.error('[VerificationCode] Director not found:', directorId)
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('[VerificationCode] Director found:', director)
    
    // Í∏∞Ï°¥ ÌôúÏÑ± ÏΩîÎìú Ï°∞Ìöå
    let codeData = null
    try {
      codeData = await c.env.DB.prepare(
        'SELECT * FROM academy_verification_codes WHERE user_id = ? AND is_active = 1 ORDER BY created_at DESC LIMIT 1'
      ).bind(directorId).first()
    } catch (selectError) {
      console.log('[VerificationCode] SELECT error (table might not exist):', selectError)
    }
    
    console.log('[VerificationCode] Existing code:', codeData)
    
    // ÏΩîÎìúÍ∞Ä ÏóÜÍ±∞ÎÇò Ïú†Ìö®ÌïòÏßÄ ÏïäÏúºÎ©¥ ÏÉàÎ°ú ÏÉùÏÑ±
    if (!codeData || (!codeData.code && !codeData.verification_code)) {
      console.log('[VerificationCode] Creating new code for director:', directorId)
      
      // 6ÏûêÎ¶¨ ÎûúÎç§ ÏΩîÎìú ÏÉùÏÑ± (ÏòÅÎ¨∏ ÎåÄÎ¨∏Ïûê + Ïà´Ïûê)
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
      let newCode = ''
      for (let i = 0; i < 6; i++) {
        newCode += chars.charAt(Math.floor(Math.random() * chars.length))
      }
      
      console.log('[VerificationCode] Generated new code:', newCode)
      
      try {
        const result = await c.env.DB.prepare(`
          INSERT INTO academy_verification_codes (user_id, code, is_active, created_at)
          VALUES (?, ?, 1, datetime('now'))
        `).bind(directorId, newCode).run()
        
        console.log('[VerificationCode] Insert result:', result)
        
        codeData = {
          id: result.meta.last_row_id,
          user_id: parseInt(directorId),
          code: newCode,
          is_active: 1,
          created_at: new Date().toISOString()
        }
      } catch (insertError) {
        console.error('[VerificationCode] Insert error:', insertError)
        throw insertError
      }
    }
    
    const responseCode = codeData.code || codeData.verification_code || 'ERROR'
    console.log('[VerificationCode] Final response code:', responseCode)
    
    return c.json({ 
      success: true, 
      code: responseCode,
      codeData: codeData,
      debug: {
        directorId: directorId,
        directorEmail: director.email,
        hasCode: !!codeData,
        codeValue: responseCode
      }
    })
  } catch (error) {
    console.error('[VerificationCode] Error:', error)
    return c.json({ 
      success: false, 
      error: 'Ïù∏Ï¶ù ÏΩîÎìú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 
      details: error.message,
      stack: error.stack
    }, 500)
  }
})

// ÏõêÏû•Îãò: Ïù∏Ï¶ù ÏΩîÎìú Ïû¨ÏÉùÏÑ±
app.post('/api/teachers/verification-code/regenerate', async (c) => {
  try {
    const { directorId } = await c.req.json()
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('[RegenerateCode] POST request for directorId:', directorId)
    
    const director = await c.env.DB.prepare(
      'SELECT id, academy_name, email FROM users WHERE id = ?'
    ).bind(directorId).first()
    
    if (!director) {
      console.error('[RegenerateCode] Director not found:', directorId)
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('[RegenerateCode] Director found:', director)
    
    // Í∏∞Ï°¥ ÏΩîÎìú ÎπÑÌôúÏÑ±Ìôî
    await c.env.DB.prepare(
      'UPDATE academy_verification_codes SET is_active = 0 WHERE user_id = ?'
    ).bind(directorId).run()
    
    // 6ÏûêÎ¶¨ ÎûúÎç§ ÏΩîÎìú ÏÉùÏÑ± (ÏòÅÎ¨∏ ÎåÄÎ¨∏Ïûê + Ïà´Ïûê)
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
    let newCode = ''
    for (let i = 0; i < 6; i++) {
      newCode += chars.charAt(Math.floor(Math.random() * chars.length))
    }
    
    console.log('[RegenerateCode] Generated new code:', newCode)
    
    const result = await c.env.DB.prepare(`
      INSERT INTO academy_verification_codes (user_id, code, is_active, created_at)
      VALUES (?, ?, 1, datetime('now'))
    `).bind(directorId, newCode).run()
    
    console.log('[RegenerateCode] Insert result:', result)
    
    return c.json({ 
      success: true, 
      code: newCode,
      codeData: {
        id: result.meta.last_row_id,
        code: newCode,
        verification_code: newCode,
        user_id: parseInt(directorId),
        is_active: 1,
        created_at: new Date().toISOString()
      },
      message: 'ÏÉàÎ°úÏö¥ Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.',
      debug: {
        directorId: directorId,
        directorEmail: director.email,
        newCode: newCode
      }
    })
  } catch (error) {
    console.error('[RegenerateCode] Error:', error)
    return c.json({ 
      success: false, 
      error: 'Ïù∏Ï¶ù ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 
      details: error.message,
      stack: error.stack
    }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÏÉùÏÑ±
app.post('/api/teachers/create', async (c) => {
  try {
    const { email, password, name, phone, directorId } = await c.req.json()
    
    // ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏
    if (!email || !password || !name || !directorId) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' }, 400)
    }
    
    // ÏõêÏû•Îãò Ï†ïÎ≥¥ ÌôïÏù∏
    const director = await c.env.DB.prepare(
      'SELECT id, academy_name, user_type FROM users WHERE id = ?'
    ).bind(directorId).first()
    
    if (!director) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Ïù¥Î©îÏùº Ï§ëÎ≥µ ÌôïÏù∏
    const existing = await c.env.DB.prepare(
      'SELECT id FROM users WHERE email = ?'
    ).bind(email).first()
    
    if (existing) {
      return c.json({ success: false, error: 'Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î©îÏùºÏûÖÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÏÉùÏÑ±
    const result = await c.env.DB.prepare(`
      INSERT INTO users (email, password, name, phone, role, user_type, parent_user_id, academy_name, created_at)
      VALUES (?, ?, ?, ?, 'user', 'teacher', ?, ?, datetime('now'))
    `).bind(email, password, name, phone || null, directorId, director.academy_name).run()
    
    return c.json({ 
      success: true, 
      teacherId: result.meta.last_row_id,
      message: 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (error) {
    console.error('Create teacher error:', error)
    return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÜåÏÜç ÏÑ†ÏÉùÎãò Î™©Î°ù Ï°∞Ìöå
app.get('/api/teachers/list', async (c) => {
  try {
    const directorId = c.req.query('directorId')
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    const teachers = await c.env.DB.prepare(`
      SELECT id, email, name, phone, created_at
      FROM users 
      WHERE parent_user_id = ? AND user_type = 'teacher'
      ORDER BY created_at DESC
    `).bind(directorId).all()
    
    return c.json({ success: true, teachers: teachers.results || [] })
  } catch (error) {
    console.error('[TeachersList] Error:', error)
    console.error('[TeachersList] Error message:', error.message)
    console.error('[TeachersList] Error stack:', error.stack)
    return c.json({ 
      success: false, 
      error: 'ÏÑ†ÏÉùÎãò Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message
    }, 500)
  }
})

// GET /api/teachers - ÏÑ†ÏÉùÎãò Î™©Î°ù Ï°∞Ìöå (userIdÎ°ú)
app.get('/api/teachers', async (c) => {
  try {
    const userId = c.req.query('userId')
    
    if (!userId) {
      return c.json({ success: false, error: 'userIdÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãò Î™©Î°ù Ï°∞Ìöå (assigned_class Ìè¨Ìï®)
    const teachers = await c.env.DB.prepare(`
      SELECT 
        id, 
        email, 
        name, 
        phone, 
        assigned_class,
        0 as student_count,
        created_at
      FROM users 
      WHERE parent_user_id = ? AND user_type = 'teacher'
      ORDER BY created_at DESC
    `).bind(userId).all()
    
    return c.json({ success: true, teachers: teachers.results || [] })
  } catch (error) {
    console.error('[Teachers] Error:', error)
    return c.json({ 
      success: false, 
      error: 'ÏÑ†ÏÉùÎãò Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message
    }, 500)
  }
})

// POST /api/teachers/:id/assign-class - Î∞ò Î∞∞Ï†ï
app.post('/api/teachers/:id/assign-class', async (c) => {
  try {
    const teacherId = c.req.param('id')
    const { assigned_class } = await c.req.json()
    
    if (!teacherId || !assigned_class) {
      return c.json({ success: false, error: 'ÌïÑÏàò Ï†ïÎ≥¥Í∞Ä ÎàÑÎùΩÎêòÏóàÏäµÎãàÎã§.' }, 400)
    }
    
    // Î∞ò Î∞∞Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
    await c.env.DB.prepare(`
      UPDATE users 
      SET assigned_class = ?
      WHERE id = ? AND user_type = 'teacher'
    `).bind(assigned_class, teacherId).run()
    
    return c.json({ 
      success: true, 
      message: 'Î∞ò Î∞∞Ï†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (error) {
    console.error('[AssignClass] Error:', error)
    return c.json({ 
      success: false, 
      error: 'Î∞ò Î∞∞Ï†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message
    }, 500)
  }
})

// DELETE /api/teachers/:id - ÏÑ†ÏÉùÎãò ÏÇ≠Ï†ú
app.delete('/api/teachers/:id', async (c) => {
  try {
    const teacherId = c.req.param('id')
    
    if (!teacherId) {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãò ÏÇ≠Ï†ú (Ïã§Ï†úÎ°úÎäî parent_user_idÎ•º NULLÎ°ú ÏÑ§Ï†ï)
    await c.env.DB.prepare(`
      UPDATE users 
      SET parent_user_id = NULL, user_type = 'user', assigned_class = NULL
      WHERE id = ? AND user_type = 'teacher'
    `).bind(teacherId).run()
    
    return c.json({ 
      success: true, 
      message: 'ÏÑ†ÏÉùÎãòÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' 
    })
  } catch (error) {
    console.error('[DeleteTeacher] Error:', error)
    return c.json({ 
      success: false, 
      error: 'ÏÑ†ÏÉùÎãò ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message
    }, 500)
  }
})

// ÏÑ†ÏÉùÎãò Í∂åÌïú Ï°∞Ìöå
app.get('/api/teachers/:id/permissions', async (c) => {
  try {
    const teacherId = c.req.param('id')
    const directorId = c.req.query('directorId')
    
    console.log('üîç [GetPermissions] teacherId:', teacherId, 'directorId:', directorId)
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãò Ï†ïÎ≥¥ Ï°∞Ìöå
    const teacher = await c.env.DB.prepare(
      'SELECT id, name, email, user_type, parent_user_id FROM users WHERE id = ?'
    ).bind(teacherId).first()
    
    if (!teacher) {
      console.error('‚ùå [GetPermissions] Teacher not found:', teacherId)
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãòÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('‚úÖ [GetPermissions] Teacher found:', teacher)
    
    // user_typeÏù¥ teacherÏù∏ÏßÄ ÌôïÏù∏
    if (teacher.user_type !== 'teacher') {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏïÑÎãôÎãàÎã§.' }, 400)
    }
    
    // parent_user_idÍ∞Ä directorIdÏôÄ ÏùºÏπòÌïòÎäîÏßÄ ÌôïÏù∏ (ÏûàÎäî Í≤ΩÏö∞Îßå)
    if (teacher.parent_user_id && teacher.parent_user_id !== parseInt(directorId)) {
      console.error('‚ùå [GetPermissions] Permission denied:', teacher.parent_user_id, '!=', directorId)
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    // teacher_permissions ÌÖåÏù¥Î∏îÏóêÏÑú Í∂åÌïú Ï°∞Ìöå
    const rows = await c.env.DB.prepare(
      'SELECT permission_key, permission_value FROM teacher_permissions WHERE teacher_id = ?'
    ).bind(teacherId).all()
    
    console.log('üìã [GetPermissions] Found permission rows:', rows.results?.length || 0)
    
    // Í∏∞Î≥∏ Í∂åÌïú Í∞ùÏ≤¥
    const permissions = {
      canViewAllStudents: false,
      canWriteDailyReports: false,
      assignedClasses: []
    }
    
    // Ï†ÄÏû•Îêú Í∂åÌïú Ï†ÅÏö©
    if (rows.results) {
      for (const row of rows.results) {
        const key = row.permission_key
        const value = row.permission_value
        
        // JSON Î¨∏ÏûêÏó¥Ïù∏ Í≤ΩÏö∞ ÌååÏã±
        if (key === 'assignedClasses' && typeof value === 'string') {
          try {
            permissions[key] = JSON.parse(value)
            console.log('üîÑ [GetPermissions] Parsed JSON:', key, '=', permissions[key])
          } catch (e) {
            console.error('‚ùå [GetPermissions] JSON parse error:', e)
            permissions[key] = []
          }
        } else if (typeof value === 'string' && (value === '1' || value === '0')) {
          permissions[key] = value === '1'
        } else if (typeof value === 'number') {
          permissions[key] = value === 1
        } else {
          permissions[key] = !!value
        }
        
        console.log('‚û°Ô∏è [GetPermissions] Permission:', key, '=', permissions[key])
      }
    }
    
    console.log('‚úÖ [GetPermissions] Final permissions:', permissions)
    
    return c.json({ 
      success: true, 
      teacher: {
        id: teacher.id,
        name: teacher.name,
        email: teacher.email
      },
      permissions
    })
  } catch (error) {
    console.error('‚ùå [GetPermissions] Error:', error)
    console.error('‚ùå [GetPermissions] Stack:', error.stack)
    return c.json({ 
      success: false, 
      error: 'Í∂åÌïú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message
    }, 500)
  }
})

// ÏÑ†ÏÉùÎãò Í∂åÌïú Ï†ÄÏû•
app.post('/api/teachers/:id/permissions', async (c) => {
  try {
    const teacherId = c.req.param('id')
    const { directorId, permissions } = await c.req.json()
    
    console.log('üìù [SaveTeacherPermissions] teacherId:', teacherId, 'directorId:', directorId)
    console.log('üìù [SaveTeacherPermissions] permissions:', permissions)
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãò ÌôïÏù∏
    const teacher = await c.env.DB.prepare(
      'SELECT id, user_type, parent_user_id FROM users WHERE id = ?'
    ).bind(teacherId).first()
    
    if (!teacher) {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãòÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // user_typeÏù¥ teacherÏù∏ÏßÄ ÌôïÏù∏
    if (teacher.user_type !== 'teacher') {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏïÑÎãôÎãàÎã§.' }, 400)
    }
    
    // parent_user_idÍ∞Ä directorIdÏôÄ ÏùºÏπòÌïòÎäîÏßÄ ÌôïÏù∏
    if (teacher.parent_user_id && teacher.parent_user_id !== parseInt(directorId)) {
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    console.log('‚úÖ [SaveTeacherPermissions] Teacher verified:', teacher)
    
    // teacher_permissions ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS teacher_permissions (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          teacher_id INTEGER NOT NULL,
          permission_key TEXT NOT NULL,
          permission_value TEXT,
          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (teacher_id) REFERENCES users(id),
          UNIQUE(teacher_id, permission_key)
        )
      `).run()
      console.log('‚úÖ [SaveTeacherPermissions] Table ensured')
    } catch (tableError) {
      console.error('‚ö†Ô∏è [SaveTeacherPermissions] Table creation warning:', tableError.message)
    }
    
    // Í∏∞Ï°¥ Í∂åÌïú ÏÇ≠Ï†ú
    await c.env.DB.prepare(
      'DELETE FROM teacher_permissions WHERE teacher_id = ?'
    ).bind(teacherId).run()
    
    console.log('üóëÔ∏è [SaveTeacherPermissions] Old permissions deleted')
    
    // ÏÉà Í∂åÌïú ÏÇΩÏûÖ
    if (permissions && typeof permissions === 'object') {
      for (const [key, value] of Object.entries(permissions)) {
        let permissionValue: string | number = value
        
        // Î∞∞Ïó¥Ïù∏ Í≤ΩÏö∞ JSON Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
        if (Array.isArray(value)) {
          permissionValue = JSON.stringify(value)
          console.log('üîÑ [SaveTeacherPermissions] Converting array to JSON:', key, '=', permissionValue)
        } else if (typeof value === 'boolean') {
          permissionValue = value ? 1 : 0
        } else if (typeof value === 'string') {
          permissionValue = value
        } else {
          permissionValue = value ? 1 : 0
        }
        
        await c.env.DB.prepare(`
          INSERT INTO teacher_permissions (teacher_id, permission_key, permission_value, created_at, updated_at)
          VALUES (?, ?, ?, datetime('now'), datetime('now'))
        `).bind(teacherId, key, permissionValue).run()
        
        console.log('‚ûï [SaveTeacherPermissions] Added permission:', key, '=', permissionValue)
      }
    }
    
    console.log('‚úÖ [SaveTeacherPermissions] All permissions saved successfully')
    
    return c.json({ 
      success: true, 
      message: 'Í∂åÌïúÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (error) {
    console.error('‚ùå [SaveTeacherPermissions] Error:', error)
    console.error('‚ùå [SaveTeacherPermissions] Stack:', error.stack)
    return c.json({ 
      success: false, 
      error: 'Í∂åÌïú Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message
    }, 500)
  }
})

// ÏõêÏû•Îãò: Î∞ò ÏÉùÏÑ±
app.post('/api/classes/create', async (c) => {
  try {
    const { name, description, userId, teacherId, gradeLevel, subject, maxStudents } = await c.req.json()
    
    if (!name || !userId) {
      return c.json({ success: false, error: 'Î∞ò Ïù¥Î¶ÑÍ≥º ÏõêÏû•Îãò Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // classes ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
    try {
      await c.env.DB.prepare(`
        CREATE TABLE IF NOT EXISTS classes (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT NOT NULL,
          description TEXT,
          user_id INTEGER NOT NULL,
          teacher_id INTEGER,
          grade_level TEXT,
          subject TEXT,
          max_students INTEGER DEFAULT 20,
          status TEXT DEFAULT 'active',
          created_at TEXT NOT NULL,
          updated_at TEXT,
          FOREIGN KEY (user_id) REFERENCES users(id),
          FOREIGN KEY (teacher_id) REFERENCES users(id)
        )
      `).run()
    } catch (tableError) {
      console.error('Create classes table error:', tableError)
    }
    
    const result = await c.env.DB.prepare(`
      INSERT INTO classes (name, description, user_id, teacher_id, grade_level, subject, max_students, status, created_at)
      VALUES (?, ?, ?, ?, ?, ?, ?, 'active', datetime('now'))
    `).bind(name, description || null, userId, teacherId || null, gradeLevel || null, subject || null, maxStudents || 20).run()
    
    return c.json({ 
      success: true, 
      classId: result.meta.last_row_id,
      message: 'Î∞òÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.'
    })
  } catch (error) {
    console.error('Create class error:', error)
    return c.json({ 
      success: false, 
      error: 'Î∞ò ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
      details: error.message 
    }, 500)
  }
})

// ÏõêÏû•Îãò/ÏÑ†ÏÉùÎãò: Î∞ò Î™©Î°ù Ï°∞Ìöå
app.get('/api/classes/list', async (c) => {
  try {
    const userId = c.req.query('userId')
    const userType = c.req.query('userType')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // classes ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥ Î∞òÌôò
    try {
      let query = ''
      // ÏõêÏû•ÎãòÏùÄ academy_idÎ°ú Î™®Îì† Î∞ò Ï°∞Ìöå (teacher_id Ï†úÍ±∞)
      query = `
        SELECT c.id, c.class_name as name, c.grade as grade_level, c.description, 
               c.created_at,
               (SELECT COUNT(*) FROM students WHERE class_id = c.id AND status = 'active') as student_count
        FROM classes c
        WHERE c.academy_id = ?
        ORDER BY c.created_at DESC
      `
      
      const classes = await c.env.DB.prepare(query).bind(userId).all()
      
      return c.json({ success: true, classes: classes.results || [] })
    } catch (tableError) {
      // ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥ Î∞òÌôò
      if (tableError.message && tableError.message.includes('no such table')) {
        return c.json({ success: true, classes: [] })
      }
      throw tableError
    }
  } catch (error) {
    console.error('[ClassesList] Error:', error)
    console.error('[ClassesList] Error message:', error.message)
    return c.json({ 
      success: true,  // ÏóêÎü¨Ïó¨ÎèÑ ÏÑ±Í≥µÏúºÎ°ú Ï≤òÎ¶¨ÌïòÍ≥† Îπà Î∞∞Ïó¥ Î∞òÌôò
      classes: [],
      warning: 'Î∞ò Î™©Î°ùÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Î∞òÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.',
      debug: error.message
    })
  }
})

// ÏõêÏû•Îãò: Î∞òÏóê ÏÑ†ÏÉùÎãò Î∞∞Ï†ï
app.put('/api/classes/:id/assign-teacher', async (c) => {
  try {
    const classId = c.req.param('id')
    const { teacherId, userId } = await c.req.json()
    
    // ÏõêÏû•Îãò Í∂åÌïú ÌôïÏù∏
    const classInfo = await c.env.DB.prepare(
      'SELECT user_id FROM classes WHERE id = ?'
    ).bind(classId).first()
    
    if (!classInfo || classInfo.user_id !== userId) {
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    // ÏÑ†ÏÉùÎãò Î∞∞Ï†ï
    await c.env.DB.prepare(
      'UPDATE classes SET teacher_id = ?, updated_at = datetime(\'now\') WHERE id = ?'
    ).bind(teacherId, classId).run()
    
    return c.json({ success: true, message: 'ÏÑ†ÏÉùÎãòÏù¥ Î∞∞Ï†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('Assign teacher error:', error)
    return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò Î∞∞Ï†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞ò Î™©Î°ù Ï°∞Ìöå (ÌïôÏÉù Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏö©) - ÏôÑÏ†Ñ Ïû¨ÏûëÏÑ±
app.get('/api/classes', async (c) => {
  console.log('\nüîç [GetClasses] ==========================================')
  console.log('üîç [GetClasses] Request started')
  
  try {
    // Step 1: DB Ïó∞Í≤∞ ÌôïÏù∏
    if (!c.env.DB) {
      console.error('‚ùå [GetClasses] FATAL: DB not available')
      return c.json({ success: false, error: 'DB Ïó∞Í≤∞ Ïã§Ìå®' }, 500)
    }
    console.log('‚úÖ [GetClasses] DB connection OK')
    
    // Step 2: userId Ï∂îÏ∂ú
    let userId = c.req.query('academyId') || c.req.query('userId')
    console.log('üîç [GetClasses] Query params - userId:', userId)
    
    // Step 3: Ìó§ÎçîÏóêÏÑú Ï∂îÏ∂ú ÏãúÎèÑ
    const userHeader = c.req.header('X-User-Data-Base64')
    console.log('üîç [GetClasses] Header present:', !!userHeader)
    
    if (userHeader && !userId) {
      try {
        const decoded = atob(userHeader)
        console.log('üîç [GetClasses] Header decoded (first 100 chars):', decoded.substring(0, 100))
        const userData = JSON.parse(decoded)
        userId = userData.id || userData.academy_id
        console.log('üîç [GetClasses] Extracted from header - userId:', userId)
      } catch (parseErr) {
        console.error('‚ùå [GetClasses] Header parse failed:', parseErr.message)
      }
    }
    
    if (!userId) {
      console.error('‚ùå [GetClasses] No userId found')
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('üîç [GetClasses] Final userId:', userId)
    
    // Step 4: Í∞ÄÏû• Îã®ÏàúÌïú ÏøºÎ¶¨Î°ú ÏãúÏûë - classes ÌÖåÏù¥Î∏îÎßå
    let classes = []
    
    // Try 1: academy_id ÌïÑÎìúÎ°ú Ï°∞Ìöå
    try {
      console.log('üîç [GetClasses] Attempting: SELECT * FROM classes WHERE academy_id =', userId)
      const result1 = await c.env.DB.prepare(
        'SELECT * FROM classes WHERE academy_id = ? ORDER BY id DESC'
      ).bind(userId).all()
      
      classes = result1.results || []
      console.log('‚úÖ [GetClasses] SUCCESS with academy_id! Found', classes.length, 'classes')
      
      if (classes.length > 0) {
        console.log('‚úÖ [GetClasses] First class:', JSON.stringify(classes[0]))
      }
    } catch (err1) {
      console.log('‚ö†Ô∏è  [GetClasses] academy_id failed:', err1.message)
      
      // Try 2: user_id ÌïÑÎìúÎ°ú Ï°∞Ìöå
      try {
        console.log('üîç [GetClasses] Attempting: SELECT * FROM classes WHERE user_id =', userId)
        const result2 = await c.env.DB.prepare(
          'SELECT * FROM classes WHERE user_id = ? ORDER BY id DESC'
        ).bind(userId).all()
        
        classes = result2.results || []
        console.log('‚úÖ [GetClasses] SUCCESS with user_id! Found', classes.length, 'classes')
        
        if (classes.length > 0) {
          console.log('‚úÖ [GetClasses] First class:', JSON.stringify(classes[0]))
        }
      } catch (err2) {
        console.log('‚ö†Ô∏è  [GetClasses] user_id failed:', err2.message)
        
        // Try 3: Î™®Îì† classes Ï°∞Ìöå (ÌïÑÌÑ∞ÎßÅ ÏóÜÏù¥)
        try {
          console.log('üîç [GetClasses] Attempting: SELECT * FROM classes (all)')
          const result3 = await c.env.DB.prepare(
            'SELECT * FROM classes ORDER BY id DESC LIMIT 100'
          ).all()
          
          classes = result3.results || []
          console.log('‚úÖ [GetClasses] Got all classes:', classes.length)
          
          // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ÏóêÏÑú ÌïÑÌÑ∞ÎßÅÌïòÎèÑÎ°ù Î™®Îëê Î∞òÌôò
          if (classes.length > 0) {
            console.log('‚úÖ [GetClasses] First class fields:', Object.keys(classes[0]))
          }
        } catch (err3) {
          console.error('‚ùå [GetClasses] ALL queries failed!')
          console.error('‚ùå [GetClasses] Error 1 (academy_id):', err1.message)
          console.error('‚ùå [GetClasses] Error 2 (user_id):', err2.message)
          console.error('‚ùå [GetClasses] Error 3 (all):', err3.message)
          throw err3
        }
      }
    }
    
    // Step 5: ÌïôÏÉù Ïàò Ï∂îÍ∞Ä (ÏòµÏÖò)
    for (const cls of classes) {
      try {
        const countResult = await c.env.DB.prepare(
          "SELECT COUNT(*) as cnt FROM students WHERE class_id = ? AND status = 'active'"
        ).bind(cls.id).first()
        cls.student_count = countResult?.cnt || 0
      } catch (countErr) {
        console.log('‚ö†Ô∏è  [GetClasses] Student count failed for class', cls.id)
        cls.student_count = 0
      }
    }
    
    console.log('‚úÖ [GetClasses] Returning', classes.length, 'classes with student counts')
    console.log('üîç [GetClasses] ==========================================\n')
    
    return c.json({ 
      success: true, 
      classes,
      debug: {
        userId,
        count: classes.length
      }
    })
    
  } catch (error) {
    console.error('‚ùå [GetClasses] FATAL ERROR:', error)
    console.error('‚ùå [GetClasses] Message:', error.message)
    console.error('‚ùå [GetClasses] Stack:', error.stack)
    console.log('üîç [GetClasses] ==========================================\n')
    
    return c.json({ 
      success: false, 
      error: 'Î∞ò Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®: ' + error.message,
      stack: error.stack
    }, 500)
  }
})

// Î∞ò Ï∂îÍ∞Ä
app.post('/api/classes', async (c) => {
  try {
    let { academyId, userId, className, grade, description, scheduleDays, startTime, endTime } = await c.req.json()
    
    console.log('‚ûï [CreateClass] Received payload:', { academyId, userId, className })
    
    // academyId ÎòêÎäî userId ÏÇ¨Ïö© (Ìò∏ÌôòÏÑ±)
    userId = userId || academyId
    
    // X-User-Data-Base64 Ìó§ÎçîÏóêÏÑú user_id Ï∂îÏ∂ú
    const userHeader = c.req.header('X-User-Data-Base64')
    console.log('‚ûï [CreateClass] Header present:', !!userHeader)
    
    if (userHeader && !userId) {
      try {
        const userData = JSON.parse(decodeURIComponent(escape(atob(userHeader))))
        userId = userData.id
        console.log('‚ûï [CreateClass] Extracted userId from header:', userId)
      } catch (err) {
        console.error('[CreateClass] Failed to parse user header:', err)
      }
    }
    
    console.log('‚ûï [CreateClass] Final userId:', userId)
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    if (!className) {
      return c.json({ success: false, error: 'Î∞ò Ïù¥Î¶ÑÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.' }, 400)
    }
    
    console.log('‚ûï [CreateClass] Creating class for academy_id:', userId, 'name:', className)
    
    // üîß Ïä§ÌÇ§Îßà Ìò∏ÌôòÏÑ±: schedule_days Ïª¨ÎüºÏù¥ ÏóÜÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú try-catch
    let result
    try {
      // schedule_days Ïª¨ÎüºÏù¥ ÏûàÎäî Í≤ΩÏö∞
      result = await c.env.DB.prepare('INSERT INTO classes (academy_id, class_name, grade, description, schedule_days, start_time, end_time, created_at) VALUES (?, ?, ?, ?, ?, ?, ?, datetime(\'now\'))').bind(userId, className, grade || null, description || null, scheduleDays || null, startTime || null, endTime || null).run()
    } catch (err) {
      console.log('‚ö†Ô∏è [CreateClass] schedule_days column not found, trying without it')
      // schedule_days Ïª¨ÎüºÏù¥ ÏóÜÎäî Í≤ΩÏö∞ (Í∏∞Î≥∏ ÌÖåÏù¥Î∏î)
      result = await c.env.DB.prepare('INSERT INTO classes (academy_id, class_name, grade, description, created_at) VALUES (?, ?, ?, ?, datetime(\'now\'))').bind(userId, className, grade || null, description || null).run()
    }
    
    console.log('‚úÖ [CreateClass] Class created with id:', result.meta.last_row_id)
    
    return c.json({ success: true, classId: result.meta.last_row_id, message: 'Î∞òÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('‚ùå [CreateClass] Error:', error)
    console.error('‚ùå [CreateClass] Error stack:', error.stack)
    return c.json({ success: false, error: 'Î∞ò Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', details: error.message }, 500)
  }
})

// Î∞ò ÏàòÏ†ï
app.put('/api/classes/:id', async (c) => {
  try {
    const classId = c.req.param('id')
    const { className, grade, description, scheduleDays, startTime, endTime } = await c.req.json()
    
    console.log('üîß [UpdateClass] Received classId:', classId, 'className:', className)
    
    if (!className) {
      return c.json({ success: false, error: 'Î∞ò Ïù¥Î¶ÑÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.' }, 400)
    }
    
    // Î∞òÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄÎßå ÌôïÏù∏
    const classCheck = await c.env.DB.prepare('SELECT id FROM classes WHERE id = ?').bind(classId).first()
    
    if (!classCheck) {
      return c.json({ success: false, error: 'Î∞òÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Î∞ò ÏàòÏ†ï (academy_id Ï°∞Í±¥ ÏóÜÏù¥)
    let result
    try {
      // schedule_days Ïª¨ÎüºÏù¥ ÏûàÎäî Í≤ΩÏö∞
      result = await c.env.DB.prepare('UPDATE classes SET class_name = ?, grade = ?, description = ?, schedule_days = ?, start_time = ?, end_time = ? WHERE id = ?').bind(className, grade || null, description || null, scheduleDays || null, startTime || null, endTime || null, classId).run()
    } catch (err) {
      console.log('‚ö†Ô∏è [UpdateClass] schedule_days column not found, trying without it')
      // schedule_days Ïª¨ÎüºÏù¥ ÏóÜÎäî Í≤ΩÏö∞
      result = await c.env.DB.prepare('UPDATE classes SET class_name = ?, grade = ?, description = ? WHERE id = ?').bind(className, grade || null, description || null, classId).run()
    }
    
    if (result.meta.changes === 0) {
      return c.json({ success: false, error: 'Î∞ò ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' }, 400)
    }
    
    console.log('‚úÖ [UpdateClass] Class updated successfully')
    return c.json({ success: true, message: 'Î∞òÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('Update class error:', error)
    return c.json({ success: false, error: 'Î∞ò ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Î∞ò ÏÇ≠Ï†ú
app.delete('/api/classes/:id', async (c) => {
  try {
    const classId = c.req.param('id')
    
    console.log('üóëÔ∏è [DeleteClass] ==================== START ====================')
    console.log('üóëÔ∏è [DeleteClass] Deleting class ID:', classId)
    
    if (!classId) {
      console.error('üóëÔ∏è [DeleteClass] ‚ùå No class ID')
      return c.json({ success: false, error: 'Î∞ò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // 1. Î∞òÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
    const classExists = await c.env.DB.prepare(
      'SELECT id, class_name FROM classes WHERE id = ?'
    ).bind(classId).first()
    
    if (!classExists) {
      console.error('üóëÔ∏è [DeleteClass] ‚ùå Class not found')
      return c.json({ success: false, error: 'Î∞òÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('üóëÔ∏è [DeleteClass] Found class:', classExists.class_name)
    
    // 2. ÌïôÏÉùÎì§Ïùò class_id ÏóÖÎç∞Ïù¥Ìä∏ (Îã®Ïùº Í∞íÎßå Ï≤òÎ¶¨)
    try {
      const updateResult = await c.env.DB.prepare(
        'UPDATE students SET class_id = NULL WHERE class_id = ?'
      ).bind(classId).run()
      
      console.log('üóëÔ∏è [DeleteClass] Updated', updateResult.meta.changes, 'students')
    } catch (err) {
      console.error('üóëÔ∏è [DeleteClass] ‚ö†Ô∏è Student update error:', err.message)
      // ÌïôÏÉù ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®Ìï¥ÎèÑ Í≥ÑÏÜç ÏßÑÌñâ
    }
    
    // 3. Î∞ò ÏÇ≠Ï†ú
    try {
      const deleteResult = await c.env.DB.prepare(
        'DELETE FROM classes WHERE id = ?'
      ).bind(classId).run()
      
      console.log('üóëÔ∏è [DeleteClass] Delete changes:', deleteResult.meta.changes)
      
      if (deleteResult.meta.changes === 0) {
        return c.json({ success: false, error: 'Î∞ò ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' }, 400)
      }
      
      console.log('üóëÔ∏è [DeleteClass] ‚úÖ SUCCESS')
      return c.json({ success: true, message: 'Î∞òÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
      
    } catch (err) {
      console.error('üóëÔ∏è [DeleteClass] ‚ùå Delete error:', err)
      return c.json({ 
        success: false, 
        error: 'ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò: ' + err.message 
      }, 500)
    }
    
  } catch (error) {
    console.error('üóëÔ∏è [DeleteClass] ‚ùå Fatal error:', error)
    return c.json({ 
      success: false, 
      error: 'Î∞ò ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message 
    }, 500)
  }
})

// ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù Ï°∞Ìöå
app.get('/api/daily-records', async (c) => {
  try {
    const studentId = c.req.query('studentId')
    const date = c.req.query('date')
    const startDate = c.req.query('startDate')
    const endDate = c.req.query('endDate')
    
    let query = 'SELECT * FROM daily_records WHERE 1=1'
    const params = []
    
    if (studentId) {
      query += ' AND student_id = ?'
      params.push(studentId)
    }
    
    if (date) {
      query += ' AND record_date = ?'
      params.push(date)
    } else if (startDate && endDate) {
      query += ' AND record_date BETWEEN ? AND ?'
      params.push(startDate, endDate)
    }
    
    query += ' ORDER BY record_date DESC, id DESC'
    
    const result = await c.env.DB.prepare(query).bind(...params).all()
    
    return c.json({ success: true, records: result.results || [] })
  } catch (error) {
    console.error('Get daily records error:', error)
    return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù Ï∂îÍ∞Ä
app.post('/api/daily-records', async (c) => {
  try {
    const data = await c.req.json()
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    console.log('üìù [AddDailyRecord] User:', user.id, 'Student:', data.studentId)
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
    const userInfo = await c.env.DB.prepare(
      'SELECT id, user_type FROM users WHERE id = ?'
    ).bind(user.id).first()
    
    console.log('üìù [AddDailyRecord] UserInfo:', userInfo)
    
    // ÏÑ†ÏÉùÎãòÏù∏ Í≤ΩÏö∞ Í∂åÌïú ÌôïÏù∏
    if (userInfo && userInfo.user_type === 'teacher') {
      console.log('üìù [AddDailyRecord] Teacher detected, checking permissions...')
      
      // teacher_permissions ÌÖåÏù¥Î∏îÏóêÏÑú Í∂åÌïú Ï°∞Ìöå
      const permRows = await c.env.DB.prepare(
        'SELECT permission_key, permission_value FROM teacher_permissions WHERE teacher_id = ?'
      ).bind(user.id).all()
      
      let permissions = { canWriteDailyReports: false, canViewAllStudents: false, assignedClasses: [] }
      
      // Í∂åÌïú ÌååÏã±
      if (permRows.results) {
        for (const row of permRows.results) {
          const key = row.permission_key
          const value = row.permission_value
          
          if (key === 'canWriteDailyReports') {
            permissions.canWriteDailyReports = value === '1' || value === 1 || value === true
          } else if (key === 'canViewAllStudents') {
            permissions.canViewAllStudents = value === '1' || value === 1 || value === true
          } else if (key === 'assignedClasses' && typeof value === 'string') {
            try {
              permissions.assignedClasses = JSON.parse(value)
            } catch (e) {
              console.error('üìù [AddDailyRecord] Failed to parse assignedClasses:', e)
            }
          }
        }
      }
      
      console.log('üìù [AddDailyRecord] Parsed permissions:', permissions)
      
      // ÏùºÏùº ÏÑ±Í≥º ÏûëÏÑ± Í∂åÌïúÏù¥ ÏóÜÏúºÎ©¥ Í±∞Î∂Ä
      if (!permissions.canWriteDailyReports) {
        console.log('üìù [AddDailyRecord] No write permission')
        return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º ÏûëÏÑ± Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
      
      // ÌïôÏÉùÏù¥ Î∞∞Ï†ïÎêú Î∞òÏóê ÏÜçÌïòÎäîÏßÄ ÌôïÏù∏
      const student = await c.env.DB.prepare(
        'SELECT class_id FROM students WHERE id = ?'
      ).bind(data.studentId).first()
      
      if (!student) {
        console.log('üìù [AddDailyRecord] Student not found')
        return c.json({ success: false, error: 'ÌïôÏÉùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
      }
      
      console.log('üìù [AddDailyRecord] Student class_id:', student.class_id)
      
      const assignedClasses = permissions.assignedClasses || []
      if (!permissions.canViewAllStudents && !assignedClasses.includes(student.class_id)) {
        console.log('üìù [AddDailyRecord] Class not assigned:', student.class_id, 'Assigned:', assignedClasses)
        return c.json({ success: false, error: 'Ïù¥ ÌïôÏÉùÏùò ÏÑ±Í≥ºÎ•º ÏûëÏÑ±Ìï† Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
      
      console.log('üìù [AddDailyRecord] Permission granted')
    }
    
    const result = await c.env.DB.prepare(`
      INSERT INTO daily_records (
        student_id, course_id, record_date, attendance, homework_status,
        understanding_level, participation_level, achievement, memo, created_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))
    `).bind(
      data.studentId,
      data.courseId || null,
      data.recordDate,
      data.attendance || null,
      data.homeworkStatus || null,
      data.understandingLevel || null,
      data.participationLevel || null,
      data.achievement || null,
      data.memo || null
    ).run()
    
    console.log('‚úÖ [AddDailyRecord] Success, id:', result.meta.last_row_id)
    
    return c.json({ success: true, id: result.meta.last_row_id, message: 'ÏùºÏùº ÏÑ±Í≥ºÍ∞Ä Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('‚ùå [AddDailyRecord] Error:', error)
    console.error('‚ùå [AddDailyRecord] Stack:', error.stack)
    return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù ÏàòÏ†ï
app.put('/api/daily-records/:id', async (c) => {
  try {
    const recordId = c.req.param('id')
    const data = await c.req.json()
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞è Í∂åÌïú Ï°∞Ìöå
    const userInfo = await c.env.DB.prepare(
      'SELECT id, user_type, permissions FROM users WHERE id = ?'
    ).bind(user.id).first()
    
    // ÏÑ†ÏÉùÎãòÏù∏ Í≤ΩÏö∞ Í∂åÌïú ÌôïÏù∏
    if (userInfo && userInfo.user_type === 'teacher') {
      let permissions = { canWriteDailyReports: false, assignedClasses: [] }
      
      if (userInfo.permissions) {
        try {
          permissions = JSON.parse(userInfo.permissions)
        } catch (e) {
          console.error('Failed to parse permissions:', e)
        }
      }
      
      if (!permissions.canWriteDailyReports) {
        return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º ÏàòÏ†ï Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
      
      // Í∏∞Î°ùÏùò ÌïôÏÉùÏù¥ Î∞∞Ï†ïÎêú Î∞òÏóê ÏÜçÌïòÎäîÏßÄ ÌôïÏù∏
      const record = await c.env.DB.prepare(
        'SELECT student_id FROM daily_records WHERE id = ?'
      ).bind(recordId).first()
      
      if (!record) {
        return c.json({ success: false, error: 'Í∏∞Î°ùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
      }
      
      const student = await c.env.DB.prepare(
        'SELECT class_id FROM students WHERE id = ?'
      ).bind(record.student_id).first()
      
      const assignedClasses = permissions.assignedClasses || []
      if (!permissions.canViewAllStudents && !assignedClasses.includes(student.class_id)) {
        return c.json({ success: false, error: 'Ïù¥ ÌïôÏÉùÏùò ÏÑ±Í≥ºÎ•º ÏàòÏ†ïÌï† Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
    }
    
    await c.env.DB.prepare(`
      UPDATE daily_records SET
        course_id = ?,
        record_date = ?,
        attendance = ?,
        homework_status = ?,
        understanding_level = ?,
        participation_level = ?,
        achievement = ?,
        memo = ?
      WHERE id = ?
    `).bind(
      data.courseId || null,
      data.recordDate,
      data.attendance || null,
      data.homeworkStatus || null,
      data.understandingLevel || null,
      data.participationLevel || null,
      data.achievement || null,
      data.memo || null,
      recordId
    ).run()
    
    return c.json({ success: true, message: 'ÏùºÏùº ÏÑ±Í≥ºÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('Update daily record error:', error)
    return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù ÏÇ≠Ï†ú
app.delete('/api/daily-records/:id', async (c) => {
  try {
    const recordId = c.req.param('id')
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞è Í∂åÌïú Ï°∞Ìöå
    const userInfo = await c.env.DB.prepare(
      'SELECT id, user_type, permissions FROM users WHERE id = ?'
    ).bind(user.id).first()
    
    // ÏÑ†ÏÉùÎãòÏù∏ Í≤ΩÏö∞ Í∂åÌïú ÌôïÏù∏
    if (userInfo && userInfo.user_type === 'teacher') {
      let permissions = { canWriteDailyReports: false, assignedClasses: [] }
      
      if (userInfo.permissions) {
        try {
          permissions = JSON.parse(userInfo.permissions)
        } catch (e) {
          console.error('Failed to parse permissions:', e)
        }
      }
      
      if (!permissions.canWriteDailyReports) {
        return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º ÏÇ≠Ï†ú Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
      
      // Í∏∞Î°ùÏùò ÌïôÏÉùÏù¥ Î∞∞Ï†ïÎêú Î∞òÏóê ÏÜçÌïòÎäîÏßÄ ÌôïÏù∏
      const record = await c.env.DB.prepare(
        'SELECT student_id FROM daily_records WHERE id = ?'
      ).bind(recordId).first()
      
      if (!record) {
        return c.json({ success: false, error: 'Í∏∞Î°ùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
      }
      
      const student = await c.env.DB.prepare(
        'SELECT class_id FROM students WHERE id = ?'
      ).bind(record.student_id).first()
      
      const assignedClasses = permissions.assignedClasses || []
      if (!permissions.canViewAllStudents && !assignedClasses.includes(student.class_id)) {
        return c.json({ success: false, error: 'Ïù¥ ÌïôÏÉùÏùò ÏÑ±Í≥ºÎ•º ÏÇ≠Ï†úÌï† Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
      }
    }
    
    await c.env.DB.prepare(`
      DELETE FROM daily_records WHERE id = ?
    `).bind(recordId).run()
    
    return c.json({ success: true, message: 'ÏùºÏùº ÏÑ±Í≥ºÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.' })
  } catch (error) {
    console.error('Delete daily record error:', error)
    return c.json({ success: false, error: 'ÏùºÏùº ÏÑ±Í≥º ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏõêÏû•Îãò: ÏÑ†ÏÉùÎãò Í∂åÌïú Ï°∞Ìöå
app.get('/api/teachers/:id/permissions', async (c) => {
  try {
    const teacherId = c.req.param('id')
    const directorId = c.req.query('directorId')
    
    console.log('üîç [GetTeacherPermissions] teacherId:', teacherId, 'directorId:', directorId)
    
    if (!directorId) {
      return c.json({ success: false, error: 'ÏõêÏû•Îãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    // ÏÑ†ÏÉùÎãòÏù¥ Ìï¥Îãπ ÏõêÏû•Îãò ÏÜåÏÜçÏù∏ÏßÄ ÌôïÏù∏
    const teacher = await c.env.DB.prepare(
      'SELECT id, user_type, parent_user_id FROM users WHERE id = ?'
    ).bind(teacherId).first()
    
    if (!teacher) {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãòÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    console.log('‚úÖ [GetTeacherPermissions] Teacher found:', teacher)
    
    // user_typeÏù¥ teacherÏù∏ÏßÄ ÌôïÏù∏
    if (teacher.user_type !== 'teacher') {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏïÑÎãôÎãàÎã§.' }, 400)
    }
    
    // parent_user_idÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå Í≤ÄÏ¶ù (ÏóÜÏúºÎ©¥ Î™®Îì† ÏõêÏû•ÎãòÏù¥ Ï†ëÍ∑º Í∞ÄÎä•)
    if (teacher.parent_user_id && teacher.parent_user_id !== parseInt(directorId)) {
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }
    
    // Í∂åÌïú Ï°∞Ìöå
    const permissions = await c.env.DB.prepare(
      'SELECT permission_key, permission_value FROM teacher_permissions WHERE teacher_id = ?'
    ).bind(teacherId).all()
    
    console.log('üìã [GetTeacherPermissions] Found', permissions.results?.length || 0, 'permissions')
    
    // Í∂åÌïúÏùÑ Í∞ùÏ≤¥Î°ú Î≥ÄÌôò
    const permissionsMap = {}
    if (permissions.results) {
      permissions.results.forEach(p => {
        const key = p.permission_key
        const value = p.permission_value
        
        // JSON Î¨∏ÏûêÏó¥Ïù∏ Í≤ΩÏö∞ ÌååÏã±
        if (key === 'assignedClasses' && typeof value === 'string') {
          try {
            permissionsMap[key] = JSON.parse(value)
            console.log('  - [JSON]', key, '=', permissionsMap[key])
          } catch (e) {
            console.error('  - [JSON Parse Error]', key, e)
            permissionsMap[key] = []
          }
        } else if (typeof value === 'string' && (value === '1' || value === '0')) {
          permissionsMap[key] = value === '1'
          console.log('  -', key, '=', permissionsMap[key])
        } else if (typeof value === 'number') {
          permissionsMap[key] = value === 1
          console.log('  -', key, '=', permissionsMap[key])
        } else {
          permissionsMap[key] = !!value
          console.log('  -', key, '=', permissionsMap[key])
        }
      })
    }
    
    return c.json({ success: true, permissions: permissionsMap })
  } catch (error) {
    console.error('‚ùå [GetTeacherPermissions] Error:', error)
    return c.json({ success: false, error: 'Í∂åÌïú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏÑ†ÏÉùÎãò: ÎÇ¥ Í∂åÌïú ÌôïÏù∏
app.get('/api/teachers/my-permissions', async (c) => {
  try {
    const teacherId = c.req.query('teacherId')
    
    if (!teacherId) {
      return c.json({ success: false, error: 'ÏÑ†ÏÉùÎãò IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    const permissions = await c.env.DB.prepare(
      'SELECT permission_key, permission_value FROM teacher_permissions WHERE teacher_id = ?'
    ).bind(teacherId).all()
    
    const permissionsMap = {}
    if (permissions.results) {
      permissions.results.forEach(p => {
        const key = p.permission_key
        const value = p.permission_value
        
        // JSON Î¨∏ÏûêÏó¥Ïù∏ Í≤ΩÏö∞ ÌååÏã±
        if (key === 'assignedClasses' && typeof value === 'string') {
          try {
            permissionsMap[key] = JSON.parse(value)
          } catch (e) {
            console.error('JSON Parse Error:', key, e)
            permissionsMap[key] = []
          }
        } else if (typeof value === 'string' && (value === '1' || value === '0')) {
          permissionsMap[key] = value === '1'
        } else if (typeof value === 'number') {
          permissionsMap[key] = value === 1
        } else {
          permissionsMap[key] = !!value
        }
      })
    }
    
    return c.json({ success: true, permissions: permissionsMap })
  } catch (error) {
    console.error('Get my permissions error:', error)
    return c.json({ success: false, error: 'Í∂åÌïú Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå (ÏõêÏû•Îãò/ÏÑ†ÏÉùÎãòÎ≥Ñ Í∂åÌïú)
app.get('/api/students/list', async (c) => {
  try {
    const userId = c.req.query('userId')
    const userType = c.req.query('userType')
    const classId = c.req.query('classId')
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    let query = ''
    let params = []
    
    if (userType === 'teacher') {
      // ÏÑ†ÏÉùÎãòÏùÄ ÏûêÏã†Ïù¥ Îã¥ÎãπÌïòÎäî Î∞òÏùò ÌïôÏÉùÎßå Ï°∞Ìöå
      if (classId) {
        query = `
          SELECT s.*, c.name as class_name
          FROM students s
          LEFT JOIN classes c ON s.class_id = c.id
          WHERE c.teacher_id = ? AND s.class_id = ? AND s.status = 'active' AND s.id NOT IN (4)
          ORDER BY s.name
        `
        params = [userId, classId]
      } else {
        query = `
          SELECT s.*, c.name as class_name
          FROM students s
          LEFT JOIN classes c ON s.class_id = c.id
          WHERE c.teacher_id = ? AND s.status = 'active' AND s.id NOT IN (4)
          ORDER BY c.name, s.name
        `
        params = [userId]
      }
    } else {
      // ÏõêÏû•ÎãòÏùÄ ÏûêÏã†Ïùò ÌïôÏõêÏùò Î™®Îì† ÌïôÏÉù Ï°∞Ìöå
      if (classId) {
        query = `
          SELECT s.*, c.name as class_name, u.name as teacher_name
          FROM students s
          LEFT JOIN classes c ON s.class_id = c.id
          LEFT JOIN users u ON c.teacher_id = u.id
          WHERE s.user_id = ? AND s.class_id = ? AND s.status = 'active'
          ORDER BY s.name
        `
        params = [userId, classId]
      } else {
        query = `
          SELECT s.*, c.name as class_name, u.name as teacher_name
          FROM students s
          LEFT JOIN classes c ON s.class_id = c.id
          LEFT JOIN users u ON c.teacher_id = u.id
          WHERE s.user_id = ? AND s.status = 'active'
          ORDER BY c.name, s.name
        `
        params = [userId]
      }
    }
    
    const students = await c.env.DB.prepare(query).bind(...params).all()
    
    return c.json({ success: true, students: students.results || [] })
  } catch (error) {
    console.error('Get students error:', error)
    return c.json({ success: false, error: 'ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê: ÏÇ¨Ïö©Ïûê ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï°∞Ìöå API
app.get('/api/admin/users/:id/detail', async (c) => {
  try {
    const userId = c.req.param('id')
    
    // ÏÇ¨Ïö©Ïûê Í∏∞Î≥∏ Ï†ïÎ≥¥
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, phone, academy_name, role, points, created_at
      FROM users WHERE id = ?
    `).bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }, 404)
    }
    
    // Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù ÏöîÏ≤≠ ÎÇ¥Ïó≠ (try-catchÎ°ú Í∞êÏã∏Í∏∞)
    let verificationRequests = { results: [] }
    try {
      verificationRequests = await c.env.DB.prepare(`
        SELECT id, phone_number, verification_method, document_url, status, 
               created_at, processed_at, admin_note
        FROM sender_verification_requests
        WHERE user_id = ?
        ORDER BY created_at DESC
      `).bind(userId).all()
    } catch (verError) {
      console.error('Verification requests error (non-critical):', verError)
    }
    
    // Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏ Î™©Î°ù (try-catchÎ°ú Í∞êÏã∏Í∏∞)
    let senderNumbers = { results: [] }
    try {
      senderNumbers = await c.env.DB.prepare(`
        SELECT id, phone_number, verification_method, status, verification_date, created_at
        FROM sender_ids
        WHERE user_id = ?
        ORDER BY created_at DESC
      `).bind(userId).all()
    } catch (senderError) {
      console.error('Sender numbers error (non-critical):', senderError)
    }
    
    // ÎûúÎî©ÌéòÏù¥ÏßÄ Î™©Î°ù (try-catchÎ°ú Í∞êÏã∏Í∏∞)
    let landingPages = { results: [] }
    try {
      landingPages = await c.env.DB.prepare(`
        SELECT id, title, slug, status, view_count, created_at, updated_at
        FROM landing_pages
        WHERE user_id = ?
        ORDER BY created_at DESC
        LIMIT 10
      `).bind(userId).all()
    } catch (lpError) {
      console.error('Landing pages error (non-critical):', lpError)
    }
    
    // Í∂åÌïú Î™©Î°ù (try-catchÎ°ú Í∞êÏã∏Í∏∞)
    let permissions = { results: [] }
    try {
      permissions = await c.env.DB.prepare(`
        SELECT program_key, granted_at, expires_at
        FROM user_permissions
        WHERE user_id = ? AND is_active = 1
        ORDER BY granted_at DESC
      `).bind(userId).all()
    } catch (permError) {
      console.error('Permissions error (non-critical):', permError)
    }
    
    // SMS Î∞úÏÜ° ÌÜµÍ≥Ñ (try-catchÎ°ú Í∞êÏã∏Í∏∞)
    let smsStats = { total_sent: 0, success_count: 0, failed_count: 0 }
    try {
      const stats = await c.env.DB.prepare(`
        SELECT 
          COUNT(*) as total_sent,
          SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success_count,
          SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed_count
        FROM sms_logs
        WHERE user_id = ?
      `).bind(userId).first()
      if (stats) {
        smsStats = stats
      }
    } catch (smsError) {
      console.error('SMS stats error (non-critical):', smsError)
      // Continue with default values
    }
    
    return c.json({
      success: true,
      user,
      verificationRequests: verificationRequests.results || [],
      senderNumbers: senderNumbers.results || [],
      landingPages: landingPages.results || [],
      permissions: permissions.results || [],
      smsStats: smsStats || { total_sent: 0, success_count: 0, failed_count: 0 }
    })
  } catch (err) {
    console.error('Get user detail error:', err)
    return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }, 500)
  }
})

// ÏÇ¨Ïö©Ïûê ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌéòÏù¥ÏßÄ
app.get('/admin/users/:id', async (c) => {
  const { env } = c
  const userId = c.req.param('id')
  
  try {
    // ÏÇ¨Ïö©Ïûê Í∏∞Î≥∏ Ï†ïÎ≥¥ Ï°∞Ìöå
    const user = await env.DB.prepare('SELECT * FROM users WHERE id = ?').bind(userId).first()
    
    if (!user) {
      return c.html('<h1>ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</h1>', 404)
    }
    
    // ÏÇ¨Ïö©Ïûê Í∂åÌïú Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥)
    let permissions = { results: [] }
    try {
      permissions = await env.DB.prepare(
        'SELECT program_key, granted_at FROM user_permissions WHERE user_id = ? AND is_active = 1'
      ).bind(userId).all()
    } catch (e) {
      console.log('user_permissions ÌÖåÏù¥Î∏î ÏóÜÏùå:', e.message)
    }
    
    // ÏÇ¨Ïö©ÏûêÏùò Î¨∏Ïùò ÎÇ¥Ïó≠ Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥)
    let contacts = { results: [] }
    try {
      contacts = await env.DB.prepare(
        'SELECT * FROM contacts WHERE email = ? ORDER BY created_at DESC'
      ).bind(user.email).all()
    } catch (e) {
      console.log('contacts ÌÖåÏù¥Î∏î ÏóÜÏùå:', e.message)
    }
    
    // ÏÇ¨Ïö©ÏûêÏùò ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠ Ï°∞Ìöå (ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥)
    let deposits = { results: [] }
    try {
      deposits = await env.DB.prepare(
        'SELECT * FROM deposits WHERE user_id = ? ORDER BY created_at DESC'
      ).bind(userId).all()
    } catch (e) {
      console.log('deposits ÌÖåÏù¥Î∏î ÏóÜÏùå:', e.message)
    }
    
    // Í∂åÌïúÏùÑ ÏùΩÍ∏∞ Ïâ¨Ïö¥ Ïù¥Î¶ÑÏúºÎ°ú Î≥ÄÌôò
    const permissionNames = {
      'search_volume': 'ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâÎüâ Ï°∞Ìöå',
      'parent_message': 'ÌïôÎ∂ÄÎ™® ÏÜåÌÜµ Î©îÏãúÏßÄ',
      'blog_writer': 'Î∏îÎ°úÍ∑∏ ÏûêÎèô ÏûëÏÑ±',
      'landing_builder': 'ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÉùÏÑ±Í∏∞',
      'sms_sender': 'SMS Î¨∏Ïûê Î∞úÏÜ°',
      'student_management': 'ÌïôÏÉù Í¥ÄÎ¶¨',
      'dashboard_analytics': 'ÌÜµÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú',
      'ai_learning_report': 'AI ÌïôÏäµ Î¶¨Ìè¨Ìä∏',
      'landing_manager': 'ÎûúÎî©ÌéòÏù¥ÏßÄ Í¥ÄÎ¶¨',
      'keyword_analyzer': 'ÌÇ§ÏõåÎìú Î∂ÑÏÑùÍ∏∞',
      'review_template': 'ÌõÑÍ∏∞ ÌÖúÌîåÎ¶ø',
      'ad_copy_generator': 'Í¥ëÍ≥† Î¨∏Íµ¨ ÏÉùÏÑ±Í∏∞',
      'photo_optimizer': 'ÏÇ¨ÏßÑ ÏµúÏ†ÅÌôî',
      'competitor_analysis': 'Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù',
      'blog_checklist': 'Î∏îÎ°úÍ∑∏ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏',
      'content_calendar': 'ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî',
      'consultation_script': 'ÏÉÅÎã¥ Ïä§ÌÅ¨Î¶ΩÌä∏',
      'place_optimization': 'ÌîåÎ†àÏù¥Ïä§ ÏµúÏ†ÅÌôî',
      'roi_calculator': 'ROI Í≥ÑÏÇ∞Í∏∞'
    }
    
    return c.html(`
      <!DOCTYPE html>
      <html lang="ko">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>${user.name} ÏÉÅÏÑ∏ Ï†ïÎ≥¥ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
          <script src="https://cdn.tailwindcss.com"></script>
          <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
          <style>
              .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
              .info-card { transition: all 0.3s ease; }
              .info-card:hover { transform: translateY(-2px); box-shadow: 0 8px 15px -5px rgba(0, 0, 0, 0.1); }
          </style>
      </head>
      <body class="bg-gray-50">
          <!-- Ìó§Îçî -->
          <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
              <div class="max-w-7xl mx-auto px-6 py-4">
                  <div class="flex justify-between items-center">
                      <div class="flex items-center gap-8">
                          <a href="/admin" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                          <div class="flex gap-4">
                              <a href="/admin" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                              <a href="/admin/users" class="text-purple-600 font-medium">ÏÇ¨Ïö©Ïûê</a>
                              <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                          </div>
                      </div>
                      <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                          <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                      </button>
                  </div>
              </div>
          </nav>

          <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
          <div class="max-w-7xl mx-auto px-6 py-8">
              <!-- ÏÉÅÎã®: Îí§Î°úÍ∞ÄÍ∏∞ + ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ -->
              <div class="mb-8">
                  <a href="/admin/users" class="text-purple-600 hover:text-purple-700 font-medium mb-4 inline-flex items-center">
                      <i class="fas fa-arrow-left mr-2"></i> ÏÇ¨Ïö©Ïûê Î™©Î°ùÏúºÎ°ú
                  </a>
                  <h1 class="text-3xl font-bold text-gray-900 mt-4 mb-2">${user.name}ÎãòÏùò ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h1>
                  <p class="text-gray-600">ÏÇ¨Ïö©Ïûê ID: ${user.id} | Ïù¥Î©îÏùº: ${user.email}</p>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  <!-- ÏôºÏ™Ω: Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                  <div class="lg:col-span-1 space-y-6">
                      <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ Ïπ¥Îìú -->
                      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <div class="flex items-center gap-4 mb-6">
                              <div class="w-16 h-16 gradient-purple rounded-full flex items-center justify-center">
                                  <i class="fas fa-user text-white text-2xl"></i>
                              </div>
                              <div>
                                  <h2 class="text-xl font-bold text-gray-900">${user.name}</h2>
                                  <span class="px-3 py-1 text-xs font-medium rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-700'}">
                                      ${user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÏùºÎ∞òÌöåÏõê'}
                                  </span>
                              </div>
                          </div>

                          <div class="space-y-4">
                              <div>
                                  <div class="text-xs text-gray-500 mb-1">üìß Ïù¥Î©îÏùº</div>
                                  <div class="text-sm font-medium text-gray-900">${user.email}</div>
                              </div>
                              <div>
                                  <div class="text-xs text-gray-500 mb-1">üì± Ï†ÑÌôîÎ≤àÌò∏</div>
                                  <div class="text-sm font-medium text-gray-900">${user.phone || '-'}</div>
                              </div>
                              <div>
                                  <div class="text-xs text-gray-500 mb-1">üè´ ÌïôÏõêÎ™Ö</div>
                                  <div class="text-sm font-medium text-gray-900">${user.academy_name || '-'}</div>
                              </div>
                              <div>
                                  <div class="text-xs text-gray-500 mb-1">üí∞ Ìè¨Ïù∏Ìä∏</div>
                                  <div class="text-xl font-bold text-blue-600">${(user.points || 0).toLocaleString()}P</div>
                              </div>
                              <div>
                                  <div class="text-xs text-gray-500 mb-1">üìÖ Í∞ÄÏûÖÏùº</div>
                                  <div class="text-sm font-medium text-gray-900">${new Date(user.created_at).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}</div>
                              </div>
                          </div>
                      </div>

                      <!-- Îπ†Î•∏ Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                      ${user.role !== 'admin' ? `
                      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <h3 class="text-lg font-bold text-gray-900 mb-4">Îπ†Î•∏ Í¥ÄÎ¶¨</h3>
                          <div class="space-y-2">
                              <button onclick="changePassword(${user.id}, '${user.name}')" class="w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition text-sm font-medium text-left">
                                  üîë ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
                              </button>
                              <button onclick="givePoints(${user.id}, '${user.name}', ${user.points || 0})" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-medium text-left">
                                  üí∞ Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â
                              </button>
                              <button onclick="deductPoints(${user.id}, '${user.name}', ${user.points || 0})" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm font-medium text-left">
                                  ‚ùå Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê
                              </button>
                              <button onclick="loginAs(${user.id}, '${user.name}')" class="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm font-medium text-left">
                                  üë§ Ïù¥ ÏÇ¨Ïö©ÏûêÎ°ú Î°úÍ∑∏Ïù∏
                              </button>
                          </div>
                      </div>
                      ` : ''}
                  </div>

                  <!-- Ïò§Î•∏Ï™Ω: ÏÉÅÏÑ∏ Ï†ïÎ≥¥ -->
                  <div class="lg:col-span-2 space-y-6">
                      <!-- Íµ¨ÎèÖ & ÏÇ¨Ïö©Îüâ Ï†ïÎ≥¥ -->
                      <div id="subscriptionInfo" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Íµ¨ÎèÖ & ÏÇ¨Ïö©Îüâ Ï†ïÎ≥¥</h3>
                          <div id="subscriptionContent">
                              <div class="animate-pulse flex space-x-4">
                                  <div class="flex-1 space-y-4 py-1">
                                      <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                                      <div class="space-y-2">
                                          <div class="h-4 bg-gray-200 rounded"></div>
                                          <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- ÌôúÏÑ±ÌôîÎêú Í∂åÌïú -->
                      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <h3 class="text-lg font-bold text-gray-900 mb-4">‚öôÔ∏è ÌôúÏÑ±ÌôîÎêú Í∂åÌïú</h3>
                          <p class="text-gray-500 text-sm">Í∂åÌïú Í¥ÄÎ¶¨Îäî ÏÇ¨Ïö©Ïûê Î™©Î°ù ÌéòÏù¥ÏßÄÏóêÏÑú Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                          <button onclick="window.location.href='/admin/users'" class="mt-4 text-purple-600 hover:text-purple-700 text-sm font-medium">
                              ÏÇ¨Ïö©Ïûê Î™©Î°ùÏúºÎ°ú Ïù¥Îèô ‚Üí
                          </button>
                      </div>

                      <!-- Î¨∏Ïùò ÎÇ¥Ïó≠ -->
                      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <h3 class="text-lg font-bold text-gray-900 mb-4">üìß Î¨∏Ïùò ÎÇ¥Ïó≠</h3>
                          <p class="text-gray-500 text-sm">Î¨∏Ïùò ÎÇ¥Ïó≠ÏùÄ Î¨∏Ïùò Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏóêÏÑú ÌôïÏù∏ Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                          <button onclick="window.location.href='/admin/contacts'" class="mt-4 text-purple-600 hover:text-purple-700 text-sm font-medium">
                              Î¨∏Ïùò Í¥ÄÎ¶¨Î°ú Ïù¥Îèô ‚Üí
                          </button>
                      </div>

                      <!-- Ï∂îÍ∞Ä Ï†ïÎ≥¥ -->
                      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 info-card">
                          <h3 class="text-lg font-bold text-gray-900 mb-4">üìä ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥</h3>
                          <div class="grid grid-cols-2 gap-4">
                              <div class="text-center p-4 bg-blue-50 rounded-lg">
                                  <div class="text-2xl font-bold text-blue-600">${user.email}</div>
                                  <div class="text-xs text-gray-600 mt-1">Ïù¥Î©îÏùº</div>
                              </div>
                              <div class="text-center p-4 bg-green-50 rounded-lg">
                                  <div class="text-2xl font-bold text-green-600">${(user.points || 0).toLocaleString()}</div>
                                  <div class="text-xs text-gray-600 mt-1">Ìè¨Ïù∏Ìä∏</div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <script src="/static/admin-users.js"></script>
          <script>
              const userId = ${user.id};
              
              // Íµ¨ÎèÖ & ÏÇ¨Ïö©Îüâ Ï†ïÎ≥¥ Î°úÎìú
              async function loadSubscriptionInfo() {
                  try {
                      const response = await fetch(\`/api/admin/usage/\${userId}\`);
                      const data = await response.json();
                      
                      const content = document.getElementById('subscriptionContent');
                      
                      if (!data.success || !data.hasSubscription) {
                          content.innerHTML = \`
                              <div class="text-center py-8">
                                  <p class="text-gray-500 mb-4">\${data.message || 'ÌôúÏÑ± Íµ¨ÎèÖÏù¥ ÏóÜÏäµÎãàÎã§'}</p>
                                  <a href="/pricing" class="inline-block px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                      ÌîåÎûú ÏÑ†ÌÉùÌïòÍ∏∞
                                  </a>
                              </div>
                          \`;
                          return;
                      }
                      
                      const { subscription, usage } = data;
                      
                      content.innerHTML = \`
                          <div class="space-y-6">
                              <!-- ÌîåÎûú Ï†ïÎ≥¥ -->
                              <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-4">
                                  <div class="flex justify-between items-start mb-3">
                                      <div>
                                          <h4 class="text-lg font-bold text-gray-900">\${subscription.planName}</h4>
                                          <p class="text-sm text-gray-600 mt-1">
                                              \${subscription.startDate} ~ \${subscription.endDate}
                                          </p>
                                      </div>
                                      <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                                          ÌôúÏÑ±
                                      </span>
                                  </div>
                              </div>
                              
                              <!-- ÏÇ¨Ïö©Îüâ & ÌïúÎèÑ Ï°∞Ï†à -->
                              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                  <!-- ÌïôÏÉù Ïàò -->
                                  <div class="border border-gray-200 rounded-lg p-4">
                                      <div class="flex items-center justify-between mb-2">
                                          <span class="text-sm font-medium text-gray-700">üë• ÌïôÏÉù Ïàò</span>
                                          <span class="text-sm font-bold \${usage.currentStudents >= subscription.studentLimit ? 'text-red-600' : 'text-blue-600'}">
                                              \${usage.currentStudents} / \${subscription.studentLimit}
                                          </span>
                                      </div>
                                      <div class="w-full bg-gray-200 rounded-full h-2">
                                          <div class="bg-blue-600 h-2 rounded-full transition-all" style="width: \${Math.min((usage.currentStudents / subscription.studentLimit) * 100, 100)}%"></div>
                                      </div>
                                      <div class="mt-2">
                                          <label class="text-xs text-gray-500">ÌïúÎèÑ ÏÑ§Ï†ï:</label>
                                          <input type="number" id="studentLimit" value="\${subscription.studentLimit}" 
                                              class="w-full mt-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                      </div>
                                  </div>
                                  
                                  <!-- AI Î¶¨Ìè¨Ìä∏ -->
                                  <div class="border border-gray-200 rounded-lg p-4">
                                      <div class="flex items-center justify-between mb-2">
                                          <span class="text-sm font-medium text-gray-700">üìä AI Î¶¨Ìè¨Ìä∏</span>
                                          <span class="text-sm font-bold \${usage.aiReportsUsed >= subscription.aiReportLimit ? 'text-red-600' : 'text-green-600'}">
                                              \${usage.aiReportsUsed} / \${subscription.aiReportLimit}
                                          </span>
                                      </div>
                                      <div class="w-full bg-gray-200 rounded-full h-2">
                                          <div class="bg-green-600 h-2 rounded-full transition-all" style="width: \${Math.min((usage.aiReportsUsed / subscription.aiReportLimit) * 100, 100)}%"></div>
                                      </div>
                                      <div class="mt-2">
                                          <label class="text-xs text-gray-500">ÌïúÎèÑ ÏÑ§Ï†ï:</label>
                                          <input type="number" id="aiReportLimit" value="\${subscription.aiReportLimit}" 
                                              class="w-full mt-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                      </div>
                                  </div>
                                  
                                  <!-- ÎûúÎî©ÌéòÏù¥ÏßÄ -->
                                  <div class="border border-gray-200 rounded-lg p-4">
                                      <div class="flex items-center justify-between mb-2">
                                          <span class="text-sm font-medium text-gray-700">üé® ÎûúÎî©ÌéòÏù¥ÏßÄ</span>
                                          <span class="text-sm font-bold \${usage.landingPagesCreated >= subscription.landingPageLimit ? 'text-red-600' : 'text-purple-600'}">
                                              \${usage.landingPagesCreated} / \${subscription.landingPageLimit}
                                          </span>
                                      </div>
                                      <div class="w-full bg-gray-200 rounded-full h-2">
                                          <div class="bg-purple-600 h-2 rounded-full transition-all" style="width: \${Math.min((usage.landingPagesCreated / subscription.landingPageLimit) * 100, 100)}%"></div>
                                      </div>
                                      <div class="mt-2">
                                          <label class="text-xs text-gray-500">ÌïúÎèÑ ÏÑ§Ï†ï:</label>
                                          <input type="number" id="landingPageLimit" value="\${subscription.landingPageLimit}" 
                                              class="w-full mt-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                      </div>
                                  </div>
                                  
                                  <!-- ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï -->
                                  <div class="border border-gray-200 rounded-lg p-4">
                                      <div class="flex items-center justify-between mb-2">
                                          <span class="text-sm font-medium text-gray-700">üë®‚Äçüè´ ÏÑ†ÏÉùÎãò</span>
                                          <span class="text-sm font-bold \${usage.currentTeachers >= subscription.teacherLimit ? 'text-red-600' : 'text-orange-600'}">
                                              \${usage.currentTeachers} / \${subscription.teacherLimit}
                                          </span>
                                      </div>
                                      <div class="w-full bg-gray-200 rounded-full h-2">
                                          <div class="bg-orange-600 h-2 rounded-full transition-all" style="width: \${Math.min((usage.currentTeachers / subscription.teacherLimit) * 100, 100)}%"></div>
                                      </div>
                                      <div class="mt-2">
                                          <label class="text-xs text-gray-500">ÌïúÎèÑ ÏÑ§Ï†ï:</label>
                                          <input type="number" id="teacherLimit" value="\${subscription.teacherLimit}" 
                                              class="w-full mt-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                      </div>
                                  </div>
                              </div>
                              
                              <!-- Ï†ÄÏû• Î≤ÑÌäº -->
                              <div class="flex justify-end gap-3 pt-4 border-t">
                                  <button onclick="loadSubscriptionInfo()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium">
                                      Ï∑®ÏÜå
                                  </button>
                                  <button onclick="updateLimits()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-medium">
                                      ÌïúÎèÑ Ï†ÄÏû•
                                  </button>
                              </div>
                          </div>
                      \`;
                  } catch (error) {
                      console.error('Failed to load subscription info:', error);
                      document.getElementById('subscriptionContent').innerHTML = \`
                          <div class="text-center py-8 text-red-500">
                              <p>Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§</p>
                          </div>
                      \`;
                  }
              }
              
              // ÌïúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
              async function updateLimits() {
                  const studentLimit = parseInt(document.getElementById('studentLimit').value);
                  const aiReportLimit = parseInt(document.getElementById('aiReportLimit').value);
                  const landingPageLimit = parseInt(document.getElementById('landingPageLimit').value);
                  const teacherLimit = parseInt(document.getElementById('teacherLimit').value);
                  
                  if (!studentLimit || !aiReportLimit || !landingPageLimit || !teacherLimit) {
                      alert('Î™®Îì† ÌïúÎèÑÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                      return;
                  }
                  
                  if (confirm('Ï†ïÎßê ÏÇ¨Ïö© ÌïúÎèÑÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                      try {
                          const response = await fetch(\`/api/admin/usage/\${userId}/update-limits\`, {
                              method: 'POST',
                              headers: { 'Content-Type': 'application/json' },
                              body: JSON.stringify({
                                  studentLimit,
                                  aiReportLimit,
                                  landingPageLimit,
                                  teacherLimit
                              })
                          });
                          
                          const data = await response.json();
                          
                          if (data.success) {
                              alert('‚úÖ ÏÇ¨Ïö© ÌïúÎèÑÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!');
                              loadSubscriptionInfo();
                          } else {
                              alert('‚ùå ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                          }
                      } catch (error) {
                          console.error('Update error:', error);
                          alert('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                      }
                  }
              }
              
              // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Íµ¨ÎèÖ Ï†ïÎ≥¥ Î°úÎìú
              window.addEventListener('DOMContentLoaded', loadSubscriptionInfo);
              
              function logout() {
                  if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                      localStorage.removeItem('user');
                      window.location.href = '/';
                  }
              }
          </script>
      </body>
      </html>
    `)
  } catch (error) {
    console.error('ÏÇ¨Ïö©Ïûê ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï°∞Ìöå Ïò§Î•ò:', error)
    return c.html('<h1>Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</h1>', 500)
  }
})

// Î¨∏Ïùò Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/admin/contacts', async (c) => {
  const { env } = c
  
  // Î¨∏Ïùò Î™©Î°ù Ï°∞Ìöå
  const contacts = await env.DB.prepare('SELECT * FROM contacts ORDER BY created_at DESC').all()
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¨∏Ïùò Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Ìó§Îçî -->
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/admin" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/contacts" class="text-purple-600 font-medium">Î¨∏Ïùò</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="mb-8 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Î¨∏Ïùò Í¥ÄÎ¶¨</h1>
                    <p class="text-gray-600">Ï†ÑÏ≤¥ ${contacts?.results?.length || 0}Í±¥Ïùò Î¨∏Ïùò</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="filterContacts('all')" class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium">Ï†ÑÏ≤¥</button>
                    <button onclick="filterContacts('pending')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium">ÎåÄÍ∏∞Ï§ë</button>
                    <button onclick="filterContacts('completed')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium">Ï≤òÎ¶¨ÏôÑÎ£å</button>
                </div>
            </div>

            <!-- Î¨∏Ïùò Î™©Î°ù -->
            <div class="space-y-4">
                ${contacts?.results?.map(contact => `
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition" data-status="${contact.status || 'pending'}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-lg font-bold text-gray-900">${contact.name}</h3>
                                    <span class="px-3 py-1 text-xs font-medium rounded-full ${contact.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}">
                                        ${contact.status === 'completed' ? 'Ï≤òÎ¶¨ÏôÑÎ£å' : 'ÎåÄÍ∏∞Ï§ë'}
                                    </span>
                                    <span class="px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700">
                                        ${contact.inquiry || 'ÏùºÎ∞òÎ¨∏Ïùò'}
                                    </span>
                                </div>
                                <div class="flex gap-4 text-sm text-gray-600">
                                    <span><i class="fas fa-building mr-1"></i>${contact.academy || '-'}</span>
                                    <span><i class="fas fa-phone mr-1"></i>${contact.phone}</span>
                                    <span><i class="fas fa-envelope mr-1"></i>${contact.email}</span>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500">
                                ${new Date(contact.created_at).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-xl p-4 mb-4">
                            <div class="text-sm text-gray-700 whitespace-pre-wrap">${contact.message}</div>
                        </div>

                        ${contact.programs ? `
                            <div class="flex gap-2 mb-4">
                                <span class="text-sm text-gray-600">Í¥ÄÏã¨ ÌîÑÎ°úÍ∑∏Îû®:</span>
                                ${JSON.parse(contact.programs || '[]').map(p => `
                                    <span class="px-2 py-1 bg-purple-50 text-purple-700 text-xs rounded-lg">${p}</span>
                                `).join('')}
                            </div>
                        ` : ''}

                        <div class="flex gap-2">
                            <button onclick="updateStatus(${contact.id}, 'completed')" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600">
                                <i class="fas fa-check mr-1"></i>Ï≤òÎ¶¨ÏôÑÎ£å
                            </button>
                            <button onclick="updateStatus(${contact.id}, 'pending')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300">
                                <i class="fas fa-undo mr-1"></i>ÎåÄÍ∏∞Ï§ëÏúºÎ°ú
                            </button>
                        </div>
                    </div>
                `).join('') || '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center text-gray-500">Îì±Î°ùÎêú Î¨∏ÏùòÍ∞Ä ÏóÜÏäµÎãàÎã§</div>'}
            </div>
        </div>

        <script>
            function logout() {
                if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            }

            function filterContacts(status) {
                const items = document.querySelectorAll('[data-status]');
                const buttons = document.querySelectorAll('button[onclick^="filterContacts"]');
                
                buttons.forEach(btn => {
                    btn.classList.remove('bg-purple-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                event.target.classList.add('bg-purple-600', 'text-white');
                event.target.classList.remove('bg-gray-200', 'text-gray-700');
                
                items.forEach(item => {
                    if(status === 'all') {
                        item.style.display = 'block';
                    } else {
                        item.style.display = item.dataset.status === status ? 'block' : 'none';
                    }
                });
            }

            async function updateStatus(id, status) {
                try {
                    const response = await fetch('/api/admin/contacts/' + id, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status })
                    });

                    if(response.ok) {
                        alert('ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§');
                        location.reload();
                    } else {
                        alert('ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïã§Ìå®');
                    }
                } catch(error) {
                    alert('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                }
            }
        </script>
    </body>
    </html>
  `)
})

// üîß ÏûÑÏãú DB Ï¥àÍ∏∞Ìôî API (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö© - Ìïú Î≤àÎßå Ïã§Ìñâ)
app.post('/api/admin/init-sender-table', async (c) => {
  try {
    const { adminSecret } = await c.req.json()
    
    // Í∞ÑÎã®Ìïú Î≥¥Ïïà Ï≤¥ÌÅ¨ (Ïã§Ï†úÎ°úÎäî Îçî Í∞ïÎ†•Ìïú Ïù∏Ï¶ù ÌïÑÏöî)
    if (adminSecret !== 'superplace-init-2026') {
      return c.json({ success: false, error: 'Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.' }, 403)
    }

    console.log('Creating sender_verification_requests table...')

    // ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS sender_verification_requests (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER NOT NULL,
        phone_number TEXT NOT NULL,
        business_name TEXT NOT NULL,
        business_registration_number TEXT NOT NULL,
        business_registration_image TEXT NOT NULL,
        certificate_image TEXT,
        employment_cert_image TEXT,
        contract_image TEXT,
        request_date DATETIME DEFAULT CURRENT_TIMESTAMP,
        status TEXT DEFAULT 'pending',
        admin_note TEXT,
        rejection_reason TEXT,
        processed_by INTEGER,
        processed_date DATETIME,
        FOREIGN KEY (user_id) REFERENCES users(id),
        FOREIGN KEY (processed_by) REFERENCES users(id)
      )
    `).run()

    // Ïù∏Îç±Ïä§ ÏÉùÏÑ±
    await c.env.DB.prepare(`
      CREATE INDEX IF NOT EXISTS idx_sender_verification_user_id ON sender_verification_requests(user_id)
    `).run()

    await c.env.DB.prepare(`
      CREATE INDEX IF NOT EXISTS idx_sender_verification_status ON sender_verification_requests(status)
    `).run()

    await c.env.DB.prepare(`
      CREATE INDEX IF NOT EXISTS idx_sender_verification_phone ON sender_verification_requests(phone_number)
    `).run()

    // sender_ids ÌÖåÏù¥Î∏îÏóê Ïª¨Îüº Ï∂îÍ∞Ä (Ïù¥ÎØ∏ ÏûàÏúºÎ©¥ Î¨¥ÏãúÎê®)
    try {
      await c.env.DB.prepare(`ALTER TABLE sender_ids ADD COLUMN verification_request_id INTEGER`).run()
    } catch (e) {
      console.log('verification_request_id column already exists or error:', e.message)
    }

    try {
      await c.env.DB.prepare(`ALTER TABLE sender_ids ADD COLUMN business_name TEXT`).run()
    } catch (e) {
      console.log('business_name column already exists or error:', e.message)
    }

    try {
      await c.env.DB.prepare(`ALTER TABLE sender_ids ADD COLUMN business_registration_number TEXT`).run()
    } catch (e) {
      console.log('business_registration_number column already exists or error:', e.message)
    }

    console.log('Table creation complete!')

    return c.json({ 
      success: true, 
      message: '‚úÖ sender_verification_requests ÌÖåÏù¥Î∏îÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!' 
    })
  } catch (err) {
    console.error('Init table error:', err)
    return c.json({ 
      success: false, 
      error: 'ÌÖåÏù¥Î∏î ÏÉùÏÑ± Ïã§Ìå®: ' + err.message 
    }, 500)
  }
})

// Í∂åÌïú Í¥ÄÎ¶¨ API
// ÏÇ¨Ïö©Ïûê Í∂åÌïú Ï°∞Ìöå API
app.get('/api/user/:id/permissions', async (c) => {
  try {
    const { env } = c;
    const userId = c.req.param('id');
    
    const permissions = await env.DB.prepare(`
      SELECT permission_type, permission_name, granted_at, expires_at, is_active
      FROM user_permissions
      WHERE user_id = ? AND is_active = 1
      ORDER BY granted_at DESC
    `).bind(userId).all();
    
    return c.json({ permissions: permissions.results });
  } catch (err) {
    console.error('Get permissions error:', err);
    return c.json({ success: false, error: 'Í∂åÌïú Ï°∞Ìöå Ïã§Ìå®' }, 500);
  }
});

// Í∂åÌïú Î∂ÄÏó¨ API (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
app.post('/api/admin/permissions/grant', async (c) => {
  try {
    const { env } = c;
    const { userId, permissionType, permissionName, expiresAt } = await c.req.json();
    
    const result = await env.DB.prepare(`
      INSERT INTO user_permissions (user_id, permission_type, permission_name, granted_by, expires_at, is_active)
      VALUES (?, ?, ?, 1, ?, 1)
    `).bind(userId, permissionType, permissionName, expiresAt || null).run();
    
    return c.json({ success: true, message: 'Í∂åÌïúÏù¥ Î∂ÄÏó¨ÎêòÏóàÏäµÎãàÎã§' });
  } catch (err) {
    console.error('Grant permission error:', err);
    return c.json({ success: false, error: 'Í∂åÌïú Î∂ÄÏó¨ Ïã§Ìå®' }, 500);
  }
});

// Í∂åÌïú ÌöåÏàò API (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
app.post('/api/admin/permissions/revoke', async (c) => {
  try {
    const { env } = c;
    const { userId, permissionType, permissionName } = await c.req.json();
    
    await env.DB.prepare(`
      UPDATE user_permissions
      SET is_active = 0
      WHERE user_id = ? AND permission_type = ? AND permission_name = ?
    `).bind(userId, permissionType, permissionName).run();
    
    return c.json({ success: true, message: 'Í∂åÌïúÏù¥ ÌöåÏàòÎêòÏóàÏäµÎãàÎã§' });
  } catch (err) {
    console.error('Revoke permission error:', err);
    return c.json({ success: false, error: 'Í∂åÌïú ÌöåÏàò Ïã§Ìå®' }, 500);
  }
});

// Î¨∏Ïùò ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ API
app.patch('/api/admin/contacts/:id', async (c) => {
  try {
    const id = c.req.param('id')
    const { status } = await c.req.json()
    const { env } = c
    
    await env.DB.prepare('UPDATE contacts SET status = ? WHERE id = ?').bind(status, id).run()
    
    return c.json({ success: true })
  } catch (err) {
    console.error('Update contact status error:', err)
    return c.json({ success: false }, 500)
  }
})

// ========================================
// Í≤∞Ï†ú Í¥ÄÎ¶¨ API
// ========================================

// Í≤∞Ï†ú Í≤ÄÏ¶ù Î∞è Íµ¨ÎèÖ ÏÉùÏÑ± API
app.post('/api/payment/verify', async (c) => {
  try {
    const { imp_uid, merchant_uid, plan, amount, user_id } = await c.req.json()
    const { DB } = c.env
    
    // Ïã§Ï†ú Ïö¥ÏòÅ ÌôòÍ≤ΩÏóêÏÑúÎäî ÏïÑÏûÑÌè¨Ìä∏ APIÎ°ú Í≤∞Ï†ú Ï†ïÎ≥¥Î•º Í≤ÄÏ¶ùÌï¥Ïïº Ìï©ÎãàÎã§
    const subscriptionId = 'SUB_' + Date.now()
    
    // ÌïúÍµ≠ ÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú ÎÇ†Ïßú Í≥ÑÏÇ∞ (Ï¢ÖÎ£åÏùºÏùÄ Ìïú Îã¨ ÌõÑ Ï†ÑÎÇ† 23:59:59)
    const now = new Date()
    const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)) // UTC+9
    const startDate = koreaTime.toISOString().split('T')[0]
    
    // Ìïú Îã¨ ÌõÑ Í≥ÑÏÇ∞
    const nextMonth = new Date(koreaTime)
    nextMonth.setMonth(nextMonth.getMonth() + 1)
    nextMonth.setDate(nextMonth.getDate() - 1) // Ï†ÑÎÇ†ÍπåÏßÄ (Ïòà: 1/20 Íµ¨Îß§ ‚Üí 2/19ÍπåÏßÄ)
    const endDate = nextMonth.toISOString().split('T')[0]
    
    await DB.prepare(`
      INSERT INTO subscriptions (id, user_id, plan_type, amount, start_date, end_date, status, merchant_uid, imp_uid, created_at)
      VALUES (?, ?, ?, ?, ?, ?, 'active', ?, ?, datetime('now'))
    `).bind(subscriptionId, user_id, plan, amount, startDate, endDate, merchant_uid, imp_uid).run()
    
    const paymentId = 'PAY_' + Date.now()
    await DB.prepare(`
      INSERT INTO payments (id, subscription_id, user_id, amount, payment_method, merchant_uid, imp_uid, status, created_at)
      VALUES (?, ?, ?, ?, 'card', ?, ?, 'completed', datetime('now'))
    `).bind(paymentId, subscriptionId, user_id, amount, merchant_uid, imp_uid).run()
    
    return c.json({
      success: true,
      message: 'Í≤∞Ï†úÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§',
      subscription: { id: subscriptionId, plan: plan, startDate: startDate, endDate: endDate }
    })
  } catch (error: any) {
    console.error('Payment verification error:', error)
    return c.json({ success: false, error: error.message || 'Í≤∞Ï†ú Í≤ÄÏ¶ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§' }, 500)
  }
})

// ÏÇ¨Ïö©Ïûê Íµ¨ÎèÖ Ï†ïÎ≥¥ Ï°∞Ìöå API
app.get('/api/subscription/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    const { DB } = c.env
    
    const subscription = await DB.prepare(`
      SELECT * FROM subscriptions WHERE user_id = ? AND status = 'active' ORDER BY created_at DESC LIMIT 1
    `).bind(userId).first()
    
    return c.json({ success: true, subscription: subscription || null })
  } catch (error: any) {
    console.error('Get subscription error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Í≤∞Ï†ú ÎÇ¥Ïó≠ Ï°∞Ìöå API
app.get('/api/payments/:userId', async (c) => {
  try {
    const userId = c.req.param('userId')
    const { DB } = c.env
    
    const { results } = await DB.prepare(`
      SELECT p.*, s.plan_type FROM payments p
      LEFT JOIN subscriptions s ON p.subscription_id = s.id
      WHERE p.user_id = ? ORDER BY p.created_at DESC
    `).bind(userId).all()
    
    return c.json({ success: true, payments: results || [] })
  } catch (error: any) {
    console.error('Get payments error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Íµ¨ÎèÖ Ï∑®ÏÜå API
app.post('/api/subscription/:subscriptionId/cancel', async (c) => {
  try {
    const subscriptionId = c.req.param('subscriptionId')
    const { DB } = c.env
    
    await DB.prepare(`
      UPDATE subscriptions SET status = 'cancelled', updated_at = datetime('now') WHERE id = ?
    `).bind(subscriptionId).run()
    
    return c.json({ success: true, message: 'Íµ¨ÎèÖÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§' })
  } catch (error: any) {
    console.error('Cancel subscription error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Í≤∞Ï†ú Í¥ÄÎ†® ÌÖåÏù¥Î∏î Ï¥àÍ∏∞Ìôî API
app.post('/api/admin/init-payment-tables', async (c) => {
  try {
    const { DB } = c.env
    
    // Drop old subscriptions table if exists (for migration)
    try {
      await DB.prepare(`DROP TABLE IF EXISTS old_subscriptions`).run()
      await DB.prepare(`ALTER TABLE subscriptions RENAME TO old_subscriptions`).run()
    } catch (e) {
      // Table doesn't exist or already migrated
    }
    
    // Create new subscriptions table with correct schema
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS subscriptions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER NOT NULL,
        plan_name TEXT NOT NULL,
        plan_price INTEGER NOT NULL DEFAULT 0,
        student_limit INTEGER NOT NULL DEFAULT 30,
        ai_report_limit INTEGER NOT NULL DEFAULT 30,
        landing_page_limit INTEGER NOT NULL DEFAULT 40,
        teacher_limit INTEGER NOT NULL DEFAULT 2,
        subscription_start_date TEXT NOT NULL,
        subscription_end_date TEXT NOT NULL,
        status TEXT DEFAULT 'active',
        payment_method TEXT,
        merchant_uid TEXT,
        imp_uid TEXT,
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (academy_id) REFERENCES academies(id)
      )
    `).run()
    
    // Create academies table
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS academies (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_name TEXT NOT NULL,
        owner_id INTEGER NOT NULL,
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (owner_id) REFERENCES users(id)
      )
    `).run()
    
    // Create usage_tracking table
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS usage_tracking (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER NOT NULL,
        subscription_id INTEGER NOT NULL,
        current_students INTEGER DEFAULT 0,
        ai_reports_used_this_month INTEGER DEFAULT 0,
        landing_pages_created INTEGER DEFAULT 0,
        current_teachers INTEGER DEFAULT 0,
        updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (academy_id) REFERENCES academies(id),
        FOREIGN KEY (subscription_id) REFERENCES subscriptions(id)
      )
    `).run()
    
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS payments (
        id TEXT PRIMARY KEY,
        subscription_id INTEGER NOT NULL,
        user_id INTEGER NOT NULL,
        amount INTEGER NOT NULL,
        payment_method TEXT NOT NULL,
        merchant_uid TEXT NOT NULL,
        imp_uid TEXT,
        status TEXT DEFAULT 'pending',
        created_at TEXT NOT NULL,
        FOREIGN KEY (subscription_id) REFERENCES subscriptions(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      )
    `).run()
    
    // Create indexes
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_subscriptions_academy_id ON subscriptions(academy_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_subscriptions_status ON subscriptions(status)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_academies_owner_id ON academies(owner_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_usage_tracking_academy_id ON usage_tracking(academy_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_usage_tracking_subscription_id ON usage_tracking(subscription_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_payments_user_id ON payments(user_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_payments_subscription_id ON payments(subscription_id)`).run()
    
    // Add academy_id column to users if not exists
    try {
      await DB.prepare(`ALTER TABLE users ADD COLUMN academy_id INTEGER`).run()
    } catch (e) {
      // Column already exists
    }
    
    return c.json({
      success: true,
      message: 'Í≤∞Ï†ú Í¥ÄÎ†® ÌÖåÏù¥Î∏îÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§ (subscriptions, payments, academies, usage_tracking)'
    })
  } catch (error: any) {
    console.error('Init payment tables error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Database migration endpoint - run this to fix academy_id issues
app.post('/api/admin/migrate-database', async (c) => {
  try {
    const { DB } = c.env
    const migrations = []
    
    // 1. Add academy_id to users table if not exists
    try {
      await DB.prepare(`ALTER TABLE users ADD COLUMN academy_id INTEGER`).run()
      migrations.push('Added academy_id column to users table')
    } catch (e) {
      migrations.push('users.academy_id already exists')
    }
    
    // 2. Create academies table if not exists
    try {
      await DB.prepare(`
        CREATE TABLE IF NOT EXISTS academies (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_name TEXT NOT NULL,
          owner_id INTEGER NOT NULL,
          created_at TEXT DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (owner_id) REFERENCES users(id)
        )
      `).run()
      migrations.push('Created academies table')
    } catch (e) {
      migrations.push('academies table already exists')
    }
    
    // 3. Create new subscriptions table
    try {
      await DB.prepare(`DROP TABLE IF EXISTS subscriptions_backup`).run()
      await DB.prepare(`ALTER TABLE subscriptions RENAME TO subscriptions_backup`).run()
      migrations.push('Backed up old subscriptions table')
    } catch (e) {
      migrations.push('No old subscriptions table to backup')
    }
    
    try {
      await DB.prepare(`
        CREATE TABLE IF NOT EXISTS subscriptions (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_id INTEGER NOT NULL,
          plan_name TEXT NOT NULL,
          plan_price INTEGER NOT NULL DEFAULT 0,
          student_limit INTEGER NOT NULL DEFAULT 30,
          ai_report_limit INTEGER NOT NULL DEFAULT 30,
          landing_page_limit INTEGER NOT NULL DEFAULT 40,
          teacher_limit INTEGER NOT NULL DEFAULT 2,
          subscription_start_date TEXT NOT NULL,
          subscription_end_date TEXT NOT NULL,
          status TEXT DEFAULT 'active',
          payment_method TEXT,
          merchant_uid TEXT,
          imp_uid TEXT,
          created_at TEXT DEFAULT CURRENT_TIMESTAMP,
          updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (academy_id) REFERENCES academies(id)
        )
      `).run()
      migrations.push('Created new subscriptions table with academy_id')
    } catch (e: any) {
      migrations.push('Subscriptions table creation: ' + e.message)
    }
    
    // 4. Create usage_tracking table
    try {
      await DB.prepare(`
        CREATE TABLE IF NOT EXISTS usage_tracking (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          academy_id INTEGER,
          subscription_id INTEGER,
          current_students INTEGER DEFAULT 0,
          ai_reports_used_this_month INTEGER DEFAULT 0,
          landing_pages_created INTEGER DEFAULT 0,
          current_teachers INTEGER DEFAULT 0,
          updated_at TEXT DEFAULT CURRENT_TIMESTAMP
        )
      `).run()
      migrations.push('‚úÖ Created usage_tracking table (no FK constraints)')
    } catch (e: any) {
      migrations.push('‚ÑπÔ∏è usage_tracking table: ' + e.message)
    }
    
    // 5. Create indexes
    const indexes = [
      'CREATE INDEX IF NOT EXISTS idx_subscriptions_academy_id ON subscriptions(academy_id)',
      'CREATE INDEX IF NOT EXISTS idx_subscriptions_status ON subscriptions(status)',
      'CREATE INDEX IF NOT EXISTS idx_academies_owner_id ON academies(owner_id)',
      'CREATE INDEX IF NOT EXISTS idx_usage_tracking_academy_id ON usage_tracking(academy_id)',
      'CREATE INDEX IF NOT EXISTS idx_usage_tracking_subscription_id ON usage_tracking(subscription_id)'
    ]
    
    for (const indexSql of indexes) {
      try {
        await DB.prepare(indexSql).run()
      } catch (e) {
        // Index already exists
      }
    }
    migrations.push('Created/verified all indexes')
    
    return c.json({
      success: true,
      message: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§',
      migrations
    })
  } catch (error: any) {
    console.error('Database migration error:', error)
    return c.json({ 
      success: false, 
      error: error.message,
      stack: error.stack 
    }, 500)
  }
})

// Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú
// DB Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏóîÎìúÌè¨Ïù∏Ìä∏
app.get('/api/test/db', async (c) => {
  const { env } = c
  try {
    if (!env.DB) {
      return c.json({ success: false, error: 'DB binding not found', env_keys: Object.keys(env) })
    }
    
    const result = await env.DB.prepare('SELECT 1 as test').first()
    return c.json({ success: true, message: 'DB connection OK', result })
  } catch (error: any) {
    return c.json({ success: false, error: error.message, stack: error.stack }, 500)
  }
})

app.get('/admin/dashboard', async (c) => {
  const {env}=c
  if(!env?.DB)return c.html('<h1>DB Error</h1><a href="/admin/users">Users</a>')
  let u=0,co=0,pc=0,pd=0,ps=0
  try{u=(await env.DB.prepare('SELECT COUNT(*)c FROM users').first())?.c||0}catch(e){}
  try{co=(await env.DB.prepare('SELECT COUNT(*)c FROM contacts').first())?.c||0}catch(e){}
  try{pc=(await env.DB.prepare('SELECT COUNT(*)c FROM contacts WHERE status=?').bind('pending').first())?.c||0}catch(e){}
  try{pd=(await env.DB.prepare('SELECT COUNT(*)c FROM deposit_requests WHERE status=?').bind('pending').first())?.c||0}catch(e){}
  try{ps=(await env.DB.prepare('SELECT COUNT(*)c FROM sender_verification_requests WHERE status=?').bind('pending').first())?.c||0}catch(e){}
  const h=`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"></head><body class="bg-gray-50">`
  const n=`<nav class="bg-white border-b"><div class="max-w-7xl mx-auto px-6 py-4"><div class="flex justify-between items-center"><div class="flex items-center gap-8"><a href="/admin/dashboard" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§</a><div class="flex gap-4"><a href="/admin/dashboard" class="text-purple-600 font-semibold">ÎåÄÏãúÎ≥¥Îìú</a><a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a><a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a><a href="/admin/sms" class="text-gray-600 hover:text-purple-600">Î¨∏Ïûê</a><a href="/admin/sender/verification" class="text-gray-600 hover:text-purple-600">Î∞úÏã†Î≤àÌò∏</a></div></div><button onclick="localStorage.removeItem('user');location.href='/'" class="text-gray-600 hover:text-red-600"><i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ</button></div></div></nav>`
  const b=`<div class="max-w-7xl mx-auto px-6 py-8"><h1 class="text-3xl font-bold mb-8">Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</h1><div class="grid md:grid-cols-3 gap-6 mb-8"><div class="bg-white rounded-xl shadow p-6 border"><div class="flex items-center justify-between mb-2"><span class="text-gray-600">Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê</span><i class="fas fa-users text-blue-600 text-2xl"></i></div><p class="text-3xl font-bold">${u}</p></div><div class="bg-white rounded-xl shadow p-6 border"><div class="flex items-center justify-between mb-2"><span class="text-gray-600">Ï†ÑÏ≤¥ Î¨∏Ïùò</span><i class="fas fa-envelope text-green-600 text-2xl"></i></div><p class="text-3xl font-bold">${co}</p></div><div class="bg-white rounded-xl shadow p-6 border"><div class="flex items-center justify-between mb-2"><span class="text-gray-600">ÎåÄÍ∏∞Ï§ë Î¨∏Ïùò</span><i class="fas fa-clock text-orange-600 text-2xl"></i></div><p class="text-3xl font-bold">${pc}</p></div></div>`
  const s=`<div class="mb-8"><h2 class="text-xl font-bold mb-4">Ïã†Ï≤≠ ÎåÄÍ∏∞</h2><div class="grid md:grid-cols-2 gap-6"><div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow p-6 text-white"><div class="flex items-center justify-between mb-2"><span>ÏûÖÍ∏à ÎåÄÍ∏∞</span><i class="fas fa-money-bill-wave text-2xl"></i></div><p class="text-3xl font-bold">${pd}</p></div><div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow p-6 text-white"><div class="flex items-center justify-between mb-2"><span>Î∞úÏã†Î≤àÌò∏ ÎåÄÍ∏∞</span><i class="fas fa-phone text-2xl"></i></div><p class="text-3xl font-bold">${ps}</p></div></div></div>`
  const l=`<div class="grid md:grid-cols-3 gap-6"><a href="/admin/users" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><i class="fas fa-user-cog text-blue-600 text-xl"></i></div><div><h3 class="text-lg font-bold">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h3><p class="text-gray-600 text-sm">Í∂åÌïú Í¥ÄÎ¶¨</p></div></div></a><a href="/admin/contacts" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"><i class="fas fa-comments text-green-600 text-xl"></i></div><div><h3 class="text-lg font-bold">Î¨∏Ïùò Í¥ÄÎ¶¨</h3><p class="text-gray-600 text-sm">Î¨∏Ïùò Ï≤òÎ¶¨</p></div></div></a><a href="/admin/sms" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><i class="fas fa-sms text-blue-600 text-xl"></i></div><div><h3 class="text-lg font-bold">Î¨∏Ïûê Í¥ÄÎ¶¨</h3><p class="text-gray-600 text-sm">SMS Î∞úÏÜ°</p></div></div></a><a href="/admin/sender/verification" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"><i class="fas fa-phone text-purple-600 text-xl"></i></div><div><h3 class="text-lg font-bold">Î∞úÏã†Î≤àÌò∏</h3><p class="text-gray-600 text-sm">Ïù∏Ï¶ù ÏäπÏù∏</p></div></div></a><a href="/admin/deposits" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"><i class="fas fa-money-bill-wave text-green-600 text-xl"></i></div><div><h3 class="text-lg font-bold">ÏûÖÍ∏à Í¥ÄÎ¶¨</h3><p class="text-gray-600 text-sm">Ìè¨Ïù∏Ìä∏ ÏäπÏù∏</p></div></div></a><a href="/admin/programs" class="bg-white rounded-xl shadow p-6 hover:shadow-md transition border"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"><i class="fas fa-graduation-cap text-purple-600 text-xl"></i></div><div><h3 class="text-lg font-bold">ÌîÑÎ°úÍ∑∏Îû®</h3><p class="text-gray-600 text-sm">ÍµêÏú° Í¥ÄÎ¶¨</p></div></div></a></div></div></body></html>`
  return c.html(h+n+b+s+l)
})

// .html ÌôïÏû•Ïûê Ï†ëÍ∑º Ïãú Î¶¨Îã§Ïù¥Î†âÌä∏
app.get('/admin/programs.html', (c) => {
  return c.redirect('/admin/programs', 301)
})

// Í¥ÄÎ¶¨Ïûê ÌîÑÎ°úÍ∑∏Îû® Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/admin/programs', async (c) => {
  const { env } = c
  
  // Î™®Îì† ÏÇ¨Ïö©ÏûêÏôÄ ÌîÑÎ°úÍ∑∏Îû® Î™©Î°ù Ï°∞Ìöå
  const users = await env.DB.prepare('SELECT id, email, name, role FROM users WHERE role != ? ORDER BY created_at DESC').bind('admin').all()

  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌîÑÎ°úÍ∑∏Îû® Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/admin/dashboard" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                            <a href="/admin/programs" class="text-purple-600 font-semibold">ÌîÑÎ°úÍ∑∏Îû®</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">ÌîÑÎ°úÍ∑∏Îû® Í¥ÄÎ¶¨</h1>
                <p class="text-gray-600">Ï¥ù 13Í∞úÏùò ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®Ïù¥ Îì±Î°ùÎêòÏñ¥ ÏûàÏäµÎãàÎã§. ÌÅ¥Î¶≠ÌïòÏó¨ Í∂åÌïúÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.</p>
            </div>

            <div id="programsGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- Í∂åÌïú Í¥ÄÎ¶¨ Î™®Îã¨ -->
        <div id="permissionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <span id="modalProgramIcon"></span>
                        <span id="modalProgramName"></span> Í∂åÌïú Í¥ÄÎ¶¨
                    </h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-bold mb-4">ÏÇ¨Ïö©ÏûêÎ≥Ñ Í∂åÌïú ÏÑ§Ï†ï</h3>
                    <div id="usersList" class="space-y-3 max-h-96 overflow-y-auto"></div>
                </div>

                <div class="flex gap-4">
                    <button onclick="savePermissions()" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold">
                        <i class="fas fa-save mr-2"></i>Ï†ÄÏû•
                    </button>
                    <button onclick="closeModal()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold">
                        Ï∑®ÏÜå
                    </button>
                </div>
            </div>
        </div>

        <script>
            const programs = [
                { id: 'naver-place', name: 'ÎÑ§Ïù¥Î≤Ñ ÌîåÎ†àÏù¥Ïä§ ÏÉÅÏúÑÎÖ∏Ï∂ú', desc: 'ÏßÄÏó≠ Í≤ÄÏÉâ 1ÏúÑÎ•º ÏúÑÌïú Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞', icon: 'üó∫Ô∏è', url: '/programs/naver-place' },
                { id: 'blog', name: 'Î∏îÎ°úÍ∑∏ ÏÉÅÏúÑÎÖ∏Ï∂ú', desc: 'Í≤ÄÏÉâ 1ÌéòÏù¥ÏßÄ ÏßÑÏûÖÏùÑ ÏúÑÌïú Î∏îÎ°úÍ∑∏ ÎßàÏºÄÌåÖ', icon: 'üìù', url: '/programs/blog' },
                { id: 'funnel', name: 'ÌçºÎÑê ÎßàÏºÄÌåÖ', desc: 'ÏûêÎèôÌôîÎêú ÌïôÏÉù Î™®Ïßë ÏãúÏä§ÌÖú Íµ¨Ï∂ï', icon: 'üéØ', url: '/programs/funnel' },
                { id: 'sns', name: 'SNS ÎßàÏºÄÌåÖ', desc: 'Ïù∏Ïä§ÌÉÄÍ∑∏Îû®, ÌéòÏù¥Ïä§Î∂Å ÌôúÏö© Ï†ÑÎûµ', icon: 'üì±', url: '/programs/sns' },
                { id: 'video', name: 'ÏòÅÏÉÅ ÎßàÏºÄÌåÖ', desc: 'Ïú†ÌäúÎ∏å, ÏàèÌèº ÏΩòÌÖêÏ∏† Ï†úÏûë', icon: 'üé•', url: '/programs/video' },
                { id: 'ad', name: 'Ïò®ÎùºÏù∏ Í¥ëÍ≥†', desc: 'ÎÑ§Ïù¥Î≤Ñ, Íµ¨Í∏Ä Í¥ëÍ≥† Ïö¥ÏòÅ Ï†ÑÎûµ', icon: 'üí∞', url: '/programs/ad' },
                { id: 'community', name: 'Ïª§ÎÆ§ÎãàÌã∞ ÎßàÏºÄÌåÖ', desc: 'ÌïôÎ∂ÄÎ™® Ïª§ÎÆ§ÎãàÌã∞ ÌôúÏÑ±Ìôî Ï†ÑÎûµ', icon: 'üë•', url: '/programs/community' },
                { id: 'branding', name: 'Î∏åÎûúÎî©', desc: 'ÌïôÏõê Î∏åÎûúÎìú ÏïÑÏù¥Îç¥Ìã∞Ìã∞ Íµ¨Ï∂ï', icon: 'üé®', url: '/programs/branding' },
                { id: 'data', name: 'Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù', desc: 'ÎßàÏºÄÌåÖ ÏÑ±Í≥º Î∂ÑÏÑù Î∞è ÏµúÏ†ÅÌôî', icon: 'üìä', url: '/programs/data' },
                { id: 'carrot', name: 'ÎãπÍ∑º ÎπÑÏ¶àÎãàÏä§ ÎßàÏºÄÌåÖ', desc: 'ÏßÄÏó≠ Í∏∞Î∞ò ÎãπÍ∑ºÎßàÏºì ÌôúÏö© Ï†ÑÎûµ', icon: 'ü•ï', url: '/programs/carrot' },
                { id: 'meta', name: 'Î©îÌÉÄ Í¥ëÍ≥†', desc: 'Facebook/Instagram Í¥ëÍ≥† Ïö¥ÏòÅ', icon: 'üìò', url: '/programs/meta' },
                { id: 'youtube-ad', name: 'Ïú†ÌäúÎ∏å Í¥ëÍ≥†', desc: 'Ïú†ÌäúÎ∏å Í¥ëÍ≥† Ï∫†ÌéòÏù∏ Ïö¥ÏòÅ', icon: 'üì∫', url: '/programs/youtube-ad' },
                { id: 'threads', name: 'Ïì∞Î†àÎìú ÎßàÏºÄÌåÖ', desc: 'Meta Threads ÌôúÏö© Ï†ÑÎûµ', icon: 'üßµ', url: '/programs/threads' }
            ];

            const users = ${JSON.stringify(users.results || [])};
            let currentProgram = null;
            let userPermissions = {};

            // ÌîÑÎ°úÍ∑∏Îû® Ïπ¥Îìú Î†åÎçîÎßÅ
            function renderPrograms() {
                const grid = document.getElementById('programsGrid');
                grid.innerHTML = programs.map(p => 
                    '<div onclick="openPermissionModal(\\'' + p.id + '\\')" ' +
                         'class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 hover:border-purple-300 hover:shadow-lg transition cursor-pointer">' +
                        '<div class="text-4xl mb-3">' + p.icon + '</div>' +
                        '<h3 class="text-xl font-bold text-gray-900 mb-2">' + p.name + '</h3>' +
                        '<p class="text-gray-600 text-sm mb-4">' + p.desc + '</p>' +
                        '<div class="flex gap-2">' +
                            '<span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-full">ÌôúÏÑ±Ìôî</span>' +
                            '<a href="' + p.url + '" target="_blank" onclick="event.stopPropagation()" ' +
                               'class="px-3 py-1 bg-blue-100 text-blue-700 text-xs rounded-full hover:bg-blue-200">' +
                                '<i class="fas fa-external-link-alt mr-1"></i>Î≥¥Í∏∞' +
                            '</a>' +
                        '</div>' +
                    '</div>'
                ).join('');
            }

            // Í∂åÌïú Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
            async function openPermissionModal(programId) {
                currentProgram = programs.find(p => p.id === programId);
                document.getElementById('modalProgramIcon').textContent = currentProgram.icon;
                document.getElementById('modalProgramName').textContent = currentProgram.name;

                // ÏÇ¨Ïö©ÏûêÎ≥Ñ Í∂åÌïú Ï°∞Ìöå
                userPermissions = {};
                for (const user of users) {
                    const response = await fetch('/api/user/' + user.id + '/permissions');
                    const data = await response.json();
                    const permissions = data.permissions || [];
                    userPermissions[user.id] = permissions.some(
                        p => p.permission_type === 'program' && p.permission_name === programId && p.is_active === 1
                    );
                }

                renderUsersList();
                document.getElementById('permissionModal').classList.remove('hidden');
            }

            // ÏÇ¨Ïö©Ïûê Î™©Î°ù Î†åÎçîÎßÅ
            function renderUsersList() {
                const list = document.getElementById('usersList');
                list.innerHTML = users.map(user =>
                    '<div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">' +
                        '<div class="flex-1">' +
                            '<p class="font-semibold text-gray-900">' + user.name + '</p>' +
                            '<p class="text-sm text-gray-600">' + user.email + '</p>' +
                        '</div>' +
                        '<label class="flex items-center cursor-pointer">' +
                            '<input type="checkbox" ' +
                                   'id="user-' + user.id + '" ' +
                                   (userPermissions[user.id] ? 'checked' : '') +
                                   ' class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">' +
                            '<span class="ml-3 text-sm font-medium text-gray-900">Í∂åÌïú Î∂ÄÏó¨</span>' +
                        '</label>' +
                    '</div>'
                ).join('');
            }

            // Í∂åÌïú Ï†ÄÏû•
            async function savePermissions() {
                const updates = [];
                
                for (const user of users) {
                    const checkbox = document.getElementById('user-' + user.id);
                    const hasPermission = checkbox.checked;
                    const hadPermission = userPermissions[user.id];

                    if (hasPermission !== hadPermission) {
                        updates.push({ userId: user.id, hasPermission });
                    }
                }

                if (updates.length === 0) {
                    alert('Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                for (const update of updates) {
                    const url = update.hasPermission 
                        ? '/api/admin/permissions/grant'
                        : '/api/admin/permissions/revoke';

                    await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: update.userId,
                            permissionType: 'program',
                            permissionName: currentProgram.id
                        })
                    });
                }

                alert('Í∂åÌïúÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                closeModal();
            }

            function closeModal() {
                document.getElementById('permissionModal').classList.add('hidden');
                currentProgram = null;
            }

            function logout() {
                if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌîÑÎ°úÍ∑∏Îû® Î†åÎçîÎßÅ
            renderPrograms();
        </script>
    </body>
    </html>
  `)
})

// ========================================
// SMS ÌéòÏù¥ÏßÄ ÎùºÏö∞Ìä∏
// ========================================

// Î∞úÏã†Î≤àÌò∏ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/sms/senders', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∞úÏã†Î≤àÌò∏ Í¥ÄÎ¶¨ - SMS Î∞úÏÜ°</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-8">
                        <a href="/dashboard" class="text-xl font-bold text-purple-600">SMS Î∞úÏÜ° ÏãúÏä§ÌÖú</a>
                        <div class="flex space-x-4">
                            <a href="/sms/senders" class="text-purple-600 border-b-2 border-purple-600 px-3 py-2 font-medium">Î∞úÏã†Î≤àÌò∏</a>
                            <a href="/sms/compose" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î¨∏Ïûê ÏûëÏÑ±</a>
                            <a href="/sms/logs" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏÜ° ÎÇ¥Ïó≠</a>
                            <a href="/sms/points" class="text-gray-600 hover:text-purple-600 px-3 py-2">Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <a href="/dashboard" class="text-gray-600 hover:text-purple-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-6xl mx-auto">
                <!-- Header -->
                <div class="mb-8 flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">üì± Î∞úÏã†Î≤àÌò∏ Í¥ÄÎ¶¨</h1>
                        <p class="text-gray-600">Î¨∏Ïûê Î∞úÏÜ°Ïóê ÏÇ¨Ïö©Ìï† Î∞úÏã†Î≤àÌò∏Î•º Í¥ÄÎ¶¨Ìï©ÎãàÎã§</p>
                    </div>
                    <a href="/sms/sender/request" 
                       class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg font-bold hover:from-green-700 hover:to-green-800 transition shadow-md hover:shadow-lg flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        <span>Ïù∏Ï¶ù Ïã†Ï≤≠</span>
                    </a>
                </div>

                <!-- ÏïåÎ¶¨Í≥† ÏïàÎÇ¥ -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-6 mb-6">
                    <div class="flex items-start space-x-3">
                        <svg class="w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <div>
                            <h3 class="font-semibold text-orange-900 mb-2">‚ö†Ô∏è Î∞úÏã†Î≤àÌò∏ Îì±Î°ù ÏïàÎÇ¥</h3>
                            <ol class="text-sm text-orange-800 space-y-1">
                                <li>1. Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ÏùÑ ÏôÑÎ£å</li>
                                <li>2. ÏïÑÎûò "Î∞úÏã†Î≤àÌò∏ Ï∂îÍ∞Ä" Î≤ÑÌäºÏúºÎ°ú Ïù∏Ï¶ùÎêú Î≤àÌò∏Î•º ÏãúÏä§ÌÖúÏóê Îì±Î°ù</li>
                                <li>3. Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏Î°ú Î¨∏Ïûê Î∞úÏÜ° Í∞ÄÎä•</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Î∞úÏã†Î≤àÌò∏ Ï∂îÍ∞Ä -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Î∞úÏã†Î≤àÌò∏ Ï∂îÍ∞Ä</h2>
                    <div class="flex gap-4">
                        <input type="text" id="phoneNumber" placeholder="010-1234-5678" 
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            onkeypress="if(event.key === 'Enter') registerSender()">
                        <button id="registerButton" onclick="registerSender()" 
                            class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition font-medium shadow-sm">
                            Îì±Î°ùÌïòÍ∏∞
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">üí° Î®ºÏ†Ä Ïù∏Ï¶ù Ïã†Ï≤≠ÏùÑ ÏôÑÎ£åÌïú ÌõÑ, Ïù∏Ï¶ùÎêú Î≤àÌò∏Î•º Ïó¨Í∏∞ÏÑú Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî</p>
                </div>

                <!-- Î∞úÏã†Î≤àÌò∏ Î™©Î°ù -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-900">Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏</h2>
                    </div>
                    <div id="sendersContainer" class="divide-y divide-gray-200">
                        <!-- Î°úÎî© ÏÉÅÌÉú -->
                        <div class="p-8 text-center text-gray-500">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-4"></div>
                            Î∂àÎü¨Ïò§Îäî Ï§ë...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let currentUserId = null;

            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            async function checkAuth() {
                const user = localStorage.getItem('user');
                if (!user) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/login';
                    return null;
                }
                const userData = JSON.parse(user);
                currentUserId = userData.id;
                return userData;
            }

            // Î∞úÏã†Î≤àÌò∏ Î™©Î°ù Î°úÎìú
            async function loadSenders() {
                try {
                    const response = await fetch(\`/api/sms/senders?userId=\${currentUserId}\`);
                    const data = await response.json();

                    const container = document.getElementById('sendersContainer');
                    
                    if (data.success && data.senders.length > 0) {
                        container.innerHTML = data.senders.map(sender => \`
                            <div class="p-6 hover:bg-gray-50 transition">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-gray-900 text-lg">\${formatPhoneNumber(sender.phone_number)}</div>
                                            <div class="text-sm text-gray-500">Ïù∏Ï¶ù: \${sender.verification_date || 'Ïïå Ïàò ÏóÜÏùå'}</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full">
                                            ‚úì Ïù∏Ï¶ùÏôÑÎ£å
                                        </span>
                                        <button onclick="deleteSender(\${sender.id})" 
                                            class="text-red-600 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        \`).join('');
                    } else {
                        container.innerHTML = \`
                            <div class="p-12 text-center">
                                <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                </svg>
                                <p class="text-gray-500 mb-2">Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§</p>
                                <p class="text-sm text-gray-400">ÏïåÎ¶¨Í≥† ÏõπÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Ïù∏Ï¶ù ÌõÑ Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî</p>
                            </div>
                        \`;
                    }
                } catch (err) {
                    console.error('Failed to load senders:', err);
                    alert('Î∞úÏã†Î≤àÌò∏ Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            }

            // Ï†ÑÌôîÎ≤àÌò∏ Ìè¨Îß∑ÌåÖ
            function formatPhoneNumber(phone) {
                if (phone.length === 10) {
                    return phone.replace(/(\\d{3})(\\d{3})(\\d{4})/, '$1-$2-$3');
                } else if (phone.length === 11) {
                    return phone.replace(/(\\d{3})(\\d{4})(\\d{4})/, '$1-$2-$3');
                }
                return phone;
            }

            // Î∞úÏã†Î≤àÌò∏ Îì±Î°ù
            async function registerSender() {
                console.log('registerSender called, userId:', currentUserId);
                
                if (!currentUserId) {
                    alert('Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    window.location.href = '/login';
                    return;
                }
                
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                
                if (!phoneNumber) {
                    alert('Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    console.log('Sending register request:', { userId: currentUserId, phoneNumber });
                    
                    const response = await fetch('/api/sms/sender/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUserId,
                            phoneNumber: phoneNumber,
                            verificationMethod: 'aligo_web'
                        })
                    });

                    const data = await response.json();
                    console.log('Register response:', data);

                    if (data.success) {
                        alert('‚úÖ Î∞úÏã†Î≤àÌò∏Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
                        document.getElementById('phoneNumber').value = '';
                        loadSenders();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Failed to register sender:', err);
                    alert('Î∞úÏã†Î≤àÌò∏ Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message);
                }
            }

            // Î∞úÏã†Î≤àÌò∏ ÏÇ≠Ï†ú
            async function deleteSender(senderId) {
                if (!confirm('Ïù¥ Î∞úÏã†Î≤àÌò∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }

                try {
                    const response = await fetch(\`/api/sms/sender/\${senderId}?userId=\${currentUserId}\`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('‚úÖ Î∞úÏã†Î≤àÌò∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                        loadSenders();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Failed to delete sender:', err);
                    alert('Î∞úÏã†Î≤àÌò∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
            (async () => {
                console.log('Page loaded, initializing...');
                await checkAuth();
                if (currentUserId) {
                    console.log('User authenticated, userId:', currentUserId);
                    loadSenders();
                    
                    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä (Ïù¥Ï§ë Î≥¥Ïïà)
                    const registerBtn = document.getElementById('registerButton');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', registerSender);
                        console.log('Register button event listener added');
                    }
                } else {
                    console.error('User not authenticated');
                }
            })();
        </script>
    </body>
    </html>
  `)
})

// Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ ÌéòÏù¥ÏßÄ
app.get('/sms/sender/request', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ - SMS ÏãúÏä§ÌÖú</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-5xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <a href="/dashboard" class="text-lg font-bold text-gray-900">‚Üê ÎåÄÏãúÎ≥¥Îìú</a>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/sms/senders" class="text-gray-600 hover:text-purple-600 transition">Î∞úÏã†Î≤àÌò∏ Í¥ÄÎ¶¨</a>
                        <span id="userName" class="text-gray-700 font-medium"></span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-3xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">üì± Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠</h1>
                    <p class="text-gray-600">ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ùÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† Î∞úÏã†Î≤àÌò∏Î•º Îì±Î°ùÌïòÏÑ∏Ïöî</p>
                </div>

                <!-- ÏïàÎÇ¥ ÏÇ¨Ìï≠ -->
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 text-blue-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-800">
                            <p class="font-bold mb-3">üìã ÌïÑÏöî ÏÑúÎ•ò Î∞è Ï†àÏ∞®</p>
                            <ul class="space-y-2 list-disc list-inside ml-2">
                                <li><strong>ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù</strong> (ÌïÑÏàò)</li>
                                <li><strong>ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê</strong> (ÌïÑÏàò)
                                    <ul class="ml-6 mt-1 text-xs space-y-1">
                                        <li>‚úì Î∞úÍ∏âÏùºÏûê: ÏµúÍ∑º 1Í∞úÏõî Ïù¥ÎÇ¥</li>
                                        <li>‚úì Í∞ÄÏûÖÏûê Ï†ïÎ≥¥(Í∞ÄÏûÖÎ≤àÌò∏, Í∞ÄÏûÖÏûêÎ™Ö, Í∞úÌÜµÏùºÏûê, Î∞úÍ∏âÏùºÏûê) Î™®Îëê Í∏∞Ïû¨</li>
                                        <li>‚úì Î∞úÏã†Î≤àÌò∏Í∞Ä 010-1234-5678 ÌòïÏãùÏúºÎ°ú Î™ÖÌôïÌûà ÌëúÏãú</li>
                                        <li>‚úì Í∞ÄÎ†§ÏßÑ Ï†ïÎ≥¥ ÏóÜÏù¥, ÏûòÎ¶∞ Î∂ÄÎ∂Ñ ÏóÜÏù¥ Ï≤®Î∂Ä</li>
                                    </ul>
                                </li>
                                <li><strong>ÎåÄÌëúÏûê Ïã†Î∂ÑÏ¶ù</strong> ÎòêÎäî <strong>Ïû¨ÏßÅÏûê Ïã†Î∂ÑÏ¶ù + Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú</strong> (ÌïÑÏàò)
                                    <ul class="ml-6 mt-1 text-xs space-y-1">
                                        <li>‚úì Ï£ºÎØºÎ≤àÌò∏ Îí∑ÏûêÎ¶¨, ÎØºÍ∞êÏ†ïÎ≥¥ ÎßàÏä§ÌÇπ ÌïÑÏàò</li>
                                        <li>‚úì Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú: ÎèÑÏû• ÎÇ†Ïù∏ ÌïÑÏàò</li>
                                    </ul>
                                </li>
                                <li><strong>Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú</strong> (ÌïÑÏàò, ÎèÑÏû• ÎÇ†Ïù∏ ÌïÑÏàò)</li>
                                <li>ÌååÏùº ÌòïÏãù: JPG, PNG, PDF, DOC, DOCX (Í∞Å ÌååÏùº ÏµúÎåÄ 5MB)</li>
                                <li>ÏäπÏù∏ ÏÜåÏöî: ÌèâÏùº ÏóÖÎ¨¥ÏãúÍ∞Ñ(10Ïãú~17Ïãú) ÎÇ¥ ÌèâÍ∑† 1~3ÏãúÍ∞Ñ ÏÜåÏöî</li>
                                <li class="text-red-700 font-bold">‚ö†Ô∏è Î™®Îì† ÏÑúÎ•òÎäî Ï†ëÏàòÏùº Í∏∞Ï§Ä ÏµúÍ∑º 1Í∞úÏõî Ïù¥ÎÇ¥Îßå Ïù∏Ï†ï</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- ÏÑúÎ•ò ÏñëÏãù Îã§Ïö¥Î°úÎìú -->
                <div class="bg-green-50 border border-green-200 rounded-xl p-6 mb-8">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 text-green-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        <div class="text-sm text-green-800">
                            <p class="font-bold mb-3">üì• ÏÑúÎ•ò ÏñëÏãù Îã§Ïö¥Î°úÎìú</p>
                            <div class="flex flex-wrap gap-3">
                                <a href="/downloads/Î∞úÏã†Î≤àÌò∏_ÏÇ¨Ï†ÑÎì±Î°ù_ÎåÄÎ¶¨_Ïã†Ï≤≠ÏÑú.docx" download class="px-4 py-2 bg-white border border-green-300 rounded-lg hover:bg-green-100 transition font-medium">
                                    üìÑ Î∞úÏã†Î≤àÌò∏ ÏÇ¨Ï†ÑÎì±Î°ù ÎåÄÎ¶¨ Ïã†Ï≤≠ÏÑú
                                </a>
                                <a href="/downloads/Î¨∏ÏûêÎ©îÏãúÏßÄ_Ïù¥Ïö©Í≥ÑÏïΩÏÑú.docx" download class="px-4 py-2 bg-white border border-green-300 rounded-lg hover:bg-green-100 transition font-medium">
                                    üìÑ Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú
                                </a>
                                <a href="/api/downloads/employment-cert" download class="px-4 py-2 bg-white border border-green-300 rounded-lg hover:bg-green-100 transition font-medium">
                                    üìÑ Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú ÏñëÏãù
                                </a>
                            </div>
                            <p class="mt-3 text-xs text-green-700">üí° ÎèÑÏû•(ÏßÅÏù∏)ÏùÄ Ïã∏Ïù∏Ïù¥ ÏïàÎêòÎ©∞ Î∞òÎìúÏãú ÎèÑÏû•ÏúºÎ°úÎßå Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                        </div>
                    </div>
                </div>

                <!-- Ïã†Ï≤≠ Ìèº -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8">
                    <form id="verificationForm" class="space-y-6">
                        <!-- ÏÇ¨ÏóÖÏûê Ï†ïÎ≥¥ -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ÏÇ¨ÏóÖÏ≤¥Î™Ö *</label>
                            <input type="text" id="businessName" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="Ïòà: Íæ∏Î©îÎïÖÌïôÏõê">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ÏÇ¨ÏóÖÏûê Îì±Î°ùÎ≤àÌò∏ *</label>
                            <input type="text" id="businessRegistrationNumber" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="123-45-67890"
                                   maxlength="12">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Î∞úÏã†Î≤àÌò∏ (Ìú¥ÎåÄÌè∞) *</label>
                            <input type="text" id="phoneNumber" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="010-1234-5678"
                                   maxlength="13">
                            <p class="text-xs text-gray-500 mt-1">ÌïòÏù¥Ìîà(-)ÏùÑ Ìè¨Ìï®ÌïòÏó¨ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</p>
                        </div>

                        <!-- 1. ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù ÏóÖÎ°úÎìú -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">1. ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù * <span class="text-red-600">(ÌïÑÏàò)</span></label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition cursor-pointer upload-area"
                                 data-target="businessRegistrationImage">
                                <input type="file" id="businessRegistrationImage" accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="hidden" required>
                                <div class="upload-placeholder">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-gray-600 font-medium mb-1">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                                    <p class="text-sm text-gray-500">JPG, PNG, PDF, DOC, DOCX (ÏµúÎåÄ 5MB)</p>
                                </div>
                                <div class="upload-preview hidden">
                                    <img class="preview-image max-w-full max-h-64 mx-auto rounded-lg mb-3">
                                    <p class="file-name text-sm text-gray-600 font-medium"></p>
                                    <button type="button" class="reset-upload text-sm text-red-600 hover:text-red-700 mt-2">
                                        Îã§Ïãú ÏÑ†ÌÉù
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 2. ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê ÏóÖÎ°úÎìú -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">2. ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê * <span class="text-red-600">(ÌïÑÏàò)</span></label>
                            <p class="text-xs text-gray-500 mb-2">Î∞úÏã†Î≤àÌò∏Í∞Ä Î™ÖÌôïÌûà ÌëúÏãúÎêòÏñ¥Ïïº Ìï©ÎãàÎã§ (010-1234-5678 ÌòïÏãù, Í∞ÄÎ¶º ÏóÜÏù¥)</p>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition cursor-pointer upload-area"
                                 data-target="certificateImage">
                                <input type="file" id="certificateImage" accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="hidden" required>
                                <div class="upload-placeholder">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-gray-600 font-medium mb-1">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                                    <p class="text-sm text-gray-500">JPG, PNG, PDF, DOC, DOCX (ÏµúÎåÄ 5MB)</p>
                                </div>
                                <div class="upload-preview hidden">
                                    <img class="preview-image max-w-full max-h-64 mx-auto rounded-lg mb-3">
                                    <p class="file-name text-sm text-gray-600 font-medium"></p>
                                    <button type="button" class="reset-upload text-sm text-red-600 hover:text-red-700 mt-2">
                                        Îã§Ïãú ÏÑ†ÌÉù
                                    </button>
                                </div>
                            </div>
                            <p class="text-xs text-blue-600 mt-2">üí° ÌÜµÏã†ÏÇ¨ 114 Î¨∏Ïùò Ïãú: "Í≥†Í∞ù ÏùëÎåÄÏö© Î¨∏Ïûê Î∞úÏã†Îì±Î°ùÏö©"Ïù¥ÎùºÍ≥† ÎãµÎ≥ÄÌïòÏÑ∏Ïöî</p>
                        </div>
                        
                        <!-- 3. Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú ÏóÖÎ°úÎìú -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">3. Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú * <span class="text-red-600">(ÌïÑÏàò, ÎèÑÏû• ÎÇ†Ïù∏ ÌïÑÏàò)</span></label>
                            <p class="text-xs text-gray-500 mb-2">ÏÇ¨ÏóÖÏûê ÎåÄÌëúÎèÑ Î≥∏Ïù∏Ïùò Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú Ï†úÏ∂ú ÌïÑÏöî</p>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition cursor-pointer upload-area"
                                 data-target="employmentCertImage">
                                <input type="file" id="employmentCertImage" accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="hidden" required>
                                <div class="upload-placeholder">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-gray-600 font-medium mb-1">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                                    <p class="text-sm text-gray-500">JPG, PNG, PDF, DOC, DOCX (ÏµúÎåÄ 5MB)</p>
                                </div>
                                <div class="upload-preview hidden">
                                    <img class="preview-image max-w-full max-h-64 mx-auto rounded-lg mb-3">
                                    <p class="file-name text-sm text-gray-600 font-medium"></p>
                                    <button type="button" class="reset-upload text-sm text-red-600 hover:text-red-700 mt-2">
                                        Îã§Ïãú ÏÑ†ÌÉù
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 4. Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú ÏóÖÎ°úÎìú -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">4. Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú * <span class="text-red-600">(ÌïÑÏàò, ÎèÑÏû• ÎÇ†Ïù∏ ÌïÑÏàò)</span></label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition cursor-pointer upload-area"
                                 data-target="contractImage">
                                <input type="file" id="contractImage" accept="image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" class="hidden" required>
                                <div class="upload-placeholder">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-gray-600 font-medium mb-1">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                                    <p class="text-sm text-gray-500">JPG, PNG, PDF, DOC, DOCX (ÏµúÎåÄ 5MB)</p>
                                </div>
                                <div class="upload-preview hidden">
                                    <img class="preview-image max-w-full max-h-64 mx-auto rounded-lg mb-3">
                                    <p class="file-name text-sm text-gray-600 font-medium"></p>
                                    <button type="button" class="reset-upload text-sm text-red-600 hover:text-red-700 mt-2">
                                        Îã§Ïãú ÏÑ†ÌÉù
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Ï†úÏ∂ú Î≤ÑÌäº -->
                        <div class="flex gap-4 pt-4">
                            <button type="button" onclick="history.back()"
                                    class="flex-1 px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-bold hover:bg-gray-50 transition">
                                Ï∑®ÏÜå
                            </button>
                            <button type="submit" id="submitButton"
                                    class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg font-bold hover:from-purple-700 hover:to-purple-800 transition shadow-md hover:shadow-lg">
                                Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Ïã†Ï≤≠ ÎÇ¥Ïó≠ -->
                <div class="mt-8 bg-white rounded-xl shadow-lg border border-gray-200 p-8">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">üìã Ïã†Ï≤≠ ÎÇ¥Ïó≠</h2>
                    <div id="requestsList" class="space-y-4">
                        <div class="text-center text-gray-500 py-8">
                            <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p>Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const user = JSON.parse(localStorage.getItem('user'))
            if (!user) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.')
                window.location.href = '/login'
            }
            document.getElementById('userName').textContent = user.name

            // ÏÇ¨ÏóÖÏûê Îì±Î°ùÎ≤àÌò∏ ÏûêÎèô ÌïòÏù¥Ìîà Ï∂îÍ∞Ä
            document.getElementById('businessRegistrationNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^0-9]/g, '')
                if (value.length > 3 && value.length <= 5) {
                    value = value.slice(0, 3) + '-' + value.slice(3)
                } else if (value.length > 5) {
                    value = value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5, 10)
                }
                e.target.value = value
            })

            // Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô ÌïòÏù¥Ìîà Ï∂îÍ∞Ä
            document.getElementById('phoneNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^0-9]/g, '')
                if (value.length > 3 && value.length <= 7) {
                    value = value.slice(0, 3) + '-' + value.slice(3)
                } else if (value.length > 7) {
                    value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11)
                }
                e.target.value = value
            })

            // ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ (4Í∞ú ÌååÏùº)
            document.querySelectorAll('.upload-area').forEach(uploadArea => {
                const inputId = uploadArea.dataset.target
                const fileInput = document.getElementById(inputId)
                const placeholder = uploadArea.querySelector('.upload-placeholder')
                const preview = uploadArea.querySelector('.upload-preview')
                const previewImage = preview.querySelector('.preview-image')
                const fileNameEl = preview.querySelector('.file-name')
                const resetBtn = preview.querySelector('.reset-upload')

                uploadArea.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('reset-upload')) {
                        fileInput.click()
                    }
                })
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault()
                    uploadArea.classList.add('border-purple-500', 'bg-purple-50')
                })

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('border-purple-500', 'bg-purple-50')
                })

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault()
                    uploadArea.classList.remove('border-purple-500', 'bg-purple-50')
                    const file = e.dataTransfer.files[0]
                    if (file && (
                        file.type.startsWith('image/') || 
                        file.type === 'application/pdf' ||
                        file.type === 'application/msword' ||
                        file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                    )) {
                        handleFileUpload(file, fileInput, placeholder, preview, previewImage, fileNameEl)
                    } else if (file) {
                        alert('JPG, PNG, PDF, DOC, DOCX ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.')
                    }
                })

                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0]
                    if (file) {
                        handleFileUpload(file, fileInput, placeholder, preview, previewImage, fileNameEl)
                    }
                })

                resetBtn.addEventListener('click', (e) => {
                    e.stopPropagation()
                    fileInput.value = ''
                    placeholder.classList.remove('hidden')
                    preview.classList.add('hidden')
                    previewImage.src = ''
                    fileNameEl.textContent = ''
                })
            })

            function handleFileUpload(file, fileInput, placeholder, preview, previewImage, fileNameEl) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('ÌååÏùº ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.')
                    return
                }

                // ÌååÏùº ÌÉÄÏûÖ Í≤ÄÏ¶ù
                const allowedTypes = [
                    'image/jpeg', 
                    'image/jpg', 
                    'image/png', 
                    'application/pdf',
                    'application/msword', // .doc
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document' // .docx
                ]
                if (!allowedTypes.includes(file.type)) {
                    alert('JPG, PNG, PDF, DOC, DOCX ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.')
                    return
                }

                const reader = new FileReader()
                reader.onload = (e) => {
                    // PDFÏôÄ Word ÌååÏùºÏùÄ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ ÎåÄÏã† ÌååÏùºÎ™ÖÎßå ÌëúÏãú
                    if (file.type === 'application/pdf') {
                        previewImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjQwIiBmaWxsPSIjZWY0NDQ0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+UERGPC90ZXh0Pjwvc3ZnPg=='
                        previewImage.classList.add('max-h-32')
                    } else if (file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                        previewImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjM1IiBmaWxsPSIjMjk2N2FhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+RE9DPC90ZXh0Pjwvc3ZnPg=='
                        previewImage.classList.add('max-h-32')
                    } else {
                        previewImage.src = e.target.result
                        previewImage.classList.remove('max-h-32')
                    }
                    fileNameEl.textContent = file.name
                    placeholder.classList.add('hidden')
                    preview.classList.remove('hidden')
                }
                reader.readAsDataURL(file)
            }

            // R2 ÏóÖÎ°úÎìú Ìï®Ïàò (imgbb ÎåÄÏ≤¥)
            async function uploadToR2(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader()
                    reader.onload = async (e) => {
                        try {
                            const response = await fetch('/api/upload/document', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    userId: user.id,
                                    fileName: file.name,
                                    fileData: e.target.result,
                                    fileType: file.type
                                })
                            })
                            
                            const data = await response.json()
                            if (data.success) {
                                resolve(data.url)
                            } else {
                                reject(new Error(data.error || 'Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïã§Ìå®'))
                            }
                        } catch (err) {
                            reject(err)
                        }
                    }
                    reader.onerror = () => reject(new Error('ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®'))
                    reader.readAsDataURL(file)
                })
            }

            // Ìèº Ï†úÏ∂ú
            document.getElementById('verificationForm').addEventListener('submit', async function(e) {
                e.preventDefault()
                
                const submitButton = document.getElementById('submitButton')
                submitButton.disabled = true
                submitButton.textContent = 'ÏóÖÎ°úÎìú Ï§ë... (ÏµúÎåÄ 4Î∂Ñ ÏÜåÏöî)'

                try {
                    const businessName = document.getElementById('businessName').value
                    const businessRegistrationNumber = document.getElementById('businessRegistrationNumber').value
                    const phoneNumber = document.getElementById('phoneNumber').value
                    
                    // 4Í∞ú ÌååÏùº Í∞ÄÏ†∏Ïò§Í∏∞
                    const businessRegFile = document.getElementById('businessRegistrationImage').files[0]
                    const certificateFile = document.getElementById('certificateImage').files[0]
                    const employmentFile = document.getElementById('employmentCertImage').files[0]
                    const contractFile = document.getElementById('contractImage').files[0]

                    if (!businessRegFile || !certificateFile || !employmentFile || !contractFile) {
                        alert('Î™®Îì† ÏÑúÎ•òÎ•º ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.')
                        submitButton.disabled = false
                        submitButton.textContent = 'Ïã†Ï≤≠ÌïòÍ∏∞'
                        return
                    }

                    // ÏàúÏ∞®Ï†ÅÏúºÎ°ú Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú (R2 ÏÇ¨Ïö©)
                    submitButton.textContent = 'ÏóÖÎ°úÎìú Ï§ë... (1/4)'
                    const businessRegUrl = await uploadToR2(businessRegFile)
                    
                    submitButton.textContent = 'ÏóÖÎ°úÎìú Ï§ë... (2/4)'
                    const certificateUrl = await uploadToR2(certificateFile)
                    
                    submitButton.textContent = 'ÏóÖÎ°úÎìú Ï§ë... (3/4)'
                    const employmentUrl = await uploadToR2(employmentFile)
                    
                    submitButton.textContent = 'ÏóÖÎ°úÎìú Ï§ë... (4/4)'
                    const contractUrl = await uploadToR2(contractFile)

                    submitButton.textContent = 'Ïã†Ï≤≠ Ï§ë...'

                    // Ïã†Ï≤≠ API Ìò∏Ï∂ú
                    const response = await fetch('/api/sms/sender/verification-request', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: user.id,
                            phoneNumber,
                            businessName,
                            businessRegistrationNumber,
                            businessRegistrationImage: businessRegUrl,
                            certificateImage: certificateUrl,
                            employmentCertImage: employmentUrl,
                            contractImage: contractUrl
                        })
                    })

                    const data = await response.json()

                    console.log('API Response:', data) // ÎîîÎ≤ÑÍπÖÏö©

                    if (data.success) {
                        alert('‚úÖ Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\nÍ¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§. (ÌèâÏùº Í∏∞Ï§Ä 2~3Ïùº ÏÜåÏöî)')
                        document.getElementById('verificationForm').reset()
                        // Î™®Îì† ÌîÑÎ¶¨Î∑∞ Ï¥àÍ∏∞Ìôî
                        document.querySelectorAll('.upload-preview').forEach(p => p.classList.add('hidden'))
                        document.querySelectorAll('.upload-placeholder').forEach(p => p.classList.remove('hidden'))
                        loadRequests()
                    } else {
                        console.error('API Error:', data.error)
                        alert('‚ùå Ïã†Ï≤≠ Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'))
                    }
                } catch (err) {
                    console.error('Submission error:', err)
                    alert('‚ùå Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message)
                } finally {
                    submitButton.disabled = false
                    submitButton.textContent = 'Ïã†Ï≤≠ÌïòÍ∏∞'
                }
            })

            // Ïã†Ï≤≠ ÎÇ¥Ïó≠ Î°úÎìú
            async function loadRequests() {
                try {
                    const response = await fetch('/api/sms/sender/verification-requests?userId=' + user.id)
                    const data = await response.json()

                    const container = document.getElementById('requestsList')
                    
                    if (data.success && data.requests.length > 0) {
                        container.innerHTML = data.requests.map(req => {
                            const statusColor = req.status === 'pending' ? 'yellow' : req.status === 'approved' ? 'green' : 'red'
                            const statusText = req.status === 'pending' ? 'ÏäπÏù∏ ÎåÄÍ∏∞' : req.status === 'approved' ? 'ÏäπÏù∏ ÏôÑÎ£å' : 'Í±∞Ï†àÎê®'
                            
                            return \`
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <p class="font-bold text-gray-900">\${req.business_name}</p>
                                            <p class="text-sm text-gray-600">\${req.phone_number}</p>
                                        </div>
                                        <span class="px-3 py-1 bg-\${statusColor}-100 text-\${statusColor}-700 text-sm font-medium rounded-full">
                                            \${statusText}
                                        </span>
                                    </div>
                                    <div class="text-sm text-gray-600 space-y-1">
                                        <p>ÏÇ¨ÏóÖÏûêÎ≤àÌò∏: \${req.business_registration_number}</p>
                                        <p>Ïã†Ï≤≠Ïùº: \${new Date(req.request_date).toLocaleString('ko-KR')}</p>
                                        \${req.admin_note ? '<p class="text-red-600">Í¥ÄÎ¶¨Ïûê Î©îÎ™®: ' + req.admin_note + '</p>' : ''}
                                    </div>
                                    <a href="\${req.business_registration_image}" target="_blank" 
                                       class="inline-block mt-3 text-sm text-purple-600 hover:text-purple-700 font-medium">
                                        ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù Î≥¥Í∏∞ ‚Üí
                                    </a>
                                </div>
                            \`
                        }).join('')
                    } else {
                        container.innerHTML = \`
                            <div class="text-center text-gray-500 py-8">
                                <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <p>Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                            </div>
                        \`
                    }
                } catch (err) {
                    console.error('Load requests error:', err)
                }
            }

            loadRequests()
        </script>
    </body>
    </html>
  `)
})

// Î¨∏Ïûê ÏûëÏÑ± ÌéòÏù¥ÏßÄ
app.get('/sms/compose', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¨∏Ïûê ÏûëÏÑ± - SMS Î∞úÏÜ°</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-8">
                        <a href="/dashboard" class="text-xl font-bold text-purple-600">SMS Î∞úÏÜ° ÏãúÏä§ÌÖú</a>
                        <div class="flex space-x-4">
                            <a href="/sms/senders" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏã†Î≤àÌò∏</a>
                            <a href="/sms/compose" class="text-purple-600 border-b-2 border-purple-600 px-3 py-2 font-medium">Î¨∏Ïûê ÏûëÏÑ±</a>
                            <a href="/sms/logs" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏÜ° ÎÇ¥Ïó≠</a>
                            <a href="/sms/points" class="text-gray-600 hover:text-purple-600 px-3 py-2">Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <a href="/dashboard" class="text-gray-600 hover:text-purple-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-6xl mx-auto">
                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">‚úâÔ∏è Î¨∏Ïûê ÏûëÏÑ±</h1>
                    <p class="text-gray-600">Î¨∏Ïûê Î©îÏãúÏßÄÎ•º ÏûëÏÑ±ÌïòÍ≥† Î∞úÏÜ°Ìï©ÎãàÎã§</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ÏôºÏ™Ω: Î¨∏Ïûê ÏûëÏÑ± -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Î∞úÏã†Î≤àÌò∏ ÏÑ†ÌÉù -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <label class="block text-sm font-semibold text-gray-900 mb-3">Î∞úÏã†Î≤àÌò∏</label>
                            <select id="senderId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Î∞úÏã†Î≤àÌò∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            </select>
                        </div>

                        <!-- ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨ -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-semibold text-gray-900">üìÅ ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨</h3>
                                <div class="flex gap-2">
                                    <button onclick="openFolderModal()" class="text-xs px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
                                        + Ìè¥Îçî
                                    </button>
                                    <button onclick="saveTemplate()" class="text-xs px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition">
                                        üíæ Ï†ÄÏû•
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Ìè¥Îçî ÌÉ≠ -->
                            <div class="flex gap-2 mb-3 overflow-x-auto pb-2" id="folderTabs">
                                <button onclick="selectFolder(null)" class="folder-tab active px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap bg-purple-100 text-purple-700">
                                    Ï†ÑÏ≤¥
                                </button>
                            </div>
                            
                            <!-- ÌÖúÌîåÎ¶ø Î™©Î°ù -->
                            <div id="templateList" class="space-y-2 max-h-40 overflow-y-auto">
                                <p class="text-xs text-gray-400 text-center py-3">ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            </div>
                        </div>

                        <!-- Î©îÏãúÏßÄ ÏûëÏÑ± -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-sm font-semibold text-gray-900">Î©îÏãúÏßÄ ÎÇ¥Ïö©</label>
                                <div class="flex items-center space-x-2">
                                    <span id="byteCount" class="text-sm font-medium text-gray-600">0</span>
                                    <span class="text-sm text-gray-400">/ 2000 Î∞îÏù¥Ìä∏</span>
                                </div>
                            </div>
                            
                            <!-- ÏπòÌôò Î≥ÄÏàò Î≤ÑÌäºÎì§ -->
                            <div class="flex flex-wrap gap-2 mb-3">
                                <button onclick="insertVariable('#{Ïù¥Î¶Ñ}')" class="text-xs px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition">
                                    + #{Ïù¥Î¶Ñ}
                                </button>
                                <button onclick="insertVariable('#{Ï†ÑÌôîÎ≤àÌò∏}')" class="text-xs px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition">
                                    + #{Ï†ÑÌôîÎ≤àÌò∏}
                                </button>
                                <button onclick="insertVariable('#{ÌïôÎÖÑ}')" class="text-xs px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition">
                                    + #{ÌïôÎÖÑ}
                                </button>
                                <button onclick="insertVariable('#{Î∞ò}')" class="text-xs px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition">
                                    + #{Î∞ò}
                                </button>
                            </div>
                            
                            <textarea id="message" rows="10" 
                                placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;&#10;ÏπòÌôò Î≥ÄÏàò ÏÇ¨Ïö© ÏòàÏãú:&#10;ÏïàÎÖïÌïòÏÑ∏Ïöî #{Ïù¥Î¶Ñ} ÌïôÎ∂ÄÎ™®Îãò!&#10;Íæ∏Î©îÎïÖÌïôÏõêÏûÖÎãàÎã§."
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                            <div class="flex items-center justify-between mt-3">
                                <span id="messageType" class="text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 rounded-full">SMS (Îã®Î¨∏)</span>
                                <p class="text-xs text-gray-500">90Î∞îÏù¥Ìä∏ Ï¥àÍ≥º Ïãú LMS(Ïû•Î¨∏)Î°ú ÏûêÎèô Ï†ÑÌôò</p>
                            </div>
                        </div>

                        <!-- ÏòàÏïΩ Î∞úÏÜ° -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <label class="flex items-center space-x-3 mb-4">
                                <input type="checkbox" id="reserveEnabled" class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                <span class="text-sm font-semibold text-gray-900">ÏòàÏïΩ Î∞úÏÜ°</span>
                            </label>
                            <input type="datetime-local" id="reserveTime" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 disabled:bg-gray-100 disabled:text-gray-400" 
                                disabled>
                        </div>
                    </div>

                    <!-- Ïò§Î•∏Ï™Ω: ÏàòÏã†Ïûê Í¥ÄÎ¶¨ -->
                    <div class="space-y-6">
                        <!-- ÏàòÏã†Ïûê Ï∂îÍ∞Ä -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <h3 class="text-sm font-semibold text-gray-900 mb-4">ÏàòÏã†Ïûê Ï∂îÍ∞Ä</h3>
                            <div class="space-y-3 mb-4">
                                <input type="text" id="receiverName" placeholder="Ïù¥Î¶Ñ" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <input type="text" id="receiverPhone" placeholder="010-1234-5678" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <button onclick="addReceiver()" 
                                class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition font-medium">
                                + ÏàòÏã†Ïûê Ï∂îÍ∞Ä
                            </button>
                        </div>

                        <!-- ÏóëÏÖÄ ÏóÖÎ°úÎìú -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <h3 class="text-sm font-semibold text-gray-900 mb-4">ÏóëÏÖÄ ÏóÖÎ°úÎìú</h3>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition cursor-pointer" 
                                onclick="document.getElementById('excelFile').click()">
                                <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                                <p class="text-sm text-gray-600">ÌÅ¥Î¶≠ ÎòêÎäî ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏóÖÎ°úÎìú</p>
                                <p class="text-xs text-gray-400 mt-1">Ïù¥Î¶Ñ, Ï†ÑÌôîÎ≤àÌò∏ Ïª¨Îüº ÌïÑÏàò</p>
                            </div>
                            <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden" onchange="uploadExcel(event)">
                        </div>

                        <!-- ÏàòÏã†Ïûê Î™©Î°ù -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-semibold text-gray-900">ÏàòÏã†Ïûê Î™©Î°ù</h3>
                                <span id="receiverCount" class="text-sm font-medium text-purple-600">0Î™Ö</span>
                            </div>
                            
                            <!-- Í≤ÄÏÉâ ÏûÖÎ†• -->
                            <div class="mb-3">
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        id="receiverSearch" 
                                        placeholder="Ïù¥Î¶Ñ ÎòêÎäî Ï†ÑÌôîÎ≤àÌò∏Î°ú Í≤ÄÏÉâ..." 
                                        oninput="filterReceivers()"
                                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
                                    >
                                    <svg class="w-5 h-5 absolute left-3 top-2.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div id="receiversContainer" class="space-y-2 max-h-64 overflow-y-auto">
                                <p class="text-sm text-gray-400 text-center py-4">ÏàòÏã†ÏûêÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî</p>
                            </div>
                            <button onclick="clearReceivers()" 
                                class="w-full mt-4 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition text-sm">
                                Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                            </button>
                        </div>

                        <!-- Î∞úÏÜ° ÎπÑÏö© -->
                        <div class="bg-purple-50 rounded-lg p-6">
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">ÏàòÏã†Ïûê Ïàò</span>
                                    <span id="costReceivers" class="font-medium">0Î™Ö</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Í±¥Îãπ ÏöîÍ∏à</span>
                                    <span id="costPerMessage" class="font-medium">20P</span>
                                </div>
                                <div class="border-t border-purple-200 pt-2 mt-2">
                                    <div class="flex justify-between">
                                        <span class="font-semibold text-gray-900">Ï¥ù ÎπÑÏö©</span>
                                        <span id="totalCost" class="font-bold text-purple-600 text-lg">0P</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Î∞úÏÜ° Î≤ÑÌäº -->
                        <button onclick="sendSMS()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-4 rounded-lg hover:from-purple-700 hover:to-purple-800 transition font-semibold text-lg shadow-lg">
                            üì§ Î¨∏Ïûê Î∞úÏÜ°ÌïòÍ∏∞
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let currentUserId = null;
            let receivers = [];
            let sendersList = [];
            let folders = [];
            let templates = [];
            let currentFolderId = null;

            // ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù
            async function checkAuth() {
                const user = localStorage.getItem('user');
                if (!user) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/login';
                    return null;
                }
                const userData = JSON.parse(user);
                currentUserId = userData.id;
                return userData;
            }

            // Î∞úÏã†Î≤àÌò∏ Î™©Î°ù Î°úÎìú
            async function loadSenders() {
                try {
                    const response = await fetch(\`/api/sms/senders?userId=\${currentUserId}\`);
                    const data = await response.json();

                    const select = document.getElementById('senderId');
                    
                    if (data.success && data.senders.length > 0) {
                        sendersList = data.senders;
                        select.innerHTML = '<option value="">Î∞úÏã†Î≤àÌò∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>' + 
                            data.senders.map(s => \`<option value="\${s.id}">\${formatPhoneNumber(s.phone_number)}</option>\`).join('');
                    } else {
                        select.innerHTML = '<option value="">Îì±Î°ùÎêú Î∞úÏã†Î≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§</option>';
                        alert('Î∞úÏã†Î≤àÌò∏Î•º Î®ºÏ†Ä Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî.');
                        window.location.href = '/sms/senders';
                    }
                } catch (err) {
                    console.error('Failed to load senders:', err);
                }
            }

            // Ï†ÑÌôîÎ≤àÌò∏ Ìè¨Îß∑ÌåÖ
            function formatPhoneNumber(phone) {
                phone = phone.replace(/[^0-9]/g, '');
                if (phone.length === 10) {
                    return phone.replace(/(\\d{3})(\\d{3})(\\d{4})/, '$1-$2-$3');
                } else if (phone.length === 11) {
                    return phone.replace(/(\\d{3})(\\d{4})(\\d{4})/, '$1-$2-$3');
                }
                return phone;
            }

            // Î∞îÏù¥Ìä∏ Ïàò Í≥ÑÏÇ∞
            function calculateBytes(str) {
                return new Blob([str]).size;
            }

            // Î©îÏãúÏßÄ ÏûÖÎ†• Ïù¥Î≤§Ìä∏
            document.getElementById('message').addEventListener('input', (e) => {
                const message = e.target.value;
                const byteSize = calculateBytes(message);
                
                document.getElementById('byteCount').textContent = byteSize;
                
                const messageTypeEl = document.getElementById('messageType');
                const costPerMessageEl = document.getElementById('costPerMessage');
                
                if (byteSize > 90) {
                    messageTypeEl.textContent = 'LMS (Ïû•Î¨∏)';
                    messageTypeEl.className = 'text-sm font-medium px-3 py-1 bg-orange-100 text-orange-800 rounded-full';
                    costPerMessageEl.textContent = '50P';
                } else {
                    messageTypeEl.textContent = 'SMS (Îã®Î¨∏)';
                    messageTypeEl.className = 'text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 rounded-full';
                    costPerMessageEl.textContent = '20P';
                }
                
                updateCost();
            });

            // ÏòàÏïΩ Î∞úÏÜ° Ï≤¥ÌÅ¨Î∞ïÏä§
            document.getElementById('reserveEnabled').addEventListener('change', (e) => {
                document.getElementById('reserveTime').disabled = !e.target.checked;
            });

            // ÏàòÏã†Ïûê Ï∂îÍ∞Ä
            function addReceiver() {
                const name = document.getElementById('receiverName').value.trim();
                const phone = document.getElementById('receiverPhone').value.trim().replace(/[^0-9]/g, '');
                
                if (!name || !phone) {
                    alert('Ïù¥Î¶ÑÍ≥º Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                if (phone.length < 10) {
                    alert('Ïò¨Î∞îÎ•∏ Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                receivers.push({ name, phone });
                
                document.getElementById('receiverName').value = '';
                document.getElementById('receiverPhone').value = '';
                
                renderReceivers();
            }

            // ÏàòÏã†Ïûê Î™©Î°ù Î†åÎçîÎßÅ
            function renderReceivers(filteredList = null) {
                const container = document.getElementById('receiversContainer');
                const list = filteredList !== null ? filteredList : receivers;
                
                if (list.length === 0) {
                    if (filteredList !== null && receivers.length > 0) {
                        container.innerHTML = '<p class="text-sm text-gray-400 text-center py-4">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p>';
                    } else {
                        container.innerHTML = '<p class="text-sm text-gray-400 text-center py-4">ÏàòÏã†ÏûêÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî</p>';
                    }
                } else {
                    container.innerHTML = list.map((r, i) => {
                        // Ïã§Ï†ú Ïù∏Îç±Ïä§ Ï∞æÍ∏∞ (Í≤ÄÏÉâ Ïãú)
                        const actualIndex = filteredList !== null ? receivers.indexOf(r) : i;
                        return \`
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="font-medium text-sm">\${r.name}</div>
                                <div class="text-xs text-gray-500">\${formatPhoneNumber(r.phone)}</div>
                            </div>
                            <button onclick="removeReceiver(\${actualIndex})" class="text-red-600 hover:text-red-700">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    \`;
                    }).join('');
                }
                
                document.getElementById('receiverCount').textContent = receivers.length + 'Î™Ö';
                updateCost();
            }

            // ÏàòÏã†Ïûê Í≤ÄÏÉâ ÌïÑÌÑ∞ÎßÅ
            function filterReceivers() {
                const searchTerm = document.getElementById('receiverSearch').value.toLowerCase().trim();
                
                if (!searchTerm) {
                    renderReceivers();
                    return;
                }
                
                const filtered = receivers.filter(r => {
                    const name = r.name.toLowerCase();
                    const phone = r.phone;
                    return name.includes(searchTerm) || phone.includes(searchTerm);
                });
                
                renderReceivers(filtered);
            }

            // ÏàòÏã†Ïûê Ï†úÍ±∞
            function removeReceiver(index) {
                receivers.splice(index, 1);
                renderReceivers();
            }

            // Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
            function clearReceivers() {
                if (receivers.length === 0) return;
                if (confirm('Î™®Îì† ÏàòÏã†ÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    receivers = [];
                    renderReceivers();
                }
            }

            // ÏóëÏÖÄ ÏóÖÎ°úÎìú
            async function uploadExcel(event) {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data);
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // AÏó¥Í≥º BÏó¥Îßå ÏùΩÍ∏∞ (Ìó§Îçî Î¨¥Ïãú)
                    const range = XLSX.utils.decode_range(firstSheet['!ref']);
                    console.log('Excel range:', firstSheet['!ref']);
                    
                    let addedCount = 0;
                    let duplicateCount = 0;
                    const tempReceivers = [];
                    
                    // 2ÌñâÎ∂ÄÌÑ∞ ÏùΩÍ∏∞ (1ÌñâÏùÄ Ìó§Îçî)
                    for (let rowNum = range.s.r + 1; rowNum <= range.e.r; rowNum++) {
                        // AÏó¥: Ïù¥Î¶Ñ
                        const nameCell = firstSheet[XLSX.utils.encode_cell({ r: rowNum, c: 0 })];
                        const name = nameCell ? String(nameCell.v).trim() : '';
                        
                        // BÏó¥: Ïó∞ÎùΩÏ≤ò
                        const phoneCell = firstSheet[XLSX.utils.encode_cell({ r: rowNum, c: 1 })];
                        const phoneRaw = phoneCell ? String(phoneCell.v) : '';
                        const phone = phoneRaw.replace(/[^0-9]/g, '');
                        
                        console.log(\`Row \${rowNum + 1}:\`, { name, phone, phoneLength: phone.length });
                        
                        // Ïù¥Î¶ÑÍ≥º Ï†ÑÌôîÎ≤àÌò∏ Î™®Îëê ÏûàÍ≥†, Ï†ÑÌôîÎ≤àÌò∏Í∞Ä 10ÏûêÎ¶¨ Ïù¥ÏÉÅ
                        if (name && phone && phone.length >= 10) {
                            // Í∏∞Ï°¥ ÏàòÏã†Ïûê Î™©Î°ùÏóê Ïù¥ÎØ∏ ÏûàÎäîÏßÄ ÌôïÏù∏
                            const existsInCurrent = receivers.some(r => r.phone === phone);
                            // ÏûÑÏãú Î™©Î°ùÏóê Ïù¥ÎØ∏ ÏûàÎäîÏßÄ ÌôïÏù∏ (ÏóëÏÖÄ ÎÇ¥ Ï§ëÎ≥µ)
                            const existsInTemp = tempReceivers.some(r => r.phone === phone);
                            
                            if (!existsInCurrent && !existsInTemp) {
                                tempReceivers.push({ name, phone });
                                addedCount++;
                            } else {
                                duplicateCount++;
                                console.log('Ï§ëÎ≥µ Ï†úÏô∏:', { name, phone });
                            }
                        }
                    }
                    
                    // Ï§ëÎ≥µ Ï†úÍ±∞Îêú ÏàòÏã†ÏûêÎì§ Ï∂îÍ∞Ä
                    receivers.push(...tempReceivers);

                    if (addedCount === 0 && duplicateCount === 0) {
                        alert('‚ùå ÏóëÏÖÄ ÌååÏùºÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.\\n\\nÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî:\\n- AÏó¥: Ïù¥Î¶Ñ\\n- BÏó¥: Ïó∞ÎùΩÏ≤ò (01012345678 ÌòïÏãù)\\n- 1Ìñâ: Ìó§Îçî (ÏûêÎèô Í±¥ÎÑàÎúÄ)\\n\\nÎ∏åÎùºÏö∞Ï†Ä ÏΩòÏÜî(F12)ÏóêÏÑú ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                    } else {
                        let message = \`‚úÖ \${addedCount}Î™ÖÏùò ÏàòÏã†ÏûêÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.\`;
                        if (duplicateCount > 0) {
                            message += \`\\n\\n‚ö†Ô∏è Ï§ëÎ≥µÎêú \${duplicateCount}Î™ÖÏùÄ Ï†úÏô∏ÎêòÏóàÏäµÎãàÎã§.\`;
                        }
                        alert(message);
                    }
                    
                    renderReceivers();
                    updateCost();
                } catch (err) {
                    console.error('Excel upload error:', err);
                    alert('ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\\n' + err.message);
                }
                
                event.target.value = '';
            }

            // ÎπÑÏö© Í≥ÑÏÇ∞
            function updateCost() {
                const byteSize = calculateBytes(document.getElementById('message').value);
                const costPerMessage = byteSize > 90 ? 50 : 20;
                const totalCost = costPerMessage * receivers.length;
                
                document.getElementById('costReceivers').textContent = receivers.length + 'Î™Ö';
                document.getElementById('totalCost').textContent = totalCost + 'P';
            }

            // SMS Î∞úÏÜ°
            async function sendSMS() {
                const senderId = document.getElementById('senderId').value;
                const message = document.getElementById('message').value.trim();
                const reserveEnabled = document.getElementById('reserveEnabled').checked;
                const reserveTime = document.getElementById('reserveTime').value;

                if (!senderId) {
                    alert('Î∞úÏã†Î≤àÌò∏Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (!message) {
                    alert('Î©îÏãúÏßÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (receivers.length === 0) {
                    alert('ÏàòÏã†ÏûêÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (reserveEnabled && !reserveTime) {
                    alert('ÏòàÏïΩ Î∞úÏÜ° ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (!confirm(\`\${receivers.length}Î™ÖÏóêÍ≤å Î¨∏ÏûêÎ•º Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) {
                    return;
                }

                try {
                    const payload = {
                        userId: currentUserId,
                        senderId: parseInt(senderId),
                        receivers: receivers,
                        message: message
                    };

                    if (reserveEnabled && reserveTime) {
                        payload.reserveTime = reserveTime;
                    }

                    const response = await fetch('/api/sms/send', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert(\`‚úÖ Î¨∏Ïûê Î∞úÏÜ°Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\n\\nÎ∞úÏÜ° Í±¥Ïàò: \${data.sentCount}Í±¥\\nÏ∞®Í∞ê Ìè¨Ïù∏Ìä∏: \${data.totalCost}P\\nÎÇ®ÏùÄ Ìè¨Ïù∏Ìä∏: \${data.remainingBalance}P\`);
                        
                        // Ï¥àÍ∏∞Ìôî
                        document.getElementById('message').value = '';
                        receivers = [];
                        renderReceivers();
                        
                        // Î∞úÏÜ° ÎÇ¥Ïó≠ÏúºÎ°ú Ïù¥Îèô
                        if (confirm('Î∞úÏÜ° ÎÇ¥Ïó≠ÏùÑ ÌôïÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            window.location.href = '/sms/logs';
                        }
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Send SMS error:', err);
                    alert('Î¨∏Ïûê Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // === ÌÖúÌîåÎ¶ø & Ìè¥Îçî Í¥ÄÎ¶¨ Ìï®Ïàò ===
            
            // ÏπòÌôò Î≥ÄÏàò ÏÇΩÏûÖ
            function insertVariable(variable) {
                const messageBox = document.getElementById('message');
                const start = messageBox.selectionStart;
                const end = messageBox.selectionEnd;
                const text = messageBox.value;
                messageBox.value = text.substring(0, start) + variable + text.substring(end);
                messageBox.focus();
                messageBox.setSelectionRange(start + variable.length, start + variable.length);
                updateByteCount();
            }

            // Ìè¥Îçî Î™©Î°ù Î°úÎìú
            async function loadFolders() {
                try {
                    const response = await fetch(\`/api/sms/folders?userId=\${currentUserId}\`);
                    const data = await response.json();
                    
                    if (data.success) {
                        folders = data.folders;
                        renderFolderTabs();
                    }
                } catch (err) {
                    console.error('Failed to load folders:', err);
                }
            }

            // Ìè¥Îçî ÌÉ≠ Î†åÎçîÎßÅ
            function renderFolderTabs() {
                const container = document.getElementById('folderTabs');
                const tabs = \`
                    <button onclick="selectFolder(null)" class="folder-tab \${!currentFolderId ? 'active' : ''} px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap \${!currentFolderId ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                        Ï†ÑÏ≤¥
                    </button>
                    \${folders.map(folder => \`
                        <div class="relative inline-block group">
                            <button onclick="selectFolder(\${folder.id})" class="folder-tab \${currentFolderId === folder.id ? 'active' : ''} px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap \${currentFolderId === folder.id ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                                üìÅ \${folder.name}
                            </button>
                            <button 
                                onclick="event.stopPropagation(); deleteFolder(\${folder.id}, '\${folder.name}')" 
                                class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs hover:bg-red-600"
                                title="Ìè¥Îçî ÏÇ≠Ï†ú"
                            >
                                √ó
                            </button>
                        </div>
                    \`).join('')}
                \`;
                container.innerHTML = tabs;
            }

            // Ìè¥Îçî ÏÑ†ÌÉù
            async function selectFolder(folderId) {
                currentFolderId = folderId;
                await loadTemplates();
                renderFolderTabs();
            }

            // ÌÖúÌîåÎ¶ø Î™©Î°ù Î°úÎìú
            async function loadTemplates() {
                try {
                    let url = \`/api/sms/templates?userId=\${currentUserId}\`;
                    if (currentFolderId) {
                        url += \`&folderId=\${currentFolderId}\`;
                    }
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.success) {
                        templates = data.templates;
                        renderTemplates();
                    }
                } catch (err) {
                    console.error('Failed to load templates:', err);
                }
            }

            // ÌÖúÌîåÎ¶ø Î™©Î°ù Î†åÎçîÎßÅ
            function renderTemplates() {
                const container = document.getElementById('templateList');
                
                if (templates.length === 0) {
                    container.innerHTML = '<p class="text-xs text-gray-400 text-center py-3">ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§</p>';
                    return;
                }
                
                container.innerHTML = templates.map(template => \`
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <button onclick="loadTemplateMessage(\${template.id})" class="flex-1 text-left text-xs font-medium text-gray-700 truncate">
                            \${template.title}
                        </button>
                        <button onclick="deleteTemplate(\${template.id})" class="ml-2 text-red-500 hover:text-red-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                \`).join('');
            }

            // ÌÖúÌîåÎ¶ø Î©îÏãúÏßÄ Î∂àÎü¨Ïò§Í∏∞
            function loadTemplateMessage(templateId) {
                const template = templates.find(t => t.id === templateId);
                if (template) {
                    // Î©îÏãúÏßÄ Î∂àÎü¨Ïò§Í∏∞
                    document.getElementById('message').value = template.message;
                    updateByteCount();
                    
                    // ÏàòÏã†Ïûê Î∂àÎü¨Ïò§Í∏∞
                    if (template.receivers) {
                        try {
                            const savedReceivers = JSON.parse(template.receivers);
                            receivers = savedReceivers;
                            renderReceivers();
                            updateCost();
                            alert(\`‚úÖ ÌÖúÌîåÎ¶ø Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å!\\nÎ©îÏãúÏßÄ + ÏàòÏã†Ïûê \${receivers.length}Î™Ö\`);
                        } catch (err) {
                            console.error('Failed to parse receivers:', err);
                        }
                    }
                }
            }

            // ÌÖúÌîåÎ¶ø Ï†ÄÏû•
            async function saveTemplate() {
                const message = document.getElementById('message').value.trim();
                if (!message) {
                    alert('Î©îÏãúÏßÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                const title = prompt('ÌÖúÌîåÎ¶ø Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', message.substring(0, 20) + '...');
                if (!title) return;
                
                try {
                    const response = await fetch('/api/sms/templates', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUserId,
                            folderId: currentFolderId,
                            title,
                            message,
                            receivers: JSON.stringify(receivers) // ÏàòÏã†Ïûê Ï†ïÎ≥¥ÎèÑ Ï†ÄÏû•
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(\`‚úÖ ÌÖúÌîåÎ¶øÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\\nÏàòÏã†Ïûê: \${receivers.length}Î™Ö\`);
                        await loadTemplates();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Save template error:', err);
                    alert('ÌÖúÌîåÎ¶ø Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú
            async function deleteTemplate(templateId) {
                if (!confirm('Ïù¥ ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
                
                try {
                    const response = await fetch(\`/api/sms/templates/\${templateId}?userId=\${currentUserId}\`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert('‚úÖ ÌÖúÌîåÎ¶øÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
                        await loadTemplates();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Delete template error:', err);
                    alert('ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // Ìè¥Îçî ÏÉùÏÑ± Î™®Îã¨
            function openFolderModal() {
                const name = prompt('Ìè¥Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', 'Ï§ëÎì± ÌïôÎ∂ÄÎ™®');
                if (!name) return;
                createFolder(name);
            }

            // Ìè¥Îçî ÏÉùÏÑ±
            async function createFolder(name) {
                try {
                    const response = await fetch('/api/sms/folders', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUserId,
                            name
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert('‚úÖ Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
                        await loadFolders();
                        await loadTemplates();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Create folder error:', err);
                    alert('Ìè¥Îçî ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // Ìè¥Îçî ÏÇ≠Ï†ú
            async function deleteFolder(folderId, folderName) {
                if (!confirm(\`"\${folderName}" Ìè¥ÎçîÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚ö†Ô∏è Ìè¥Îçî ÏïàÏùò Î™®Îì† ÌÖúÌîåÎ¶øÎèÑ Ìï®Íªò ÏÇ≠Ï†úÎê©ÎãàÎã§.\`)) {
                    return;
                }
                
                try {
                    const response = await fetch(\`/api/sms/folders/\${folderId}?userId=\${currentUserId}\`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert('‚úÖ Ìè¥ÎçîÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
                        
                        // ÏÇ≠Ï†úÎêú Ìè¥ÎçîÍ∞Ä ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ìè¥ÎçîÏòÄÎã§Î©¥ Ï†ÑÏ≤¥Î°ú Ïù¥Îèô
                        if (currentFolderId === folderId) {
                            currentFolderId = null;
                        }
                        
                        await loadFolders();
                        await loadTemplates();
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Delete folder error:', err);
                    alert('Ìè¥Îçî ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú
            (async () => {
                await checkAuth();
                if (currentUserId) {
                    await loadSenders();
                    await loadFolders();
                    await loadTemplates();
                }
            })();
        </script>
    </body>
    </html>
  `)
})

// Î∞úÏÜ° ÎÇ¥Ïó≠ ÌéòÏù¥ÏßÄ
app.get('/sms/logs', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∞úÏÜ° ÎÇ¥Ïó≠ - SMS Î∞úÏÜ°</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-8">
                        <a href="/dashboard" class="text-xl font-bold text-purple-600">SMS Î∞úÏÜ° ÏãúÏä§ÌÖú</a>
                        <div class="flex space-x-4">
                            <a href="/sms/senders" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏã†Î≤àÌò∏</a>
                            <a href="/sms/compose" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î¨∏Ïûê ÏûëÏÑ±</a>
                            <a href="/sms/logs" class="text-purple-600 border-b-2 border-purple-600 px-3 py-2 font-medium">Î∞úÏÜ° ÎÇ¥Ïó≠</a>
                            <a href="/sms/points" class="text-gray-600 hover:text-purple-600 px-3 py-2">Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <a href="/dashboard" class="text-gray-600 hover:text-purple-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">üìä Î∞úÏÜ° ÎÇ¥Ïó≠</h1>
                    <p class="text-gray-600">Î¨∏Ïûê Î∞úÏÜ° ÎÇ¥Ïó≠ÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§</p>
                </div>

                <!-- ÌïÑÌÑ∞ -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÏÉÅÌÉú</label>
                            <select id="statusFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Ï†ÑÏ≤¥</option>
                                <option value="success">ÏÑ±Í≥µ</option>
                                <option value="failed">Ïã§Ìå®</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Î©îÏãúÏßÄ ÌÉÄÏûÖ</label>
                            <select id="typeFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Ï†ÑÏ≤¥</option>
                                <option value="SMS">SMS (Îã®Î¨∏)</option>
                                <option value="LMS">LMS (Ïû•Î¨∏)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÌéòÏù¥ÏßÄÎãπ Í∞úÏàò</label>
                            <select id="limitFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="20">20Í∞ú</option>
                                <option value="50">50Í∞ú</option>
                                <option value="100">100Í∞ú</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="applyFilters()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition font-medium">
                                Í≤ÄÏÉâ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ï¥ù Î∞úÏÜ°</p>
                                <p id="totalSent" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">ÏÑ±Í≥µ</p>
                                <p id="totalSuccess" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ïã§Ìå®</p>
                                <p id="totalFailed" class="text-2xl font-bold text-red-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Ï¥ù ÎπÑÏö©</p>
                                <p id="totalCost" class="text-2xl font-bold text-purple-600">0P</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Î∞úÏÜ° ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-900">Î∞úÏÜ° ÎÇ¥Ïó≠</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Î∞úÏÜ° ÏùºÏãú</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Î∞úÏã†Î≤àÌò∏</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÏàòÏã†Ïûê</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÌÉÄÏûÖ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÏÉÅÌÉú</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÎπÑÏö©</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÏÉÅÏÑ∏</th>
                                </tr>
                            </thead>
                            <tbody id="logsContainer" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-6 py-12 text-center">
                                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-4"></div>
                                        <p class="text-gray-500">Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                    <div class="p-6 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <p id="paginationInfo" class="text-sm text-gray-600">Ï¥ù 0Í±¥</p>
                            <div class="flex space-x-2" id="paginationButtons">
                                <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏÉÅÏÑ∏ Î™®Îã¨ -->
        <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-6">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-semibold text-gray-900">Î∞úÏÜ° ÏÉÅÏÑ∏</h3>
                        <button onclick="closeDetailModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="detailContent" class="p-6">
                    <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                </div>
            </div>
        </div>

        <script>
            let currentUserId = null;
            let currentPage = 1;
            let currentLimit = 20;

            async function checkAuth() {
                const user = localStorage.getItem('user');
                if (!user) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/login';
                    return null;
                }
                const userData = JSON.parse(user);
                currentUserId = userData.id;
                return userData;
            }

            function formatPhoneNumber(phone) {
                phone = phone.replace(/[^0-9]/g, '');
                if (phone.length === 10) {
                    return phone.replace(/(\\d{3})(\\d{3})(\\d{4})/, '$1-$2-$3');
                } else if (phone.length === 11) {
                    return phone.replace(/(\\d{3})(\\d{4})(\\d{4})/, '$1-$2-$3');
                }
                return phone;
            }

            function formatDateTime(dateStr) {
                if (!dateStr) return '-';
                const date = new Date(dateStr);
                return date.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            async function loadLogs(page = 1) {
                currentPage = page;
                const limit = parseInt(document.getElementById('limitFilter').value);
                currentLimit = limit;

                try {
                    const response = await fetch(\`/api/sms/logs?userId=\${currentUserId}&page=\${page}&limit=\${limit}\`);
                    const data = await response.json();

                    if (data.success) {
                        renderLogs(data.logs);
                        renderPagination(data.pagination);
                        updateStats(data.logs);
                    }
                } catch (err) {
                    console.error('Failed to load logs:', err);
                }
            }

            function renderLogs(logs) {
                const container = document.getElementById('logsContainer');

                if (logs.length === 0) {
                    container.innerHTML = \`
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center">
                                <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                                </svg>
                                <p class="text-gray-500">Î∞úÏÜ° ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                            </td>
                        </tr>
                    \`;
                    return;
                }

                container.innerHTML = logs.map(log => \`
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm text-gray-900">\${formatDateTime(log.sent_at || log.created_at)}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">\${formatPhoneNumber(log.sender_number)}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">\${log.receiver_number.split(',').length}Î™Ö</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium rounded-full \${log.message_type === 'SMS' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}">
                                \${log.message_type}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium rounded-full \${log.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                \${log.status === 'success' ? '‚úì ÏÑ±Í≥µ' : '‚úó Ïã§Ìå®'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">\${log.point_cost}P</td>
                        <td class="px-6 py-4">
                            <button onclick='showDetail(\${JSON.stringify(log).replace(/'/g, "\\\\'")})'
                                class="text-purple-600 hover:text-purple-700 text-sm font-medium">
                                Î≥¥Í∏∞
                            </button>
                        </td>
                    </tr>
                \`).join('');
            }

            function renderPagination(pagination) {
                const info = document.getElementById('paginationInfo');
                const buttons = document.getElementById('paginationButtons');

                info.textContent = \`Ï¥ù \${pagination.total}Í±¥ (ÌéòÏù¥ÏßÄ \${pagination.page}/\${pagination.totalPages})\`;

                let html = '';
                
                if (pagination.page > 1) {
                    html += \`<button onclick="loadLogs(\${pagination.page - 1})" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">Ïù¥Ï†Ñ</button>\`;
                }

                for (let i = 1; i <= Math.min(pagination.totalPages, 5); i++) {
                    const active = i === pagination.page ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50';
                    html += \`<button onclick="loadLogs(\${i})" class="px-3 py-1 border border-gray-300 rounded \${active}">\${i}</button>\`;
                }

                if (pagination.page < pagination.totalPages) {
                    html += \`<button onclick="loadLogs(\${pagination.page + 1})" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">Îã§Ïùå</button>\`;
                }

                buttons.innerHTML = html;
            }

            function updateStats(logs) {
                const totalSent = logs.length;
                const totalSuccess = logs.filter(l => l.status === 'success').length;
                const totalFailed = logs.filter(l => l.status === 'failed').length;
                const totalCost = logs.reduce((sum, l) => sum + (l.point_cost || 0), 0);

                document.getElementById('totalSent').textContent = totalSent;
                document.getElementById('totalSuccess').textContent = totalSuccess;
                document.getElementById('totalFailed').textContent = totalFailed;
                document.getElementById('totalCost').textContent = totalCost + 'P';
            }

            function showDetail(log) {
                const modal = document.getElementById('detailModal');
                const content = document.getElementById('detailContent');

                content.innerHTML = \`
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Î∞úÏÜ° Ï†ïÎ≥¥</h4>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Î∞úÏã†Î≤àÌò∏</span>
                                    <span class="font-medium">\${formatPhoneNumber(log.sender_number)}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">ÏàòÏã†Ïûê</span>
                                    <span class="font-medium">\${log.receiver_number.split(',').length}Î™Ö</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Î∞úÏÜ° ÏùºÏãú</span>
                                    <span class="font-medium">\${formatDateTime(log.sent_at || log.created_at)}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Î©îÏãúÏßÄ ÌÉÄÏûÖ</span>
                                    <span class="font-medium">\${log.message_type}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">ÏÉÅÌÉú</span>
                                    <span class="font-medium">\${log.status === 'success' ? '‚úì ÏÑ±Í≥µ' : '‚úó Ïã§Ìå®'}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">ÎπÑÏö©</span>
                                    <span class="font-medium">\${log.point_cost}P</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Î©îÏãúÏßÄ ÎÇ¥Ïö©</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <p class="text-sm text-gray-900 whitespace-pre-wrap">\${log.message_content}</p>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">ÏàòÏã†Ïûê Î™©Î°ù</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="space-y-1 text-sm text-gray-900">
                                    \${log.receiver_number.split(',').map(phone => \`
                                        <div>\${formatPhoneNumber(phone)}</div>
                                    \`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                \`;

                modal.classList.remove('hidden');
            }

            function closeDetailModal() {
                document.getElementById('detailModal').classList.add('hidden');
            }

            function applyFilters() {
                loadLogs(1);
            }

            (async () => {
                await checkAuth();
                if (currentUserId) {
                    loadLogs(1);
                }
            })();
        </script>
    </body>
    </html>
  `)
})

// Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/sms/points', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨ - SMS Î∞úÏÜ°</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
          }
          .tab-active {
            border-bottom: 2px solid #9333ea;
            color: #9333ea;
            font-weight: 600;
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-8">
                        <a href="/dashboard" class="text-xl font-bold text-purple-600">SMS Î∞úÏÜ° ÏãúÏä§ÌÖú</a>
                        <div class="flex space-x-4">
                            <a href="/sms/senders" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏã†Î≤àÌò∏</a>
                            <a href="/sms/compose" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î¨∏Ïûê ÏûëÏÑ±</a>
                            <a href="/sms/logs" class="text-gray-600 hover:text-purple-600 px-3 py-2">Î∞úÏÜ° ÎÇ¥Ïó≠</a>
                            <a href="/sms/points" class="text-purple-600 border-b-2 border-purple-600 px-3 py-2 font-medium">Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <a href="/dashboard" class="text-gray-600 hover:text-purple-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">üí∞ Ìè¨Ïù∏Ìä∏ Í¥ÄÎ¶¨</h1>
                    <p class="text-gray-600">SMS Î∞úÏÜ° Ìè¨Ïù∏Ìä∏Î•º Í¥ÄÎ¶¨ÌïòÍ≥† Í±∞Îûò ÎÇ¥Ïó≠ÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§</p>
                </div>

                <!-- ÌòÑÏû¨ ÏûîÏï° Ïπ¥Îìú -->
                <div class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-lg shadow-lg p-8 text-white mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-medium opacity-90">Î≥¥Ïú† Ìè¨Ïù∏Ìä∏</h2>
                        <svg class="w-8 h-8 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="flex items-end justify-between">
                        <div>
                            <p id="currentBalance" class="text-5xl font-bold mb-2">0</p>
                            <p class="text-lg opacity-90">Ìè¨Ïù∏Ìä∏</p>
                        </div>
                        <div class="text-right space-y-2">
                            <div class="flex items-center gap-3">
                                <span class="text-sm opacity-75">SMS</span>
                                <span id="smsCount" class="text-xl font-bold">0Í±¥</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm opacity-75">LMS</span>
                                <span id="lmsCount" class="text-xl font-bold">0Í±¥</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm opacity-75">MMS</span>
                                <span id="mmsCount" class="text-xl font-bold">0Í±¥</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÌÜµÍ≥Ñ -->
                    <div class="grid grid-cols-3 gap-4 pt-6 mt-6 border-t border-white/20">
                        <div>
                            <p class="text-xs opacity-75 mb-1">Ï¥ù Ï∂©Ï†Ñ</p>
                            <p id="totalCharged" class="text-lg font-semibold">0P</p>
                        </div>
                        <div>
                            <p class="text-xs opacity-75 mb-1">Ï¥ù ÏÇ¨Ïö©</p>
                            <p id="totalUsed" class="text-lg font-semibold">0P</p>
                        </div>
                        <div>
                            <p class="text-xs opacity-75 mb-1">Í±∞Îûò Í±¥Ïàò</p>
                            <p id="totalTransactions" class="text-lg font-semibold">0Í±¥</p>
                        </div>
                    </div>
                </div>

                <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                    <div class="flex border-b border-gray-200">
                        <button onclick="switchTab('charge')" id="tab-charge" class="tab-active flex-1 px-6 py-4 text-center transition">
                            üí≥ Ï∂©Ï†ÑÌïòÍ∏∞
                        </button>
                        <button onclick="switchTab('deposit')" id="tab-deposit" class="flex-1 px-6 py-4 text-center text-gray-600 hover:text-purple-600 transition">
                            üìã Ï∂©Ï†Ñ ÎÇ¥Ïó≠
                        </button>
                        <button onclick="switchTab('transactions')" id="tab-transactions" class="flex-1 px-6 py-4 text-center text-gray-600 hover:text-purple-600 transition">
                            üìä ÏÇ¨Ïö© ÎÇ¥Ïó≠
                        </button>
                        <button onclick="switchTab('pricing')" id="tab-pricing" class="flex-1 px-6 py-4 text-center text-gray-600 hover:text-purple-600 transition">
                            üíµ ÏöîÍ∏àÌëú
                        </button>
                    </div>

                    <!-- Ï∂©Ï†ÑÌïòÍ∏∞ ÌÉ≠ -->
                    <div id="content-charge" class="p-6">
                        <div class="max-w-2xl mx-auto space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ï∂©Ï†Ñ Í∏àÏï°</label>
                                <div class="relative">
                                    <input type="number" id="depositAmount" placeholder="10000" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 pr-12">
                                    <span class="absolute right-4 top-3 text-gray-500">Ïõê</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-4 gap-2">
                                <button onclick="setAmount(10000)" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-purple-50 hover:border-purple-500 text-sm transition">+1Îßå</button>
                                <button onclick="setAmount(50000)" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-purple-50 hover:border-purple-500 text-sm transition">+5Îßå</button>
                                <button onclick="setAmount(100000)" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-purple-50 hover:border-purple-500 text-sm transition">+10Îßå</button>
                                <button onclick="setAmount(500000)" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-purple-50 hover:border-purple-500 text-sm transition">+50Îßå</button>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÏùÄÌñâÎ™Ö (ÏÑ†ÌÉù)</label>
                                <input type="text" id="bankName" placeholder="Ïã†ÌïúÏùÄÌñâ" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Í≥ÑÏ¢åÎ≤àÌò∏ (ÏÑ†ÌÉù)</label>
                                <input type="text" id="accountNumber" placeholder="110-123-456789" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÏûÖÍ∏àÏûêÎ™Ö (ÏÑ†ÌÉù)</label>
                                <input type="text" id="depositorName" placeholder="ÌôçÍ∏∏Îèô" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                                <textarea id="depositMessage" rows="3" placeholder="ÏûÖÍ∏à Í¥ÄÎ†® Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                            </div>
                            
                            <!-- ÏûÖÍ∏à ÏïàÎÇ¥ -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-900 mb-2">üí° ÏûÖÍ∏à ÏïàÎÇ¥</h4>
                                <p class="text-sm text-blue-800 mb-2">ÏïÑÎûò Í≥ÑÏ¢åÎ°ú ÏûÖÍ∏à ÌõÑ Ïã†Ï≤≠Ìï¥Ï£ºÏÑ∏Ïöî:</p>
                                <div class="bg-white rounded p-3 font-mono text-sm">
                                    <p class="font-bold text-gray-900">Íµ≠ÎØºÏùÄÌñâ 746-910023-17004</p>
                                    <p class="text-gray-600">ÏòàÍ∏àÏ£º: ÏäàÌçºÌîåÎ†àÏù¥Ïä§</p>
                                </div>
                                <p class="text-xs text-blue-600 mt-2">‚Ä¢ ÏµúÏÜå Ï∂©Ï†Ñ Í∏àÏï°: 10,000Ïõê<br>‚Ä¢ Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Ìè¨Ïù∏Ìä∏Í∞Ä ÏûêÎèô Ï∂©Ï†ÑÎê©ÎãàÎã§</p>
                            </div>
                            
                            <button onclick="requestDeposit()" 
                                class="w-full bg-purple-600 text-white px-6 py-4 rounded-lg hover:bg-purple-700 transition font-semibold text-lg">
                                ÏûÖÍ∏à Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>

                    <!-- Ï∂©Ï†Ñ ÎÇ¥Ïó≠ ÌÉ≠ -->
                    <div id="content-deposit" class="p-6 hidden">
                        <div id="depositsContainer" class="space-y-3">
                            <p class="text-sm text-gray-400 text-center py-8">Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>

                    <!-- ÏÇ¨Ïö© ÎÇ¥Ïó≠ ÌÉ≠ -->
                    <div id="content-transactions" class="p-6 hidden">
                        <div id="transactionsContainer" class="space-y-3">
                            <p class="text-sm text-gray-400 text-center py-8">Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>

                    <!-- ÏöîÍ∏àÌëú ÌÉ≠ -->
                    <div id="content-pricing" class="p-6 hidden">
                        <div id="pricingContainer" class="max-w-2xl mx-auto space-y-3">
                            <div class="animate-pulse">
                                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                                <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let currentUserId = null;
            let currentUserName = '';
            let currentUserEmail = '';
            let currentBalance = 0;
            let currentTab = 'charge';

            async function checkAuth() {
                const user = localStorage.getItem('user');
                if (!user) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    window.location.href = '/login';
                    return null;
                }
                const userData = JSON.parse(user);
                currentUserId = userData.id;
                currentUserName = userData.name || '';
                currentUserEmail = userData.email || '';
                currentBalance = userData.points || 0;
                return userData;
            }

            function switchTab(tab) {
                // Î™®Îì† ÌÉ≠ Î≤ÑÌäºÏùò active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                    btn.classList.remove('tab-active');
                    btn.classList.add('text-gray-600');
                });
                
                // Î™®Îì† ÌÉ≠ Ïª®ÌÖêÏ∏† Ïà®Í∏∞Í∏∞
                document.querySelectorAll('[id^="content-"]').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
                document.getElementById('tab-' + tab).classList.add('tab-active');
                document.getElementById('tab-' + tab).classList.remove('text-gray-600');
                document.getElementById('content-' + tab).classList.remove('hidden');
                
                currentTab = tab;
                
                // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                if (tab === 'deposit' && currentUserId) {
                    loadDepositRequests();
                } else if (tab === 'transactions' && currentUserId) {
                    loadTransactions();
                } else if (tab === 'pricing') {
                    loadPricing();
                }
            }

            async function loadBalance() {
                try {
                    const response = await fetch(\`/api/users/\${currentUserId}/points\`);
                    const data = await response.json();

                    if (data.success) {
                        currentBalance = data.points || 0;
                        document.getElementById('currentBalance').textContent = currentBalance.toLocaleString();
                        
                        // Î∞úÏÜ° Í∞ÄÎä• Í±¥Ïàò Í≥ÑÏÇ∞
                        document.getElementById('smsCount').textContent = Math.floor(currentBalance / 20) + 'Í±¥';
                        document.getElementById('lmsCount').textContent = Math.floor(currentBalance / 50) + 'Í±¥';
                        document.getElementById('mmsCount').textContent = Math.floor(currentBalance / 150) + 'Í±¥';
                    }
                } catch (err) {
                    console.error('Failed to load balance:', err);
                }
            }

            async function loadStats() {
                try {
                    const response = await fetch(\`/api/point-transactions/\${currentUserId}?limit=1000\`);
                    const data = await response.json();

                    if (data.success && data.stats) {
                        document.getElementById('totalCharged').textContent = data.stats.totalCharged.toLocaleString() + 'P';
                        document.getElementById('totalUsed').textContent = data.stats.totalUsed.toLocaleString() + 'P';
                        document.getElementById('totalTransactions').textContent = data.stats.totalTransactions.toLocaleString() + 'Í±¥';
                    }
                } catch (err) {
                    console.error('Failed to load stats:', err);
                }
            }

            async function loadPricing() {
                try {
                    const response = await fetch('/api/sms/pricing');
                    const data = await response.json();

                    if (data.success) {
                        const container = document.getElementById('pricingContainer');
                        container.innerHTML = data.pricing.map(p => \`
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                <div>
                                    <div class="font-semibold text-gray-900">\${p.message_type}</div>
                                    <div class="text-sm text-gray-500 mt-1">\${p.description}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-purple-600">\${p.retail_price}P</div>
                                    <div class="text-xs text-gray-400">Í±¥Îãπ</div>
                                </div>
                            </div>
                        \`).join('');
                    }
                } catch (err) {
                    console.error('Failed to load pricing:', err);
                }
            }

            async function loadDepositRequests() {
                try {
                    const response = await fetch(\`/api/deposit/my-requests/\${currentUserId}\`);
                    const data = await response.json();

                    const container = document.getElementById('depositsContainer');
                    
                    if (data.success && data.requests && data.requests.length > 0) {
                        container.innerHTML = data.requests.map(req => \`
                            <div class="p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xl font-bold text-gray-900">\${req.amount.toLocaleString()}Ïõê</span>
                                    <span class="text-xs px-3 py-1 rounded-full font-semibold \${
                                        req.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                        req.status === 'approved' ? 'bg-green-100 text-green-800' :
                                        'bg-red-100 text-red-800'
                                    }">
                                        \${req.status === 'pending' ? 'ÎåÄÍ∏∞Ï§ë' : req.status === 'approved' ? 'ÏäπÏù∏ÏôÑÎ£å' : 'Í±∞Ï†àÎê®'}
                                    </span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-sm text-gray-600">
                                    \${req.bank_name ? \`<div>‚Ä¢ ÏùÄÌñâ: \${req.bank_name}</div>\` : ''}
                                    \${req.depositor_name ? \`<div>‚Ä¢ ÏûÖÍ∏àÏûê: \${req.depositor_name}</div>\` : ''}
                                </div>
                                <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-200">
                                    <span class="text-xs text-gray-500">Ïã†Ï≤≠Ïùº: \${new Date(req.created_at).toLocaleString('ko-KR')}</span>
                                    \${req.processed_at ? \`<span class="text-xs text-gray-500">Ï≤òÎ¶¨Ïùº: \${new Date(req.processed_at).toLocaleString('ko-KR')}</span>\` : ''}
                                </div>
                                \${req.message ? \`<div class="mt-2 text-sm text-gray-600 italic">\${req.message}</div>\` : ''}
                            </div>
                        \`).join('');
                    } else {
                        container.innerHTML = '<div class="text-center py-12"><p class="text-gray-400">ÏûÖÍ∏à Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p><p class="text-sm text-gray-400 mt-2">Ï∂©Ï†ÑÌïòÍ∏∞ ÌÉ≠ÏóêÏÑú ÏûÖÍ∏àÏùÑ Ïã†Ï≤≠Ìï¥Î≥¥ÏÑ∏Ïöî</p></div>';
                    }
                } catch (err) {
                    console.error('Failed to load deposit requests:', err);
                    document.getElementById('depositsContainer').innerHTML = '<p class="text-sm text-red-500 text-center py-8">Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®</p>';
                }
            }

            async function loadTransactions() {
                try {
                    const response = await fetch(\`/api/point-transactions/\${currentUserId}?limit=50\`);
                    const data = await response.json();

                    const container = document.getElementById('transactionsContainer');
                    
                    if (data.success && data.transactions && data.transactions.length > 0) {
                        container.innerHTML = data.transactions.map(tx => {
                            const isPositive = tx.amount > 0;
                            const typeLabels = {
                                'deposit': 'ÏûÖÍ∏à ÏäπÏù∏',
                                'charge': 'Í¥ÄÎ¶¨Ïûê Ï∂©Ï†Ñ',
                                'sms_cost': 'SMS Î∞úÏÜ°',
                                'refund': 'ÌôòÎ∂à'
                            };
                            const typeLabel = typeLabels[tx.transaction_type] || tx.transaction_type;
                            
                            return \`
                            <div class="p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl">\${isPositive ? 'üì•' : 'üì§'}</span>
                                        <div>
                                            <div class="font-semibold text-gray-900">\${typeLabel}</div>
                                            <div class="text-xs text-gray-500">\${new Date(tx.created_at).toLocaleString('ko-KR')}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold \${isPositive ? 'text-green-600' : 'text-red-600'}">
                                            \${isPositive ? '+' : ''}\${tx.amount.toLocaleString()}P
                                        </div>
                                        <div class="text-xs text-gray-500">ÏûîÏï°: \${tx.balance_after.toLocaleString()}P</div>
                                    </div>
                                </div>
                                \${tx.description ? \`<div class="text-sm text-gray-600 mt-2">\${tx.description}</div>\` : ''}
                            </div>
                        \`}).join('');
                    } else {
                        container.innerHTML = '<div class="text-center py-12"><p class="text-gray-400">Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p><p class="text-sm text-gray-400 mt-2">Ï∂©Ï†Ñ ÎòêÎäî SMS Î∞úÏÜ° ÌõÑ ÎÇ¥Ïó≠Ïù¥ ÌëúÏãúÎê©ÎãàÎã§</p></div>';
                    }
                } catch (err) {
                    console.error('Failed to load transactions:', err);
                    document.getElementById('transactionsContainer').innerHTML = '<p class="text-sm text-red-500 text-center py-8">Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®</p>';
                }
            }

            function setAmount(amount) {
                const input = document.getElementById('depositAmount');
                const current = parseInt(input.value) || 0;
                input.value = current + amount;
            }

            async function requestDeposit() {
                const amount = parseInt(document.getElementById('depositAmount').value);
                const bankName = document.getElementById('bankName').value.trim();
                const accountNumber = document.getElementById('accountNumber').value.trim();
                const depositorName = document.getElementById('depositorName').value.trim();
                const message = document.getElementById('depositMessage').value.trim();

                if (!amount || amount <= 0) {
                    alert('Ï∂©Ï†Ñ Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (amount < 10000) {
                    alert('ÏµúÏÜå Ï∂©Ï†Ñ Í∏àÏï°ÏùÄ 10,000ÏõêÏûÖÎãàÎã§.');
                    return;
                }

                if (!confirm(\`\${amount.toLocaleString()}ÏõêÏùÑ Ï∂©Ï†Ñ Ïã†Ï≤≠ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) {
                    return;
                }

                try {
                    const response = await fetch('/api/deposit/request', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUserId,
                            userName: currentUserName,
                            userEmail: currentUserEmail,
                            amount: amount,
                            bankName: bankName,
                            accountNumber: accountNumber,
                            depositorName: depositorName,
                            message: message
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('‚úÖ ÏûÖÍ∏à Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\\nÍ¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Ìè¨Ïù∏Ìä∏Í∞Ä Ï∂©Ï†ÑÎê©ÎãàÎã§.');
                        
                        // Ìèº Ï¥àÍ∏∞Ìôî
                        document.getElementById('depositAmount').value = '';
                        document.getElementById('bankName').value = '';
                        document.getElementById('accountNumber').value = '';
                        document.getElementById('depositorName').value = '';
                        document.getElementById('depositMessage').value = '';
                        
                        // Ï∂©Ï†Ñ ÎÇ¥Ïó≠ ÌÉ≠ÏúºÎ°ú Ï†ÑÌôò
                        switchTab('deposit');
                    } else {
                        alert('‚ùå ' + data.error);
                    }
                } catch (err) {
                    console.error('Deposit request error:', err);
                    alert('ÏûÖÍ∏à Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            (async () => {
                await checkAuth();
                if (currentUserId) {
                    loadBalance();
                    loadStats();
                }
            })();
        </script>
    </body>
    </html>
  `)
})

// Í¥ÄÎ¶¨Ïûê - Î∞úÏã†Î≤àÌò∏ ÏäπÏù∏ ÌéòÏù¥ÏßÄ
// Í¥ÄÎ¶¨Ïûê Î¨∏Ïûê Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/admin/sms', async (c) => {
  const { env } = c
  
  // SMS ÌÜµÍ≥Ñ Ï°∞Ìöå
  const smsStats = await env.DB.prepare(`
    SELECT 
      COUNT(*) as total,
      SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success,
      SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed
    FROM sms_logs
  `).all()
  
  // Ïπ¥Ïπ¥Ïò§ ÌÜµÍ≥Ñ Ï°∞Ìöå
  const kakaoStats = await env.DB.prepare(`
    SELECT 
      COUNT(*) as total,
      SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success,
      SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed
    FROM kakao_logs
  `).all()
  
  // ÏµúÍ∑º Î∞úÏÜ° ÎÇ¥Ïó≠ (SMS + Ïπ¥Ïπ¥Ïò§ ÌÜµÌï©)
  const recentSMS = await env.DB.prepare(`
    SELECT 
      id, user_id, sender_id, message_type, 
      status, created_at
    FROM sms_logs 
    ORDER BY created_at DESC 
    LIMIT 10
  `).all()
  
  const recentKakao = await env.DB.prepare(`
    SELECT 
      id, user_id, sender_key, template_code, 
      status, created_at
    FROM kakao_logs 
    ORDER BY created_at DESC 
    LIMIT 10
  `).all()
  
  const sms = smsStats.results[0] || { total: 0, success: 0, failed: 0 }
  const kakao = kakaoStats.results[0] || { total: 0, success: 0, failed: 0 }
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î¨∏Ïûê Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/admin/dashboard" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                            <a href="/admin/sms" class="text-purple-600 font-semibold">Î¨∏Ïûê Í¥ÄÎ¶¨</a>
                            <a href="/admin/sender/verification" class="text-gray-600 hover:text-purple-600">Î∞úÏã†Î≤àÌò∏ ÏäπÏù∏</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">Î¨∏Ïûê Î∞úÏÜ° Í¥ÄÎ¶¨</h1>
            
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-sm p-6 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-blue-100">SMS Î∞úÏÜ°</span>
                        <i class="fas fa-sms text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mb-1">${sms.total}</p>
                    <p class="text-sm text-blue-100">ÏÑ±Í≥µ ${sms.success} / Ïã§Ìå® ${sms.failed}</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-sm p-6 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-green-100">SMS ÏÑ±Í≥µ</span>
                        <i class="fas fa-check-circle text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mb-1">${sms.success || 0}</p>
                    <p class="text-sm text-green-100">ÏÑ±Í≥µÎ•† ${sms.total > 0 ? Math.round((sms.success / sms.total) * 100) : 0}%</p>
                </div>
                
                <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl shadow-sm p-6 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-yellow-100">Ïπ¥Ïπ¥Ïò§ÌÜ°</span>
                        <i class="fas fa-comment-dots text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mb-1">${kakao.total}</p>
                    <p class="text-sm text-yellow-100">ÏÑ±Í≥µ ${kakao.success} / Ïã§Ìå® ${kakao.failed}</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-400 to-green-500 rounded-xl shadow-sm p-6 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-green-100">Ïπ¥Ïπ¥Ïò§ ÏÑ±Í≥µ</span>
                        <i class="fas fa-check-circle text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mb-1">${kakao.success || 0}</p>
                    <p class="text-sm text-green-100">ÏÑ±Í≥µÎ•† ${kakao.total > 0 ? Math.round((kakao.success / kakao.total) * 100) : 0}%</p>
                </div>
            </div>
            
            <!-- ÏµúÍ∑º Î∞úÏÜ° ÎÇ¥Ïó≠ -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">ÏµúÍ∑º SMS Î∞úÏÜ° ÎÇ¥Ïó≠</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ID</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÇ¨Ïö©Ïûê</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÌÉÄÏûÖ</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÑ±Í≥µ/Ïã§Ìå®</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÉÅÌÉú</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">Î∞úÏÜ°ÏùºÏãú</th>
                            </tr>
                        </thead>
                        <tbody id="smsTableBody">
                            ${recentSMS.results.map(log => `
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-3 px-4">#${log.id}</td>
                                    <td class="py-3 px-4">User ${log.user_id}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                          log.message_type === 'SMS' ? 'bg-blue-100 text-blue-800' : 
                                          log.message_type === 'LMS' ? 'bg-purple-100 text-purple-800' : 
                                          'bg-pink-100 text-pink-800'
                                        }">
                                            ${log.message_type}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">-</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                          log.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                        }">
                                            ${log.status === 'success' ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4 text-sm text-gray-600">${new Date(log.created_at).toLocaleString('ko-KR')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ÏµúÍ∑º Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° ÎÇ¥Ïó≠ -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-4">ÏµúÍ∑º Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° ÎÇ¥Ïó≠</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ID</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÇ¨Ïö©Ïûê</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÌÖúÌîåÎ¶ø</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÑ±Í≥µ/Ïã§Ìå®</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÉÅÌÉú</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">Î∞úÏÜ°ÏùºÏãú</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentKakao.results.map(log => `
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-3 px-4">#${log.id}</td>
                                    <td class="py-3 px-4">User ${log.user_id}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded text-xs font-semibold bg-yellow-100 text-yellow-800">
                                            ${log.template_code || 'N/A'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">-</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                          log.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                        }">
                                            ${log.status === 'success' ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4 text-sm text-gray-600">${new Date(log.created_at).toLocaleString('ko-KR')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            function logout() {
                if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            }
        </script>
    </body>
    </html>
  `)
})

// Í¥ÄÎ¶¨Ïûê ÏûÖÍ∏à Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/admin/deposits', async (c) => {
  const { env } = c
  
  // ÏûÖÍ∏à Ïã†Ï≤≠ Î™©Î°ù Ï°∞Ìöå
  const deposits = await env.DB.prepare(`
    SELECT 
      dr.*,
      u.name as user_name,
      u.email as user_email
    FROM deposit_requests dr
    LEFT JOIN users u ON dr.user_id = u.id
    ORDER BY 
      CASE 
        WHEN dr.status = 'pending' THEN 1
        WHEN dr.status = 'approved' THEN 2
        ELSE 3
      END,
      dr.created_at DESC
    LIMIT 50
  `).all()
  
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏûÖÍ∏à Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-50">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-8">
                        <a href="/admin/dashboard" class="text-2xl font-bold text-purple-600">ÏäàÌçºÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ¶¨Ïûê</a>
                        <div class="flex gap-4">
                            <a href="/admin/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/admin/users" class="text-gray-600 hover:text-purple-600">ÏÇ¨Ïö©Ïûê</a>
                            <a href="/admin/contacts" class="text-gray-600 hover:text-purple-600">Î¨∏Ïùò</a>
                            <a href="/admin/sms" class="text-gray-600 hover:text-purple-600">Î¨∏Ïûê Í¥ÄÎ¶¨</a>
                            <a href="/admin/deposits" class="text-purple-600 font-semibold">ÏûÖÍ∏à Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">Ìè¨Ïù∏Ìä∏ ÏûÖÍ∏à Í¥ÄÎ¶¨</h1>
            
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ID</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÇ¨Ïö©Ïûê</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">Í∏àÏï°</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏùÄÌñâ/ÏûÖÍ∏àÏûê</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">Ïã†Ï≤≠Ïùº</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">ÏÉÅÌÉú</th>
                                <th class="text-left py-3 px-4 text-gray-600 font-semibold">Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${deposits.results.map(deposit => `
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-3 px-4">#${deposit.id}</td>
                                    <td class="py-3 px-4">
                                        <div class="font-semibold">${deposit.user_name}</div>
                                        <div class="text-sm text-gray-600">${deposit.user_email}</div>
                                    </td>
                                    <td class="py-3 px-4 font-bold text-lg">${deposit.amount.toLocaleString()}P</td>
                                    <td class="py-3 px-4">
                                        <div class="text-sm">${deposit.bank_name || 'N/A'}</div>
                                        <div class="text-sm text-gray-600">${deposit.depositor_name || 'N/A'}</div>
                                    </td>
                                    <td class="py-3 px-4 text-sm text-gray-600">${new Date(deposit.created_at).toLocaleString('ko-KR')}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                          deposit.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                          deposit.status === 'approved' ? 'bg-green-100 text-green-800' :
                                          'bg-red-100 text-red-800'
                                        }">
                                            ${
                                              deposit.status === 'pending' ? 'ÎåÄÍ∏∞Ï§ë' :
                                              deposit.status === 'approved' ? 'ÏäπÏù∏ÏôÑÎ£å' :
                                              'Í±∞Ï†àÎê®'
                                            }
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">
                                        ${deposit.status === 'pending' ? `
                                            <button onclick="processDeposit(${deposit.id}, 'approved')" 
                                                class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm mr-2">
                                                ÏäπÏù∏
                                            </button>
                                            <button onclick="processDeposit(${deposit.id}, 'rejected')" 
                                                class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">
                                                Í±∞Ï†à
                                            </button>
                                        ` : '-'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            async function processDeposit(requestId, status) {
                const action = status === 'approved' ? 'ÏäπÏù∏' : 'Í±∞Ï†à';
                if(!confirm(\`Ï†ïÎßê Ïù¥ ÏûÖÍ∏à Ïã†Ï≤≠ÏùÑ \${action}ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) return;
                
                try {
                    const response = await fetch(\`/api/admin/deposit/requests/\${requestId}/process\`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            status: status,
                            adminId: user.id
                        })
                    });
                    
                    const data = await response.json();
                    
                    if(data.success) {
                        alert(\`ÏûÖÍ∏à Ïã†Ï≤≠Ïù¥ \${action}ÎêòÏóàÏäµÎãàÎã§.\`);
                        location.reload();
                    } else {
                        alert(\`Ïò§Î•ò: \${data.error}\`);
                    }
                } catch(error) {
                    alert('Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
            
            function logout() {
                if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            }
        </script>
    </body>
    </html>
  `)
})

app.get('/admin/sender/verification', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î∞úÏã†Î≤àÌò∏ ÏäπÏù∏ Í¥ÄÎ¶¨ - Í¥ÄÎ¶¨Ïûê</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
          @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
          * { font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- Navigation -->
        <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <a href="/admin/dashboard" class="text-lg font-bold text-gray-900">‚Üê Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</a>
                    </div>
                    <span id="userName" class="text-gray-700 font-medium"></span>
                </div>
            </div>
        </nav>

        <div class="pt-24 pb-12 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">üì± Î∞úÏã†Î≤àÌò∏ ÏäπÏù∏ Í¥ÄÎ¶¨</h1>
                    <p class="text-gray-600">ÏÇ¨Ïö©ÏûêÏùò Î∞úÏã†Î≤àÌò∏ Ïù∏Ï¶ù Ïã†Ï≤≠ÏùÑ Í≤ÄÌÜ†ÌïòÍ≥† ÏäπÏù∏/Í±∞Ï†àÌï©ÎãàÎã§</p>
                </div>

                <!-- ÌÜµÍ≥Ñ -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-yellow-700 font-medium">ÏäπÏù∏ ÎåÄÍ∏∞</p>
                                <p class="text-3xl font-bold text-yellow-900 mt-1"><span id="pendingCount">0</span>Í±¥</p>
                            </div>
                            <svg class="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-700 font-medium">ÏäπÏù∏ ÏôÑÎ£å</p>
                                <p class="text-3xl font-bold text-green-900 mt-1"><span id="approvedCount">0</span>Í±¥</p>
                            </div>
                            <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-red-700 font-medium">Í±∞Ï†àÎê®</p>
                                <p class="text-3xl font-bold text-red-900 mt-1"><span id="rejectedCount">0</span>Í±¥</p>
                            </div>
                            <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ïã†Ï≤≠ Î™©Î°ù -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">Ïã†Ï≤≠ Î™©Î°ù</h2>
                            <button onclick="loadRequests()" class="text-purple-600 hover:text-purple-700 font-medium">
                                üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                        </div>
                    </div>
                    <div id="requestsList" class="divide-y divide-gray-200">
                        <div class="text-center text-gray-500 py-12">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                            <p>Î°úÎî© Ï§ë...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏÉÅÏÑ∏ Î™®Îã¨ -->
        <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-900">Î∞úÏã†Î≤àÌò∏ ÏäπÏù∏ Í≤ÄÌÜ†</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="modalContent" class="p-6">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú Ï±ÑÏõåÏßê -->
                </div>
            </div>
        </div>

        <script>
            const user = JSON.parse(localStorage.getItem('user'))
            if (!user || user.role !== 'admin') {
                alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.')
                window.location.href = '/dashboard'
            }
            document.getElementById('userName').textContent = user.name

            let currentRequest = null

            async function loadRequests() {
                try {
                    const response = await fetch('/api/admin/sender/verification-requests?adminId=' + user.id)
                    const data = await response.json()

                    if (data.success) {
                        updateStats(data.requests)
                        renderRequests(data.requests)
                    }
                } catch (err) {
                    console.error('Load requests error:', err)
                }
            }

            function updateStats(requests) {
                const pending = requests.filter(r => r.status === 'pending').length
                const approved = requests.filter(r => r.status === 'approved').length
                const rejected = requests.filter(r => r.status === 'rejected').length

                document.getElementById('pendingCount').textContent = pending
                document.getElementById('approvedCount').textContent = approved
                document.getElementById('rejectedCount').textContent = rejected
            }

            function renderRequests(requests) {
                const container = document.getElementById('requestsList')

                if (requests.length === 0) {
                    container.innerHTML = \`
                        <div class="text-center text-gray-500 py-12">
                            <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p>Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                        </div>
                    \`
                    return
                }

                container.innerHTML = requests.map(req => {
                    const statusColor = req.status === 'pending' ? 'yellow' : req.status === 'approved' ? 'green' : 'red'
                    const statusText = req.status === 'pending' ? 'ÏäπÏù∏ ÎåÄÍ∏∞' : req.status === 'approved' ? 'ÏäπÏù∏ ÏôÑÎ£å' : 'Í±∞Ï†àÎê®'
                    
                    return \`
                        <div class="p-6 hover:bg-gray-50 transition">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="px-3 py-1 bg-\${statusColor}-100 text-\${statusColor}-700 text-sm font-medium rounded-full">
                                            \${statusText}
                                        </span>
                                        <span class="text-sm text-gray-500">
                                            \${new Date(req.request_date).toLocaleString('ko-KR')}
                                        </span>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-4 mb-3">
                                        <div>
                                            <p class="text-sm text-gray-600">Ïã†Ï≤≠Ïûê</p>
                                            <p class="font-bold text-gray-900">\${req.user_name} (\${req.user_email})</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">ÏÇ¨ÏóÖÏ≤¥Î™Ö</p>
                                            <p class="font-bold text-gray-900">\${req.business_name}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">Î∞úÏã†Î≤àÌò∏</p>
                                            <p class="font-bold text-gray-900">\${req.phone_number}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">ÏÇ¨ÏóÖÏûêÎ≤àÌò∏</p>
                                            <p class="font-bold text-gray-900">\${req.business_registration_number}</p>
                                        </div>
                                    </div>
                                    \${req.admin_note ? '<p class="text-sm text-gray-600 bg-gray-100 p-3 rounded">Í¥ÄÎ¶¨Ïûê Î©îÎ™®: ' + req.admin_note + '</p>' : ''}
                                </div>
                                <div class="ml-6">
                                    <button onclick='openModal(\${JSON.stringify(req)})' 
                                            class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium">
                                        ÏÉÅÏÑ∏Î≥¥Í∏∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    \`
                }).join('')
            }

            // ÌååÏùº Î†åÎçîÎßÅ Ìó¨Ìçº Ìï®Ïàò (Ïù¥ÎØ∏ÏßÄ ÎòêÎäî PDF)
            function renderFilePreview(url, title) {
                if (!url) {
                    return '<p class="text-gray-500 text-sm">ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</p>'
                }
                
                // URLÏóêÏÑú ÌååÏùº ÌôïÏû•Ïûê ÌôïÏù∏
                const isPdf = url.toLowerCase().endsWith('.pdf') || url.includes('application/pdf')
                
                if (isPdf) {
                    return \`
                        <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
                            <div class="flex items-center justify-center mb-3">
                                <svg class="w-16 h-16 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/>
                                    <path d="M8 10a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                                </svg>
                            </div>
                            <p class="text-center text-sm font-medium text-gray-700 mb-3">PDF Î¨∏ÏÑú</p>
                            <a href="\${url}" target="_blank" 
                               class="block w-full px-4 py-2 bg-red-600 text-white text-center rounded-lg hover:bg-red-700 transition">
                                üìÑ PDF Ïó¥Í∏∞
                            </a>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 text-center">ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Î¶ΩÎãàÎã§</p>
                    \`
                } else {
                    return \`
                        <a href="\${url}" target="_blank" class="block">
                            <img src="\${url}" 
                                 class="w-full rounded-lg border border-gray-300 hover:border-purple-500 transition cursor-pointer"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE2IiBmaWxsPSIjOTc5N2E3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+7J2066+47KeAIOuhnOuTnCDsi6Ttjqg8L3RleHQ+PC9zdmc+'">
                        </a>
                        <p class="text-xs text-gray-500 mt-2 text-center">ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Î¶ΩÎãàÎã§</p>
                    \`
                }
            }

            function openModal(request) {
                currentRequest = request
                const modal = document.getElementById('detailModal')
                const content = document.getElementById('modalContent')

                const statusColor = request.status === 'pending' ? 'yellow' : request.status === 'approved' ? 'green' : 'red'
                const statusText = request.status === 'pending' ? 'ÏäπÏù∏ ÎåÄÍ∏∞' : request.status === 'approved' ? 'ÏäπÏù∏ ÏôÑÎ£å' : 'Í±∞Ï†àÎê®'

                content.innerHTML = \`
                    <div class="space-y-6">
                        <!-- ÏÉÅÌÉú -->
                        <div class="flex items-center justify-between p-4 bg-\${statusColor}-50 border border-\${statusColor}-200 rounded-lg">
                            <span class="text-\${statusColor}-700 font-bold">ÏÉÅÌÉú: \${statusText}</span>
                            \${request.processed_date ? '<span class="text-sm text-' + statusColor + '-600">Ï≤òÎ¶¨Ïùº: ' + new Date(request.processed_date).toLocaleString('ko-KR') + '</span>' : ''}
                        </div>

                        <!-- Ïã†Ï≤≠Ïûê Ï†ïÎ≥¥ -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h3 class="font-bold text-gray-900 mb-3">Ïã†Ï≤≠Ïûê Ï†ïÎ≥¥</h3>
                            <div class="grid md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">Ïù¥Î¶Ñ</p>
                                    <p class="font-medium">\${request.user_name}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Ïù¥Î©îÏùº</p>
                                    <p class="font-medium">\${request.user_email}</p>
                                </div>
                            </div>
                        </div>

                        <!-- ÏÇ¨ÏóÖÏûê Ï†ïÎ≥¥ -->
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h3 class="font-bold text-gray-900 mb-3">ÏÇ¨ÏóÖÏûê Ï†ïÎ≥¥</h3>
                            <div class="grid md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">ÏÇ¨ÏóÖÏ≤¥Î™Ö</p>
                                    <p class="font-medium">\${request.business_name}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏</p>
                                    <p class="font-medium">\${request.business_registration_number}</p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="text-gray-600">Î∞úÏã†Î≤àÌò∏</p>
                                    <p class="font-medium">\${request.phone_number}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Ï†úÏ∂ú ÏÑúÎ•ò Ïù¥ÎØ∏ÏßÄ -->
                        <div class="space-y-4">
                            <!-- 1. ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h3 class="font-bold text-gray-900 mb-3">üìÑ 1. ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù</h3>
                                \${renderFilePreview(request.business_registration_image, 'ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù')}
                            </div>

                            <!-- 2. ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h3 class="font-bold text-gray-900 mb-3">üìÑ 2. ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê</h3>
                                \${renderFilePreview(request.certificate_image, 'ÌÜµÏã†ÏÇ¨ Í∞ÄÏûÖÏ¶ùÎ™ÖÏõê')}
                            </div>

                            <!-- 3. Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h3 class="font-bold text-gray-900 mb-3">üìÑ 3. Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú (ÎèÑÏû• ÎÇ†Ïù∏)</h3>
                                \${renderFilePreview(request.employment_cert_image, 'Ïû¨ÏßÅÏ¶ùÎ™ÖÏÑú')}
                            </div>

                            <!-- 4. Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h3 class="font-bold text-gray-900 mb-3">üìÑ 4. Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú (ÎèÑÏû• ÎÇ†Ïù∏)</h3>
                                \${renderFilePreview(request.contract_image, 'Î¨∏ÏûêÎ©îÏãúÏßÄ Ïù¥Ïö©Í≥ÑÏïΩÏÑú')}
                            </div>
                        </div>

                        <!-- Í¥ÄÎ¶¨Ïûê Î©îÎ™® ÏûÖÎ†• -->
                        \${request.status === 'pending' ? \`
                            <div class="border border-gray-200 rounded-lg p-4">
                                <label class="block text-sm font-bold text-gray-700 mb-2">Í¥ÄÎ¶¨Ïûê Î©îÎ™® (ÏÑ†ÌÉù)</label>
                                <textarea id="adminNote" rows="3" 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                          placeholder="ÏäπÏù∏/Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                            </div>
                        \` : request.admin_note ? \`
                            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                <p class="text-sm font-bold text-gray-700 mb-2">Í¥ÄÎ¶¨Ïûê Î©îÎ™®</p>
                                <p class="text-gray-900">\${request.admin_note}</p>
                            </div>
                        \` : ''}

                        <!-- Ïï°ÏÖò Î≤ÑÌäº -->
                        \${request.status === 'pending' ? \`
                            <div class="flex gap-4 pt-4">
                                <button onclick="processRequest('reject')" 
                                        class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-bold">
                                    ‚ùå Í±∞Ï†à
                                </button>
                                <button onclick="processRequest('approve')" 
                                        class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-bold">
                                    ‚úÖ ÏäπÏù∏
                                </button>
                            </div>
                        \` : ''}
                    </div>
                \`

                modal.classList.remove('hidden')
            }

            function closeModal() {
                document.getElementById('detailModal').classList.add('hidden')
                currentRequest = null
            }

            async function processRequest(action) {
                if (!currentRequest) return

                const adminNote = document.getElementById('adminNote')?.value || ''

                if (!confirm(\`Ï†ïÎßêÎ°ú Ïù¥ Ïã†Ï≤≠ÏùÑ \${action === 'approve' ? 'ÏäπÏù∏' : 'Í±∞Ï†à'}ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) {
                    return
                }

                try {
                    const response = await fetch('/api/sms/sender/verification-process', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            requestId: currentRequest.id,
                            action,
                            adminNote,
                            adminId: user.id
                        })
                    })

                    const data = await response.json()

                    if (data.success) {
                        alert(data.message)
                        closeModal()
                        loadRequests()
                    } else {
                        alert(data.error || 'Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.')
                    }
                } catch (err) {
                    console.error('Process error:', err)
                    alert('Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.')
                }
            }

            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            document.getElementById('detailModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal()
                }
            })

            loadRequests()
        </script>
    </body>
    </html>
  `)
})

// ========================================
// ÌïôÏÉù Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú ÌéòÏù¥ÏßÄ
// ========================================

// ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ (ÏõêÏû•Îãò Ï†ÑÏö©)
app.get('/teachers/manage', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center gap-8">
                        <h1 class="text-xl font-bold text-purple-600">
                            <i class="fas fa-chalkboard-teacher mr-2"></i>ÏÑ†ÏÉùÎãò & Î∞ò Í¥ÄÎ¶¨
                        </h1>
                        <div class="flex gap-4">
                            <a href="/dashboard" class="text-gray-600 hover:text-purple-600">ÎåÄÏãúÎ≥¥Îìú</a>
                            <a href="/students" class="text-gray-600 hover:text-purple-600">ÌïôÏÉù Í¥ÄÎ¶¨</a>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- ÏÉÅÎã® ÏöîÏïΩ -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò</p>
                            <p id="teacherCount" class="text-3xl font-bold text-purple-600">0Î™Ö</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-user-tie text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Ïö¥ÏòÅ Ï§ëÏù∏ Î∞ò</p>
                            <p id="classCount" class="text-3xl font-bold text-blue-600">0Í∞ú</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-chalkboard text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏÑ†ÏÉùÎãò Î™©Î°ù ÏÑπÏÖò -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-user-tie text-purple-600 mr-2"></i>ÏÑ†ÏÉùÎãò Î™©Î°ù
                    </h2>
                    <button onclick="openCreateTeacherModal()" class="px-4 py-2 gradient-purple text-white rounded-lg hover:opacity-90 transition">
                        <i class="fas fa-plus mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä
                    </button>
                </div>
                <div id="teacherList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- ÏÑ†ÏÉùÎãò Ïπ¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>Î°úÎî© Ï§ë...</p>
                    </div>
                </div>
            </div>

            <!-- Î∞ò Î™©Î°ù ÏÑπÏÖò -->
            <div>
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-chalkboard text-blue-600 mr-2"></i>Î∞ò Î™©Î°ù
                    </h2>
                    <button onclick="openCreateClassModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-plus mr-2"></i>Î∞ò ÏÉùÏÑ±
                    </button>
                </div>
                <div id="classList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Î∞ò Ïπ¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>Î°úÎî© Ï§ë...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏÑ†ÏÉùÎãò ÏÉùÏÑ± Î™®Îã¨ -->
        <div id="createTeacherModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900">ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï ÏÉùÏÑ±</h3>
                    <button onclick="closeCreateTeacherModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="createTeacherForm" onsubmit="createTeacher(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ïù¥Î¶Ñ *</label>
                            <input type="text" name="name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ïù¥Î©îÏùº *</label>
                            <input type="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÎπÑÎ∞ÄÎ≤àÌò∏ *</label>
                            <input type="password" name="password" required minlength="6" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ *</label>
                            <input type="password" name="confirmPassword" required minlength="6" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ï†ÑÌôîÎ≤àÌò∏</label>
                            <input type="tel" name="phone" placeholder="010-1234-5678" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" onclick="closeCreateTeacherModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Ï∑®ÏÜå
                        </button>
                        <button type="submit" class="flex-1 px-4 py-2 gradient-purple text-white rounded-lg hover:opacity-90">
                            ÏÉùÏÑ±
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Î∞ò ÏÉùÏÑ± Î™®Îã¨ -->
        <div id="createClassModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900">Î∞ò ÏÉùÏÑ±</h3>
                    <button onclick="closeCreateClassModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="createClassForm" onsubmit="createClass(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Î∞ò Ïù¥Î¶Ñ *</label>
                            <input type="text" name="className" required placeholder="Ïòà: Ï¥àÎì± 1Î∞ò" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÏÑ§Î™Ö</label>
                            <textarea name="description" rows="2" placeholder="Î∞òÏóê ÎåÄÌïú Í∞ÑÎã®Ìïú ÏÑ§Î™Ö" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÌïôÎÖÑ ÏàòÏ§Ä</label>
                            <select name="gradeLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                <option value="Ï¥àÎì±">Ï¥àÎì±</option>
                                <option value="Ï§ëÎì±">Ï§ëÎì±</option>
                                <option value="Í≥†Îì±">Í≥†Îì±</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Í≥ºÎ™©</label>
                            <input type="text" name="subject" placeholder="Ïòà: ÏàòÌïô, ÏòÅÏñ¥, Ï†ÑÍ≥ºÎ™©" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÏµúÎåÄ ÌïôÏÉù Ïàò</label>
                            <input type="number" name="maxStudents" value="20" min="1" max="50" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" onclick="closeCreateClassModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Ï∑®ÏÜå
                        </button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ÏÉùÏÑ±
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script src="/static/teacher-management.js"></script>
    </body>
    </html>
  `)
})

// ÏÑ†ÏÉùÎãò: ÌïôÏõê Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/academy-management', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏõê Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center gap-8">
                        <h1 class="text-xl font-bold text-purple-600">
                            <i class="fas fa-school mr-2"></i>ÌïôÏõê Í¥ÄÎ¶¨
                        </h1>
                        <a href="/" class="text-gray-600 hover:text-purple-600">ÌôàÏúºÎ°ú</a>
                    </div>
                    <button onclick="logout()" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-sign-out-alt mr-2"></i>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- ÎÇ¥ ÌïôÏõê Î™©Î°ù -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-building text-purple-600 mr-2"></i>ÎÇ¥ ÌïôÏõê
                    </h2>
                    <button onclick="openAddAcademyModal()" class="px-4 py-2 gradient-purple text-white rounded-lg hover:opacity-90">
                        <i class="fas fa-plus mr-2"></i>ÌïôÏõê Ï∂îÍ∞Ä
                    </button>
                </div>
                <div id="academyList" class="space-y-4">
                    <div class="text-center text-gray-500 py-8">Î°úÎî© Ï§ë...</div>
                </div>
            </div>
        </div>

        <!-- ÌïôÏõê Ï∂îÍ∞Ä Î™®Îã¨ -->
        <div id="addAcademyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900">ÌïôÏõê Ï∂îÍ∞ÄÌïòÍ∏∞</h3>
                    <button onclick="closeAddAcademyModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="addAcademyForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõêÎ™Ö <span class="text-red-500">*</span></label>
                        <input type="text" name="academy_name" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Íæ∏Î©îÎïÖÌïôÏõê Î∂ÑÎãπÏ†ê">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÌïôÏõê Ï£ºÏÜå <span class="text-red-500">*</span></label>
                        <input type="text" name="academy_address" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Ïù∏Ï≤ú ÏÑúÍµ¨ Í≤ÄÎã®Îèô">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÏõêÏû•Îãò Ïù¥Î¶Ñ <span class="text-red-500">*</span></label>
                        <input type="text" name="director_name" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ÌôçÍ∏∏Îèô">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">ÏõêÏû•Îãò Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span></label>
                        <input type="tel" name="director_phone" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="010-0000-0000">
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§
                        </p>
                    </div>
                    
                    <button type="submit" class="w-full gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90">
                        <i class="fas fa-paper-plane mr-2"></i>Ïã†Ï≤≠ÌïòÍ∏∞
                    </button>
                </form>
            </div>
        </div>

        <script>
            let currentUser = null;
            
            // Î°úÍ∑∏Ïù∏ ÌôïÏù∏
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                location.href = '/login';
            } else {
                currentUser = JSON.parse(userStr);
                if (currentUser.user_type !== 'teacher') {
                    alert('ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÎßå Ï†ëÍ∑º Í∞ÄÎä•Ìï©ÎãàÎã§.');
                    location.href = '/';
                }
                loadMyAcademies();
            }
            
            async function loadMyAcademies() {
                try {
                    const res = await fetch('/api/teacher/academies?teacherId=' + currentUser.id);
                    const data = await res.json();
                    const container = document.getElementById('academyList');
                    
                    if (!data.success || data.academies.length === 0) {
                        container.innerHTML = \`
                            <div class="text-center py-12">
                                <i class="fas fa-school text-6xl text-gray-300 mb-4"></i>
                                <p class="text-gray-600 mb-4">Îì±Î°ùÎêú ÌïôÏõêÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                <button onclick="openAddAcademyModal()" class="px-6 py-3 gradient-purple text-white rounded-lg hover:opacity-90">
                                    <i class="fas fa-plus mr-2"></i>Ï≤´ ÌïôÏõê Ï∂îÍ∞ÄÌïòÍ∏∞
                                </button>
                            </div>
                        \`;
                        return;
                    }
                    
                    container.innerHTML = data.academies.map(academy => \`
                        <div class="border rounded-xl p-6 hover:shadow-lg transition">
                            <div class="flex items-start justify-between">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900 mb-2">\${academy.academy_name}</h3>
                                    <p class="text-sm text-gray-600 mb-1"><i class="fas fa-map-marker-alt mr-2"></i>\${academy.academy_address}</p>
                                    <p class="text-sm text-gray-600 mb-1"><i class="fas fa-user mr-2"></i>ÏõêÏû•: \${academy.director_name}</p>
                                    <p class="text-sm text-gray-600"><i class="fas fa-phone mr-2"></i>\${academy.director_phone}</p>
                                </div>
                                <div>
                                    \${academy.status === 'pending' ? 
                                        '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">ÏäπÏù∏ ÎåÄÍ∏∞</span>' :
                                      academy.status === 'approved' ?
                                        '<span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">ÏäπÏù∏ ÏôÑÎ£å</span>' :
                                        '<span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Í±∞Ï†àÎê®</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    \`).join('');
                } catch (error) {
                    console.error('Load academies error:', error);
                }
            }
            
            function openAddAcademyModal() {
                document.getElementById('addAcademyModal').classList.remove('hidden');
            }
            
            function closeAddAcademyModal() {
                document.getElementById('addAcademyModal').classList.add('hidden');
            }
            
            document.getElementById('addAcademyForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = {
                    teacher_id: currentUser.id,
                    academy_name: formData.get('academy_name'),
                    academy_address: formData.get('academy_address'),
                    director_name: formData.get('director_name'),
                    director_phone: formData.get('director_phone')
                };
                
                try {
                    const res = await fetch('/api/teacher/academy/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await res.json();
                    
                    if (result.success) {
                        alert('ÌïôÏõê Ï∂îÍ∞Ä Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.');
                        closeAddAcademyModal();
                        e.target.reset();
                        loadMyAcademies();
                    } else {
                        alert(result.error || 'ÌïôÏõê Ï∂îÍ∞Ä Ïã§Ìå®');
                    }
                } catch (error) {
                    console.error('Add academy error:', error);
                    alert('ÌïôÏõê Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            });
            
            function logout() {
                if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem('user');
                    location.href = '/';
                }
            }
        </script>
    </body>
    </html>
  `)
})

// Redirect /teachers to /students (all features are in /students page)
app.get('/teachers', (c) => {
  return c.redirect('/students')
})

// OLD /teachers page (temporarily disabled due to JS errors)
app.get('/teachers-old', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ - ÏäàÌçºÌîåÎ†àÏù¥Ïä§</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
            * { font-family: 'Pretendard Variable', sans-serif; }
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">üë®‚Äçüè´ ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-home mr-2"></i>Ìôà
                        </a>
                        <a href="/students" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-user-graduate mr-2"></i>ÌïôÏÉù Í¥ÄÎ¶¨
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Ï†ÑÏ≤¥ ÏÑ†ÏÉùÎãò</p>
                            <p class="text-3xl font-bold text-gray-900" id="totalTeachers">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chalkboard-teacher text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë</p>
                            <p class="text-3xl font-bold text-gray-900" id="pendingCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Îã¥Îãπ Î∞ò Î∞∞Ï†ïÏôÑÎ£å</p>
                            <p class="text-3xl font-bold text-gray-900" id="assignedCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ïù∏Ï¶ù ÏΩîÎìú ÏÑπÏÖò -->
            <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-key text-purple-600 mr-2"></i>ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìú
                </h3>
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">ÏÑ†ÏÉùÎãòÏóêÍ≤å Ïù¥ ÏΩîÎìúÎ•º Ï†ÑÎã¨ÌïòÏÑ∏Ïöî</p>
                        <span id="verificationCode" class="text-3xl font-mono font-bold text-purple-600 block mb-2">------</span>
                        <a href="/signup?teacher=true" target="_blank" class="text-sm text-purple-600 hover:underline">
                            <i class="fas fa-external-link-alt mr-1"></i>ÏÑ†ÏÉùÎãò Îì±Î°ù ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        </a>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyVerificationCode()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 whitespace-nowrap">
                            <i class="fas fa-copy mr-2"></i>Î≥µÏÇ¨
                        </button>
                        <button onclick="regenerateVerificationCode()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 whitespace-nowrap">
                            <i class="fas fa-sync-alt mr-2"></i>Ïû¨ÏÉùÏÑ±
                        </button>
                    </div>
                </div>
            </div>

            <!-- ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë ÏÑπÏÖò -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-clock text-yellow-600 mr-2"></i>ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë
                    </h3>
                    <span id="pendingBadge" class="px-3 py-1 bg-yellow-500 text-white rounded-full text-sm font-bold">0</span>
                </div>
                <div id="pendingList" class="space-y-4">
                    <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                </div>
            </div>

            <!-- Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò ÏÑπÏÖò -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-users text-green-600 mr-2"></i>Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò
                    </h3>
                    <button onclick="openAddTeacherModal()" class="px-6 py-3 gradient-purple text-white rounded-lg hover:opacity-90 font-semibold shadow-lg">
                        <i class="fas fa-user-plus mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä
                    </button>
                </div>
                <div id="teachersList" class="space-y-4">
                    <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                </div>
            </div>
        </div>

        <!-- ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Î™®Îã¨ -->
        <div id="addTeacherModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-user-plus text-purple-600 mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä
                    </h3>
                    <button onclick="closeAddTeacherModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="addTeacherForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            Ïù¥Î¶Ñ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="name" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ÍπÄÏÑ†ÏÉù">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            Ïù¥Î©îÏùº (ÌöåÏõê ÏïÑÏù¥Îîî) <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="email" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="teacher@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" name="phone" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="010-0000-0000">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            Ï¥àÍ∏∞ ÎπÑÎ∞ÄÎ≤àÌò∏ <span class="text-red-500">*</span>
                        </label>
                        <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ÏµúÏÜå 6Ïûê">
                        <p class="text-xs text-gray-500 mt-1">ÏÑ†ÏÉùÎãòÏù¥ Î°úÍ∑∏Ïù∏ ÌõÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            Îã¥Îãπ Î∞ò Î∞∞Ï†ï (ÏÑ†ÌÉù)
                        </label>
                        <select name="class_id" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">ÎÇòÏ§ëÏóê Î∞∞Ï†ï</option>
                            <!-- Î∞ò Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                        </select>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±ÎêòÎ©∞, Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Î°úÍ∑∏Ïù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                    
                    <button type="submit" class="w-full gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90">
                        <i class="fas fa-check mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞ÄÌïòÍ∏∞
                    </button>
                </form>
            </div>
        </div>

        <!-- Í∂åÌïú ÏÑ§Ï†ï Î™®Îã¨ -->
        <div id="permissionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-user-shield text-purple-600 mr-2"></i><span id="permissionsTeacherName"></span> ÏÑ†ÏÉùÎãò Í∂åÌïú ÏÑ§Ï†ï
                    </h3>
                    <button onclick="closePermissionsModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="permissionsForm" class="space-y-6">
                    <input type="hidden" id="permissionsTeacherId">
                    
                    <!-- Í∂åÌïú ÏÑ†ÌÉù (ÎùºÎîîÏò§ Î≤ÑÌäº) - Updated for /teachers page -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-gray-900 text-lg mb-4">
                            <i class="fas fa-shield-alt text-purple-600 mr-2"></i>Ï†ëÍ∑º Í∂åÌïú ÏÑ†ÌÉù
                        </h4>
                        
                        <!-- ÏòµÏÖò 1: Î™®Îëê Îã§ Í≥µÍ∞ú -->
                        <label class="block cursor-pointer">
                            <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-400 transition-colors" id="allAccessOption">
                                <div class="flex items-start">
                                    <input type="radio" name="accessLevel" value="all" id="accessLevelAll" class="mt-1 w-5 h-5 text-purple-600 focus:ring-purple-500">
                                    <div class="ml-4 flex-1">
                                        <div class="flex items-center mb-2">
                                            <i class="fas fa-globe text-blue-600 mr-2 text-xl"></i>
                                            <span class="text-base font-bold text-gray-900">Î™®Îëê Îã§ Í≥µÍ∞ú</span>
                                        </div>
                                        <p class="text-sm text-gray-600 leading-relaxed">
                                            ‚Ä¢ Î™®Îì† ÌïôÏÉù Ï†ïÎ≥¥ Ï°∞Ìöå<br>
                                            ‚Ä¢ Î™®Îì† Î∞ò Í¥ÄÎ¶¨<br>
                                            ‚Ä¢ Î™®Îì† Í≥ºÎ™© Í¥ÄÎ¶¨<br>
                                            ‚Ä¢ Ï†ÑÏ≤¥ ÏùºÏùº ÏÑ±Í≥º ÏûëÏÑ±<br>
                                            ‚Ä¢ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†ëÍ∑º
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </label>
                        
                        <!-- ÏòµÏÖò 2: Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú -->
                        <label class="block cursor-pointer">
                            <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-400 transition-colors" id="assignedOnlyOption">
                                <div class="flex items-start">
                                    <input type="radio" name="accessLevel" value="assigned" id="accessLevelAssigned" class="mt-1 w-5 h-5 text-purple-600 focus:ring-purple-500">
                                    <div class="ml-4 flex-1">
                                        <div class="flex items-center mb-2">
                                            <i class="fas fa-users text-green-600 mr-2 text-xl"></i>
                                            <span class="text-base font-bold text-gray-900">Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú</span>
                                        </div>
                                        <p class="text-sm text-gray-600 leading-relaxed mb-3">
                                            ‚Ä¢ Î∞∞Ï†ïÎêú Î∞òÏùò ÌïôÏÉùÎßå Ï°∞Ìöå<br>
                                            ‚Ä¢ Î∞∞Ï†ïÎêú Î∞òÏùò ÏùºÏùº ÏÑ±Í≥ºÎßå ÏûëÏÑ±<br>
                                            ‚Ä¢ Î∞ò/Í≥ºÎ™© Í¥ÄÎ¶¨ Î∂àÍ∞Ä<br>
                                            ‚Ä¢ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†ëÍ∑º Î∂àÍ∞Ä
                                        </p>
                                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mt-3">
                                            <p class="text-xs text-purple-800 font-medium mb-2">
                                                <i class="fas fa-info-circle mr-1"></i>Ïù¥ ÏòµÏÖòÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏïÑÎûòÏóêÏÑú Î∞òÏùÑ Î∞∞Ï†ïÌï¥Ï£ºÏÑ∏Ïöî:
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Î∞ò Î∞∞Ï†ï (Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú ÏÑ†ÌÉù ÏãúÏóêÎßå ÌôúÏÑ±Ìôî) -->
                    <div id="classAssignmentSection" class="border border-gray-200 rounded-lg p-4 bg-gray-50" style="display: none;">
                        <h4 class="font-medium text-gray-900 mb-3">
                            <i class="fas fa-chalkboard text-purple-600 mr-2"></i>Î∞ò Î∞∞Ï†ï
                        </h4>
                        <div id="classesCheckboxList" class="space-y-2 max-h-60 overflow-y-auto">
                            <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Í∂åÌïú ÏÑ§Ï†ï ÌõÑ ÏÑ†ÏÉùÎãòÏùÄ Ï¶âÏãú Ìï¥Îãπ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        </p>
                    </div>
                    
                    <div class="flex gap-3">
                        <button type="button" onclick="closePermissionsModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-times mr-2"></i>Ï∑®ÏÜå
                        </button>
                        <button type="submit" class="flex-1 gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90">
                            <i class="fas fa-save mr-2"></i>Ï†ÄÏû•
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            // Complete JavaScript for /teachers page - to replace lines 24599-24794
            
            let currentUser = null;
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
            window.addEventListener('DOMContentLoaded', () => {
                const userStr = localStorage.getItem('user');
                if (!userStr) {
                    window.location.href = '/login';
                    return;
                }
                
                currentUser = JSON.parse(userStr);
                console.log('Current user:', currentUser);
                
                loadPageData();
            });
            
            async function loadPageData() {
                loadVerificationCode();
                loadPendingApplications();
                loadTeachersList();
            }
            
            // Ïù∏Ï¶ù ÏΩîÎìú Î°úÎìú
            async function loadVerificationCode() {
                try {
                    const res = await fetch('/api/teachers/verification-code?directorId=' + currentUser.id);
                    const data = await res.json();
                    
                    if (data.success) {
                        const code = data.code || (data.codeData && (data.codeData.code || data.codeData.verification_code)) || '------';
                        document.getElementById('verificationCode').textContent = code;
                    }
                } catch (error) {
                    console.error('Ïù∏Ï¶ù ÏΩîÎìú Î°úÎî© Ïã§Ìå®:', error);
                }
            }
            
            // Ïù∏Ï¶ù ÏΩîÎìú Î≥µÏÇ¨
            function copyVerificationCode() {
                const code = document.getElementById('verificationCode').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    alert('Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§: ' + code);
                });
            }
            
            // Ïù∏Ï¶ù ÏΩîÎìú Ïû¨ÏÉùÏÑ±
            async function regenerateVerificationCode() {
                if (!confirm('Ïù∏Ï¶ù ÏΩîÎìúÎ•º Ïû¨ÏÉùÏÑ±ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\n\\n‚ö†Ô∏è Ïù¥Ï†Ñ ÏΩîÎìúÎäî ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÍ≤å Îê©ÎãàÎã§.')) return;
                try {
                    const res = await fetch('/api/teachers/verification-code/regenerate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ directorId: currentUser.id })
                    });
                    const data = await res.json();
                    
                    if (data.success) {
                        const newCode = data.code || (data.codeData && (data.codeData.code || data.codeData.verification_code));
                        document.getElementById('verificationCode').textContent = newCode;
                        alert('‚úÖ Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä Ïû¨ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!\\n\\nÏÉà ÏΩîÎìú: ' + newCode);
                    } else {
                        alert('‚ùå ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                    }
                } catch (error) {
                    alert('ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }
            
            // ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù Î°úÎìú
            async function loadPendingApplications() {
                try {
                    const res = await fetch('/api/teachers/applications?directorId=' + currentUser.id + '&status=pending');
                    const data = await res.json();
                    const container = document.getElementById('pendingList');
                    const countBadge = document.getElementById('pendingBadge');
                    const pendingCount = document.getElementById('pendingCount');
                    
                    if (!data.success || !data.applications || data.applications.length === 0) {
                        container.innerHTML = '<div class="text-center text-gray-500 py-8">ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ëÏù∏ Ïã†Ï≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                        countBadge.textContent = '0';
                        pendingCount.textContent = '0';
                        return;
                    }
            
                    countBadge.textContent = data.applications.length;
                    pendingCount.textContent = data.applications.length;
                    container.innerHTML = data.applications.map(app => {
                        const escapedName = (app.name || '').replace(/'/g, "\\'");
                        return \`
                        <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900">\${app.name}</h3>
                                    <p class="text-sm text-gray-600">\${app.email}</p>
                                    <p class="text-sm text-gray-500">\${app.phone || '-'}</p>
                                    <p class="text-xs text-gray-400 mt-2">Ïã†Ï≤≠Ïùº: \${new Date(app.applied_at).toLocaleString('ko-KR')}</p>
                                </div>
                                <span class="px-3 py-1 bg-yellow-500 text-white rounded-full text-xs font-medium">
                                    ÎåÄÍ∏∞Ï§ë
                                </span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="approveApplication(\${app.id}, '\${escapedName}')" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <i class="fas fa-check mr-2"></i>ÏäπÏù∏
                                </button>
                                <button onclick="rejectApplication(\${app.id}, '\${escapedName}')" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                    <i class="fas fa-times mr-2"></i>Í±∞Ï†à
                                </button>
                            </div>
                        </div>
                        \`;
                    }).join('');
                } catch (error) {
                    console.error('ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù Î°úÎî© Ïã§Ìå®:', error);
                }
            }
            
            // ÏÑ†ÏÉùÎãò ÏäπÏù∏
            async function approveApplication(id, name) {
                if (!confirm(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) return;
                try {
                    const res = await fetch(\`/api/teachers/applications/\${id}/approve\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ directorId: currentUser.id })
                    });
                    const data = await res.json();
                    if (data.success) {
                        alert(\`\${name} ÏÑ†ÏÉùÎãòÏù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§!\`);
                        loadPendingApplications();
                        loadTeachersList();
                    } else {
                        alert('ÏäπÏù∏ Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    alert('ÏäπÏù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
            
            // ÏÑ†ÏÉùÎãò Í±∞Ï†à
            async function rejectApplication(id, name) {
                if (!confirm(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠ÏùÑ Í±∞Ï†àÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) return;
                const reason = prompt('Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠):');
                try {
                    const res = await fetch(\`/api/teachers/applications/\${id}/reject\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            directorId: currentUser.id,
                            reason: reason || 'ÏäπÏù∏ Í±∞Î∂Ä'
                        })
                    });
                    const data = await res.json();
                    if (data.success) {
                        alert(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.\`);
                        loadPendingApplications();
                    } else {
                        alert('Í±∞Ï†à Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    alert('Í±∞Ï†à Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
            
            // Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò Î™©Î°ù Î°úÎìú
            async function loadTeachersList() {
                try {
                    const res = await fetch('/api/teachers/list?directorId=' + currentUser.id);
                    const data = await res.json();
                    const container = document.getElementById('teachersList');
                    const totalCount = document.getElementById('totalTeachers');
                    const assignedCount = document.getElementById('assignedCount');
                    
                    if (!data.success || data.teachers.length === 0) {
                        container.innerHTML = '<div class="text-center text-gray-500 py-8">Îì±Î°ùÎêú ÏÑ†ÏÉùÎãòÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                        totalCount.textContent = '0';
                        assignedCount.textContent = '0';
                        return;
                    }
            
                    totalCount.textContent = data.teachers.length;
                    let assignedCounter = 0;
                    data.teachers.forEach(t => {
                        if (t.class_count && t.class_count > 0) assignedCounter++;
                    });
                    assignedCount.textContent = assignedCounter;
            
                    container.innerHTML = data.teachers.map(teacher => {
                        const escapedName = (teacher.name || '').replace(/'/g, "\\'");
                        return \`
                        <div class="bg-white border rounded-xl p-6 hover:shadow-lg transition">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-tie text-purple-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">\${teacher.name}</h3>
                                        <p class="text-sm text-gray-600">\${teacher.email}</p>
                                        <p class="text-sm text-gray-500">\${teacher.phone || '-'}</p>
                                        <span class="inline-block mt-2 px-3 py-1 bg-purple-100 text-purple-600 rounded-full text-xs font-medium">
                                            Îã¥Îãπ Î∞ò: \${teacher.class_count || 0}Í∞ú
                                        </span>
                                    </div>
                                </div>
                                <button onclick="showTeacherPermissions(\${teacher.id}, '\${escapedName}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <i class="fas fa-cog mr-2"></i>Í∂åÌïú ÏÑ§Ï†ï
                                </button>
                            </div>
                        </div>
                        \`;
                    }).join('');
                } catch (error) {
                    console.error('ÏÑ†ÏÉùÎãò Î™©Î°ù Î°úÎî© Ïã§Ìå®:', error);
                }
            }
            
            // ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Î™®Îã¨
            function openAddTeacherModal() {
                document.getElementById('addTeacherModal').classList.remove('hidden');
            }
            
            function closeAddTeacherModal() {
                document.getElementById('addTeacherModal').classList.add('hidden');
                document.getElementById('addTeacherForm').reset();
            }
            
            document.getElementById('addTeacherForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    password: formData.get('password'),
                    directorId: currentUser.id
                };
            
                try {
                    const res = await fetch('/api/teachers/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await res.json();
                    
                    if (result.success) {
                        alert(\`\${data.name} ÏÑ†ÏÉùÎãòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!\`);
                        closeAddTeacherModal();
                        loadTeachersList();
                    } else {
                        alert('Ï∂îÍ∞Ä Ïã§Ìå®: ' + result.error);
                    }
                } catch (error) {
                    alert('ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ï§ë ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            });
            
            // Í∂åÌïú ÏÑ§Ï†ï Î™®Îã¨
            async function showTeacherPermissions(teacherId, teacherName) {
                document.getElementById('permissionsModal').classList.remove('hidden');
                document.getElementById('permissionsTeacherName').textContent = teacherName;
                document.getElementById('permissionsTeacherId').value = teacherId;
                
                try {
                    // Î∞ò Î™©Î°ù Î°úÎìú - /api/classes/list ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏÇ¨Ïö©
                    const classesRes = await fetch(\`/api/classes/list?userId=\${currentUser.id}&userType=director\`);
                    const classesData = await classesRes.json();
                    
                    console.log('[Teachers Page] Classes loaded:', classesData);
                    
                    if (classesData.success) {
                        const classList = document.getElementById('classesCheckboxList');
                        if (classesData.classes && classesData.classes.length > 0) {
                            classList.innerHTML = classesData.classes.map(cls => \`
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="\${cls.id}" class="class-checkbox w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
                                    <span class="ml-2 text-sm text-gray-700">\${cls.class_name || cls.name} \${cls.grade || cls.grade_level ? '(' + (cls.grade || cls.grade_level) + ')' : ''}</span>
                                </label>
                            \`).join('');
                        } else {
                            classList.innerHTML = '<div class="text-center text-gray-500 py-4">Îì±Î°ùÎêú Î∞òÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                        }
                    }
                    
                    // ÏÑ†ÏÉùÎãò Í∂åÌïú Ï†ïÎ≥¥ Î°úÎìú
                    const permRes = await fetch(\`/api/teachers/\${teacherId}/permissions?directorId=\${currentUser.id}\`);
                    const permData = await permRes.json();
                    
                    console.log('[Teachers Page] Permissions loaded:', permData);
                    
                    if (permData.success) {
                        const hasFullAccess = permData.permissions?.canViewAllStudents || false;
                        const assignedClasses = permData.permissions?.assignedClasses || [];
                        
                        // ÎùºÎîîÏò§ Î≤ÑÌäº ÏÑ§Ï†ï
                        if (hasFullAccess) {
                            document.getElementById('accessLevelAll').checked = true;
                            document.getElementById('classAssignmentSection').style.display = 'none';
                            document.getElementById('allAccessOption').classList.add('border-purple-500', 'bg-purple-50');
                            document.getElementById('assignedOnlyOption').classList.remove('border-purple-500', 'bg-purple-50');
                        } else if (assignedClasses.length > 0) {
                            document.getElementById('accessLevelAssigned').checked = true;
                            document.getElementById('classAssignmentSection').style.display = 'block';
                            document.getElementById('assignedOnlyOption').classList.add('border-purple-500', 'bg-purple-50');
                            document.getElementById('allAccessOption').classList.remove('border-purple-500', 'bg-purple-50');
                            
                            // Î∞∞Ï†ïÎêú Î∞ò Ï≤¥ÌÅ¨
                            document.querySelectorAll('.class-checkbox').forEach(checkbox => {
                                checkbox.checked = assignedClasses.includes(parseInt(checkbox.value));
                            });
                        } else {
                            // Í∂åÌïú ÏóÜÏùå
                            document.getElementById('accessLevelAll').checked = false;
                            document.getElementById('accessLevelAssigned').checked = false;
                            document.getElementById('classAssignmentSection').style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('[Teachers Page] Í∂åÌïú Î°úÎìú Ïã§Ìå®:', error);
                    alert('Í∂åÌïú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
            
            // ÎùºÎîîÏò§ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.addEventListener('DOMContentLoaded', function() {
                const allAccessRadio = document.getElementById('accessLevelAll');
                const assignedRadio = document.getElementById('accessLevelAssigned');
                const classSection = document.getElementById('classAssignmentSection');
                const allOption = document.getElementById('allAccessOption');
                const assignedOption = document.getElementById('assignedOnlyOption');
                
                if (allAccessRadio) {
                    allAccessRadio.addEventListener('change', function() {
                        if (this.checked) {
                            classSection.style.display = 'none';
                            allOption.classList.add('border-purple-500', 'bg-purple-50');
                            assignedOption.classList.remove('border-purple-500', 'bg-purple-50');
                        }
                    });
                }
                
                if (assignedRadio) {
                    assignedRadio.addEventListener('change', function() {
                        if (this.checked) {
                            classSection.style.display = 'block';
                            assignedOption.classList.add('border-purple-500', 'bg-purple-50');
                            allOption.classList.remove('border-purple-500', 'bg-purple-50');
                        }
                    });
                }
            });
            
            function closePermissionsModal() {
                document.getElementById('permissionsModal').classList.add('hidden');
                document.getElementById('permissionsForm').reset();
                document.getElementById('classAssignmentSection').style.display = 'none';
                document.getElementById('allAccessOption').classList.remove('border-purple-500', 'bg-purple-50');
                document.getElementById('assignedOnlyOption').classList.remove('border-purple-500', 'bg-purple-50');
            }
            
            document.getElementById('permissionsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const teacherId = document.getElementById('permissionsTeacherId').value;
                const teacherName = document.getElementById('permissionsTeacherName').textContent;
                
                // ÎùºÎîîÏò§ Î≤ÑÌäº Í∞í ÌôïÏù∏
                const accessLevel = document.querySelector('input[name="accessLevel"]:checked')?.value;
                
                if (!accessLevel) {
                    alert('‚ùå Í∂åÌïú Î†àÎ≤®ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                let permissions;
                
                if (accessLevel === 'all') {
                    // Î™®Îëê Îã§ Í≥µÍ∞ú
                    permissions = {
                        canViewAllStudents: true,
                        canWriteDailyReports: true,
                        assignedClasses: []
                    };
                    console.log('[Teachers Page] Selected: Î™®Îëê Îã§ Í≥µÍ∞ú');
                } else {
                    // Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú
                    const assignedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                        .map(cb => parseInt(cb.value));
                    
                    if (assignedClasses.length === 0) {
                        alert('‚ùå ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅÏùò Î∞òÏùÑ Î∞∞Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    permissions = {
                        canViewAllStudents: false,
                        canWriteDailyReports: true,
                        assignedClasses: assignedClasses
                    };
                    console.log('[Teachers Page] Selected: Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú, classes:', assignedClasses);
                }
                
                try {
                    const res = await fetch(\`/api/teachers/\${teacherId}/permissions\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            directorId: currentUser.id,
                            permissions: permissions
                        })
                    });
                    
                    const data = await res.json();
                    
                    if (data.success) {
                        // Ï†ÄÏû• ÌõÑ Ïã§Ï†ú Ï†ÄÏû•Îêú Í∂åÌïú ÌôïÏù∏
                        alert(teacherName + " ÏÑ†ÏÉùÎãòÏùò Í∂åÌïúÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!");
                        closePermissionsModal();
                        closePermissionsModal();
                    } else {
                        alert('Í∂åÌïú Ï†ÄÏû• Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    alert('Í∂åÌïú Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            });
        </script>
    </body>
    </html>
  `)
})

app.get('/students', (c) => {
  return c.html(`
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÌïôÏÉù Í¥ÄÎ¶¨ - Íæ∏Î©îÎïÖÌïôÏõê</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .gradient-blue { background: linear-gradient(135deg, #667eea 0%, #4facfe 100%); }
            .gradient-green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
            .gradient-orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        </style>
    </head>
    <body class="bg-gray-50">
        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">üë®‚Äçüéì ÌïôÏÉù Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-home mr-2"></i>Ìôà
                        </a>
                        <a href="/sms/compose" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-sms mr-2"></i>Î¨∏Ïûê
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
            <div id="dashboardCardGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ (ÏõêÏû•Îãò Ï†ÑÏö©) -->
                <div id="teacherManagementCard" class="bg-white rounded-xl shadow-lg hover:shadow-xl transition cursor-pointer" onclick="toggleTeacherSection()">
                    <div class="bg-gradient-to-br from-purple-500 to-indigo-600 text-white p-6 rounded-t-xl">
                        <i class="fas fa-chalkboard-teacher text-4xl mb-3"></i>
                        <h3 class="text-xl font-bold">ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">ÏÑ†ÏÉùÎãò Îì±Î°ù, Î∞ò Î∞∞Ï†ï, ÏäπÏù∏ Í¥ÄÎ¶¨</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Îì±Î°ù <span id="totalTeachers" class="font-bold text-purple-600">0</span>Î™Ö</span>
                            <i class="fas fa-chevron-down text-purple-600" id="teacherSectionIcon"></i>
                        </div>
                    </div>
                </div>

                <!-- Î∞ò Í¥ÄÎ¶¨ -->
                <a href="/students/classes" class="block bg-white rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                    <div class="gradient-purple text-white p-6 rounded-t-xl">
                        <i class="fas fa-chalkboard text-4xl mb-3"></i>
                        <h3 class="text-xl font-bold">Î∞ò Í¥ÄÎ¶¨</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">Î∞ò ÏÉùÏÑ±, ÌïôÏÉù Î∞∞Ï†ï, Î∞òÎ≥Ñ Í¥ÄÎ¶¨</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Ï†ÑÏ≤¥ <span id="totalClasses" class="font-bold text-purple-600">0</span>Í∞ú Î∞ò</span>
                            <i class="fas fa-arrow-right text-purple-600"></i>
                        </div>
                    </div>
                </a>

                <!-- ÌïôÏÉù Î™©Î°ù -->
                <a href="/students/list" class="block bg-white rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                    <div class="gradient-blue text-white p-6 rounded-t-xl">
                        <i class="fas fa-users text-4xl mb-3"></i>
                        <h3 class="text-xl font-bold">ÌïôÏÉù Î™©Î°ù</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">ÌïôÏÉù Îì±Î°ù, Ï†ïÎ≥¥ ÏàòÏ†ï, ÌïôÎ∂ÄÎ™® Ïó∞ÎùΩÏ≤ò</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Ï†ÑÏ≤¥ <span id="totalStudents" class="font-bold text-blue-600">0</span>Î™Ö</span>
                            <i class="fas fa-arrow-right text-blue-600"></i>
                        </div>
                    </div>
                </a>

                <!-- Í≥ºÎ™© Í¥ÄÎ¶¨ -->
                <a href="/students/courses" class="block bg-white rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                    <div class="gradient-green text-white p-6 rounded-t-xl">
                        <i class="fas fa-book text-4xl mb-3"></i>
                        <h3 class="text-xl font-bold">Í≥ºÎ™© Í¥ÄÎ¶¨</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">Í≥ºÎ™© Îì±Î°ù, ÏàòÍ∞ï Í¥ÄÎ¶¨</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Ï†ÑÏ≤¥ <span id="totalCourses" class="font-bold text-green-600">0</span>Í∞ú Í≥ºÎ™©</span>
                            <i class="fas fa-arrow-right text-green-600"></i>
                        </div>
                    </div>
                </a>

                <!-- ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù -->
                <a href="/students/daily-record" class="block bg-white rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                    <div class="gradient-orange text-white p-6 rounded-t-xl">
                        <i class="fas fa-calendar-check text-4xl mb-3"></i>
                        <h3 class="text-xl font-bold">ÏùºÏùº ÏÑ±Í≥º</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">Ï∂úÏÑù, Í≥ºÏ†ú, ÏàòÏóÖ Ïù¥Ìï¥ÎèÑ Í∏∞Î°ù</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">Ïò§Îäò <span id="todayRecords" class="font-bold text-pink-600">0</span>Í±¥</span>
                            <i class="fas fa-arrow-right text-pink-600"></i>
                        </div>
                    </div>
                </a>
            </div>

            <!-- ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ÏÑπÏÖò -->
            <div id="teacherSection" class="hidden mb-8 space-y-6">
                <!-- Ïù∏Ï¶ù ÏΩîÎìú -->
                <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">
                        <i class="fas fa-key text-purple-600 mr-2"></i>ÌïôÏõê Ïù∏Ï¶ù ÏΩîÎìú
                    </h3>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-2">ÏÑ†ÏÉùÎãòÏóêÍ≤å Ïù¥ ÏΩîÎìúÎ•º Ï†ÑÎã¨ÌïòÏÑ∏Ïöî</p>
                            <span id="verificationCode" class="text-3xl font-mono font-bold text-purple-600 block mb-2">------</span>
                            <a href="/signup?teacher=true" target="_blank" class="text-sm text-purple-600 hover:underline">
                                <i class="fas fa-external-link-alt mr-1"></i>ÏÑ†ÏÉùÎãò Îì±Î°ù ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                            </a>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="copyVerificationCode()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 whitespace-nowrap">
                                <i class="fas fa-copy mr-2"></i>Î≥µÏÇ¨
                            </button>
                            <button onclick="regenerateVerificationCode()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 whitespace-nowrap">
                                <i class="fas fa-sync-alt mr-2"></i>Ïû¨ÏÉùÏÑ±
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÏäπÏù∏ ÎåÄÍ∏∞ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-clock text-yellow-600 mr-2"></i>ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë
                        </h3>
                        <span id="pendingBadge" class="px-3 py-1 bg-yellow-500 text-white rounded-full text-sm font-bold">0</span>
                    </div>
                    <div id="pendingList" class="space-y-4">
                        <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                    </div>
                </div>

                <!-- Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-users text-green-600 mr-2"></i>Îì±Î°ùÎêú ÏÑ†ÏÉùÎãò
                        </h3>
                        <button onclick="openAddTeacherModal()" class="px-6 py-3 gradient-purple text-white rounded-lg hover:opacity-90 font-semibold shadow-lg">
                            <i class="fas fa-user-plus mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä
                        </button>
                    </div>
                    <div id="teachersList" class="space-y-4">
                        <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                    </div>
                </div>
            </div>

            <!-- ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Î™®Îã¨ -->
            <div id="addTeacherModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-user-plus text-purple-600 mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä
                        </h3>
                        <button onclick="closeAddTeacherModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    
                    <form id="addTeacherForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                Ïù¥Î¶Ñ <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="name" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ÍπÄÏÑ†ÏÉù">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                Ïù¥Î©îÏùº (ÌöåÏõê ÏïÑÏù¥Îîî) <span class="text-red-500">*</span>
                            </label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="teacher@example.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                Ïó∞ÎùΩÏ≤ò <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" name="phone" required class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="010-0000-0000">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                Ï¥àÍ∏∞ ÎπÑÎ∞ÄÎ≤àÌò∏ <span class="text-red-500">*</span>
                            </label>
                            <input type="password" name="password" required minlength="6" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="ÏµúÏÜå 6Ïûê">
                            <p class="text-xs text-gray-500 mt-1">ÏÑ†ÏÉùÎãòÏù¥ Î°úÍ∑∏Ïù∏ ÌõÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">
                                Îã¥Îãπ Î∞ò Î∞∞Ï†ï (ÏÑ†ÌÉù)
                            </label>
                            <select name="class_id" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">ÎÇòÏ§ëÏóê Î∞∞Ï†ï</option>
                                <!-- Î∞ò Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </select>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <p class="text-sm text-blue-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                ÏÑ†ÏÉùÎãò Í≥ÑÏ†ïÏù¥ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±ÎêòÎ©∞, Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Î°úÍ∑∏Ïù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                            </p>
                        </div>
                        
                        <button type="submit" class="w-full gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90">
                            <i class="fas fa-check mr-2"></i>ÏÑ†ÏÉùÎãò Ï∂îÍ∞ÄÌïòÍ∏∞
                        </button>
                    </form>
                </div>
            </div>

            <!-- Í∂åÌïú ÏÑ§Ï†ï Î™®Îã¨ -->
            <div id="permissionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-user-shield text-purple-600 mr-2"></i><span id="permissionsTeacherName"></span> ÏÑ†ÏÉùÎãò Í∂åÌïú ÏÑ§Ï†ï
                        </h3>
                        <button onclick="closePermissionsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    
                    <form id="permissionsForm" class="space-y-6">
                        <input type="hidden" id="permissionsTeacherId">
                        
                        <!-- Í∂åÌïú ÏÑ†ÌÉù (ÎùºÎîîÏò§ Î≤ÑÌäº) - Updated 2026-01-18 -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900 text-lg mb-4">
                                <i class="fas fa-shield-alt text-purple-600 mr-2"></i>Ï†ëÍ∑º Í∂åÌïú ÏÑ†ÌÉù
                            </h4>
                            
                            <!-- ÏòµÏÖò 1: Î™®Îëê Îã§ Í≥µÍ∞ú -->
                            <label class="block cursor-pointer">
                                <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-400 transition-colors" id="allAccessOption">
                                    <div class="flex items-start">
                                        <input type="radio" name="accessLevel" value="all" id="accessLevelAll" class="mt-1 w-5 h-5 text-purple-600 focus:ring-purple-500">
                                        <div class="ml-4 flex-1">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-globe text-blue-600 mr-2 text-xl"></i>
                                                <span class="text-base font-bold text-gray-900">Î™®Îëê Îã§ Í≥µÍ∞ú</span>
                                            </div>
                                            <p class="text-sm text-gray-600 leading-relaxed">
                                                ‚Ä¢ Î™®Îì† ÌïôÏÉù Ï†ïÎ≥¥ Ï°∞Ìöå<br>
                                                ‚Ä¢ Î™®Îì† Î∞ò Í¥ÄÎ¶¨<br>
                                                ‚Ä¢ Î™®Îì† Í≥ºÎ™© Í¥ÄÎ¶¨<br>
                                                ‚Ä¢ Ï†ÑÏ≤¥ ÏùºÏùº ÏÑ±Í≥º ÏûëÏÑ±<br>
                                                ‚Ä¢ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†ëÍ∑º
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </label>
                            
                            <!-- ÏòµÏÖò 2: Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú -->
                            <label class="block cursor-pointer">
                                <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-400 transition-colors" id="assignedOnlyOption">
                                    <div class="flex items-start">
                                        <input type="radio" name="accessLevel" value="assigned" id="accessLevelAssigned" class="mt-1 w-5 h-5 text-purple-600 focus:ring-purple-500">
                                        <div class="ml-4 flex-1">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-users text-green-600 mr-2 text-xl"></i>
                                                <span class="text-base font-bold text-gray-900">Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú</span>
                                            </div>
                                            <p class="text-sm text-gray-600 leading-relaxed mb-3">
                                                ‚Ä¢ Î∞∞Ï†ïÎêú Î∞òÏùò ÌïôÏÉùÎßå Ï°∞Ìöå<br>
                                                ‚Ä¢ Î∞∞Ï†ïÎêú Î∞òÏùò ÏùºÏùº ÏÑ±Í≥ºÎßå ÏûëÏÑ±<br>
                                                ‚Ä¢ Î∞ò/Í≥ºÎ™© Í¥ÄÎ¶¨ Î∂àÍ∞Ä<br>
                                                ‚Ä¢ ÎûúÎî©ÌéòÏù¥ÏßÄ Ï†ëÍ∑º Î∂àÍ∞Ä
                                            </p>
                                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mt-3">
                                                <p class="text-xs text-purple-800 font-medium mb-2">
                                                    <i class="fas fa-info-circle mr-1"></i>Ïù¥ ÏòµÏÖòÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏïÑÎûòÏóêÏÑú Î∞òÏùÑ Î∞∞Ï†ïÌï¥Ï£ºÏÑ∏Ïöî:
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Î∞ò Î∞∞Ï†ï (Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú ÏÑ†ÌÉù ÏãúÏóêÎßå ÌôúÏÑ±Ìôî) -->
                        <div id="classAssignmentSection" class="border border-gray-200 rounded-lg p-4 bg-gray-50" style="display: none;">
                            <h4 class="font-medium text-gray-900 mb-3">
                                <i class="fas fa-chalkboard text-purple-600 mr-2"></i>Î∞ò Î∞∞Ï†ï
                            </h4>
                            <div id="classesCheckboxList" class="space-y-2 max-h-60 overflow-y-auto">
                                <div class="text-center text-gray-500 py-4">Î°úÎî© Ï§ë...</div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                Í∂åÌïú ÏÑ§Ï†ï ÌõÑ ÏÑ†ÏÉùÎãòÏùÄ Ï¶âÏãú Ìï¥Îãπ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                            </p>
                        </div>
                        
                        <div class="flex gap-3">
                            <button type="button" onclick="closePermissionsModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-times mr-2"></i>Ï∑®ÏÜå
                            </button>
                            <button type="submit" class="flex-1 gradient-purple text-white py-3 rounded-lg font-medium hover:opacity-90">
                                <i class="fas fa-save mr-2"></i>Ï†ÄÏû•
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ÏµúÍ∑º ÌôúÎèô -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä ÏµúÍ∑º ÌôúÎèô</h2>
                <div id="recentActivity" class="space-y-4">
                    <div class="text-center text-gray-500 py-8">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
                </div>
            </div>
        </div>

        <script>
            // Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌôïÏù∏
            const userStr = localStorage.getItem('user');
            let currentUser = null;
            let academyId = 1; // Í∏∞Î≥∏Í∞í (Î°úÍ∑∏Ïù∏ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞)
            let userPermissions = {
                canViewAllStudents: false,
                canWriteDailyReports: false,
                assignedClasses: []
            };
            
            if (userStr) {
                currentUser = JSON.parse(userStr);
                academyId = currentUser.id; // ‚≠ê Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÏùò IDÎ•º academyIdÎ°ú ÏÇ¨Ïö©
                console.log('‚úÖ Current user:', currentUser);
                console.log('‚úÖ Academy ID:', academyId);
            } else {
                console.warn('‚ö†Ô∏è Not logged in - using default academyId');
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í∂åÌïú ÌôïÏù∏ Î∞è UI Ï†úÌïú
            async function initializePage() {
                if (!currentUser) {
                    console.log('‚ö†Ô∏è No user logged in, showing public read-only view');
                    // ÎπÑÎ°úÍ∑∏Ïù∏ ÏÇ¨Ïö©ÏûêÎ•º ÏúÑÌïú Í≥µÍ∞ú ÏùΩÍ∏∞ Ï†ÑÏö© Î™®Îìú
                    applyPublicViewRestrictions();
                    await loadDashboard();
                    return;
                }
                
                console.log('üîç Initializing page for user:', currentUser);
                
                // user_typeÏù¥ ÏóÜÏúºÎ©¥ roleÏùÑ ÏÇ¨Ïö© (ÌïòÏúÑ Ìò∏ÌôòÏÑ±)
                if (!currentUser.user_type && currentUser.role) {
                    currentUser.user_type = currentUser.role;
                }
                
                // ÏÑ†ÏÉùÎãò Í≥ÑÏ†ï Í∞êÏßÄ (DBÏóê user_type='teacher'Î°ú Îì±Î°ùÎêú Í≤ΩÏö∞ÏóêÎßå ÏÑ†ÏÉùÎãò)
                // ‚úÖ Í∏∞Î≥∏Í∞í = ÏõêÏû•Îãò (Î™®Îì† Í∂åÌïú)
                // ‚úÖ ÏÑ†ÏÉùÎãòÏúºÎ°ú Îì±Î°ùÌïú Í≤ΩÏö∞ÏóêÎßå Ï†úÌïúÎêú Í∂åÌïú
                const isTeacher = currentUser.user_type === 'teacher' || currentUser.role === 'teacher';
                
                if (isTeacher) {
                    console.log('üîç Teacher account detected!');
                    console.log('   - user_type:', currentUser.user_type);
                    console.log('   - role:', currentUser.role);
                    console.log('   - id:', currentUser.id);
                    
                    // localStorageÏóê permissionsÍ∞Ä ÏóÜÏúºÎ©¥ ÏÑúÎ≤ÑÏóêÏÑú Ï°∞Ìöå
                    if (!currentUser.permissions) {
                        console.log('‚ö†Ô∏è No permissions in localStorage, fetching from server...');
                        await loadTeacherPermissions();
                        
                        // Ï°∞ÌöåÌïú Í∂åÌïúÏùÑ localStorageÏóê Ï†ÄÏû•
                        if (userPermissions) {
                            currentUser.permissions = userPermissions;
                            localStorage.setItem('user', JSON.stringify(currentUser));
                            console.log('‚úÖ Permissions saved to localStorage:', userPermissions);
                        } else {
                            // Í∂åÌïú Ï°∞Ìöå Ïã§Ìå® Ïãú Í∏∞Î≥∏ Ï†úÌïúÏ†Å Í∂åÌïú
                            currentUser.permissions = {
                                canViewAllStudents: false,
                                canWriteDailyReports: false,
                                assignedClasses: []
                            };
                            userPermissions = currentUser.permissions;
                            localStorage.setItem('user', JSON.stringify(currentUser));
                            console.log('‚ö†Ô∏è Using default restrictive permissions');
                        }
                    } else {
                        userPermissions = currentUser.permissions;
                        console.log('‚úÖ Using permissions from localStorage:', userPermissions);
                    }
                    
                    // ÏÑ†ÏÉùÎãò UI Ï†úÌïú Ï†ÅÏö©
                    applyTeacherRestrictions();
                } else {
                    console.log('‚úÖ Director account detected, no restrictions');
                }
                
                await loadDashboard();
            }
            
            // Í≥µÍ∞ú ÏùΩÍ∏∞ Ï†ÑÏö© Î™®Îìú Ï†úÌïú Ï†ÅÏö©
            function applyPublicViewRestrictions() {
                console.log('üîí Applying public read-only restrictions');
                
                // Î™®Îì† Ï∂îÍ∞Ä/ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº Ïà®Í∏∞Í∏∞
                const restrictedButtons = document.querySelectorAll(
                    '[onclick*="add"], [onclick*="create"], [onclick*="edit"], [onclick*="delete"], ' +
                    '[onclick*="update"], [onclick*="save"], [onclick*="remove"], ' +
                    '.add-button, .edit-button, .delete-button, .save-button'
                );
                restrictedButtons.forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ÏÑπÏÖò Ïà®Í∏∞Í∏∞
                const teacherSection = document.getElementById('teacherManagementSection');
                if (teacherSection) {
                    teacherSection.style.display = 'none';
                }
                
                // ÌéòÏù¥ÏßÄ ÏÉÅÎã®Ïóê ÏïåÎ¶º ÌëúÏãú
                const mainContent = document.querySelector('body > nav + div');
                if (mainContent) {
                    const notice = document.createElement('div');
                    notice.className = 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4';
                    notice.innerHTML = \`
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                                </div>
                                <div class="ml-3 flex-1">
                                    <p class="text-sm text-blue-700">
                                        <strong>ÏùΩÍ∏∞ Ï†ÑÏö© Î™®Îìú</strong> - Îç∞Ïù¥ÌÑ∞Î•º Î≥¥Í∏∞Îßå Ìï† Ïàò ÏûàÏäµÎãàÎã§. 
                                        <a href="/login" class="underline font-medium hover:text-blue-800">Î°úÍ∑∏Ïù∏</a>ÌïòÏó¨ Ï†ÑÏ≤¥ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
                                    </p>
                                </div>
                            </div>
                        </div>
                    \`;
                    mainContent.parentNode.insertBefore(notice, mainContent);
                }
            }

            // ÏÑ†ÏÉùÎãò Í∂åÌïú Î°úÎìú
            async function loadTeacherPermissions() {
                try {
                    // parent_user_idÍ∞Ä ÏóÜÏúºÎ©¥ ÏõêÏû• ID Ï°∞Ìöå
                    let directorId = currentUser.parent_user_id;
                    if (!directorId) {
                        console.log('‚ö†Ô∏è No parent_user_id, trying to find director...');
                        // Î™®Îì† ÏõêÏû•Ïùò IDÎ•º 1Î°ú Í∞ÄÏ†ïÌïòÍ±∞ÎÇò, ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò academy Ï†ïÎ≥¥ÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                        // ÏûÑÏãúÎ°ú 1ÏùÑ ÏÇ¨Ïö© (ÎåÄÎ∂ÄÎ∂ÑÏùò Í≤ΩÏö∞ ÏõêÏû• IDÍ∞Ä 1)
                        directorId = 1;
                    }
                    
                    console.log(\`üîç Fetching permissions for teacher \${currentUser.id} from director \${directorId}\`);
                    const res = await fetch(\`/api/teachers/\${currentUser.id}/permissions?directorId=\${directorId}\`);
                    const data = await res.json();
                    
                    if (data.success && data.permissions) {
                        userPermissions = data.permissions;
                        console.log('‚úÖ Teacher permissions loaded from server:', userPermissions);
                    } else {
                        console.warn('‚ö†Ô∏è No permissions found, using defaults');
                        userPermissions = {
                            canViewAllStudents: false,
                            canWriteDailyReports: false,
                            assignedClasses: []
                        };
                    }
                } catch (error) {
                    console.error('‚ùå Í∂åÌïú Î°úÎìú Ïã§Ìå®:', error);
                    // Ïã§Ìå® Ïãú Í∏∞Î≥∏ Í∂åÌïú (Î™®Îëê Ï†úÌïú)
                    userPermissions = {
                        canViewAllStudents: false,
                        canWriteDailyReports: false,
                        assignedClasses: []
                    };
                }
            }

            // ÏÑ†ÏÉùÎãò UI Ï†úÌïú Ï†ÅÏö©
            function applyTeacherRestrictions() {
                console.log('üîí Applying teacher restrictions...');
                console.log('Current user:', currentUser);
                console.log('User permissions:', userPermissions);
                
                // ‚úÖ Í∂åÌïú ÌôïÏù∏: assignedClassesÍ∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ Í∂åÌïú ÏóÜÏùå
                const hasAnyPermission = userPermissions && 
                                        userPermissions.assignedClasses && 
                                        userPermissions.assignedClasses.length > 0;
                
                const hasFullAccess = userPermissions && userPermissions.canViewAllStudents === true;
                
                console.log('üîç Permission check:');
                console.log('   - hasAnyPermission (assigned classes):', hasAnyPermission);
                console.log('   - hasFullAccess (canViewAllStudents):', hasFullAccess);
                console.log('   - assignedClasses:', userPermissions.assignedClasses);
                
                // ‚úÖ ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ Ïπ¥ÎìúÎäî ÏÑ†ÏÉùÎãòÏóêÍ≤å Ìï≠ÏÉÅ Ïà®ÍπÄ
                const teacherCard = document.getElementById('teacherManagementCard');
                if (teacherCard) {
                    teacherCard.style.display = 'none';
                    console.log('‚úÖ Hidden: Teacher management card');
                }
                
                // ‚úÖ Í∂åÌïúÏù¥ ÏóÜÏúºÎ©¥ Î™®Îì† Ïπ¥Îìú Ïà®Í∏∞Í≥† "Í∂åÌïú ÏóÜÏùå" Î©îÏãúÏßÄ ÌëúÏãú
                if (!hasAnyPermission && !hasFullAccess) {
                    console.log('‚ùå No permissions - hiding ALL cards and showing no-permission message');
                    
                    // Î™®Îì† Ïπ¥Îìú ÏöîÏÜå Ï∞æÍ∏∞
                    const gridContainer = document.getElementById('dashboardCardGrid');
                    
                    if (gridContainer) {
                        // Í∏∞Ï°¥ Î™®Îì† Ïπ¥Îìú Ï†úÍ±∞
                        gridContainer.innerHTML = '';
                        
                        // Í∂åÌïú ÏóÜÏùå Î©îÏãúÏßÄ Ï∂îÍ∞Ä
                        const noPermissionHTML = '<div class="col-span-full">' +
                            '<div class="text-center py-20">' +
                            '<div class="bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-12 max-w-lg mx-auto shadow-lg">' +
                            '<div class="mb-6">' +
                            '<i class="fas fa-lock text-7xl text-yellow-600 mb-4"></i>' +
                            '</div>' +
                            '<h3 class="text-2xl font-bold text-gray-900 mb-4">' +
                            'Ï†ëÍ∑º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§' +
                            '</h3>' +
                            '<p class="text-gray-600 text-lg mb-6 leading-relaxed">' +
                            'ÏõêÏû•ÎãòÏù¥ Í∂åÌïúÏùÑ Î∂ÄÏó¨ÌïòÎ©¥<br>' +
                            'ÌïôÏÉù Í¥ÄÎ¶¨ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.' +
                            '</p>' +
                            '<div class="bg-white rounded-lg p-4 text-sm text-gray-500">' +
                            '<i class="fas fa-info-circle mr-2"></i>' +
                            'Í∂åÌïú Î¨∏ÏùòÎäî ÏõêÏû•ÎãòÍªò ÏöîÏ≤≠Ìï¥Ï£ºÏÑ∏Ïöî.' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>';
                        gridContainer.innerHTML = noPermissionHTML;
                        console.log('‚úÖ Displayed: No permission message');
                    }
                    
                    // ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ÏÑπÏÖòÎèÑ Ïà®ÍπÄ
                    const teacherSection = document.getElementById('teacherSection');
                    if (teacherSection) {
                        teacherSection.style.display = 'none';
                    }
                    
                    return; // Îçî Ïù¥ÏÉÅ Ï≤òÎ¶¨ÌïòÏßÄ ÏïäÏùå
                }
                
                // ‚úÖ Î∞ò Í¥ÄÎ¶¨ÏôÄ Í≥ºÎ™© Í¥ÄÎ¶¨Îäî Ï†ÑÏ≤¥ Í∂åÌïúÏù¥ ÏûàÏùÑ ÎïåÎßå ÌëúÏãú
                const classCard = document.querySelector('a[href="/students/classes"]');
                if (classCard) {
                    if (hasFullAccess) {
                        classCard.style.display = 'block';
                        console.log('‚úÖ Showing: Class management (full access)');
                    } else {
                        classCard.style.display = 'none';
                        console.log('‚úÖ Hidden: Class management (restricted)');
                    }
                }
                
                const courseCard = document.querySelector('a[href="/students/courses"]');
                if (courseCard) {
                    if (hasFullAccess) {
                        courseCard.style.display = 'block';
                        console.log('‚úÖ Showing: Course management (full access)');
                    } else {
                        courseCard.style.display = 'none';
                        console.log('‚úÖ Hidden: Course management (restricted)');
                    }
                }
                
                // ‚úÖ ÌïôÏÉù Î™©Î°ùÍ≥º ÏùºÏùº ÏÑ±Í≥ºÎäî Í∂åÌïúÏù¥ ÏûàÏúºÎ©¥ ÌëúÏãú (Î∞∞Ï†ïÎêú Î∞òÎßå)
                const studentCard = document.querySelector('a[href="/students/list"]');
                if (studentCard) {
                    if (hasAnyPermission || hasFullAccess) {
                        studentCard.style.display = 'block';
                        console.log('‚úÖ Showing: Student list (has permission)');
                    } else {
                        studentCard.style.display = 'none';
                        console.log('‚úÖ Hidden: Student list (no permission)');
                    }
                }
                
                const dailyCard = document.querySelector('a[href="/students/daily-record"]');
                if (dailyCard) {
                    if (hasAnyPermission || hasFullAccess) {
                        dailyCard.style.display = 'block';
                        console.log('‚úÖ Showing: Daily records (has permission)');
                    } else {
                        dailyCard.style.display = 'none';
                        console.log('‚úÖ Hidden: Daily records (no permission)');
                    }
                }
                
                // ‚úÖ ÎûúÎî©ÌéòÏù¥ÏßÄ ÏÑπÏÖòÏùÄ Í¥ÄÎ¶¨ÏûêÍ∞Ä Í∂åÌïúÏùÑ Î∂ÄÏó¨Ìïú Í≤ΩÏö∞ÏóêÎßå ÌëúÏãú
                const landingSection = document.getElementById('landingPagesSection');
                if (landingSection) {
                    if (hasFullAccess) {
                        landingSection.style.display = 'block';
                        console.log('‚úÖ Showing: Landing pages section (full access)');
                    } else {
                        landingSection.style.display = 'none';
                        console.log('‚úÖ Hidden: Landing pages section (restricted)');
                    }
                }
                
                console.log('‚úÖ Teacher restrictions applied');
            }

            async function loadDashboard() {
                try {
                    // ÏÑ†ÏÉùÎãò Ïàò (ÏõêÏû•ÎãòÎßå)
                    if (currentUser && currentUser.user_type !== 'teacher') {
                        const teachersRes = await fetch('/api/teachers/list?directorId=' + currentUser.id);
                        const teachersData = await teachersRes.json();
                        if (teachersData.success) {
                            document.getElementById('totalTeachers').textContent = teachersData.teachers.length;
                        }
                    }
                
                    // Î∞ò Í∞úÏàò (ÏÑ†ÏÉùÎãòÏùÄ ÏûêÏã†Ïùò Î∞∞Ï†ïÎêú Î∞òÎßå)
                    if (currentUser && currentUser.user_type === 'teacher' && !userPermissions.canViewAllStudents) {
                        // Î∞∞Ï†ïÎêú Î∞òÎßå ÌëúÏãú
                        document.getElementById('totalClasses').textContent = userPermissions.assignedClasses.length;
                    } else {
                        const userDataHeader = currentUser ? btoa(unescape(encodeURIComponent(JSON.stringify(currentUser)))) : btoa(JSON.stringify({id: academyId}));
                        const classesRes = await fetch('/api/classes', {
                            headers: {
                                'X-User-Data-Base64': userDataHeader
                            }
                        });
                        const classesData = await classesRes.json();
                        console.log('üìä Classes data:', classesData);
                        if (classesData.success) {
                            document.getElementById('totalClasses').textContent = classesData.classes.length;
                        }
                    }

                    // ÌïôÏÉù Ïàò (APIÍ∞Ä ÏûêÎèôÏúºÎ°ú Í∂åÌïú ÌïÑÌÑ∞ÎßÅÌï®)
                    const studentsUserDataHeader = currentUser ? btoa(unescape(encodeURIComponent(JSON.stringify(currentUser)))) : btoa(JSON.stringify({id: academyId}));
                    const studentsRes = await fetch('/api/students', {
                        headers: {
                            'X-User-Data-Base64': studentsUserDataHeader
                        }
                    });
                    const studentsData = await studentsRes.json();
                    if (studentsData.success) {
                        document.getElementById('totalStudents').textContent = studentsData.students.length;
                        // ÏµúÍ∑º ÌôúÎèô ÌëúÏãú
                        showRecentActivity(studentsData.students.slice(0, 5));
                    }

                    // Í≥ºÎ™© Ïàò
                    const coursesRes = await fetch('/api/courses?academyId=' + academyId);
                    const coursesData = await coursesRes.json();
                    if (coursesData.success) {
                        document.getElementById('totalCourses').textContent = coursesData.courses.length;
                    }

                    // Ïò§Îäò Í∏∞Î°ù Ïàò
                    const today = new Date().toISOString().split('T')[0];
                    const recordsRes = await fetch('/api/daily-records?date=' + today);
                    const recordsData = await recordsRes.json();
                    if (recordsData.success) {
                        document.getElementById('todayRecords').textContent = recordsData.records.length;
                    }
                } catch (error) {
                    console.error('ÎåÄÏãúÎ≥¥Îìú Î°úÎî© Ïã§Ìå®:', error);
                }
            }

            function showRecentActivity(students) {
                const container = document.getElementById('recentActivity');
                if (students.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-8">ÏµúÍ∑º ÌôúÎèôÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                    return;
                }

                container.innerHTML = students.map(student => \`
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100">
                        <div class="flex items-center space-x-4">
                            <div class="bg-purple-100 text-purple-600 rounded-full w-10 h-10 flex items-center justify-center font-bold">
                                \${student.name.charAt(0)}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900">\${student.name}</p>
                                <p class="text-sm text-gray-500">\${student.class_name || 'Î∞ò ÎØ∏Î∞∞Ï†ï'} ¬∑ \${student.grade}</p>
                            </div>
                        </div>
                        <a href="/students/detail/\${student.id}" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            ÏÉÅÏÑ∏Î≥¥Í∏∞
                        </a>
                    </div>
                \`).join('');
            }

            // ÏÑ†ÏÉùÎãò Í¥ÄÎ¶¨ ÏÑπÏÖò ÌÜ†Í∏Ä
            function toggleTeacherSection() {
                const section = document.getElementById('teacherSection');
                const icon = document.getElementById('teacherSectionIcon');
                
                if (section.classList.contains('hidden')) {
                    section.classList.remove('hidden');
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                    loadTeacherData();
                } else {
                    section.classList.add('hidden');
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            }

            function loadTeacherData() {
                if (!currentUser) return;
                loadVerificationCode();
                loadTeachersList();
                loadPendingApplications();
            }

            async function loadVerificationCode() {
                try {
                    console.log('[Frontend] Loading verification code for user:', currentUser);
                    
                    const res = await fetch('/api/teachers/verification-code?directorId=' + currentUser.id);
                    const data = await res.json();
                    console.log('[Frontend] Verification code response:', data);
                    
                    if (data.success) {
                        // code Ïö∞ÏÑ†, Í∑∏ Îã§Ïùå codeData.code, ÎßàÏßÄÎßâÏúºÎ°ú codeData.verification_code
                        const code = data.code || (data.codeData && (data.codeData.code || data.codeData.verification_code)) || '------';
                        console.log('[Frontend] Setting code to:', code);
                        
                        const codeElement = document.getElementById('verificationCode');
                        if (codeElement) {
                            codeElement.textContent = code;
                            // ÏΩîÎìúÍ∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏúºÎ©¥ Îπ®Í∞ÑÏÉâÏúºÎ°ú ÌëúÏãú
                            if (code === '------' || code === 'Ïò§Î•ò' || code === 'ERROR') {
                                codeElement.classList.add('text-red-600');
                                codeElement.classList.remove('text-purple-600');
                            } else {
                                codeElement.classList.add('text-purple-600');
                                codeElement.classList.remove('text-red-600');
                            }
                        }
                    } else {
                        console.error('[Frontend] Ïù∏Ï¶ù ÏΩîÎìú Î°úÎî© Ïã§Ìå®:', data.error, data.details);
                        const codeElement = document.getElementById('verificationCode');
                        if (codeElement) {
                            codeElement.textContent = 'Ïò§Î•ò';
                            codeElement.classList.add('text-red-600');
                            codeElement.classList.remove('text-purple-600');
                        }
                        alert('Ïù∏Ï¶ù ÏΩîÎìú Î°úÎî© Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    console.error('[Frontend] Ïù∏Ï¶ù ÏΩîÎìú Î°úÎî© Ïã§Ìå®:', error);
                    const codeElement = document.getElementById('verificationCode');
                    if (codeElement) {
                        codeElement.textContent = 'Ïò§Î•ò';
                        codeElement.classList.add('text-red-600');
                        codeElement.classList.remove('text-purple-600');
                    }
                }
            }

            async function regenerateVerificationCode() {
                if (!confirm('Ïù∏Ï¶ù ÏΩîÎìúÎ•º Ïû¨ÏÉùÏÑ±ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\n\\n‚ö†Ô∏è Ïù¥Ï†Ñ ÏΩîÎìúÎäî ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÍ≤å Îê©ÎãàÎã§.')) return;
                try {
                    console.log('[Frontend] Regenerating code for user:', currentUser);
                    
                    const res = await fetch('/api/teachers/verification-code/regenerate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ directorId: currentUser.id })
                    });
                    const data = await res.json();
                    console.log('[Frontend] Regenerate response:', data);
                    
                    if (data.success) {
                        // code Ïö∞ÏÑ†, Í∑∏ Îã§Ïùå codeData.code, ÎßàÏßÄÎßâÏúºÎ°ú codeData.verification_code
                        const newCode = data.code || (data.codeData && (data.codeData.code || data.codeData.verification_code));
                        console.log('[Frontend] New code:', newCode);
                        
                        const codeElement = document.getElementById('verificationCode');
                        if (codeElement) {
                            codeElement.textContent = newCode;
                            codeElement.classList.add('text-purple-600');
                            codeElement.classList.remove('text-red-600');
                        }
                        alert('‚úÖ Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä Ïû¨ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!\\n\\nÏÉà ÏΩîÎìú: ' + newCode);
                    } else {
                        console.error('[Frontend] Ïû¨ÏÉùÏÑ± Ïã§Ìå®:', data);
                        alert('‚ùå ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                        console.error('Ïû¨ÏÉùÏÑ± Ïã§Ìå® ÏÉÅÏÑ∏:', data);
                    }
                } catch (error) {
                    console.error('ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ïã§Ìå®:', error);
                    alert('ÏΩîÎìú Ïû¨ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }

            function copyVerificationCode() {
                const code = document.getElementById('verificationCode').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    alert('Ïù∏Ï¶ù ÏΩîÎìúÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§: ' + code);
                });
            }

            function copyRegisterLink() {
                const link = 'https://superplace-academy.pages.dev/signup?teacher=true';
                navigator.clipboard.writeText(link).then(() => {
                    alert('Îì±Î°ù ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                });
            }

            async function loadTeachersList() {
                try {
                    const res = await fetch('/api/teachers/list?directorId=' + currentUser.id);
                    const data = await res.json();
                    const container = document.getElementById('teachersList');
                    
                    if (!data.success || data.teachers.length === 0) {
                        container.innerHTML = '<div class="text-center text-gray-500 py-8">Îì±Î°ùÎêú ÏÑ†ÏÉùÎãòÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                        return;
                    }

                    container.innerHTML = data.teachers.map(teacher => {
                        const escapedName = (teacher.name || '').replace(/'/g, "\\'");
                        return \`
                        <div class="bg-white border rounded-xl p-6 hover:shadow-lg transition">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-tie text-purple-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">\${teacher.name}</h3>
                                        <p class="text-sm text-gray-600">\${teacher.email}</p>
                                        <p class="text-sm text-gray-500">\${teacher.phone || '-'}</p>
                                        <span class="inline-block mt-2 px-3 py-1 bg-purple-100 text-purple-600 rounded-full text-xs font-medium">
                                            Îã¥Îãπ Î∞ò: \${teacher.class_count || 0}Í∞ú
                                        </span>
                                    </div>
                                </div>
                                <button onclick="showTeacherPermissions(\${teacher.id}, '\${escapedName}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <i class="fas fa-cog mr-2"></i>Í∂åÌïú ÏÑ§Ï†ï
                                </button>
                            </div>
                        </div>
                        \`;
                    }).join('');
                } catch (error) {
                    console.error('ÏÑ†ÏÉùÎãò Î™©Î°ù Î°úÎî© Ïã§Ìå®:', error);
                }
            }

            async function loadPendingApplications() {
                try {
                    const res = await fetch('/api/teachers/applications?directorId=' + currentUser.id + '&status=pending');
                    const data = await res.json();
                    const container = document.getElementById('pendingList');
                    const countBadge = document.getElementById('pendingBadge');
                    
                    console.log('[LoadPending] Response:', data);
                    
                    if (!data.success || !data.applications || data.applications.length === 0) {
                        if (container) container.innerHTML = '<div class="text-center text-gray-500 py-8">ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ëÏù∏ Ïã†Ï≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                        if (countBadge) countBadge.textContent = '0';
                        return;
                    }

                    if (countBadge) countBadge.textContent = data.applications.length;
                    if (container) {
                        container.innerHTML = data.applications.map(app => {
                            const escapedName = (app.name || '').replace(/'/g, "\\'");
                            return \`
                            <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">\${app.name}</h3>
                                        <p class="text-sm text-gray-600">\${app.email}</p>
                                        <p class="text-sm text-gray-500">\${app.phone || '-'}</p>
                                        <p class="text-xs text-gray-400 mt-2">Ïã†Ï≤≠Ïùº: \${new Date(app.applied_at).toLocaleString('ko-KR')}</p>
                                    </div>
                                    <span class="px-3 py-1 bg-yellow-500 text-white rounded-full text-xs font-medium">
                                        ÎåÄÍ∏∞Ï§ë
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="approveApplication(\${app.id}, '\${escapedName}')" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                        <i class="fas fa-check mr-2"></i>ÏäπÏù∏
                                    </button>
                                    <button onclick="rejectApplication(\${app.id}, '\${escapedName}')" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                        <i class="fas fa-times mr-2"></i>Í±∞Ï†à
                                    </button>
                                </div>
                            </div>
                            \`;
                        }).join('');
                    }
                } catch (error) {
                    console.error('ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù Î°úÎî© Ïã§Ìå®:', error);
                    alert('ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù Î°úÎî© Ïã§Ìå®: ' + error.message);
                }
            }

            async function approveApplication(id, name) {
                if (!confirm(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) return;
                try {
                    const res = await fetch(\`/api/teachers/applications/\${id}/approve\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ directorId: currentUser.id })
                    });
                    const data = await res.json();
                    if (data.success) {
                        alert(\`\${name} ÏÑ†ÏÉùÎãòÏù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§!\`);
                        loadPendingApplications();
                        loadTeachersList();
                        loadDashboard();
                    } else {
                        alert('ÏäπÏù∏ Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    console.error('ÏäπÏù∏ Ïã§Ìå®:', error);
                    alert('ÏäπÏù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            async function rejectApplication(id, name) {
                if (!confirm(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠ÏùÑ Í±∞Ï†àÌïòÏãúÍ≤†ÏäµÎãàÍπå?\`)) return;
                const reason = prompt('Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠):');
                try {
                    const res = await fetch(\`/api/teachers/applications/\${id}/reject\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            directorId: currentUser.id,
                            reason: reason || 'ÏäπÏù∏ Í±∞Î∂Ä'
                        })
                    });
                    const data = await res.json();
                    if (data.success) {
                        alert(\`\${name} ÏÑ†ÏÉùÎãòÏùò Ïã†Ï≤≠Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.\`);
                        loadPendingApplications();
                    } else {
                        alert('Í±∞Ï†à Ïã§Ìå®: ' + data.error);
                    }
                } catch (error) {
                    console.error('Í±∞Ï†à Ïã§Ìå®:', error);
                    alert('Í±∞Ï†à Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            async function showTeacherPermissions(teacherId, teacherName) {
                // Î™®Îã¨ Ïó¥Í∏∞
                document.getElementById('permissionsModal').classList.remove('hidden');
                document.getElementById('permissionsTeacherName').textContent = teacherName;
                document.getElementById('permissionsTeacherId').value = teacherId;
                
                console.log('üîç [ShowPermissions] Opening modal for teacher:', teacherId, teacherName);
                console.log('üîç [ShowPermissions] Current user:', currentUser);
                
                try {
                    // Î∞ò Î™©Î°ù Î°úÎìú - /api/classes/list ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏÇ¨Ïö©
                    const classesRes = await fetch(\`/api/classes/list?userId=\${currentUser.id}&userType=director\`);
                    const classesData = await classesRes.json();
                    
                    console.log('üìö [ShowPermissions] Classes response:', classesData);
                    
                    if (classesData.success) {
                        const classList = document.getElementById('classesCheckboxList');
                        if (classesData.classes && classesData.classes.length > 0) {
                            console.log('‚úÖ [ShowPermissions] Found ' + classesData.classes.length + ' classes');
                            classList.innerHTML = classesData.classes.map(cls => \`
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" value="\${cls.id}" class="class-checkbox w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
                                    <span class="ml-2 text-sm text-gray-700">\${cls.name || cls.class_name} \${cls.grade_level || cls.grade || ''}</span>
                                </label>
                            \`).join('');
                        } else {
                            console.warn('‚ö†Ô∏è [ShowPermissions] No classes found');
                            classList.innerHTML = '<div class="text-center text-gray-500 py-4">Îì±Î°ùÎêú Î∞òÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                        }
                    } else {
                        console.error('‚ùå [ShowPermissions] Classes API failed:', classesData.error);
                        document.getElementById('classesCheckboxList').innerHTML = '<div class="text-center text-red-500 py-4">Î∞ò Î™©Î°ù Î°úÎìú Ïã§Ìå®: ' + (classesData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò') + '</div>';
                    }
                    
                    // ÏÑ†ÏÉùÎãò Í∂åÌïú Ï†ïÎ≥¥ Î°úÎìú
                    console.log('üîê [ShowPermissions] Loading permissions for teacher:', teacherId);
                    const permRes = await fetch(\`/api/teachers/\${teacherId}/permissions?directorId=\${currentUser.id}\`);
                    const permData = await permRes.json();
                    
                    console.log('üîê [ShowPermissions] Permissions response:', permData);
                    
                    if (permData.success) {
                        const hasFullAccess = permData.permissions?.canViewAllStudents || false;
                        const assignedClasses = permData.permissions?.assignedClasses || [];
                        
                        // ÎùºÎîîÏò§ Î≤ÑÌäº ÏÑ§Ï†ï
                        if (hasFullAccess) {
                            document.getElementById('accessLevelAll').checked = true;
                            document.getElementById('classAssignmentSection').style.display = 'none';
                            // ÏòµÏÖò Í∞ïÏ°∞
                            document.getElementById('allAccessOption').classList.add('border-purple-500', 'bg-purple-50');
                            document.getElementById('assignedOnlyOption').classList.remove('border-purple-500', 'bg-purple-50');
                        } else if (assignedClasses.length > 0) {
                            document.getElementById('accessLevelAssigned').checked = true;
                            document.getElementById('classAssignmentSection').style.display = 'block';
                            // ÏòµÏÖò Í∞ïÏ°∞
                            document.getElementById('assignedOnlyOption').classList.add('border-purple-500', 'bg-purple-50');
                            document.getElementById('allAccessOption').classList.remove('border-purple-500', 'bg-purple-50');
                            
                            // Î∞∞Ï†ïÎêú Î∞ò Ï≤¥ÌÅ¨
                            console.log('üîê [ShowPermissions] Assigned classes:', assignedClasses);
                            document.querySelectorAll('.class-checkbox').forEach(checkbox => {
                                const classId = parseInt(checkbox.value);
                                checkbox.checked = assignedClasses.includes(classId);
                                console.log('  - Class', classId, 'checked:', checkbox.checked);
                            });
                        } else {
                            // Í∂åÌïú ÏóÜÏùå - Í∏∞Î≥∏Í∞í
                            document.getElementById('accessLevelAll').checked = false;
                            document.getElementById('accessLevelAssigned').checked = false;
                            document.getElementById('classAssignmentSection').style.display = 'none';
                        }
                    } else {
                        console.error('‚ùå [ShowPermissions] Failed to load permissions:', permData.error);
                    }
                } catch (error) {
                    console.error('‚ùå [ShowPermissions] Exception:', error);
                    console.error('‚ùå [ShowPermissions] Stack:', error.stack);
                    alert('Í∂åÌïú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }
            
            // ÎùºÎîîÏò§ Î≤ÑÌäº Î≥ÄÍ≤Ω Ïãú Î∞ò Î∞∞Ï†ï ÏÑπÏÖò ÌëúÏãú/Ïà®ÍπÄ
            document.addEventListener('DOMContentLoaded', function() {
                const allAccessRadio = document.getElementById('accessLevelAll');
                const assignedRadio = document.getElementById('accessLevelAssigned');
                const classSection = document.getElementById('classAssignmentSection');
                const allOption = document.getElementById('allAccessOption');
                const assignedOption = document.getElementById('assignedOnlyOption');
                
                if (allAccessRadio) {
                    allAccessRadio.addEventListener('change', function() {
                        if (this.checked) {
                            classSection.style.display = 'none';
                            allOption.classList.add('border-purple-500', 'bg-purple-50');
                            assignedOption.classList.remove('border-purple-500', 'bg-purple-50');
                        }
                    });
                }
                
                if (assignedRadio) {
                    assignedRadio.addEventListener('change', function() {
                        if (this.checked) {
                            classSection.style.display = 'block';
                            assignedOption.classList.add('border-purple-500', 'bg-purple-50');
                            allOption.classList.remove('border-purple-500', 'bg-purple-50');
                        }
                    });
                }
            });
            
            function closePermissionsModal() {
                document.getElementById('permissionsModal').classList.add('hidden');
                document.getElementById('permissionsForm').reset();
                document.getElementById('classAssignmentSection').style.display = 'none';
                document.getElementById('allAccessOption').classList.remove('border-purple-500', 'bg-purple-50');
                document.getElementById('assignedOnlyOption').classList.remove('border-purple-500', 'bg-purple-50');
            }
            
            // Í∂åÌïú Ï†ÄÏû•
            document.getElementById('permissionsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                console.log('üîí [SavePermissions] Form submitted');
                
                const teacherId = document.getElementById('permissionsTeacherId').value;
                const teacherName = document.getElementById('permissionsTeacherName').textContent;
                
                console.log('üîí [SavePermissions] teacherId:', teacherId);
                console.log('üîí [SavePermissions] teacherName:', teacherName);
                console.log('üîí [SavePermissions] currentUser:', currentUser);
                
                // ÎùºÎîîÏò§ Î≤ÑÌäº Í∞í ÌôïÏù∏
                const accessLevel = document.querySelector('input[name="accessLevel"]:checked')?.value;
                
                if (!accessLevel) {
                    alert('‚ùå Í∂åÌïú Î†àÎ≤®ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                let permissions;
                
                if (accessLevel === 'all') {
                    // Î™®Îëê Îã§ Í≥µÍ∞ú
                    permissions = {
                        canViewAllStudents: true,
                        canWriteDailyReports: true,
                        assignedClasses: []  // Ï†ÑÏ≤¥ Ï†ëÍ∑ºÏù¥ÎØÄÎ°ú Îπà Î∞∞Ïó¥
                    };
                    console.log('üîí [SavePermissions] Selected: Î™®Îëê Îã§ Í≥µÍ∞ú');
                } else {
                    // Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú
                    const assignedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                        .map(cb => parseInt(cb.value));
                    
                    if (assignedClasses.length === 0) {
                        alert('‚ùå ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅÏùò Î∞òÏùÑ Î∞∞Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    permissions = {
                        canViewAllStudents: false,
                        canWriteDailyReports: true,  // Î∞∞Ï†ïÎêú Î∞òÏóê ÎåÄÌï¥ÏÑúÎäî ÏùºÏùº ÏÑ±Í≥º ÏûëÏÑ± Í∞ÄÎä•
                        assignedClasses: assignedClasses
                    };
                    console.log('üîí [SavePermissions] Selected: Î∞∞Ï†ïÎêú Î∞òÎßå Í≥µÍ∞ú, classes:', assignedClasses);
                }
                
                console.log('üîí [SavePermissions] Final permissions:', permissions);
                console.log('üîí [SavePermissions] directorId:', currentUser?.id);
                
                if (!currentUser?.id) {
                    alert('‚ùå Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                if (!teacherId) {
                    alert('‚ùå ÏÑ†ÏÉùÎãò IDÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                try {
                    console.log('üîí [SavePermissions] Sending request to /api/teachers/' + teacherId + '/permissions');
                    
                    const requestBody = {
                        directorId: currentUser.id,
                        permissions: permissions
                    };
                    
                    console.log('üîí [SavePermissions] Request body:', JSON.stringify(requestBody, null, 2));
                    
                    const res = await fetch(\`/api/teachers/\${teacherId}/permissions\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });
                    
                    console.log('üîí [SavePermissions] Response status:', res.status);
                    console.log('üîí [SavePermissions] Response ok:', res.ok);
                    
                    const data = await res.json();
                    console.log('üîí [SavePermissions] Response data:', data);
                    
                    if (data.success) {
                        // Ï†ÄÏû• ÌõÑ Ïã§Ï†ú Ï†ÄÏû•Îêú Í∂åÌïú ÌôïÏù∏
                        alert(teacherName + " ÏÑ†ÏÉùÎãòÏùò Í∂åÌïúÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!");
                        alert(message);
                        console.log('‚úÖ [SavePermissions] Success!');
                        closePermissionsModal();
                    } else {
                        alert('‚ùå Í∂åÌïú Ï†ÄÏû• Ïã§Ìå®: ' + data.error);
                        console.error('‚ùå [SavePermissions] Failed:', data.error);
                    }
                } catch (error) {
                    console.error('‚ùå [SavePermissions] Exception:', error);
                    console.error('‚ùå [SavePermissions] Stack:', error.stack);
                    alert('‚ùå Í∂åÌïú Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            });

            function openAddTeacherModal() {
                document.getElementById('addTeacherModal').classList.remove('hidden');
            }

            function closeAddTeacherModal() {
                document.getElementById('addTeacherModal').classList.add('hidden');
                document.getElementById('addTeacherForm').reset();
            }

            // ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ìèº Ï†úÏ∂ú
            document.getElementById('addTeacherForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                console.log('[AddTeacher] Form submitted');
                console.log('[AddTeacher] Current user:', currentUser);
                
                const formData = new FormData(e.target);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    password: formData.get('password'),
                    directorId: currentUser?.id
                };
                
                console.log('[AddTeacher] Form data:', data);
                
                if (!data.directorId) {
                    alert('Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    console.log('[AddTeacher] Sending request...');
                    const res = await fetch('/api/teachers/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    console.log('[AddTeacher] Response status:', res.status);
                    const result = await res.json();
                    console.log('[AddTeacher] Response data:', result);
                    
                    if (result.success) {
                        alert(\`\${data.name} ÏÑ†ÏÉùÎãòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!\`);
                        closeAddTeacherModal();
                        loadTeachersList();
                        loadDashboard();
                    } else {
                        alert('Ï∂îÍ∞Ä Ïã§Ìå®: ' + result.error);
                        if (result.details) {
                            console.error('[AddTeacher] Error details:', result.details);
                        }
                    }
                } catch (error) {
                    console.error('[AddTeacher] Network error:', error);
                    alert('ÏÑ†ÏÉùÎãò Ï∂îÍ∞Ä Ï§ë ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            });

            // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
            initializePage();
        </script>
    </body>
    </html>
  `)
})

// Î∞ò Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/students/classes', (c) => {
  return c.html(studentPages.classesPage)
})

// ÌïôÏÉù Î™©Î°ù ÌéòÏù¥ÏßÄ
app.get('/students/list', (c) => {
  return c.html(studentPages.studentsListPage)
})

// ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù ÌéòÏù¥ÏßÄ
app.get('/students/daily-record', (c) => {
  return c.html(studentPages.dailyRecordPage)
})

// Í≥ºÎ™© Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
app.get('/students/courses', (c) => {
  return c.html(studentPages.coursesPage)
})

// ÌïôÏÉù ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ
app.get('/students/detail/:studentId', (c) => {
  return c.html(studentPages.studentDetailPage)
})

// DB Ï¥àÍ∏∞Ìôî API (ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤ΩÏóêÏÑú ÌïôÏÉù Í¥ÄÎ¶¨ ÌÖåÏù¥Î∏î ÏÉùÏÑ±Ïö©)
app.get('/api/init-student-tables', async (c) => {
  try {
    const { DB } = c.env
    
    // ÌïôÏÉù Ï†ïÎ≥¥ ÌÖåÏù¥Î∏î ÏÉùÏÑ± (Î®ºÏ†Ä ÏÉùÏÑ±)
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS students (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER DEFAULT 1,
        name TEXT NOT NULL,
        phone TEXT,
        parent_name TEXT NOT NULL,
        parent_phone TEXT NOT NULL,
        parent_email TEXT,
        grade TEXT NOT NULL,
        subjects TEXT NOT NULL,
        enrollment_date DATE NOT NULL,
        status TEXT DEFAULT 'active',
        notes TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()
    
    // Î∞ò(Class) ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS classes (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER DEFAULT 1,
        class_name TEXT NOT NULL,
        grade TEXT,
        description TEXT,
        schedule_days TEXT,
        start_time TEXT,
        end_time TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()
    
    // classes ÌÖåÏù¥Î∏îÏóê Ïä§ÏºÄÏ§Ñ Ïª¥Îüº Ï∂îÍ∞Ä (Ïù¥ÎØ∏ ÏûàÏúºÎ©¥ Î¨¥Ïãú)
    try {
      await DB.prepare(`ALTER TABLE classes ADD COLUMN schedule_days TEXT`).run()
    } catch (e) {
      console.log('schedule_days column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE classes ADD COLUMN start_time TEXT`).run()
    } catch (e) {
      console.log('start_time column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE classes ADD COLUMN end_time TEXT`).run()
    } catch (e) {
      console.log('end_time column already exists')
    }
    
    // Í≥ºÎ™©(Course) ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS courses (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        academy_id INTEGER DEFAULT 1,
        course_name TEXT NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()
    
    // ÌïôÏÉù ÌÖåÏù¥Î∏îÏóê class_id Ïª¨Îüº Ï∂îÍ∞Ä (Ïù¥ÎØ∏ ÏûàÏúºÎ©¥ Î¨¥Ïãú)
    try {
      await DB.prepare(`ALTER TABLE students ADD COLUMN class_id INTEGER`).run()
    } catch (e) {
      // Ïª¨ÎüºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ Î¨¥Ïãú
      console.log('class_id column already exists')
    }
    
    // ÏùºÏùº ÏÑ±Í≥º Í∏∞Î°ù ÌÖåÏù¥Î∏î ÏÉùÏÑ±
    await DB.prepare(`
      CREATE TABLE IF NOT EXISTS daily_records (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        student_id INTEGER NOT NULL,
        class_id INTEGER,
        record_date DATE NOT NULL,
        attendance TEXT CHECK(attendance IN ('Ï∂úÏÑù', 'ÏßÄÍ∞Å', 'Í≤∞ÏÑù', 'Ï°∞Ìá¥')),
        lesson_concept TEXT,
        lesson_understanding INTEGER CHECK(lesson_understanding >= 1 AND lesson_understanding <= 5),
        lesson_participation INTEGER CHECK(lesson_participation >= 1 AND lesson_participation <= 5),
        lesson_achievement TEXT,
        homework_status TEXT CHECK(homework_status IN ('ÏôÑÎ£å', 'ÎØ∏ÏôÑÎ£å', 'Î∂ÄÎ∂ÑÏôÑÎ£å')),
        homework_content TEXT,
        homework_achievement TEXT,
        memo TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `).run()
    
    // Í∏∞Ï°¥ ÌÖåÏù¥Î∏îÏóê ÏÉà Ïª¨Îüº Ï∂îÍ∞Ä (Ïù¥ÎØ∏ ÏûàÏúºÎ©¥ Î¨¥Ïãú)
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN class_id INTEGER`).run()
    } catch (e) {
      console.log('class_id column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN lesson_concept TEXT`).run()
    } catch (e) {
      console.log('lesson_concept column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN lesson_understanding INTEGER`).run()
    } catch (e) {
      console.log('lesson_understanding column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN lesson_participation INTEGER`).run()
    } catch (e) {
      console.log('lesson_participation column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN lesson_achievement TEXT`).run()
    } catch (e) {
      console.log('lesson_achievement column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN homework_content TEXT`).run()
    } catch (e) {
      console.log('homework_content column already exists')
    }
    try {
      await DB.prepare(`ALTER TABLE daily_records ADD COLUMN homework_achievement TEXT`).run()
    } catch (e) {
      console.log('homework_achievement column already exists')
    }
    
    // Ïù∏Îç±Ïä§ ÏÉùÏÑ±
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_students_academy_id ON students(academy_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_classes_academy_id ON classes(academy_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_courses_academy_id ON courses(academy_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_students_class_id ON students(class_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_daily_records_student_id ON daily_records(student_id)`).run()
    await DB.prepare(`CREATE INDEX IF NOT EXISTS idx_daily_records_date ON daily_records(record_date)`).run()
    
    return c.json({
      success: true,
      message: 'ÌïôÏÉù Í¥ÄÎ¶¨ ÌÖåÏù¥Î∏îÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! (students, classes, courses, daily_records)'
    })
  } catch (error: any) {
    return c.json({
      success: false,
      error: error.message
    }, 500)
  }
})

// ÎîîÎ≤ÑÍ∑∏: ÌïôÏÉù Ï∞∏Ï°∞ ÌôïÏù∏ API
app.get('/api/debug/student-references/:studentId', async (c) => {
  try {
    const studentId = c.req.param('studentId')
    const { DB } = c.env
    
    const references: any = {}
    
    // daily_records ÌôïÏù∏
    const dailyRecords = await DB.prepare('SELECT COUNT(*) as count FROM daily_records WHERE student_id = ?').bind(studentId).first()
    references.daily_records = dailyRecords
    
    // ÌïôÏÉù Ï†ïÎ≥¥ ÌôïÏù∏
    const student = await DB.prepare('SELECT * FROM students WHERE id = ?').bind(studentId).first()
    references.student = student
    
    return c.json({
      success: true,
      studentId,
      references
    })
  } catch (error: any) {
    return c.json({
      success: false,
      error: error.message
    }, 500)
  }
})

// ÎîîÎ≤ÑÍπÖ API: ÌòÑÏû¨ ÏÑ†ÏÉùÎãòÏùò Ï†ÄÏû•Îêú Í∂åÌïú ÌôïÏù∏
app.get('/api/debug/my-permissions', async (c) => {
  try {
    const user = JSON.parse(c.req.header('X-User-Data-Base64') ? decodeURIComponent(escape(atob(c.req.header('X-User-Data-Base64') || ''))) : '{"id":1}')
    
    console.log('üîç [DebugPermissions] User ID:', user.id)
    
    // teacher_permissions ÌÖåÏù¥Î∏îÏóêÏÑú Í∂åÌïú Ï°∞Ìöå
    const permRows = await c.env.DB.prepare(
      'SELECT permission_key, permission_value FROM teacher_permissions WHERE teacher_id = ?'
    ).bind(user.id).all()
    
    console.log('üîç [DebugPermissions] Found', permRows.results?.length || 0, 'permission rows')
    
    const permissions = {}
    if (permRows.results) {
      for (const row of permRows.results) {
        const key = row.permission_key
        const value = row.permission_value
        
        // Í∞í ÌååÏã±
        if (key === 'assignedClasses' && typeof value === 'string') {
          try {
            permissions[key] = JSON.parse(value)
          } catch (e) {
            permissions[key] = value
          }
        } else if (key === 'canViewAllStudents' || key === 'canWriteDailyReports') {
          permissions[key] = value === '1' || value === 1 || value === true
        } else {
          permissions[key] = value
        }
      }
    }
    
    return c.json({
      success: true,
      userId: user.id,
      rawRows: permRows.results,
      parsedPermissions: permissions
    })
  } catch (err) {
    console.error('‚ùå [DebugPermissions] Error:', err)
    return c.json({ success: false, error: err.message }, 500)
  }
})

// üöÄ Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± API (Î∞ò ÏûêÎèô ÏÉùÏÑ±)
app.post('/api/admin/init-sample-classes', async (c) => {
  try {
    const { userId } = await c.req.json()
    
    if (!userId) {
      return c.json({ success: false, error: 'ÏÇ¨Ïö©Ïûê IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.' }, 400)
    }
    
    console.log('[InitClasses] Creating sample classes for userId:', userId)
    
    const sampleClasses = [
      { name: 'Ï¥àÎì± 3ÌïôÎÖÑ ÏàòÌïôÎ∞ò', grade: '3ÌïôÎÖÑ', description: 'Ï¥àÎì±ÌïôÍµê 3ÌïôÎÖÑ ÏàòÌïô ÏàòÏóÖ' },
      { name: 'Ï¥àÎì± 4ÌïôÎÖÑ ÏàòÌïôÎ∞ò', grade: '4ÌïôÎÖÑ', description: 'Ï¥àÎì±ÌïôÍµê 4ÌïôÎÖÑ ÏàòÌïô ÏàòÏóÖ' },
      { name: 'Ï¥àÎì± 5ÌïôÎÖÑ ÏàòÌïôÎ∞ò', grade: '5ÌïôÎÖÑ', description: 'Ï¥àÎì±ÌïôÍµê 5ÌïôÎÖÑ ÏàòÌïô ÏàòÏóÖ' }
    ]
    
    const created = []
    
    for (const cls of sampleClasses) {
      const result = await c.env.DB.prepare(`
        INSERT INTO classes (name, description, user_id, grade_level, max_students, status, created_at)
        VALUES (?, ?, ?, ?, 20, 'active', datetime('now'))
      `).bind(cls.name, cls.description, userId, cls.grade).run()
      
      created.push({
        id: result.meta.last_row_id,
        name: cls.name,
        grade: cls.grade
      })
      
      console.log('[InitClasses] Created class:', cls.name, 'with ID:', result.meta.last_row_id)
    }
    
    return c.json({
      success: true,
      message: `${created.length}Í∞úÏùò ÏÉòÌîå Î∞òÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`,
      classes: created
    })
  } catch (err) {
    console.error('[InitClasses] Error:', err)
    return c.json({ success: false, error: err.message }, 500)
  }
})

// ==================== TEMPORARY FIX ====================
// Create empty teacher_classes table to fix D1 error
app.get('/api/fix-teacher-classes-error', async (c) => {
  try {
    // Create teacher_classes table (empty, unused, just to prevent error)
    await c.env.DB.prepare(`
      CREATE TABLE IF NOT EXISTS teacher_classes (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        teacher_id INTEGER NOT NULL,
        class_id INTEGER NOT NULL,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(teacher_id, class_id)
      )
    `).run()
    
    return c.json({ 
      success: true, 
      message: 'teacher_classes ÌÖåÏù¥Î∏îÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§ (ÏûÑÏãú ÏàòÏ†ï)',
      note: 'Ïù¥ ÌÖåÏù¥Î∏îÏùÄ ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏßÄÎßå D1 ÏóêÎü¨Î•º Î∞©ÏßÄÌï©ÎãàÎã§'
    })
  } catch (err) {
    return c.json({ success: false, error: err.message }, 500)
  }
})
// ==================== END TEMPORARY FIX ====================

// ÏÇ¨Ïö©Ïûê Î∞è Î∞ò Ï†ïÎ≥¥ Ï°∞Ìöå API
app.get('/api/admin/get-user-classes', async (c) => {
  try {
    const { DB } = c.env
    const email = c.req.query('email')
    
    if (!email) {
      return c.json({ success: false, error: 'Email parameter required' }, 400)
    }
    
    // ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    const user = await DB.prepare('SELECT id, email, name, academy_name FROM users WHERE email = ?')
      .bind(email)
      .first()
    
    if (!user) {
      return c.json({ success: false, error: 'User not found' }, 404)
    }
    
    // Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÏùò Î∞ò Î™©Î°ù (academy_id ÏÇ¨Ïö©)
    const classes = await DB.prepare(`
      SELECT c.*, COUNT(s.id) as student_count
      FROM classes c
      LEFT JOIN students s ON c.id = s.class_id AND s.status = 'active'
      WHERE c.academy_id = ?
      GROUP BY c.id
      ORDER BY c.class_name
    `).bind(user.id).all()
    
    return c.json({
      success: true,
      user,
      classes: classes.results || []
    })
  } catch (error: any) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// Î∞ò ÏÜåÏú†Í∂å Ïù¥Ï†Ñ API
app.post('/api/admin/transfer-classes', async (c) => {
  try {
    const { DB } = c.env
    const { fromEmail, toEmail, classIds } = await c.req.json()
    
    if (!fromEmail || !toEmail || !classIds || !Array.isArray(classIds)) {
      return c.json({ 
        success: false, 
        error: 'fromEmail, toEmail, and classIds array required' 
      }, 400)
    }
    
    // Îëê ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
    const fromUser = await DB.prepare('SELECT id, email, name FROM users WHERE email = ?')
      .bind(fromEmail).first()
    const toUser = await DB.prepare('SELECT id, email, name FROM users WHERE email = ?')
      .bind(toEmail).first()
    
    if (!fromUser || !toUser) {
      return c.json({ 
        success: false, 
        error: !fromUser ? 'From user not found' : 'To user not found' 
      }, 404)
    }
    
    // Í∞Å Î∞òÏùò ÏÜåÏú†Í∂å Ïù¥Ï†Ñ
    const transferred = []
    for (const classId of classIds) {
      // Î∞òÏù¥ fromUser ÏÜåÏú†Ïù∏ÏßÄ ÌôïÏù∏ (academy_id ÏÇ¨Ïö©)
      const classInfo = await DB.prepare('SELECT * FROM classes WHERE id = ? AND academy_id = ?')
        .bind(classId, fromUser.id)
        .first()
      
      if (classInfo) {
        // ÏÜåÏú†Í∂å Ïù¥Ï†Ñ
        await DB.prepare('UPDATE classes SET academy_id = ? WHERE id = ?')
          .bind(toUser.id, classId)
          .run()
        
        // Ìï¥Îãπ Î∞òÏùò ÌïôÏÉùÎì§ÎèÑ Ïù¥Ï†Ñ (academy_id ÏÇ¨Ïö©)
        await DB.prepare('UPDATE students SET academy_id = ? WHERE class_id = ?')
          .bind(toUser.id, classId)
          .run()
        
        transferred.push({
          classId,
          className: classInfo.class_name,
          studentCount: classInfo.student_count || 0
        })
      }
    }
    
    return c.json({
      success: true,
      message: `${transferred.length}Í∞ú Î∞ò Ïù¥Ï†Ñ ÏôÑÎ£å`,
      transferred,
      from: { id: fromUser.id, email: fromUser.email, name: fromUser.name },
      to: { id: toUser.id, email: toUser.email, name: toUser.name }
    })
  } catch (error: any) {
    return c.json({ success: false, error: error.message }, 500)
  }
})

// ========================================
// Form Builder Pages
// ========================================

// Ìèº ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ (Ìèº ÎπåÎçî)
app.get('/tools/form-builder', async (c) => {
  return c.html(`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ìèº ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨ - SUPERPLACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-sm mb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900">Ìèº ÎπåÎçî</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/tools/form-submissions" class="text-gray-600 hover:text-gray-900">Ïã†Ï≤≠ ÎÇ¥Ïó≠</a>
                    <a href="/dashboard" class="text-gray-600 hover:text-gray-900">ÎåÄÏãúÎ≥¥Îìú</a>
                </div>
            </div>
        </div>
    </nav>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">ÎÇ¥ Ìèº ÌÖúÌîåÎ¶ø</h2>
                <p class="text-gray-600 mt-1">ÎûúÎî©ÌéòÏù¥ÏßÄÏóê ÏÇ¨Ïö©Ìï† Ïª§Ïä§ÌÖÄ ÌèºÏùÑ ÏÉùÏÑ±ÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
            </div>
            <button onclick="openCreateModal()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ ÏÉà ÌÖúÌîåÎ¶ø ÎßåÎì§Í∏∞</button>
        </div>
        <div id="templatesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-12"><p class="text-gray-500">Î°úÎî© Ï§ë...</p></div>
        </div>
    </div>
    <div id="templateModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b sticky top-0 bg-white z-10"><h3 class="text-xl font-bold">ÏÉà Ìèº ÌÖúÌîåÎ¶ø ÎßåÎì§Í∏∞</h3></div>
                <form id="templateForm" class="p-6 space-y-6">
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ *</label>
                        <input type="text" id="templateName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ïòà: ÌïôÏõê ÏÑ§Î™ÖÌöå Ïã†Ï≤≠ÏÑú"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">ÏÑ§Î™Ö</label>
                        <textarea id="templateDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea></div>
                    <div><div class="flex justify-between items-center mb-3"><h4 class="text-lg font-semibold">Ìèº ÌïÑÎìú</h4>
                            <button type="button" onclick="addField()" class="text-blue-600 text-sm">+ ÌïÑÎìú Ï∂îÍ∞Ä</button></div>
                        <div id="fieldsList" class="space-y-3"></div></div>
                    <div class="flex justify-end space-x-3 pt-6 border-t">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-700">Ï∑®ÏÜå</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">Ï†ÄÏû•ÌïòÍ∏∞</button></div>
                </form>
            </div>
        </div>
    </div>
    <script>
        let currentFields=[{type:'text',name:'name',label:'Ïù¥Î¶Ñ',required:true,placeholder:'Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî'},{type:'tel',name:'phone',label:'Ï†ÑÌôîÎ≤àÌò∏',required:true,placeholder:'010-1234-5678'}];
        document.addEventListener('DOMContentLoaded',function(){loadTemplates()});
        async function loadTemplates(){try{const response=await fetch('/api/form-templates',{credentials:'include'});if(!response.ok){if(response.status===401){window.location.href='/login';return}throw new Error('ÌÖúÌîåÎ¶øÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§')}const templates=await response.json();displayTemplates(templates)}catch(error){console.error('Error:',error);alert('ÌÖúÌîåÎ¶øÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        function displayTemplates(templates){const container=document.getElementById('templatesList');if(templates.length===0){container.innerHTML='<div class="col-span-full text-center py-12"><p class="text-gray-500">ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§</p></div>';return}container.innerHTML=templates.map(t=>{const fields=JSON.parse(t.fields);return\`<div class="bg-white rounded-lg shadow-sm border p-6"><h3 class="text-lg font-semibold mb-2">\${t.name}</h3><p class="text-sm text-gray-600 mb-4">\${fields.length}Í∞ú ÌïÑÎìú</p><div class="flex space-x-2"><button onclick="copyHTML(\${t.id})" class="flex-1 px-4 py-2 text-sm text-green-600 bg-green-50 rounded-lg">HTML Î≥µÏÇ¨</button><button onclick="deleteTemplate(\${t.id})" class="px-4 py-2 text-sm text-red-600 bg-red-50 rounded-lg">ÏÇ≠Ï†ú</button></div></div>\`}).join('')}
        function openCreateModal(){renderFields();document.getElementById('templateModal').classList.remove('hidden')}
        function closeModal(){document.getElementById('templateModal').classList.add('hidden');document.getElementById('templateForm').reset()}
        function addField(){currentFields.push({type:'text',name:'field_'+Date.now(),label:'ÏÉà ÌïÑÎìú',required:false,placeholder:''});renderFields()}
        function renderFields(){const container=document.getElementById('fieldsList');container.innerHTML=currentFields.map((f,i)=>\`<div class="border p-3 rounded"><div class="grid grid-cols-2 gap-2 mb-2"><input type="text" value="\${f.label}" onchange="currentFields[\${i}].label=this.value" class="px-2 py-1 text-sm border rounded" placeholder="Î†àÏù¥Î∏î"><input type="text" value="\${f.name}" onchange="currentFields[\${i}].name=this.value" class="px-2 py-1 text-sm border rounded" placeholder="ÌïÑÎìúÎ™Ö"></div><div class="flex items-center justify-between"><select onchange="currentFields[\${i}].type=this.value" class="px-2 py-1 text-sm border rounded"><option value="text" \${f.type==='text'?'selected':''}>ÌÖçÏä§Ìä∏</option><option value="email" \${f.type==='email'?'selected':''}>Ïù¥Î©îÏùº</option><option value="tel" \${f.type==='tel'?'selected':''}>Ï†ÑÌôîÎ≤àÌò∏</option><option value="textarea" \${f.type==='textarea'?'selected':''}>Í∏¥ ÌÖçÏä§Ìä∏</option></select><label class="text-sm"><input type="checkbox" \${f.required?'checked':''} onchange="currentFields[\${i}].required=this.checked"> ÌïÑÏàò</label><button type="button" onclick="currentFields.splice(\${i},1);renderFields()" class="text-red-600 text-sm">ÏÇ≠Ï†ú</button></div></div>\`).join('')}
        document.getElementById('templateForm').addEventListener('submit',async function(e){e.preventDefault();try{const response=await fetch('/api/form-templates',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({name:document.getElementById('templateName').value,description:document.getElementById('templateDescription').value,fields:JSON.stringify(currentFields),submit_button_text:'Ïã†Ï≤≠ÌïòÍ∏∞',success_message:'Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!'})});if(!response.ok)throw new Error('Ï†ÄÏû• Ïã§Ìå®');alert('ÌÖúÌîåÎ¶øÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');closeModal();loadTemplates()}catch(error){alert('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}});
        async function copyHTML(id){try{const response=await fetch(\`/api/form-templates/\${id}/html\`,{credentials:'include'});if(!response.ok)throw new Error('HTML ÏÉùÏÑ± Ïã§Ìå®');const data=await response.json();await navigator.clipboard.writeText(data.html);alert('HTMLÏù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!')}catch(error){alert('HTML Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        async function deleteTemplate(id){if(!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'))return;try{const response=await fetch(\`/api/form-templates/\${id}\`,{method:'DELETE',credentials:'include'});if(!response.ok)throw new Error('ÏÇ≠Ï†ú Ïã§Ìå®');alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');loadTemplates()}catch(error){alert('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
    </script>
</body>
</html>`)
})

// Ìèº Ï†úÏ∂ú ÎÇ¥Ïó≠ ÌéòÏù¥ÏßÄ
app.get('/tools/form-submissions', async (c) => {
  return c.html(`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ìèº Ïã†Ï≤≠ ÎÇ¥Ïó≠ - SUPERPLACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-sm mb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900">Ìèº Ïã†Ï≤≠ ÎÇ¥Ïó≠</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/tools/form-builder" class="text-gray-600 hover:text-gray-900">Ìèº ÎπåÎçî</a>
                    <a href="/dashboard" class="text-gray-600 hover:text-gray-900">ÎåÄÏãúÎ≥¥Îìú</a>
                </div>
            </div>
        </div>
    </nav>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Ïã†Ï≤≠ ÎÇ¥Ïó≠ Í¥ÄÎ¶¨</h2>
            <div id="statsSection" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div class="bg-blue-50 p-4 rounded-lg"><div class="text-sm text-blue-600 font-medium">Ï†ÑÏ≤¥ Ïã†Ï≤≠</div><div id="totalCount" class="text-2xl font-bold text-blue-900 mt-1">0</div></div>
                <div class="bg-yellow-50 p-4 rounded-lg"><div class="text-sm text-yellow-600 font-medium">ÏÉà Ïã†Ï≤≠</div><div id="newCount" class="text-2xl font-bold text-yellow-900 mt-1">0</div></div>
                <div class="bg-green-50 p-4 rounded-lg"><div class="text-sm text-green-600 font-medium">Ïó∞ÎùΩ ÏôÑÎ£å</div><div id="contactedCount" class="text-2xl font-bold text-green-900 mt-1">0</div></div>
                <div class="bg-purple-50 p-4 rounded-lg"><div class="text-sm text-purple-600 font-medium">Ï≤òÎ¶¨ ÏôÑÎ£å</div><div id="completedCount" class="text-2xl font-bold text-purple-900 mt-1">0</div></div>
            </div>
            <div class="flex space-x-3">
                <select id="statusFilter" onchange="loadSubmissions()" class="px-4 py-2 border rounded-lg">
                    <option value="">Ï†ÑÏ≤¥ ÏÉÅÌÉú</option><option value="new">ÏÉà Ïã†Ï≤≠</option><option value="contacted">Ïó∞ÎùΩ ÏôÑÎ£å</option><option value="completed">Ï≤òÎ¶¨ ÏôÑÎ£å</option><option value="rejected">Í±∞Ï†à</option>
                </select>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ïã†Ï≤≠ÏùºÏãú</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÌÖúÌîåÎ¶ø</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ïã†Ï≤≠Ïûê</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÏÉÅÌÉú</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÏûëÏóÖ</th>
                    </tr>
                </thead>
                <tbody id="submissionsList" class="bg-white divide-y divide-gray-200">
                    <tr><td colspan="5" class="px-6 py-12 text-center text-gray-500">Î°úÎî© Ï§ë...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="p-6 border-b"><h3 class="text-xl font-bold">Ïã†Ï≤≠ ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h3></div>
                <div id="detailContent" class="p-6"></div>
                <div class="p-6 border-t">
                    <div class="space-y-4">
                        <div><label class="block text-sm font-medium mb-2">ÏÉÅÌÉú Î≥ÄÍ≤Ω</label>
                            <select id="statusUpdate" class="w-full px-3 py-2 border rounded-lg">
                                <option value="new">ÏÉà Ïã†Ï≤≠</option><option value="contacted">Ïó∞ÎùΩ ÏôÑÎ£å</option><option value="completed">Ï≤òÎ¶¨ ÏôÑÎ£å</option><option value="rejected">Í±∞Ï†à</option>
                            </select></div>
                        <div><label class="block text-sm font-medium mb-2">Î©îÎ™®</label>
                            <textarea id="notesUpdate" rows="3" class="w-full px-3 py-2 border rounded-lg"></textarea></div>
                        <div class="flex justify-between">
                            <button onclick="deleteSubmission()" class="px-4 py-2 text-red-600">ÏÇ≠Ï†ú</button>
                            <div class="space-x-3">
                                <button onclick="closeDetailModal()" class="px-4 py-2">Ï∑®ÏÜå</button>
                                <button onclick="updateSubmission()" class="px-6 py-2 bg-blue-600 text-white rounded-lg">Ï†ÄÏû•</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentSubmissionId=null;
        document.addEventListener('DOMContentLoaded',function(){loadStats();loadSubmissions()});
        async function loadStats(){try{const response=await fetch('/api/form-submissions/stats',{credentials:'include'});if(!response.ok)throw new Error('ÌÜµÍ≥Ñ Î°úÎìú Ïã§Ìå®');const stats=await response.json();document.getElementById('totalCount').textContent=stats.total||0;document.getElementById('newCount').textContent=stats.new_count||0;document.getElementById('contactedCount').textContent=stats.contacted_count||0;document.getElementById('completedCount').textContent=stats.completed_count||0}catch(error){console.error('Error loading stats:',error)}}
        async function loadSubmissions(){try{const status=document.getElementById('statusFilter').value;const url=status?'/api/form-submissions?status='+status:'/api/form-submissions';const response=await fetch(url,{credentials:'include'});if(!response.ok){if(response.status===401){window.location.href='/login';return}throw new Error('Ïã†Ï≤≠ ÎÇ¥Ïó≠ Î°úÎìú Ïã§Ìå®')}const submissions=await response.json();displaySubmissions(submissions)}catch(error){console.error('Error:',error);alert('Ïã†Ï≤≠ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        function displaySubmissions(submissions){const container=document.getElementById('submissionsList');if(submissions.length===0){container.innerHTML='<tr><td colspan="5" class="px-6 py-12 text-center text-gray-500">Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</td></tr>';return}container.innerHTML=submissions.map(function(s){const data=JSON.parse(s.submission_data);const name=data.name||'Ïù¥Î¶Ñ ÏóÜÏùå';const phone=data.phone||data.email||'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå';let statusBadge='';if(s.status==='new')statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">ÏÉà Ïã†Ï≤≠</span>';else if(s.status==='contacted')statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Ïó∞ÎùΩ ÏôÑÎ£å</span>';else if(s.status==='completed')statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">Ï≤òÎ¶¨ ÏôÑÎ£å</span>';else if(s.status==='rejected')statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Í±∞Ï†à</span>';return'<tr class="hover:bg-gray-50"><td class="px-6 py-4 text-sm">'+new Date(s.submitted_at).toLocaleString('ko-KR')+'</td><td class="px-6 py-4 text-sm font-medium">'+s.template_name+'</td><td class="px-6 py-4 text-sm"><div class="font-medium">'+name+'</div><div class="text-gray-500">'+phone+'</div></td><td class="px-6 py-4">'+statusBadge+'</td><td class="px-6 py-4 text-right"><button onclick="viewSubmission('+s.id+')" class="text-blue-600 text-sm">ÏÉÅÏÑ∏Î≥¥Í∏∞</button></td></tr>'}).join('')}
        async function viewSubmission(id){try{const response=await fetch('/api/form-submissions/'+id,{credentials:'include'});if(!response.ok)throw new Error('Ï°∞Ìöå Ïã§Ìå®');const submission=await response.json();displaySubmissionDetail(submission);currentSubmissionId=id;document.getElementById('detailModal').classList.remove('hidden')}catch(error){alert('Ï°∞ÌöåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        function displaySubmissionDetail(s){const data=JSON.parse(s.submission_data);let html='<div class="space-y-3">';for(const key in data){html+='<div><div class="text-sm text-gray-500">'+key+'</div><div class="font-medium">'+data[key]+'</div></div>'}html+='</div>';document.getElementById('detailContent').innerHTML=html;document.getElementById('statusUpdate').value=s.status;document.getElementById('notesUpdate').value=s.notes||''}
        async function updateSubmission(){if(!currentSubmissionId)return;try{const response=await fetch('/api/form-submissions/'+currentSubmissionId,{method:'PATCH',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({status:document.getElementById('statusUpdate').value,notes:document.getElementById('notesUpdate').value})});if(!response.ok)throw new Error('ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®');alert('ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§');closeDetailModal();loadStats();loadSubmissions()}catch(error){alert('ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        async function deleteSubmission(){if(!currentSubmissionId||!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'))return;try{const response=await fetch('/api/form-submissions/'+currentSubmissionId,{method:'DELETE',credentials:'include'});if(!response.ok)throw new Error('ÏÇ≠Ï†ú Ïã§Ìå®');alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');closeDetailModal();loadStats();loadSubmissions()}catch(error){alert('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§')}}
        function closeDetailModal(){document.getElementById('detailModal').classList.add('hidden');currentSubmissionId=null}
    </script>
</body>
</html>`)
})

// Test route to verify deployment
app.get('/test-deployment', async (c) => {
  return c.text('Deployment successful! Timestamp: ' + Date.now())
})

// üîç ÎîîÎ≤ÑÍ∑∏: ÏÇ¨Ïö©Ïûê Íµ¨ÎèÖ Ï†ïÎ≥¥ ÏÉÅÏÑ∏ Ï°∞Ìöå
// üî• ÌïôÏÉù Î™©Î°ù ÌôïÏù∏ API (ÎîîÎ≤ÑÍπÖÏö©)
app.get('/api/debug/students/:academyId', async (c) => {
  try {
    const academyId = c.req.param('academyId')
    
    // students ÌÖåÏù¥Î∏îÏóêÏÑú Ïã§Ï†ú ÌïôÏÉù Î™©Î°ù Ï°∞Ìöå
    const students = await c.env.DB.prepare(`
      SELECT id, name, parent_phone, academy_id, created_at 
      FROM students 
      WHERE academy_id = ?
      ORDER BY created_at DESC
      LIMIT 100
    `).bind(academyId).all()
    
    // Ï¥ù ÌïôÏÉù Ïàò
    const count = await c.env.DB.prepare(`
      SELECT COUNT(*) as count FROM students WHERE academy_id = ?
    `).bind(academyId).first()
    
    return c.json({
      academyId: academyId,
      totalCount: count?.count || 0,
      students: students.results || [],
      message: `Academy ${academyId}Ïùò Ïã§Ï†ú students ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞`
    })
  } catch (error) {
    return c.json({ error: error.message, stack: error.stack }, 500)
  }
})

app.get('/api/debug/user/:userId/subscription', async (c) => {
  try {
    const userId = c.req.param('userId')
    
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
    const user = await c.env.DB.prepare(`
      SELECT id, email, name, academy_id, academy_name FROM users WHERE id = ?
    `).bind(userId).first()
    
    if (!user) {
      return c.json({ error: 'User not found' }, 404)
    }
    
    // Î™®Îì† Íµ¨ÎèÖ Ï°∞Ìöå (academy_id Í∏∞Ï§Ä)
    const subscriptionsByAcademy = await c.env.DB.prepare(`
      SELECT * FROM subscriptions WHERE academy_id = ? ORDER BY created_at DESC
    `).bind(user.academy_id || user.id).all()
    
    // ÌôúÏÑ± Íµ¨ÎèÖÎßå
    const activeSubscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND status = 'active'
      ORDER BY created_at DESC LIMIT 1
    `).bind(user.academy_id || user.id).first()
    
    // Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú
    const adminSubscription = await c.env.DB.prepare(`
      SELECT * FROM subscriptions 
      WHERE academy_id = ? AND plan_name = 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú'
      ORDER BY created_at DESC LIMIT 1
    `).bind(user.academy_id || user.id).first()
    
    // usage_tracking Ï†ïÎ≥¥
    const usageTracking = await c.env.DB.prepare(`
      SELECT * FROM usage_tracking WHERE academy_id = ? ORDER BY updated_at DESC LIMIT 1
    `).bind(user.academy_id || user.id).first()
    
    // üî• Ïã§Ï†ú ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå
    let actualData = {}
    try {
      // students ÌÖåÏù¥Î∏î ÌôïÏù∏
      let studentsCount = 0
      try {
        const students = await c.env.DB.prepare(`
          SELECT COUNT(*) as count FROM students WHERE academy_id = ?
        `).bind(user.academy_id || user.id).first()
        studentsCount = students?.count || 0
      } catch (e) {
        studentsCount = 'table_not_found'
      }
      
      // landing_pages ÌÖåÏù¥Î∏î ÌôïÏù∏
      let landingPagesCount = 0
      try {
        const landingPages = await c.env.DB.prepare(`
          SELECT COUNT(*) as count FROM landing_pages WHERE user_id = ?
        `).bind(userId).first()
        landingPagesCount = landingPages?.count || 0
      } catch (e) {
        landingPagesCount = 'table_not_found'
      }
      
      // teacher_applications ÌÖåÏù¥Î∏î ÌôïÏù∏ (teachers ÎåÄÏã†)
      let teachersCount = 0
      try {
        const teachers = await c.env.DB.prepare(`
          SELECT COUNT(*) as count FROM teacher_applications WHERE academy_id = ?
        `).bind(user.academy_id || user.id).first()
        teachersCount = teachers?.count || 0
      } catch (e) {
        teachersCount = 'table_not_found'
      }
      
      actualData = {
        students: studentsCount,
        landingPages: landingPagesCount,
        teachers: teachersCount
      }
    } catch (err) {
      actualData = { error: err.message }
    }
    
    return c.json({
      user: user,
      subscriptions: {
        all: subscriptionsByAcademy.results,
        active: activeSubscription,
        admin: adminSubscription
      },
      usageTracking: usageTracking,
      actualData: actualData,
      debug: {
        academyIdUsedForQuery: user.academy_id || user.id,
        totalSubscriptions: subscriptionsByAcademy.results.length
      }
    })
  } catch (error) {
    return c.json({ error: error.message }, 500)
  }
})

// üî• Í∏¥Í∏â Î≥µÍµ¨ API: User 7Ïùò Íµ¨ÎèÖ Ïû¨ÏÉùÏÑ±
app.post('/api/emergency/restore-subscription/:userId', async (c) => {
  try {
    const userId = parseInt(c.req.param('userId'))
    const { studentLimit, aiReportLimit, landingPageLimit, teacherLimit, months } = await c.req.json()
    
    console.log('[Emergency Restore] Restoring subscription for user:', userId)
    
    // ÏÇ¨Ïö©Ïûê ÌôïÏù∏
    const user = await c.env.DB.prepare(`
      SELECT id, academy_id FROM users WHERE id = ?
    `).bind(userId).first()
    
    if (!user) {
      return c.json({ success: false, error: 'User not found' }, 404)
    }
    
    const academyId = user.id
    
    // Íµ¨ÎèÖ Í∏∞Í∞Ñ Í≥ÑÏÇ∞
    const today = new Date().toISOString().split('T')[0]
    const endDate = new Date()
    endDate.setMonth(endDate.getMonth() + months)
    const subscriptionEndDate = endDate.toISOString().split('T')[0]
    
    console.log('[Emergency Restore] Creating subscription:', {
      academyId,
      studentLimit,
      aiReportLimit,
      landingPageLimit,
      teacherLimit,
      startDate: today,
      endDate: subscriptionEndDate
    })
    
    // Í∏∞Ï°¥ Íµ¨ÎèÖ Î™®Îëê ÎßåÎ£å Ï≤òÎ¶¨
    try {
      await c.env.DB.prepare(`
        UPDATE subscriptions 
        SET status = 'expired', updated_at = CURRENT_TIMESTAMP
        WHERE academy_id = ?
      `).bind(academyId).run()
    } catch (updateError) {
      console.warn('[Emergency Restore] No existing subscriptions to expire:', updateError.message)
    }
    
    // Ïô∏ÎûòÌÇ§ Ï≤¥ÌÅ¨ ÎπÑÌôúÏÑ±Ìôî
    await c.env.DB.prepare(`PRAGMA foreign_keys = OFF`).run()
    
    // ÏÉà Íµ¨ÎèÖ ÏÉùÏÑ±
    const result = await c.env.DB.prepare(`
      INSERT INTO subscriptions (
        academy_id, plan_name, plan_price,
        student_limit, ai_report_limit, landing_page_limit, teacher_limit,
        subscription_start_date, subscription_end_date, status, payment_method,
        merchant_uid, created_at, updated_at
      )
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))
    `).bind(
      academyId, 'Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï ÌîåÎûú', 0,
      studentLimit, aiReportLimit, landingPageLimit, teacherLimit,
      today, subscriptionEndDate, 'active', 'admin',
      'admin_' + userId + '_' + Date.now()
    ).run()
    
    // Ïô∏ÎûòÌÇ§ Ï≤¥ÌÅ¨ Ïû¨ÌôúÏÑ±Ìôî
    await c.env.DB.prepare(`PRAGMA foreign_keys = ON`).run()
    
    const subscriptionId = result.meta.last_row_id
    
    // usage_tracking ÏÉùÏÑ± (Ïã§Ìå®Ìï¥ÎèÑ Í≥ÑÏÜç ÏßÑÌñâ)
    try {
      await c.env.DB.prepare(`
        INSERT INTO usage_tracking (
          academy_id, subscription_id,
          current_students, ai_reports_used_this_month,
          landing_pages_created, current_teachers,
          created_at, updated_at
        )
        VALUES (?, ?, 0, 0, 0, 0, datetime('now'), datetime('now'))
      `).bind(academyId, subscriptionId).run()
      console.log('[Emergency Restore] usage_tracking created')
    } catch (usageError) {
      console.warn('[Emergency Restore] Failed to create usage_tracking:', usageError.message)
      // Continue anyway - subscription is created
    }
    
    console.log('[Emergency Restore] Subscription restored successfully')
    
    return c.json({
      success: true,
      message: 'Íµ¨ÎèÖÏù¥ Î≥µÍµ¨ÎêòÏóàÏäµÎãàÎã§',
      subscription: {
        id: subscriptionId,
        academy_id: academyId,
        start_date: today,
        end_date: subscriptionEndDate,
        limits: {
          students: studentLimit,
          ai_reports: aiReportLimit,
          landing_pages: landingPageLimit,
          teachers: teacherLimit
        }
      }
    })
  } catch (error) {
    console.error('[Emergency Restore] Error:', error)
    return c.json({ success: false, error: error.message }, 500)
  }
})

export default app
// Force rebuild: Sun Jan 18 18:13:00 UTC 2026
// Cache buster: 1768863600
// Force deploy: Mon Jan 20 00:00:00 UTC 2026
// UI update: Single column layout for usage cards
// Force deploy Mon Jan 19 02:13:47 UTC 2026
