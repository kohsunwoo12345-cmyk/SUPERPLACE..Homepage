<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ìŠˆí¼í”Œë ˆì´ìŠ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css');
      * { font-family: 'Pretendard Variable', Pretendard, sans-serif; }
      .gradient-purple { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="fixed w-full top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <span class="text-xl font-bold text-purple-600">ğŸ” ê´€ë¦¬ì</span>
                    <div class="flex space-x-4">
                        <a href="/admin/dashboard.html" class="text-purple-600 font-medium">ëŒ€ì‹œë³´ë“œ</a>
                        <a href="/admin/users.html" class="text-gray-600 hover:text-purple-600">ì‚¬ìš©ì</a>
                        <a href="/admin/programs.html" class="text-gray-600 hover:text-purple-600">í”„ë¡œê·¸ë¨</a>
                        <a href="/admin/contacts.html" class="text-gray-600 hover:text-purple-600">ë¬¸ì˜</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="adminName" class="text-gray-700"></span>
                    <a href="/" class="text-gray-600 hover:text-purple-600">ì‚¬ì´íŠ¸ ë³´ê¸°</a>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-24 pb-12 px-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                <p class="text-gray-600">ì „ì²´ ì‹œìŠ¤í…œ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
            </div>

            <!-- Stats Grid -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-600">ì „ì²´ íšŒì›ìˆ˜</div>
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="totalUsers">-</div>
                    <div class="text-sm text-green-600 mt-2">í™œì„± íšŒì›</div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-600">ì‹ ê·œ ë¬¸ì˜</div>
                        <svg class="w-8 h-8 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="totalContacts">-</div>
                    <div class="text-sm text-orange-600 mt-2" id="pendingContacts">ëŒ€ê¸°ì¤‘: -</div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-600">í™œì„± í”„ë¡œê·¸ë¨</div>
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="totalPrograms">-</div>
                    <div class="text-sm text-blue-600 mt-2">ìš´ì˜ì¤‘</div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-600">ìˆ˜ê°• í˜„í™©</div>
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="totalEnrollments">-</div>
                    <div class="text-sm text-green-600 mt-2">ì§„í–‰ì¤‘</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">ì›”ë³„ íšŒì› ì¦ê°€ ì¶”ì´</h3>
                    <canvas id="userChart"></canvas>
                </div>

                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">í”„ë¡œê·¸ë¨ë³„ ìˆ˜ê°• í˜„í™©</h3>
                    <canvas id="programChart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">ìµœê·¼ ê°€ì… íšŒì›</h3>
                    <div id="recentUsers" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”©ì¤‘...</div>
                    </div>
                    <a href="/admin/users.html" class="block text-center text-purple-600 font-medium mt-4 hover:underline">
                        ì „ì²´ íšŒì› ë³´ê¸° â†’
                    </a>
                </div>

                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">ìµœê·¼ ë¬¸ì˜</h3>
                    <div id="recentContacts" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">ë°ì´í„° ë¡œë”©ì¤‘...</div>
                    </div>
                    <a href="/admin/contacts.html" class="block text-center text-purple-600 font-medium mt-4 hover:underline">
                        ì „ì²´ ë¬¸ì˜ ë³´ê¸° â†’
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ì¸ì¦ ì²´í¬
    const user = JSON.parse(localStorage.getItem('user') || 'null')
    if (!user || user.role !== 'admin') {
        alert('ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.')
        window.location.href = '/login'
    } else {
        document.getElementById('adminName').textContent = user.name
    }

    function logout() {
        localStorage.removeItem('user')
        window.location.href = '/'
    }

    // ë°ì´í„° ë¡œë“œ
    async function loadDashboardData() {
        try {
            // ì‚¬ìš©ì ëª©ë¡
            const usersRes = await fetch('/api/admin/users')
            const usersData = await usersRes.json()
            if (usersData.success) {
                document.getElementById('totalUsers').textContent = usersData.users.length
                renderRecentUsers(usersData.users.slice(0, 5))
            }

            // ë¬¸ì˜ ëª©ë¡
            const contactsRes = await fetch('/api/contacts')
            const contactsData = await contactsRes.json()
            if (contactsData.success) {
                document.getElementById('totalContacts').textContent = contactsData.contacts.length
                const pending = contactsData.contacts.filter(c => c.status === 'pending').length
                document.getElementById('pendingContacts').textContent = `ëŒ€ê¸°ì¤‘: ${pending}ê±´`
                renderRecentContacts(contactsData.contacts.slice(0, 5))
            }

            // í”„ë¡œê·¸ë¨ ëª©ë¡
            const programsRes = await fetch('/api/admin/programs')
            const programsData = await programsRes.json()
            if (programsData.success) {
                document.getElementById('totalPrograms').textContent = programsData.programs.length
            }

            // ìˆ˜ê°• í˜„í™©
            const enrollmentsRes = await fetch('/api/admin/enrollments')
            const enrollmentsData = await enrollmentsRes.json()
            if (enrollmentsData.success) {
                document.getElementById('totalEnrollments').textContent = enrollmentsData.enrollments.length
            }
        } catch (error) {
            console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error)
        }
    }

    function renderRecentUsers(users) {
        const html = users.map(u => `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                        ${u.name.charAt(0)}
                    </div>
                    <div>
                        <div class="font-medium text-gray-900">${u.name}</div>
                        <div class="text-sm text-gray-500">${u.email}</div>
                    </div>
                </div>
                <span class="text-xs text-gray-500">${new Date(u.created_at).toLocaleDateString()}</span>
            </div>
        `).join('')
        document.getElementById('recentUsers').innerHTML = html
    }

    function renderRecentContacts(contacts) {
        const html = contacts.map(c => `
            <div class="p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-medium text-gray-900">${c.name}</span>
                    <span class="px-2 py-1 text-xs rounded-full ${
                        c.status === 'pending' ? 'bg-orange-100 text-orange-700' :
                        c.status === 'completed' ? 'bg-green-100 text-green-700' :
                        'bg-gray-100 text-gray-700'
                    }">${c.status}</span>
                </div>
                <div class="text-sm text-gray-600 truncate">${c.message}</div>
                <div class="text-xs text-gray-500 mt-1">${new Date(c.created_at).toLocaleString()}</div>
            </div>
        `).join('')
        document.getElementById('recentContacts').innerHTML = html
    }

    // ì°¨íŠ¸ ìƒì„±
    function createCharts() {
        // ì‚¬ìš©ì ì¦ê°€ ì¶”ì´
        const userCtx = document.getElementById('userChart').getContext('2d')
        new Chart(userCtx, {
            type: 'line',
            data: {
                labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”'],
                datasets: [{
                    label: 'ì‹ ê·œ íšŒì›',
                    data: [12, 19, 25, 32, 45, 58],
                    borderColor: 'rgb(124, 58, 237)',
                    backgroundColor: 'rgba(124, 58, 237, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        })

        // í”„ë¡œê·¸ë¨ë³„ ìˆ˜ê°• í˜„í™©
        const programCtx = document.getElementById('programChart').getContext('2d')
        new Chart(programCtx, {
            type: 'doughnut',
            data: {
                labels: ['ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤', 'ë¸”ë¡œê·¸ SEO', 'í¼ë„ ë§ˆì¼€íŒ…', 'í•™ë¶€ëª¨ ì†Œí†µ', 'ì¢…í•© íŒ¨í‚¤ì§€'],
                datasets: [{
                    data: [15, 20, 12, 8, 10],
                    backgroundColor: [
                        'rgb(124, 58, 237)',
                        'rgb(251, 146, 60)',
                        'rgb(59, 130, 246)',
                        'rgb(34, 197, 94)',
                        'rgb(168, 85, 247)'
                    ]
                }]
            },
            options: { responsive: true }
        })
    }

    // ì´ˆê¸°í™”
    loadDashboardData()
    createCharts()
    </script>
</body>
</html>
