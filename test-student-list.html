<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒ ëª©ë¡ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª í•™ìƒ ëª©ë¡ API í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section info">
        <h2>ğŸ“‹ í…ŒìŠ¤íŠ¸ ì •ë³´</h2>
        <p><strong>í…ŒìŠ¤íŠ¸ URL:</strong> https://superplace-academy.pages.dev</p>
        <p><strong>í•™ìƒ ê´€ë¦¬ í˜ì´ì§€:</strong> <a href="https://superplace-academy.pages.dev/students/list" target="_blank">í•™ìƒ ëª©ë¡</a></p>
        <p><strong>í•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€:</strong> <a href="https://superplace-academy.pages.dev/tools/parent-message" target="_blank">í•™ë¶€ëª¨ ì†Œí†µ</a></p>
    </div>

    <div class="test-section">
        <h2>1ï¸âƒ£ í•™ìƒ API í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testStudentAPI()">í•™ìƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="student-result"></div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ localStorage í™•ì¸</h2>
        <button onclick="checkLocalStorage()">ì‚¬ìš©ì ì •ë³´ í™•ì¸</button>
        <button onclick="setTestUser()">í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì„¤ì •</button>
        <button onclick="clearUser()">ì‚¬ìš©ì ì •ë³´ ì‚­ì œ</button>
        <div id="localstorage-result"></div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ í•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="openParentMessagePage()">í˜ì´ì§€ ì—´ê¸°</button>
        <div id="page-result">
            <p>ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìƒˆ íƒ­ì—ì„œ í•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€ê°€ ì—´ë¦½ë‹ˆë‹¤.</p>
            <p>ê°œë°œì ë„êµ¬(F12)ë¥¼ ì—´ê³  Console íƒ­ì—ì„œ ì—ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>
    </div>

    <div class="test-section">
        <h2>4ï¸âƒ£ ë°°í¬ ë²„ì „ í™•ì¸</h2>
        <button onclick="checkDeployVersion()">ìµœì‹  ë°°í¬ í™•ì¸</button>
        <div id="version-result"></div>
    </div>

    <script>
        // 1. í•™ìƒ API í…ŒìŠ¤íŠ¸
        async function testStudentAPI() {
            const resultDiv = document.getElementById('student-result');
            resultDiv.innerHTML = '<p>â³ ë¡œë”© ì¤‘...</p>';
            
            try {
                const response = await fetch('https://superplace-academy.pages.dev/api/students?academyId=1');
                const data = await response.json();
                
                if (data.success && data.students) {
                    resultDiv.className = 'success';
                    resultDiv.innerHTML = `
                        <h3>âœ… ì„±ê³µ! í•™ìƒ ${data.students.length}ëª… ì¡°íšŒ</h3>
                        <pre>${JSON.stringify(data.students, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = `<h3>âŒ ì‹¤íŒ¨</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (err) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<h3>âŒ ì—ëŸ¬ ë°œìƒ</h3><p>${err.message}</p>`;
            }
        }

        // 2. localStorage í™•ì¸
        function checkLocalStorage() {
            const resultDiv = document.getElementById('localstorage-result');
            const userData = localStorage.getItem('user');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    resultDiv.className = 'success';
                    resultDiv.innerHTML = `
                        <h3>âœ… ì‚¬ìš©ì ì •ë³´ ìˆìŒ</h3>
                        <pre>${JSON.stringify(user, null, 2)}</pre>
                    `;
                } catch (err) {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = `<h3>âŒ íŒŒì‹± ì—ëŸ¬</h3><p>${err.message}</p>`;
                }
            } else {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<h3>âš ï¸ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ</h3><p>localStorageì— 'user' í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
        }

        function setTestUser() {
            const testUser = {
                id: 1,
                name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                academy_id: 1,
                role: 'user'
            };
            localStorage.setItem('user', JSON.stringify(testUser));
            checkLocalStorage();
            alert('âœ… í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì„¤ì • ì™„ë£Œ!\ní•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
        }

        function clearUser() {
            localStorage.removeItem('user');
            checkLocalStorage();
            alert('ğŸ—‘ï¸ ì‚¬ìš©ì ì •ë³´ ì‚­ì œ ì™„ë£Œ!');
        }

        // 3. í•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€ ì—´ê¸°
        function openParentMessagePage() {
            window.open('https://superplace-academy.pages.dev/tools/parent-message', '_blank');
        }

        // 4. ë°°í¬ ë²„ì „ í™•ì¸
        async function checkDeployVersion() {
            const resultDiv = document.getElementById('version-result');
            resultDiv.innerHTML = '<p>â³ í™•ì¸ ì¤‘...</p>';
            
            try {
                const response = await fetch('https://superplace-academy.pages.dev/tools/parent-message');
                const html = await response.text();
                
                const hasDOMContentLoaded = html.includes('DOMContentLoaded');
                const hasKoreanTimezone = html.includes('í•œêµ­ ì‹œê°„ëŒ€');
                
                if (hasDOMContentLoaded && hasKoreanTimezone) {
                    resultDiv.className = 'success';
                    resultDiv.innerHTML = `
                        <h3>âœ… ìµœì‹  ë²„ì „ ë°°í¬ë¨!</h3>
                        <p>DOMContentLoaded: âœ…</p>
                        <p>í•œêµ­ ì‹œê°„ëŒ€ ì½”ë“œ: âœ…</p>
                    `;
                } else if (hasDOMContentLoaded) {
                    resultDiv.className = 'info';
                    resultDiv.innerHTML = `
                        <h3>âš ï¸ ë¶€ë¶„ ë°°í¬ë¨</h3>
                        <p>DOMContentLoaded: âœ…</p>
                        <p>í•œêµ­ ì‹œê°„ëŒ€ ì½”ë“œ: âŒ</p>
                        <p>ì¼ë¶€ ì½”ë“œë§Œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ë°°í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    `;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = `
                        <h3>âŒ ì´ì „ ë²„ì „</h3>
                        <p>DOMContentLoaded: âŒ</p>
                        <p>í•œêµ­ ì‹œê°„ëŒ€ ì½”ë“œ: âŒ</p>
                        <p><strong>Cloudflare Dashboardì—ì„œ ì¬ë°°í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤!</strong></p>
                        <p>MANUAL_DEPLOY_GUIDE.md ì°¸ê³ </p>
                    `;
                }
            } catch (err) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `<h3>âŒ í™•ì¸ ì‹¤íŒ¨</h3><p>${err.message}</p>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        });
    </script>

    <hr style="margin: 40px 0;">
    
    <div class="test-section info">
        <h2>ğŸ“– ë¬¸ì œ í•´ê²° ê°€ì´ë“œ</h2>
        <ol>
            <li><strong>í•™ìƒ API í…ŒìŠ¤íŠ¸</strong>ì—ì„œ í•™ìƒì´ ì¡°íšŒë˜ëŠ”ì§€ í™•ì¸</li>
            <li><strong>localStorage í™•ì¸</strong>ì—ì„œ ì‚¬ìš©ì ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸
                <ul>
                    <li>ì—†ìœ¼ë©´: "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì„¤ì •" ë²„íŠ¼ í´ë¦­</li>
                </ul>
            </li>
            <li><strong>ë°°í¬ ë²„ì „ í™•ì¸</strong>ì—ì„œ ìµœì‹  ë²„ì „ì¸ì§€ í™•ì¸
                <ul>
                    <li>ì´ì „ ë²„ì „ì´ë©´: Cloudflare Dashboardì—ì„œ ì¬ë°°í¬ í•„ìš”</li>
                    <li>ë°©ë²•: <code>MANUAL_DEPLOY_GUIDE.md</code> ì°¸ê³ </li>
                </ul>
            </li>
            <li><strong>í•™ë¶€ëª¨ ì†Œí†µ í˜ì´ì§€</strong> ì—´ê¸° â†’ F12 â†’ Console íƒ­ì—ì„œ ì—ëŸ¬ í™•ì¸</li>
        </ol>
    </div>
</body>
</html>
