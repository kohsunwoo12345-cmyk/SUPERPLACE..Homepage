<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë”©í˜ì´ì§€ í™•ì¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸ” ëœë”©í˜ì´ì§€ í™•ì¸</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">1ë‹¨ê³„: ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸</h2>
            <button onclick="checkAuth()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                ë¡œê·¸ì¸ í™•ì¸
            </button>
            <div id="authResult" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">2ë‹¨ê³„: ëœë”©í˜ì´ì§€ ëª©ë¡ í™•ì¸</h2>
            <button onclick="checkLandingPages()" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600">
                ëœë”©í˜ì´ì§€ í™•ì¸
            </button>
            <div id="landingResult" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">3ë‹¨ê³„: ì‚¬ìš©ëŸ‰ ë™ê¸°í™”</h2>
            <button onclick="syncUsage()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600">
                ë™ê¸°í™” ì‹¤í–‰
            </button>
            <div id="syncResult" class="mt-4"></div>
        </div>
    </div>

    <script>
        async function checkAuth() {
            const result = document.getElementById('authResult');
            result.innerHTML = 'í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch('/api/user/check', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `
                        <div class="bg-green-50 p-4 rounded">
                            <p class="text-green-800">âœ… ë¡œê·¸ì¸ë¨</p>
                            <p class="mt-2"><strong>Email:</strong> ${data.email}</p>
                            <p><strong>User ID:</strong> ${data.id}</p>
                            <p><strong>Academy ID:</strong> ${data.academy_id || 'null'}</p>
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="bg-red-50 p-4 rounded">
                            <p class="text-red-800">âŒ ë¡œê·¸ì¸ ì•ˆ ë¨</p>
                            <p class="mt-2">ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”: <a href="/login" class="text-blue-600 underline">ë¡œê·¸ì¸ í˜ì´ì§€</a></p>
                        </div>
                    `;
                }
            } catch (err) {
                result.innerHTML = `
                    <div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">âŒ ì˜¤ë¥˜: ${err.message}</p>
                    </div>
                `;
            }
        }

        async function checkLandingPages() {
            const result = document.getElementById('landingResult');
            result.innerHTML = 'í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch('/api/landing-pages', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    const pages = data.pages || [];
                    result.innerHTML = `
                        <div class="bg-blue-50 p-4 rounded">
                            <p class="text-blue-800 text-xl font-bold">ğŸ“Š ì´ ${pages.length}ê°œì˜ ëœë”©í˜ì´ì§€</p>
                            <div class="mt-4 space-y-2">
                                ${pages.length === 0 ? 
                                    '<p class="text-gray-600">ëœë”©í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' : 
                                    pages.map(p => `
                                        <div class="bg-white p-3 rounded border">
                                            <p><strong>ì œëª©:</strong> ${p.title}</p>
                                            <p><strong>ìƒì„±ì¼:</strong> ${p.created_at}</p>
                                            <p><strong>URL:</strong> <a href="/landing/${p.slug}" target="_blank" class="text-blue-600">/landing/${p.slug}</a></p>
                                        </div>
                                    `).join('')
                                }
                            </div>
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="bg-red-50 p-4 rounded">
                            <p class="text-red-800">âŒ ì¡°íšŒ ì‹¤íŒ¨: ${data.error}</p>
                        </div>
                    `;
                }
            } catch (err) {
                result.innerHTML = `
                    <div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">âŒ ì˜¤ë¥˜: ${err.message}</p>
                    </div>
                `;
            }
        }

        async function syncUsage() {
            const result = document.getElementById('syncResult');
            result.innerHTML = 'ë™ê¸°í™” ì¤‘...';
            
            try {
                const response = await fetch('/api/emergency/sync-my-landing-pages', {
                    method: 'POST',
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `
                        <div class="bg-green-50 p-4 rounded">
                            <p class="text-green-800 text-xl font-bold">âœ… ë™ê¸°í™” ì„±ê³µ!</p>
                            <div class="mt-4">
                                <p><strong>Email:</strong> ${data.data.user_email}</p>
                                <p><strong>Academy ID:</strong> ${data.data.academy_id}</p>
                                <p><strong>ëœë”©í˜ì´ì§€ ê°œìˆ˜:</strong> ${data.data.landing_pages_count}ê°œ</p>
                                <p><strong>Action:</strong> ${data.data.action}</p>
                            </div>
                            <button onclick="location.href='/dashboard'" class="mt-4 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                                ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                            </button>
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="bg-red-50 p-4 rounded">
                            <p class="text-red-800">âŒ ë™ê¸°í™” ì‹¤íŒ¨: ${data.error}</p>
                        </div>
                    `;
                }
            } catch (err) {
                result.innerHTML = `
                    <div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">âŒ ì˜¤ë¥˜: ${err.message}</p>
                        <p class="mt-2 text-sm">APIê°€ ì•„ì§ ë°°í¬ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
